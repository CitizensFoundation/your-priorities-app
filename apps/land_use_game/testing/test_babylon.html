<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Babylon.js Terrain Example</title>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
        padding: 0;
        margin: 0;
        overflow: hidden;
      }

      #renderCanvas {
        width: 100%;
        height: 100%;
        touch-action: none;
      }
    </style>
    <script src="https://cdn.babylonjs.com/babylon.js"></script>
    <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
  </head>
  <body>
    <canvas id="renderCanvas"></canvas>
    <script>
      const canvas = document.getElementById("renderCanvas");
      const engine = new BABYLON.Engine(canvas, true);
      function getRandomColor() {
        return new BABYLON.Color3(Math.random(), Math.random(), Math.random());
      }

      const createScene = function () {
        const scene = new BABYLON.Scene(engine);
        const camera = new BABYLON.ArcRotateCamera(
          "camera",
          Math.PI / 2,
          Math.PI / 4,
          200,
          BABYLON.Vector3.Zero(),
          scene
        );
        camera.attachControl(canvas, true);
        const light = new BABYLON.HemisphericLight(
          "light",
          new BABYLON.Vector3(0, 1, 0),
          scene
        );

        const heightmapUrl = "out/clipped_zmasl.png";
        const shadeTextureUrl = "out/clipped_shade.png";
        const daylightTextureUrl = "out/clipped_daylight.png";
        const aspectTextureUrl = "out/clipped_aspect.png";

        //const terrainMaterial = new BABYLON.StandardMaterial('terrainMaterial', scene);
        const shadeTexture = new BABYLON.Texture(shadeTextureUrl, scene);
        const daylightTexture = new BABYLON.Texture(daylightTextureUrl, scene);
        const aspectTexture = new BABYLON.Texture(aspectTextureUrl, scene);
        // Create a material with random colors
        var colorfulMaterial = new BABYLON.StandardMaterial(
          "colorfulMaterial",
          scene
        );
        colorfulMaterial.diffuseColor = getRandomColor();
        colorfulMaterial.ambientColor = getRandomColor();
        colorfulMaterial.specularColor = getRandomColor();

        //terrainMaterial.material = colorfulMaterial;

        //terrainMaterial.diffuseTexture = aspectTexture;
        //terrainMaterial.diffuseTexture.level = 0.5;
        //terrainMaterial.specularTexture = shadeTexture;
        //terrainMaterial.specularTexture.level = 0.5;
        //terrainMaterial.ambientTexture = aspectTexture;
        //terrainMaterial.ambientTexture.level = 0.5;

        const terrainOptions = {
          width: 1000,
          height: 1000,
          subdivisions: 512,
          minHeight: 0,
          maxHeight: 500,
          onReady: () => {
            scene.executeWhenReady(() => {
              engine.runRenderLoop(() => {
                scene.render();
              });
            });
          },
        };

        BABYLON.MeshBuilder.CreateGroundFromHeightMap(
          "terrain",
          heightmapUrl,
          terrainOptions,
          scene
        );

        var terrainMaterial = new BABYLON.ShaderMaterial("terrainMaterial", scene, {
          vertexElement: "./shaders/custom",
          fragmentElement: "./shaders/custom"
      },
      {
          attributes: ["position", "normal", "uv"],
          uniforms: ["world", "worldView", "worldViewProjection", "view", "projection"]
      });
        // Create a gradient texture for height-based colors
        var gradientTexture = new BABYLON.DynamicTexture(
          "gradientTexture",
          { width: 256, height: 1 },
          scene,
          false
        );
        var context = gradientTexture.getContext();
        var gradient = context.createLinearGradient(0, 0, 256, 0);

        // Define color stops for the gradient
        gradient.addColorStop(0, "blue");
        gradient.addColorStop(0.5, "green");
        gradient.addColorStop(1, "white");

        context.fillStyle = gradient;
        context.fillRect(0, 0, 256, 1);
        gradientTexture.update();

        // Set the gradient texture to the terrain material
        terrainMaterial.setTexture("gradientTexture", gradientTexture);

        // Apply the terrain material to the ground mesh
        scene.meshes[0].material = terrainMaterial;

        return scene;
      };

      const scene = createScene();

      window.addEventListener("resize", function () {
        engine.resize();
      });
    </script>
  </body>
</html>
