{"version":3,"file":"yp-dialog-ratings.js","sourceRoot":"","sources":["../../src/yp-rating/yp-dialog-ratings.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-ignore */\nimport { html, css, nothing } from \"lit\";\nimport { customElement, property } from \"lit/decorators.js\";\n\nimport { YpBaseElement } from \"../common/yp-base-element.js\";\nimport \"@material/web/button/text-button.js\";\nimport \"@material/web/dialog/dialog.js\";\n\n@customElement(\"yp-dialog-ratings\")\nexport class YpDialogRatings extends YpBaseElement {\n  @property({ type: String })\n  itemName: string | undefined;\n\n  @property({ type: Boolean })\n  isOpen = false;\n\n  @property({ type: Object })\n  post: YpPostData | undefined;\n\n  @property({ type: Object })\n  refreshFunction: Function | undefined;\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        md-dialog {\n          width: 400px;\n        }\n\n        .ratingName {\n          font-weight: bold;\n          font-size: 16px;\n          margin-bottom: 8px;\n          margin-top: 8px;\n        }\n\n        .itemHeader {\n          font-size: 22px;\n          color: var(--md-sys-color-on-primary-container);\n          background-color: var(--md-sys-color-primary-container);\n          margin-top: 0;\n          margin-bottom: 0;\n          padding: 0;\n          text-align: center;\n          padding-bottom: 10px;\n          padding-top: 10px;\n          width: 100%;\n        }\n\n        .itemName {\n          font-size: 18px;\n          font-weight: bold;\n          margin-top: 0;\n          margin-bottom: 0;\n          text-align: center;\n          padding: 16px;\n          padding-top: 16px;\n          text-decoration: underline;\n          padding-bottom: 0;\n        }\n\n        .evalIcon {\n          margin-right: 8px;\n          padding-top: 8px;\n          width: 40px;\n          height: 40px;\n        }\n\n        .itemContainer {\n          margin-bottom: 8px;\n        }\n\n        .ratingContainer {\n          margin-left: auto;\n          margin-right: auto;\n        }\n\n        @media (max-width: 600px) {\n          #ratingsDialog {\n            width: 100%;\n            height: 100%;\n            margin: 0;\n          }\n\n          yp-rating {\n            width: 100%;\n          }\n        }\n\n        md-text-button {\n          margin-bottom: 24px;\n          margin-top: 16px;\n        }\n\n        .scrollable {\n          width: 100%;\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return html`\n      <md-dialog\n        ?open=\"${this.isOpen}\"\n        id=\"ratingsDialog\"\n        class=\"layout vertical\">\n        ${\n          this.post && this.isOpen\n            ? html`\n                <div slot=\"headline\">\n                  <div class=\"itemHeader layout horizontal center-center\">\n                    <md-icon class=\"evalIcon\">rate_review</md-icon\n                    >[[t('evaluate')]]\n                  </div>\n                  <div class=\"itemName\">${this.post.name}</div>\n                </div>\n                <div\n                  class=\"ratingContainer layout vertical center-center\"\n                  slot=\"content\"\n                >\n                  ${this.post?.Group.configuration.customRatings?.map(\n                    (rating, index) => {\n                      return html`\n                        <div\n                          class=\"layout vertical self-start center-center itemContainer\"\n                        >\n                          <yp-magic-text\n                            .contentId=\"${this.post!.id}\"\n                            .extraId=\"${index}\"\n                            textOnly\n                            .content=\"${rating.name}\"\n                            .contentLanguage=\"${this.post!.Group.language}\"\n                            class=\"ratingName\"\n                            textType=\"customRatingName\"\n                          ></yp-magic-text>\n                          <yp-rating\n                            .postId=\"${this.post!.id}\"\n                            class=\"layout horizontal self-start\"\n                            .ratingIndex=\"${index}\"\n                            .emoji=\"${rating.emoji}\"\n                            .numberOf=\"${rating.numberOf}\"\n                            .rate=\"${this.getRating(index)}\"\n                            @yp-rating-add=\"${this._addRating}\"\n                            @yp-rating-delete=\"${this._deleteRating}\"\n                          >\n                          </yp-rating>\n                        </div>\n                      `;\n                    }\n                  )}\n                </div>\n                <div class=\"buttons layout horizontal center-center\" slot=\"actions\">\n                  <md-text-button\n                    class=\"closeButton\"\n                    raised\n                    click=\"${this._close}\"\n                    .label=\"${this.t(\"close\")}\"\n                  ></md-text-button>\n                </div>\n              `\n            : nothing\n        }\n      </md-dialog>\n    `;\n  }\n\n  getRating(index: number) {\n    if (\n      this.post &&\n      window.appUser.loggedIn() &&\n      window.appUser.ratingPostsIndex[this.post.id] &&\n      window.appUser.ratingPostsIndex[this.post.id][index]\n    ) {\n      return window.appUser.ratingPostsIndex[this.post.id][index].value;\n    } else {\n      return null;\n    }\n  }\n\n  _close() {\n    if (this.refreshFunction) this.refreshFunction();\n  }\n\n  _addRating(event: CustomEvent) {\n    const detail = event.detail;\n    window.appUser.updateRatingForPost(detail.postId, detail.ratingIndex, {\n      post_id: detail.postId,\n      type_index: detail.ratingIndex,\n      value: detail.rate,\n    } as YpRatingData);\n\n    window.serverApi.postRating(detail.postId, detail.ratingIndex, {\n      value: detail.rate,\n    });\n  }\n\n  _deleteRating(event: CustomEvent) {\n    const detail = event.detail;\n    window.appUser.updateRatingForPost(\n      detail.postId,\n      detail.ratingIndex,\n      undefined\n    );\n    window.serverApi.deleteRating(detail.postId, detail.ratingIndex);\n  }\n\n  async open(post: YpPostData, refreshFunction: Function) {\n    this.refreshFunction = refreshFunction;\n    this.post = post;\n    this.isOpen = false;\n    await this.requestUpdate();\n    this.isOpen = true;\n  }\n}\n"]}