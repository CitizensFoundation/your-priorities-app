{"version":3,"file":"yp-post-map.js","sourceRoot":"","sources":["../../src/yp-post/yp-post-map.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, css, nothing } from 'lit';\nimport { property, customElement, state } from 'lit/decorators.js';\n\nimport { YpBaseElement } from '../common/yp-base-element.js';\n\nimport 'lit-google-map';\nimport './yp-post-card.js';\n\nimport { ShadowStyles } from '../common/ShadowStyles.js';\n\n@customElement('yp-post-map')\nexport class YpPostMap extends YpBaseElement {\n  @property({ type: Array })\n  posts: Array<YpPostData> | undefined;\n\n  @property({ type: Number })\n  groupId: number | undefined;\n\n  @property({ type: Number })\n  communityId: number | undefined;\n\n  @property({ type: Boolean })\n  noPosts = false;\n\n  @property({ type: Object })\n  selectedPost: YpPostData | undefined;\n\n  @property({ type: Number })\n  collectionId!: number\n\n  @property({ type: String })\n  collectionType!: string\n\n  @state()\n  skipFitToMarkersNext = false\n\n  override updated(changedProperties: Map<string | number | symbol, unknown>) {\n    super.updated(changedProperties);\n\n    if (changedProperties.has('groupId')) {\n      this._groupChanged();\n    }\n\n    if (changedProperties.has('communityId')) {\n      this._communityChanged();\n    }\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      ShadowStyles,\n      css`\n        :host {\n          display: block;\n          width: 100%;\n          height: 100%;\n        }\n\n        .mapContainer {\n          margin: 0;\n          padding: 0;\n          width: 960px;\n          height: 500px;\n          margin-top: 16px;\n          margin-bottom: 48px;\n        }\n\n        .noMapContainer {\n          padding: 32px;\n          margin: 16px;\n          font-size: 22px;\n        }\n\n        #map {\n        }\n\n        a {\n        }\n\n        h1 {\n          padding: 24px;\n        }\n\n        @media (max-width: 934px) {\n          .mapContainer {\n            margin: 16px;\n            width: 800px;\n            height: 400px;\n          }\n        }\n\n        @media (max-width: 832px) {\n          .mapContainer {\n            margin: 8px;\n            width: 600px;\n            height: 340px;\n          }\n        }\n\n        @media (max-width: 632px) {\n          .mapContainer {\n            margin: 8px;\n            width: 400px;\n            height: 300px;\n          }\n        }\n\n        @media (max-width: 420px) {\n          .mapContainer {\n            margin: 8px;\n            width: 330px;\n            height: 250px;\n          }\n        }\n\n        @media (max-width: 360px) {\n          .mapContainer {\n            margin: 8px;\n            width: 280px;\n            height: 200px;\n          }\n        }\n\n        #myInfoCard {\n          background-color: var(--md-sys-color-surface-variant);\n          color: var(--md-sys-color-on-surface-variant);\n          padding: 0;\n          margin: 0 !important;\n          --yp-post-map-info-mixin: {\n            padding: 0;\n            margin: 0 !important;\n            max-width: 100%;\n            max-height: 100%;\n          }\n          --yp-post-map-info-beak-mixin: {\n            color: #f57c00;\n          }\n        }\n      `,\n    ];\n  }\n\n  renderInfoCard(post: YpPostData) {\n    return post //&& post.id==this.selectedPost.id\n      ? html` <yp-post-card mini .post=\"${post}\"></yp-post-card> `\n      : nothing;\n  }\n\n  override render() {\n    return html`\n      <div class=\"layout vertical center-center\">\n        ${this.posts\n          ? html`\n              <div\n                id=\"mapContainer\"\n                class=\"mapContainer shadow-elevation-2dp shadow-transition\">\n                <lit-google-map\n                  additionalMapOptions=\"{'keyboardShortcuts':false,'fullscreenControl': false}\"\n                  id=\"map\"\n                  version=\"weekly\"\n                  api-key=\"AIzaSyDkF_kak8BVZA5zfp5R4xRnrX8HP3hjiL0\"\n                  fit-to-markers>\n                  ${this.posts.map(\n                    post => html`\n                      <lit-google-map-marker\n                        slot=\"markers\"\n                        .latitude=\"${post.location.latitude}\"\n                        .longitude=\"${post.location.longitude}\"\n                        click-events\n                        class=\"marker\"\n                        @selector-item-activate=\"${() => {\n                          this.markerClick(post);\n                        }}\">\n\n                      </lit-google-map-marker>\n                    `\n                  )}\n                </lit-google-map>\n              </div>\n            `\n          : nothing}\n        ${this.noPosts\n          ? html`\n              <div lass=\"noMapContainer shadow-elevation-2dp shadow-transition\">\n                <div>${this.t('posts.noMapPosts')}</div>\n              </div>\n            `\n          : nothing}\n\n        <div class=\"layout horizontal center-center\">\n          <yp-ajax id=\"ajax\" @response=\"${this._response}\"></yp-ajax>\n        </div>\n      </div>\n    `;\n  }\n\n  resetMapHeight() {\n    const map = this.$$('#mapContainer');\n    if (map) {\n      const windowHeight = window.innerHeight;\n      let height;\n      if (this.wide) {\n        height = windowHeight / 1.5;\n        //map.style.height = Math.max(Math.min(height, window.innerHeight)),  + 'px';\n      } else {\n        height = windowHeight / 1.5;\n      }\n      map.style.width =\n        Math.min(window.innerWidth - (this.wide ? 96 : 32), 1920) + 'px';\n      map.style.height = height + 'px';\n      map.style.marginBottom = '64px';\n      if (this.skipFitToMarkersNext===true) {\n        this.skipFitToMarkersNext = false;\n      } else {\n        setTimeout(() => {\n          const gMap = this.$$('#map') as YpLitGoogleMapElement;\n          if (gMap) {\n            gMap.fitToMarkers = true;\n            setTimeout(() => {\n              gMap.fitToMarkers = false;\n            }, 1000);\n          }\n        });\n      }\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback()\n    switch (this.collectionType) {\n      case 'community':\n        this.communityId = this.collectionId\n        break\n      case 'group':\n        this.groupId = this.collectionId\n        break\n    }\n\n    this.addGlobalListener(\"yp-refresh-group-posts\", this._refreshAjax);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeGlobalListener(\"yp-refresh-group-posts\", this._refreshAjax);\n  }\n\n  async _groupChanged() {\n    if (this.groupId) {\n      this.posts = undefined;\n\n      this._response(\n        await window.serverApi.getPostLocations('groups', this.groupId)\n      );\n    } else {\n      this.posts = undefined;\n    }\n  }\n\n  async _communityChanged() {\n    if (this.communityId) {\n      this.posts = undefined;\n      this._response(\n        await window.serverApi.getPostLocations('communities', this.communityId)\n      );\n    } else {\n      this.posts = undefined;\n    }\n  }\n\n  _refreshAjax() {\n    if (this.groupId)\n      this._groupChanged();\n    else if (this.communityId)\n      this._communityChanged();\n    this.skipFitToMarkersNext = true;\n  }\n\n  _response(response: Array<YpPostData>) {\n    if (response && response.length > 0) {\n      this.noPosts = false;\n      this.posts = response;\n    } else {\n      this.noPosts = true;\n    }\n    setTimeout(() => {\n      this.resetMapHeight();\n    });\n  }\n\n  markerClick(post: YpPostData) {\n    debugger;\n    //TODO: Review this, if this data handling with the click makes sense and is not too slow\n    window.appGlobals.activity('clicked', 'marker');\n    this.selectedPost = post;\n    //TODO: Review and removed if the current infocard solution is working\n    /*const a = this.selectedPost;\n    if (e.srcElement) {\n      this.$$('#myInfoCard').showInfoWindow(e.srcElement.marker);\n    } else {\n      this.$$('#myInfoCard').showInfoWindow(e.currentTarget.marker);\n    }\n    const infocardDiv = this.$$('#myInfoCard').$$('#infocarddiv');\n    infocardDiv.children[1].style.zIndex = '20';\n    */\n  }\n}\n"]}