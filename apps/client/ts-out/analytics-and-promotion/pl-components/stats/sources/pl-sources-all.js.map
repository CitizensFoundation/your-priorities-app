{"version":3,"file":"pl-sources-all.js","sourceRoot":"","sources":["../../../../../src/analytics-and-promotion/pl-components/stats/sources/pl-sources-all.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, css, html, nothing } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\nimport numberFormatter from '../../util/number-formatter';\nimport { PlausibleSourcesBase } from './pl-sources-base';\n\nimport * as url from '../../util/url.js';\nimport * as api from '../../api.js';\n\nimport '../../pl-link.js';\nimport '../../stats/pl-bar.js';\nimport '../../pl-fade-in.js';\n\n@customElement('pl-sources-all')\nexport class PlausibleSourcesAll extends PlausibleSourcesBase {\n  @property({ type: String })\n  to: string | undefined = undefined;\n\n override connectedCallback() {\n    super.connectedCallback();\n    if (this.timer) this.timer.onTick(this.fetchReferrers.bind(this));\n  }\n\n  override fetchReferrers() {\n    this.loading = true;\n    this.referrers = undefined;\n\n    api\n      .get(\n        this.proxyUrl,\n        `/api/stats/${encodeURIComponent(this.site!.domain!)}/sources`,\n        this.query,\n        { show_noref: this.showNoRef }\n      )\n      .then((res: PlausibleReferrerData[]) => {\n        this.loading = false;\n        this.referrers = res;\n      });\n  }\n  static override get styles() {\n    return [...super.styles, css`\n      .directNoneIcon {\n        margin-right: 28px;\n      }\n    `];\n  }\n\n\n  renderReferrer(referrer: PlausibleReferrerData) {\n    const maxWidthDeduction = this.showConversionRate ? '10rem' : '5rem';\n\n    let translatedReferrerName;\n\n    if (referrer.name) {\n      translatedReferrerName = this.t(referrer.name);\n    }\n\n    return html`\n      <div\n        class=\"flex items-center justify-between my-1 text-sm\"\n        key=${referrer.name}\n      >\n        <pl-bar\n          .count=${referrer.visitors}\n          .all=${this.referrers}\n          bg=\"bg-blue-50 dark:bg-gray-500 dark:bg-opacity-15 faviconMargin\"\n          .maxWidthDeduction=${maxWidthDeduction}\n        >\n          <span\n            class=\"flex px-2 py-1.5 dark:text-gray-300 relative z-2 break-all\"\n          >\n            <pl-link\n              class=\"md:truncate block hover:underline\"\n              .to=${{ search: url.setQuerySearch('source', referrer.name) }}\n            >\n            ${ referrer.name !== \"Direct / None\" ? html`\n              <img\n                  src=${this.faviconUrl(referrer.name)}\n                  class=\"inline w-4 h-4 mr-2 -mt-px align-middle\"\n                />\n            ` : html`\n              <div class=\"inline w-4 h-4 mr-2 -mt-px align-middle directNoneIcon\"></div>\n            `}\n              ${translatedReferrerName}\n            </pl-link>\n          </span>\n        </pl-bar>\n        <span\n          class=\"font-medium dark:text-gray-200 w-20 text-right\"\n          tooltip=\"${referrer.visitors}\"\n          >${numberFormatter(referrer.visitors)}</span\n        >\n        ${this.showConversionRate\n          ? html`<span class=\"font-medium dark:text-gray-200 w-20 text-right\"\n              >${referrer.conversion_rate}%</span\n            >`\n          : nothing}\n      </div>\n    `;\n  }\n\n  renderList() {\n    if (this.referrers && this.referrers.length > 0) {\n      return html`\n        <div\n          class=\"flex items-center justify-between mt-3 mb-2 text-xs font-bold tracking-wide text-gray-500\"\n        >\n          <span>${this.t('Source')}</span>\n          <div class=\"text-right\">\n            <span class=\"inline-block w-20\">${this.label}</span>\n            ${this.showConversionRate\n              ? html`<span class=\"inline-block w-20\">CR</span>`\n              : nothing}\n          </div>\n        </div>\n\n        <div class=\"flex-grow\">\n          ${this.referrers.map(r => this.renderReferrer(r))}\n        </div>\n\n        <pl-more-link\n          .site=${this.site}\n          .list=${this.referrers}\n          endpoint=\"sources\"\n        ></pl-more-link>\n      `;\n    } else {\n      return html`\n        <div class=\"font-medium text-center text-gray-500 mt-44\">\n          No data yet\n        </div>\n      `;\n    }\n  }\n\n  renderContent() {\n    return html`\n      <div class=\"flex flex-col flex-grow\">\n        <div id=\"sources\" class=\"justify-between w-full flex\">\n          <h3 class=\"font-bold dark:text-gray-100\">${this.t('Top Sources')}</h3>\n          ${this.renderTabs()}\n        </div>\n        ${this.loading\n          ? html`<div class=\"mx-auto loading mt-44\">\n              <div></div>\n            </div>`\n          : nothing}\n        <pl-fade-in .show=\"${!this.loading}\" class=\"flex flex-col flex-grow\">\n          ${this.renderList()}\n        </pl-fade-in>\n      </div>\n    `;\n  }\n\n  override render() {\n    return html`\n      <div\n        class=\"relative p-4 bg-white rounded shadow-xl stats-item flex flex-col mt-6 w-full dark:bg-gray-825\"\n      >\n        ${this.renderContent()}\n      </div>\n    `;\n  }\n}\n"]}