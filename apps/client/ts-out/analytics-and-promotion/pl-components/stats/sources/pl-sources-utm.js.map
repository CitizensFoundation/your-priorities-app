{"version":3,"file":"pl-sources-utm.js","sourceRoot":"","sources":["../../../../../src/analytics-and-promotion/pl-components/stats/sources/pl-sources-utm.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, css, html, nothing } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\nimport numberFormatter from '../../util/number-formatter';\nimport { PlausibleSourcesBase, UTM_TAGS } from './pl-sources-base';\n\nimport * as url from '../../util/url.js';\nimport * as api from '../../api.js';\n\nimport '../../pl-link.js';\nimport '../../stats/pl-bar.js';\n\n@customElement('pl-sources-utm')\nexport class PlausibleSourcesUtm extends PlausibleSourcesBase {\n  @property({ type: String })\n  to: string | undefined = undefined;\n\n override connectedCallback() {\n    super.connectedCallback();\n    if (this.timer) this.timer.onTick(this.fetchReferrers.bind(this));\n  }\n\n  override fetchReferrers() {\n    const endpoint = UTM_TAGS[this.tab].endpoint;\n    this.loading = true;\n    this.referrers = undefined;\n\n    api\n      .get(\n        this.proxyUrl,\n        `/api/stats/${encodeURIComponent(this.site!.domain!)}/${endpoint}`,\n        this.query,\n        { show_noref: this.showNoRef }\n      )\n      .then(res => {\n        this.loading = false;\n        this.referrers = res;\n      });\n  }\n\n  renderReferrer(referrer: PlausibleReferrerData) {\n    const maxWidthDeduction = this.showConversionRate ? '10rem' : '5rem';\n\n    return html`\n          <div\n        class=\"flex items-center justify-between my-1 text-sm\"\n        key=${referrer.name}\n      >\n        <pl-bar\n          .count=${referrer.visitors}\n          .all=${this.referrers}\n          bg=\"bg-blue-50 dark:bg-gray-500 dark:bg-opacity-15\"\n          .maxWidthDeduction=${maxWidthDeduction}\n        >\n\n          <span class=\"flex px-2 py-1.5 dark:text-gray-300 relative z-2 break-all\">\n            <pl-link\n              class=\"md:truncate block hover:underline\"\n              .to=${{ search: url.setQuerySearch(this.tab, referrer.name) }}\n            >\n              ${referrer.name}\n           </pl-link>\n          </span>\n        </pl-bar>\n        <span class=\"font-medium dark:text-gray-200 w-20 text-right\" tooltip=${\n          referrer.visitors\n        }>${numberFormatter(referrer.visitors)}</span>\n        ${\n          this.showConversionRate\n            ? html`<span class=\"font-medium dark:text-gray-200 w-20 text-right\"\n                >${referrer.conversion_rate}%</span\n              >`\n            : nothing\n        }\n      </div>\n\n    `;\n  }\n\n  renderList() {\n    if (this.referrers && this.referrers.length > 0) {\n      return html`\n        <div class=\"flex flex-col flex-grow\">\n          <div\n            class=\"flex items-center justify-between mt-3 mb-2 text-xs font-bold tracking-wide text-gray-500 dark:text-gray-400\"\n          >\n            <span>${UTM_TAGS[this.tab].label}</span>\n            <div class=\"text-right\">\n              <span class=\"inline-block w-20\">${this.label}</span>\n              ${this.showConversionRate\n                ? html`<span class=\"inline-block w-20\">CR</span>`\n                : nothing}\n            </div>\n          </div>\n\n          <div class=\"flex-grow\">\n            ${this.referrers.map(r => this.renderReferrer(r))}\n          </div>\n          <pl-more-link\n            .site=${this.site}\n            .list=${this.referrers}\n            .endpoint=${UTM_TAGS[this.tab].endpoint}\n          ></pl-more-link>\n        </div>\n      `;\n    } else {\n      return html`<div\n        class=\"font-medium text-center text-gray-500 mt-44 dark:text-gray-400\"\n      >\n        No data yet\n      </div>`;\n    }\n  }\n\n  renderContent() {\n    return html`\n      <div class=\"flex justify-between w-full\">\n        <h3 class=\"font-bold dark:text-gray-100\">${this.t('Top Sources')}</h3>\n        ${this.renderTabs()}\n      </div>\n      ${this.loading\n        ? html` <div class=\"mx-auto loading mt-44\"><div></div></div>\n            }`\n        : nothing}\n\n      <pl-fade-in ?show=\"${!this.loading}\" class=\"flex flex-col flex-grow\">\n        ${this.renderList()}\n       </pl-fade-in>\n    `;\n  }\n\n  override render() {\n    return html`\n      <div\n        class=\"relative p-4 bg-white rounded shadow-xl stats-item flex flex-col dark:bg-gray-825 mt-6 w-full\"\n      >\n        ${this.renderContent()}\n      </div>\n    `;\n  }\n}\n"]}