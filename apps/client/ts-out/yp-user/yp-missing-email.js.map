{"version":3,"file":"yp-missing-email.js","sourceRoot":"","sources":["../../src/yp-user/yp-missing-email.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACzC,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,mBAAmB,CAAC;AAE5D,OAAO,qCAAqC,CAAC;AAC7C,OAAO,gDAAgD,CAAC;AACxD,OAAO,gCAAgC,CAAC;AAExC,OAAO,EAAE,aAAa,EAAE,MAAM,8BAA8B,CAAC;AAMtD,IAAM,cAAc,GAApB,MAAM,cAAe,SAAQ,aAAa;IAA1C;;QAQL,iBAAY,GAAG,KAAK,CAAC;QAGrB,oBAAe,GAAG,KAAK,CAAC;QAGxB,wBAAmB,GAAG,KAAK,CAAC;IA4P9B,CAAC;IA3OC,MAAM,KAAc,MAAM;QACxB,OAAO;YACL,KAAK,CAAC,MAAM;YACZ,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OA+BF;SACF,CAAC;IACJ,CAAC;IAEQ,MAAM;QACb,OAAO,IAAI,CAAA;;;+BAGgB,IAAI,CAAC,OAAO;;;6BAGd,CAAC,IAAI,CAAC,mBAAmB;iBACrC,IAAI,CAAC,CAAC,CAAC,+BAA+B,CAAC;;6BAE3B,IAAI,CAAC,mBAAmB;iBACpC,IAAI,CAAC,CAAC,CAAC,mBAAmB,CAAC;;;;;wBAKpB,IAAI,CAAC,QAAQ;;sBAEf,IAAI,CAAC,CAAC,CAAC,YAAY,CAAC;sBACpB,IAAI,CAAC,KAAK,IAAI,EAAE;kCACJ,IAAI,CAAC,iBAAiB,IAAI,EAAE;;;YAGlD,IAAI,CAAC,YAAY;YACjB,CAAC,CAAC,IAAI,CAAA;;oBAEE,IAAI,CAAC,CAAC,CAAC,4BAA4B,CAAC;;;;;4BAK5B,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC;4BACvB,IAAI,CAAC,QAAQ,IAAI,EAAE;;wCAEP,IAAI,CAAC,oBAAoB,IAAI,EAAE;;eAExD;YACH,CAAC,CAAC,OAAO;;;;wBAIG,IAAI,CAAC,OAAO;wBACZ,IAAI,CAAC,CAAC,CAAC,aAAa,CAAC;yBACpB,IAAI,CAAC,mBAAmB;;wBAEzB,IAAI,CAAC,eAAe;yBACnB,CAAC,IAAI,CAAC,YAAY;wBACnB,IAAI,CAAC,CAAC,CAAC,kBAAkB,CAAC;;;wBAG1B,IAAI,CAAC,OAAO;wBACZ,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC;yBACd,IAAI,CAAC,mBAAmB;;;;;wBAKzB,IAAI,CAAC,iBAAiB;wBACtB,IAAI,CAAC,gBAAgB;;;;;KAKxC,CAAC;IACJ,CAAC;IAED,IAAI,iBAAiB;QACnB,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;YAC1B,IAAI,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBAC7B,OAAO,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC;YAC3B,CAAC;iBAAM,CAAC;gBACN,OAAO,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;YACjC,CAAC;QACH,CAAC;aAAM,CAAC;YACN,OAAO,IAAI,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC;QACpC,CAAC;IACH,CAAC;IAED,QAAQ,CAAC,KAAoB;QAC3B,IAAI,KAAK,CAAC,OAAO,IAAI,EAAE,EAAE,CAAC;YACxB,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC1B,CAAC;IACH,CAAC;IAED,OAAO;QACL,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;QAChD,IAAI,CAAC,EAAE,CAAC,SAAS,CAAY,CAAC,KAAK,EAAE,CAAC;IACzC,CAAC;IAED,OAAO;QACL,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,QAAQ,EAAE,UAAU,CAAC,CAAC;QACjD,MAAM,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC;IAC1B,CAAC;IAED,eAAe;QACb,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,MAAM,EAAE,4BAA4B,CAAC,CAAC;QACjE,IAAI,CAAC,UAAU,CAAC,oBAAoB,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC,CAAC;IAC/D,CAAC;IAEQ,iBAAiB;QACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC1B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC;IACzC,CAAC;IAED,IAAI,WAAW;QACb,MAAM,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAc,CAAC;QAC7C,MAAM,QAAQ,GAAG,IAAI,CAAC,EAAE,CAAC,WAAW,CAAc,CAAC;QAEnD,OAAO;YACL,KAAK,EAAE,KAAK,CAAC,KAAK;YAClB,QAAQ,EAAE,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,SAAS;SAChD,CAAC;IACJ,CAAC;IAED,KAAK,CAAC,gBAAgB;QACpB,MAAM,KAAK,GAAG,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAc,CAAC;QAC7C,MAAM,QAAQ,GAAG,IAAI,CAAC,EAAE,CAAC,WAAW,CAAc,CAAC;QAEnD,IAAI,KAAK,IAAI,KAAK,CAAC,aAAa,EAAE,EAAE,CAAC;YACnC,IACE,IAAI,CAAC,YAAY;gBACjB,QAAQ;gBACR,QAAQ,CAAC,aAAa,EAAE;gBACxB,QAAQ,CAAC,KAAK,EACd,CAAC;gBACD,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,SAAS,EAAE,kBAAkB,CAAC,CAAC;gBAE1D,MAAM,QAAQ,GAAG,CAAC,MAAM,MAAM,CAAC,SAAS,CAAC,YAAY,CACnD,IAAI,CAAC,WAAW,CACjB,CAA0B,CAAC;gBAE5B,IAAI,QAAQ,CAAC,aAAa,EAAE,CAAC;oBAC3B,MAAM,CAAC,UAAU,CAAC,kBAAkB,CAClC,IAAI,CAAC,CAAC,CAAC,wBAAwB,CAAC,GAAG,GAAG,GAAG,QAAQ,CAAC,KAAK,CACxD,CAAC;oBACF,MAAM,CAAC,OAAO,CAAC,UAAU,EAAE,CAAC;oBAC5B,IAAI,CAAC,KAAK,EAAE,CAAC;gBACf,CAAC;qBAAM,CAAC;oBACN,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC,yBAAyB,CAAC,CAAC,CAAC;gBAC3D,CAAC;gBAED,wBAAwB;gBACxB,yCAAyC;YAC3C,CAAC;iBAAM,CAAC;gBACN,MAAM,CAAC,UAAU,CAAC,QAAQ,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;gBAClD,IACE,CAAC,IAAI,CAAC,yBAAyB;oBAC/B,IAAI,CAAC,yBAAyB,IAAI,KAAK,CAAC,KAAK,EAC7C,CAAC;oBACD,MAAM,QAAQ,GAAG,CAAC,MAAM,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;wBAChD,KAAK,EAAE,KAAK,CAAC,KAAK;qBACnB,CAAC,CAAuB,CAAC;oBAC1B,IAAI,QAAQ,IAAI,QAAQ,CAAC,iBAAiB,EAAE,CAAC;wBAC3C,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;wBACzB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC,CAAC,kBAAkB,CAAC,CAAC;wBAC1C,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;wBAC5B,OAAO,IAAI,CAAC;oBACd,CAAC;yBAAM,CAAC;wBACN,MAAM,CAAC,UAAU,CAAC,kBAAkB,CAClC,IAAI,CAAC,CAAC,CAAC,kBAAkB,CAAC,GAAG,GAAG,GAAG,QAAQ,CAAC,KAAK,CAClD,CAAC;wBACF,IAAI,CAAC,KAAK,EAAE,CAAC;wBACb,OAAO,IAAI,CAAC;oBACd,CAAC;oBACD,OAAO,IAAI,CAAC;oBACZ,uBAAuB;oBACvB,yCAAyC;gBAC3C,CAAC;qBAAM,CAAC;oBACN,MAAM,CAAC,UAAU,CAAC,kBAAkB,CAClC,IAAI,CAAC,CAAC,CAAC,kBAAkB,CAAC,GAAG,GAAG,GAAG,KAAK,CAAC,KAAK,CAC/C,CAAC;oBACF,IAAI,CAAC,KAAK,EAAE,CAAC;oBACb,OAAO,IAAI,CAAC;gBACd,CAAC;YACH,CAAC;QACH,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC;YACnD,OAAO,KAAK,CAAC;QACf,CAAC;QACD,OAAO,KAAK,CAAC;IACf,CAAC;IAED,IAAI,CAAC,cAAuB,EAAE,KAAa;QACzC,IAAI,CAAC,mBAAmB,GAAG,cAAc,CAAC;QAC1C,IAAI,KAAK,EAAE,CAAC;YACV,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;YACnB,IAAI,CAAC,yBAAyB,GAAG,KAAK,CAAC;QACzC,CAAC;QACA,IAAI,CAAC,EAAE,CAAC,SAAS,CAAY,CAAC,IAAI,EAAE,CAAC;QACtC,IAAI,IAAI,CAAC,mBAAmB,EAAE,CAAC;YAC7B,MAAM,CAAC,SAAS,CAAC,iBAAiB,EAAE,CAAC;QACvC,CAAC;IACH,CAAC;IAED,KAAK;QACF,IAAI,CAAC,EAAE,CAAC,SAAS,CAAY,CAAC,KAAK,EAAE,CAAC;IACzC,CAAC;CACF,CAAA;AAxQC;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;yDACW;AAGtC;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;4DACc;AAGzC;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;oDACP;AAGrB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;uDACJ;AAGxB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;2DACA;AAG5B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;iEACmB;AAG9C;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;6CACD;AAG1B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;gDACE;AAG7B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;+CACC;AAG5B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;8CACK;AA7BrB,cAAc;IAD1B,aAAa,CAAC,kBAAkB,CAAC;GACrB,cAAc,CA0Q1B","sourcesContent":["import { html, css, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport '@material/web/button/text-button.js';\nimport '@material/web/textfield/outlined-text-field.js';\nimport '@material/web/dialog/dialog.js';\n\nimport { YpBaseElement } from '../common/yp-base-element.js';\nimport { Dialog } from '@material/web/dialog/internal/dialog.js';\nimport { TextField } from '@material/web/textfield/internal/text-field.js';\n\n\n@customElement('yp-missing-email')\nexport class YpMissingEmail extends YpBaseElement {\n  @property({ type: String })\n  emailErrorMessage: string | undefined;\n\n  @property({ type: String })\n  passwordErrorMessage: string | undefined;\n\n  @property({ type: Boolean })\n  needPassword = false;\n\n  @property({ type: Boolean })\n  linkAccountText = false;\n\n  @property({ type: Boolean })\n  onlyConfirmingEmail = false;\n\n  @property({ type: String })\n  originalConfirmationEmail: string | undefined;\n\n  @property({ type: String })\n  email: string | undefined;\n\n  @property({ type: String })\n  password: string | undefined;\n\n  @property({ type: String })\n  heading: string | undefined;\n\n  @property({ type: Object })\n  target: HTMLElement | undefined;\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        md-dialog {\n          width: 420px;\n        }\n\n        .linkAccounts {\n          padding-top: 16px;\n        }\n\n        @media (max-width: 480px) {\n          md-dialog {\n            padding: 0;\n            margin: 0;\n            width: 100%;\n          }\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n\n        .buttons {\n          margin-bottom: 8px;\n          margin-right: 4px;\n          text-align: center;\n        }\n\n        .setEmailInfo {\n          font-size: 16px;\n          font-weight: bold;\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return html`\n      <div id=\"outer\">\n        <md-dialog id=\"dialog\">\n          <h2 slot=\"heading\">${this.heading}</h2>\n          <div slot=\"content\">\n          <div class=\"setEmailInfo\">\n            <span ?hidden=\"${!this.onlyConfirmingEmail}\"\n              >${this.t('user.setEmailConfirmationInfo')}</span\n            >\n            <span ?hidden=\"${this.onlyConfirmingEmail}\"\n              >${this.t('user.setEmailInfo')}</span\n            >\n          </div>\n          <md-outlined-text-field\n            id=\"email\"\n            @keydown=\"${this._onEnter}\"\n            type=\"email\"\n            .label=\"${this.t('user.email')}\"\n            .value=\"${this.email || ''}\"\n            .validationMessage=\"${this.emailErrorMessage || ''}\">\n          </md-outlined-text-field>\n\n          ${this.needPassword\n            ? html`\n                <div class=\"linkAccounts\">\n                  ${this.t('user.existsLinkAccountInfo')}\n                </div>\n                <mmd-outlined-text-field\n                  id=\"password\"\n                  type=\"password\"\n                  .label=\"${this.t('user.password')}\"\n                  .value=\"${this.password || ''}\"\n                  autocomplete=\"off\"\n                  .validationMessage=\"${this.passwordErrorMessage || ''}\">\n                </md-outlined-text-field>\n              `\n            : nothing}\n          </div>\n          <div class=\"buttons\" slot=\"actions\">\n            <md-text-button\n              @click=\"${this._logout}\"\n              .label=\"${this.t('user.logout')}\"\n              ?hidden=\"${this.onlyConfirmingEmail}\"></md-text-button>\n            <md-text-button\n              @click=\"${this._forgotPassword}\"\n              ?hidden=\"${!this.needPassword}\"\n              .label=\"${this.t('user.newPassword')}\"></md-text-button>\n            <md-text-button\n              raised\n              @click=\"${this._notNow}\"\n              .label=\"${this.t('later')}\"\n              ?hidden=\"${this.onlyConfirmingEmail}\"></md-text-button>\n            <md-text-button\n              raised\n              id=\"sendButton\"\n              autofocus\n              .label=\"${this.submitButtonLabel}\"\n              @click=\"${this._validateAndSend}\">\n            </md-text-button>\n          </div>\n        </md-dialog>\n      </div>\n    `;\n  }\n\n  get submitButtonLabel() {\n    if (!this.linkAccountText) {\n      if (this.onlyConfirmingEmail) {\n        return this.t('confirm');\n      } else {\n        return this.t('user.setEmail');\n      }\n    } else {\n      return this.t('user.linkAccount');\n    }\n  }\n\n  _onEnter(event: KeyboardEvent) {\n    if (event.keyCode == 13) {\n      this._validateAndSend();\n    }\n  }\n\n  _notNow() {\n    window.appGlobals.activity('cancel', 'setEmail');\n    (this.$$('#dialog') as Dialog).close();\n  }\n\n  _logout() {\n    window.appGlobals.activity('logout', 'setEmail');\n    window.appUser.logout();\n  }\n\n  _forgotPassword() {\n    window.appGlobals.activity('open', 'forgotPasswordFromSetEmail');\n    this.fireGlobal('yp-forgot-password', { email: this.email });\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.heading = this.t('user.setEmail');\n  }\n\n  get credentials() {\n    const email = this.$$('#email') as TextField;\n    const password = this.$$('#password') as TextField;\n\n    return {\n      email: email.value,\n      password: password ? password.value : undefined,\n    };\n  }\n\n  async _validateAndSend() {\n    const email = this.$$('#email') as TextField;\n    const password = this.$$('#password') as TextField;\n\n    if (email && email.checkValidity()) {\n      if (\n        this.needPassword &&\n        password &&\n        password.checkValidity() &&\n        password.value\n      ) {\n        window.appGlobals.activity('confirm', 'linkAccountsAjax');\n\n        const response = (await window.serverApi.linkAccounts(\n          this.credentials\n        )) as YpLinkAccountResponse;\n\n        if (response.accountLinked) {\n          window.appGlobals.notifyUserViaToast(\n            this.t('userHaveLinkedAccounts') + ' ' + response.email\n          );\n          window.appUser.checkLogin();\n          this.close();\n        } else {\n          this.fire('yp-error', this.t('user.loginNotAuthorized'));\n        }\n\n        //TODO: Do we need this?\n        //this.$$('#dialog').fire('iron-resize');\n      } else {\n        window.appGlobals.activity('confirm', 'setEmail');\n        if (\n          !this.originalConfirmationEmail ||\n          this.originalConfirmationEmail != email.value\n        ) {\n          const response = (await window.serverApi.setEmail({\n            email: email.value,\n          })) as YpSetEmailResponse;\n          if (response && response.alreadyRegistered) {\n            this.needPassword = true;\n            this.heading = this.t('user.linkAccount');\n            this.linkAccountText = true;\n            return true;\n          } else {\n            window.appGlobals.notifyUserViaToast(\n              this.t('userHaveSetEmail') + ' ' + response.email\n            );\n            this.close();\n            return true;\n          }\n          return true;\n          //TODO: If we need this\n          //this.$$('#dialog').fire('iron-resize');\n        } else {\n          window.appGlobals.notifyUserViaToast(\n            this.t('userHaveSetEmail') + ' ' + email.value\n          );\n          this.close();\n          return true;\n        }\n      }\n    } else {\n      this.fire('yp-error', this.t('user.completeForm'));\n      return false;\n    }\n    return false;\n  }\n\n  open(onlyConfirming: boolean, email: string) {\n    this.onlyConfirmingEmail = onlyConfirming;\n    if (email) {\n      this.email = email;\n      this.originalConfirmationEmail = email;\n    }\n    (this.$$('#dialog') as Dialog).show();\n    if (this.onlyConfirmingEmail) {\n      window.serverApi.confirmEmailShown();\n    }\n  }\n\n  close() {\n    (this.$$('#dialog') as Dialog).close();\n  }\n}\n"]}