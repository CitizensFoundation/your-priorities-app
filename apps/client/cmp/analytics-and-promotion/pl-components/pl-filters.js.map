{"version":3,"file":"pl-filters.js","sourceRoot":"","sources":["../../../src/analytics-and-promotion/pl-components/pl-filters.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, css, html, nothing } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\n\nimport { appliedFilters, navigateToQuery, formattedFilters } from './query';\n\nimport {\n  FILTER_GROUPS,\n  formatFilterGroup,\n  filterGroupForFilter,\n  toFilterType,\n  valueWithoutPrefix,\n} from './util/filter.js';\nimport { PlausibleBaseElementWithState } from './pl-base-element-with-state';\nimport { BrowserHistory } from './util/history';\nimport { AdjustmentsIcon, PencilIcon, SearchIcon, XIcon } from './pl-icons';\n\n@customElement('pl-filters')\nexport class PlausibleFilters extends PlausibleBaseElementWithState {\n  @property({ type: String })\n  url!: string;\n\n  @property({ type: Number })\n  viewport = 1080;\n\n  @property({ type: Number })\n  wrapped = 1; // 0=unwrapped, 1=waiting to check, 2=wrapped\n\n  @property({ type: Object })\n  history!: BrowserHistory;\n\n  @property({ type: Boolean })\n  addingFilter = false;\n\n  @property({ type: Boolean })\n  menuOpen = false;\n\n override connectedCallback() {\n    super.connectedCallback();\n    this.renderDropDown = this.renderDropDown.bind(this);\n    this.handleResize = this.handleResize.bind(this);\n    this.handleKeyup = this.handleKeyup.bind(this);\n\n    document.addEventListener('mousedown', this.handleClick, false);\n    window.addEventListener('resize', this.handleResize, false);\n    document.addEventListener('keyup', this.handleKeyup);\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    document.removeEventListener('keyup', this.handleKeyup);\n    document.removeEventListener('mousedown', this.handleClick, false);\n    window.removeEventListener('resize', this.handleResize, false);\n  }\n\n  override updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    if (changedProperties.get('query') || changedProperties.get('viewport')) {\n      this.wrapped = 1;\n    }\n\n    if (\n      changedProperties.get('wrapped') &&\n      this.wrapped === 1 &&\n      changedProperties.get('wrapped') !== -1\n    ) {\n      this.rewrapFilters();\n    }\n\n    this.rewrapFilters();\n  }\n\n  override firstUpdated() {\n    this.handleResize();\n    this.rewrapFilters();\n  }\n\n  static override get styles() {\n    return [\n      ...super.styles,\n      css`\n        .filterMain {\n          margin-right: 0px;\n          font-size: 14px;\n          color: #444;\n        }\n\n        .filterKeys {\n          padding-top: 8px;\n        }\n\n        .filterContainer {\n          padding-top: 0px;\n          padding-bottom: 0px;\n          height: 32px;\n          font-size: 12px;\n        }\n      `,\n    ];\n  }\n\n  handleClick(e: MouseEvent) {\n    if (this.menuOpen && !this.contains(e.target as Node)) {\n      this.menuOpen = false;\n    }\n    this.menuOpen = false;\n  }\n\n  removeFilter(key: string) {\n    const newOpts = {\n      [key]: false,\n    };\n    if (key === 'country') {\n      newOpts.country_name = false;\n    }\n    if (key === 'region') {\n      newOpts.region_name = false;\n    }\n    if (key === 'city') {\n      newOpts.city_name = false;\n    }\n\n    this.menuOpen = false;\n\n    navigateToQuery(this.history, this.query, newOpts as any);\n  }\n\n  clearAllFilters() {\n    const newOpts = Object.keys(this.query.filters).reduce(\n      (acc, red) => ({ ...acc, [red]: false }),\n      {}\n    );\n    navigateToQuery(this.history, this.query, newOpts as any);\n    this.menuOpen = false;\n  }\n\n  filterText(key: string, rawValue: string) {\n    const type = toFilterType(rawValue);\n    const translatedType = this.t(type);\n    const value = valueWithoutPrefix(rawValue);\n\n    if (key === 'goal') {\n      return html`${this.t('Completed goal')}: <b>${this.t(value)}</b>`;\n    }\n    if (key === 'props') {\n      const [metaKey, metaValue] = Object.entries(value)[0];\n      const eventName = this.query.filters.goal\n        ? this.query.filters.goal\n        : 'event';\n      return html`${eventName}.${metaKey} ${toFilterType(metaValue)}\n        <b>${valueWithoutPrefix(metaValue)}</b>`;\n    }\n    if (key === 'browser_version') {\n      const browserName = this.query.filters.browser\n        ? this.query.filters.browser\n        : this.t('Browser');\n      return html`${browserName}.Version ${translatedType} <b>${value}</b>`;\n    }\n    if (key === 'os_version') {\n      const osName = this.query.filters.os ? this.query.filters.os : 'OS';\n      return html`${osName}.Version ${translatedType} <b>${value}</b>`;\n    }\n    if (key === 'country') {\n      const q = new URLSearchParams(window.location.search);\n      const countryName = q.get('country_name');\n      return html`${this.t('Country')} ${translatedType} <b>${countryName}</b>`;\n    }\n\n    if (key === 'region') {\n      const q = new URLSearchParams(window.location.search);\n      const regionName = q.get('region_name');\n      return html`${this.t('Region')} ${translatedType} <b>${regionName}</b>`;\n    }\n\n    if (key === 'city') {\n      const q = new URLSearchParams(window.location.search);\n      const cityName = q.get('city_name');\n      return html`${this.t('City')} ${translatedType} <b>${cityName}</b>`;\n    }\n\n    //@ts-ignore\n    const formattedFilter = formattedFilters[key];\n\n    if (formattedFilter) {\n      return html`${this.t(formattedFilter)} ${translatedType} <b>${value}</b>`;\n    }\n\n    throw new Error(`Unknown filter: ${key}`);\n  }\n\n  renderDropdownFilter(filter: string[]) {\n    const key = filter[0];\n    const value = filter[1];\n    return html`\n      <div key=${key}>\n        <div\n          class=\"px-3 md:px-4 sm:py-2 py-3 text-sm leading-tight flex items-center justify-between\"\n          key=\"{key\"\n          +\n          value}\n        >\n          <pl-link\n            title=${`Edit filter: ${formattedFilters[key]}`}\n            .to=${{\n              pathname: `/${encodeURIComponent(\n                this.site.domain\n              )}/filter/${filterGroupForFilter(key)}`,\n              search: window.location.search,\n            }}\n            class=\"group flex w-full justify-between items-center\"\n            .style=${{ width: 'calc(100% - 1.5rem)' }}\n          >\n            <span class=\"inline-block w-full truncate\"\n              >${this.filterText(key, value)}</span\n            >\n            <div hidden\n              class=\"w-4 h-4 ml-1 cursor-pointer group-hover:text-indigo-700 dark:group-hover:text-indigo-500\"\n            >\n              ${PencilIcon}\n            </div>\n          </pl-link>\n          <b\n            title=${`Remove filter: ${formattedFilters[key]}`}\n            class=\"ml-2 cursor-pointer hover:text-indigo-700 dark:hover:text-indigo-500\"\n            @click=${() => this.removeFilter(key)}\n          >\n            <div class=\"w-4 h-4\">${XIcon}</div>\n          </b>\n        </div>\n      </div>\n    `;\n  }\n\n  filterDropdownOption(option: string) {\n    //TODO: Fix this and find what item is active\n    const active = true;\n    return html`\n      <div key=${option}>\n        <pl-link\n          .to=${{\n            pathname: `/${encodeURIComponent(\n              this.site.domain\n            )}/filter/${option}`,\n            search: window.location.search,\n          }}\n          class=\"${active\n            ? 'bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100'\n            : 'text-gray-800 dark:text-gray-300'} block px-4 py-2 text-sm font-medium\"\n        >\n          ${formatFilterGroup(option)}\n        </pl-link>\n      </div>\n    `;\n  }\n\n  renderDropdownContentOriginal() {\n    if (this.wrapped === 0 || this.addingFilter) {\n      return Object.keys(FILTER_GROUPS)\n        .filter(option =>\n          option === 'props' ? this.site.flags!.custom_dimension_filter : true\n        )\n        .map(option => this.filterDropdownOption(option));\n    } else {\n      return html`\n        <div\n          class=\"border-b border-gray-200 dark:border-gray-500 px-4 sm:py-2 py-3 text-sm leading-tight hover:text-indigo-700 dark:hover:text-indigo-500 hover:cursor-pointer\"\n          @click=${() => (this.addingFilter = true)}\n        >\n          + Add filter\n        </div>\n        ${appliedFilters(this.query).map(filter =>\n          this.renderDropdownFilter(filter)\n        )}\n        <div key=\"clear\">\n          <div\n            class=\"border-t border-gray-200 dark:border-gray-500 px-4 sm:py-2 py-3 text-sm leading-tight hover:text-indigo-700 dark:hover:text-indigo-500 hover:cursor-pointer\"\n            @click=${() => this.clearAllFilters()}\n          >\n           ${this.t(\"Clear All Filters\")}\n          </div>\n        </div>\n      `;\n    }\n  }\n\n  renderDropdownContent() {\n    if (this.wrapped === 0 || this.addingFilter) {\n      return nothing;\n    } else {\n      return html`\n        ${appliedFilters(this.query).map(filter =>\n          this.renderDropdownFilter(filter)\n        )}\n        <div key=\"clear\">\n          <div\n            class=\"pointer border-t border-gray-200 dark:border-gray-500 px-4 sm:py-2 py-3 text-sm leading-tight hover:text-indigo-700 dark:hover:text-indigo-500 hover:cursor-pointer\"\n            @click=${() => this.clearAllFilters()}\n          >\n            ${this.t(\"Clear All Filters\")}\n          </div>\n        </div>\n      `;\n    }\n  }\n\n  handleKeyup(e: KeyboardEvent) {\n    if (e.ctrlKey || e.metaKey || e.altKey) return;\n\n    if (e.key === 'Escape') {\n      this.clearAllFilters();\n    }\n  }\n\n  handleResize() {\n    this.viewport = window.innerWidth || 639;\n  }\n\n  // Checks if the filter container is wrapping items\n  rewrapFilters() {\n    const items = this.$$('#filters');\n\n    // Always wrap on mobile\n    if (appliedFilters(this.query).length > 0 && this.viewport <= 768) {\n      this.wrapped = 2;\n      return;\n    }\n\n    //this.wrapped = 0;\n\n    // Don't rewrap if we're already properly wrapped, there are no DOM children, or there is only filter\n    if (\n      this.wrapped !== 1 ||\n      !items ||\n      appliedFilters(this.query).length === 1\n    ) {\n      return;\n    }\n\n    let prevItem: { top: number };\n\n    // For every filter DOM Node, check if its y value is higher than the previous (this indicates a wrap)\n    [...items.childNodes].forEach(item => {\n      // @ts-ignore\n      if (typeof item.getBoundingClientRect === 'function') {\n        // @ts-ignore\n        const currItem = item.getBoundingClientRect();\n        if (prevItem && prevItem.top < currItem.top) {\n          this.wrapped = 2;\n        }\n        prevItem = currItem;\n      }\n    });\n  }\n\n  renderListFilter(filter: string[]) {\n    const key = filter[0];\n    const value = filter[1];\n\n    return html`\n      <div\n        .key=${key}\n        .title=${value}\n        class=\"flex bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 shadow text-sm rounded mr-2 items-center filterContainer\"\n      >\n        <pl-link\n          .title=${`Edit filter: ${formattedFilters[key]}`}\n          class=\"flex w-full h-full items-center py-2 pl-3\"\n          .to=${{\n            pathname: `/${encodeURIComponent(\n              this.site.domain\n            )}/filter/${filterGroupForFilter(key)}`,\n            search: window.location.search,\n          }}\n        >\n          <span class=\"filterKeys inline-block max-w-2xs md:max-w-xs truncate\"\n            >${this.filterText(key, value)}</span\n          >\n        </pl-link>\n        <span\n          .title=${`Remove filter: ${formattedFilters[key]}`}\n          class=\"flex h-full w-full px-2 cursor-pointer hover:text-indigo-700 dark:hover:text-indigo-500 items-center\"\n          @click=${() => this.removeFilter(key)}\n        >\n          <div class=\"w-4 h-4\">${XIcon}</div>\n        </span>\n      </div>\n    `;\n  }\n\n  renderDropdownButton() {\n    if (this.wrapped === 2) {\n      const filterCount = appliedFilters(this.query).length;\n      return html`\n        <div class=\"flex\">\n          <div class=\"-ml-1 mr-1 h-4 w-4 layout horizontal\" aria-hidden=\"true\">\n            ${AdjustmentsIcon}\n          </div>\n          <div>${filterCount} Filter${filterCount === 1 ? '' : 's'}</div>\n        </div>\n      `;\n    } else if (this.wrapped === 1) {\n      return nothing;\n    } else {\n      return html`\n        <div class=\"flex\">\n          <div class=\"ml-1 mr-1 h-4 w-4 h-4 w-4\" aria-hidden=\"true\">\n            ${SearchIcon}\n          </div>\n          <!-- This would have been a good use-case for JSX! But in the interest of keeping the breakpoint width logic with TailwindCSS, this is a better long-term way to deal with it. -->\n          <span class=\"\">Filter</span>\n        </div>\n      `;\n    }\n  }\n\n  toggleMenu() {\n    this.menuOpen = !this.menuOpen;\n  }\n\n  renderDropDown() {\n    return html`\n      <div class=\"flex\">\n        <div class=\"flex\"></div>\n        <button @click=\"${this.toggleMenu}\">\n          ${this.renderDropdownButton()}\n        </button>\n      </div>\n\n      ${this.menuOpen\n        ? html`\n            <div class=\"md:relative ml-auto\">\n              <div\n                static\n                class=\"absolute w-full left-0 right-0 md:w-72 md:absolute md:top-auto md:left-auto md:right-0 mt-2 origin-top-right z-10\"\n              >\n                <div\n                  class=\"rounded-md shadow-lg  bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5\n              font-medium text-gray-800 dark:text-gray-200\"\n                >\n                  ${this.renderDropdownContent()}\n                </div>\n              </div>\n            </div>\n          `\n        : nothing}\n    `;\n  }\n\n  renderFilterList() {\n    if (this.wrapped !== 2) {\n      return html`\n        <div id=\"filters\" class=\"flex flex-wrap\">\n          ${appliedFilters(this.query).map(filter =>\n            this.renderListFilter(filter)\n          )}\n        </div>\n      `;\n    } else {\n      return nothing;\n    }\n  }\n\n  override render() {\n    return html`\n      <div class=\"flex ml-auto pl-2 filterMain\">\n        ${this.renderFilterList()} ${this.renderDropDown()}\n      </div>\n    `;\n  }\n}\n"]}