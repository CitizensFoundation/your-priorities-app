{"version":3,"file":"YpAnalytics.js","sourceRoot":"","sources":["../../src/yp-app/YpAnalytics.ts"],"names":[],"mappings":"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","sourcesContent":["import { YpCodeBase } from '../common/YpCodeBaseclass.js'\n\nexport class YpAnalytics extends YpCodeBase {\n\n  pixelTrackerId: string | undefined;\n\n  communityTrackerId: string | undefined;\n\n  communityTrackerIds: Record<string,boolean> = {}\n\n  setupGoogleAnalytics(domain: YpDomainData) {\n    /*if (domain.public_api_keys && domain.public_api_keys && domain.public_api_keys.google && domain.public_api_keys.google.analytics_tracking_id) {\n      ga('create', domain.public_api_keys.google.analytics_tracking_id, 'auto');\n    } else if (domain.google_analytics_code && domain.google_analytics_code!=\"\") {\n      ga('create', domain.google_analytics_code, 'auto');\n    }\n    if (typeof ga == 'function') {\n      ga('set', 'anonymizeIp', true);\n      ga('send', 'pageview', location.pathname);\n      ga('set', 'nonInteraction', true);\n      setTimeout(() => {\n        ga('set', 'nonInteraction', false);\n      }, 900);\n    } else {\n      console.warn(\"Can't find Google Analytics object\");\n    }*/\n  }\n\n  facebookPixelTracking(event: string, detailedEvent: string | undefined = undefined) {\n    if (this.pixelTrackerId && event) {\n      let fbEvent;\n      if (event===\"pageview\") {\n        fbEvent=\"PageView\"\n      } else if (event===\"event\" && detailedEvent) {\n        fbEvent=detailedEvent;\n      } else {\n        fbEvent=event;\n      }\n      const image = new Image(1,1);\n      image.src = \"https://www.facebook.com/tr?id=\"+this.pixelTrackerId+\"&ev=\"+fbEvent+\"&noscript=1\";\n      console.debug(\"Have sent to Facebook pixel: \"+fbEvent)\n    }\n  }\n\n  setCommunityPixelTracker(trackerId: string | undefined) {\n    if (trackerId && trackerId!=='') {\n      if (localStorage.getItem(\"consentGivenForFacebookPixelTracking\")!=null) {\n        const oldTrackerId = this.pixelTrackerId;\n        this.pixelTrackerId = trackerId;\n        if (trackerId!==oldTrackerId) {\n          this.facebookPixelTracking('pageview');\n        }\n      } else if (!localStorage.getItem(\"disableFacebookPixelTracking\")) {\n        //TODO: Make sure is implemented\n        this.fireGlobal('yp-open-pixel-cookie-confirm', trackerId);\n      } else {\n        console.log(\"Facebook tracking disabled\");\n      }\n    } else {\n      this.pixelTrackerId = undefined;\n    }\n  }\n\n  setCommunityAnalyticsTracker(trackerId: string | undefined) {\n    trackerId = trackerId?.trim();\n    if (trackerId && trackerId.length>5) {\n      const oldTrackerId = this.communityTrackerId;\n      this.communityTrackerId=trackerId;\n      if (trackerId!==oldTrackerId) {\n        this.sendToAnalyticsTrackers('sendOnlyCommunity', 'pageview', location.pathname);\n      }\n    } else {\n      this.communityTrackerId = undefined;\n    }\n  }\n\n  sendToAnalyticsTrackers(a: string|object, b: string|object,\n                          c: string|object, d: string|object|undefined = undefined,\n                          e: string|object|undefined = undefined, f: string|object|undefined = undefined) {\n    //console.debug(\"Analytics \"+a+\" \"+b+\" \"+c+\" \"+d);\n    /*if (typeof ga == 'function') {\n      if (a!='sendOnlyCommunity') {\n        ga('send', b, c, d, e, f);\n        console.debug(\"Analytics global: send \"+b+\" \"+c+\" \"+d);\n      }\n      if (this.communityTrackerId) {\n        let sendName = 'tracker'+this.communityTrackerId.replace(/-/g,'');\n        if (!this.communityTrackerIds[this.communityTrackerId]) {\n          ga('create', this.communityTrackerId, 'auto', sendName);\n          this.communityTrackerIds[this.communityTrackerId] = true;\n          console.debug(\"Created tracker: \"+sendName);\n        }\n        sendName += '.send';\n        console.debug(\"Analytics: \"+sendName+\": \"+b+\" \"+c+\" \"+d);\n        ga(sendName, b, c, d, e, f);\n      }\n    } else {\n      console.warn(\"Google analytics message not sent for a:\"+a+\" b:\"+b+\" c:\"+c+\" d:\"+d+\" e:\"+e+\" f:\"+f);\n    }*/\n\n    if (a!='sendOnlyCommunity') {\n      this.facebookPixelTracking(b as string, c as string);\n    }\n\n    if (b===\"pageview\" && a!==\"sendOnlyCommunity\") {\n      window.appGlobals.activity('pageview', c);\n    }\n  }\n\n  sendLoginAndSignup(userId: number, eventType: string, authProvider: string, validationError: string|undefined=undefined) {\n    /*if (typeof ga == 'function') {\n      if (userId) {\n        ga('set', '&uid', userId);\n      }\n\n      let fieldsObjects;\n      let authProviderText = authProvider;\n\n      switch(eventType) {\n        case 'Signup Success':\n          fieldsObjects = {\n            'dimension1': userId,\n            'dimension2': 'Yes',\n            'dimension3': authProvider,\n            'metric1': '1'\n          };\n          break;\n        case 'Signup Fail':\n          fieldsObjects = {\n            'dimension3': authProvider,\n            'metric2': '1'\n          };\n          authProviderText += \": \"+validationError;\n          break;\n        case 'Signup Submit':\n          fieldsObjects = {\n            'dimension3': authProvider,\n            'metric3': '1'\n          };\n          break;\n        case 'Login Success':\n          fieldsObjects = {\n            'dimension1': userId,\n            'dimension2': 'Yes',\n            'dimension3': authProvider,\n            'metric4': '1'\n          };\n          break;\n        case 'Login Fail':\n          fieldsObjects = {\n            'dimension3': authProvider,\n            'metric5': '1'\n          };\n          authProviderText += \": \"+validationError;\n          break;\n        case 'Login Submit':\n          fieldsObjects = {\n            'dimension3': authProvider,\n            'metric6': '1'\n          };\n          break;\n        case 'Signup/Login Opened':\n          fieldsObjects = {\n            'metric7': '1'\n          };\n          break;\n\n      this.sendToAnalyticsTrackers('send','event','Login and Signup', eventType, authProviderText, fieldsObjects);\n    }      }*/\n  }\n}\n"]}