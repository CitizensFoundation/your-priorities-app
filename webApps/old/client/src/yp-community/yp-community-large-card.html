<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html" >
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html" >
<link rel="import" href="../../bower_components/lite-signal/lite-signal.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">

<link rel="import" href="../../bower_components/paper-material/paper-material.html">

<link rel="import" href="../yp-app-globals/yp-app-icons.html">
<link rel="import" href="../yp-behaviors/yp-language-behavior.html">
<link rel="import" href="../yp-behaviors/access-helpers.html">
<link rel="import" href="../yp-behaviors/yp-got-admin-rights-behavior.html">
<link rel="import" href="../yp-behaviors/yp-got-promoter-rights-behavior.html">
<link rel="import" href="../yp-behaviors/yp-truncate-behavior.html">

<link rel="import" href="../yp-behaviors/yp-large-card-behaviors.html">
<link rel="import" href="../yp-behaviors/yp-goto-behavior.html">
<link rel="import" href="../yp-behaviors/yp-media-formats-behavior.html">

<link rel="import" href="yp-community-behaviors.html">
<link rel="import" href="yp-community-stats.html">
<link rel="import" href="../yp-magic-text/yp-magic-text.html">

<dom-module id="yp-community-large-card">

  <template>
    <style include="iron-flex iron-flex-alignment">
      :host {
      }

      .communityAccess {
        padding-bottom: 8px;
      }

      .description {
        line-height: var(--description-line-height, 1.3);
      }

      video {
        outline: none !important;
      }


      .stats {
        position: absolute;
        bottom: 0;
        right: 8px;
      }

      .community-name {
        padding: 0;
        padding-bottom: 4px;
        padding-right: 1px;
        margin: 0;
        font-size: 24px;
        font-weight: var(--app-header-font-weight, 700);
        font-family: var(--app-header-font-family, Roboto);
      }

      .community-name[widetext] {
        font-size: 20px;
      }

      .community-name[largefont] {
        font-size: 22px;
      }

      iron-image, video {
        width: 432px;
        height: 243px;
      }

      .large-card {
        background-color: var(--app-community-large-card-background-color, #fefefe);
        color: var(--app-community-large-card-color, #333);
        height: 243px;
        width: var(--app-community-large-card-desktop-width,  432px);
        padding: 0 !important;
        margin-top: 0 !important;
      }

      @media (max-width: 945px) {
        .logo-card {
          display: var(--app-large-card-display-mobile, block);
          box-shadow: var(--app-large-card-box-shadow-mobile, var(--shadow-elevation-6dp_-_box-shadow, none));
          background-color: var(--app-large-card-background-color-mobile,#fefefe);
        }
      }

      @media (min-width: 945px) {
        .logo-card {
          display: var(--app-large-card-display-desktop, block);
          box-shadow: var(--app-large-card-box-shadow-desktop, var(--shadow-elevation-6dp_-_box-shadow, none));
          background-color: var(--app-large-card-background-color-desktop,#fefefe);
        }
      }

      .image {
        width: 432px;
        height: 243px;
      }

      .description-and-stats {
        width: 100%;
      }

      .edit {
        color: #FFF;
        position: absolute;
        top: 0;
        right: 0px;
        padding-right: 0;
        margin-right: 0;
        z-index: 200;
      }

      .contentContainer {
        @apply --layout-horizontal;
      }

      .description-and-stats {
        padding-bottom: 32px;
      }


      .description {
        padding: 0;
        margin: 0;
        z-index: 100;
      }

      .communityDescription {
        padding-left: 16px;
        padding-right: 16px;
        padding-top: 14px;
      }

      .communityDescription[widetext] {
        font-size: 14px !important;
      }

      .community-name {
        background-color: var(--primary-color-800, #000);
        color: #fafafa;
        padding-left: 16px;
        padding-top: 16px;
        padding-bottom: 16px;
        min-height: 31px;
        padding-right: 32px;
      }

      .textBox {
        margin-left: 32px;
        position: relative;
      }

      #welcomeHTML {
        width: 432px;
        max-width: 432px;
        overflow: hidden;
      }

      .k2017Image {
        height: 72px;
      }

      .k2017FeaturedImage {
        height: 85px;
      }

      .k2017extraMargin {
        margin-right: 68px;
        margin-left: 45px;
      }

      .k2017topPadding {
        padding: 8px;
      }

      .k2017topPadding a:link { color: #333 }
      .k2017topPadding a:visited { color: #333 }

      .k2017showOnlyMobile {
        display: none;
      }

      @media (max-width: 960px) {
        :host {
          max-width: 423px;
          padding: 0 !important;
          padding-top: 8px !important;
          width: 100%;
        }

        .k2017Image {
          height: 42px;
        }

        .k2017FeaturedImage {
          height: 55px;
        }

        .k2017extraMargin {
          margin-right: 52px;
          margin-left: 32px;
        }

        .k2017topPadding {
          padding-top: 4px;
        }

        .k2017hiddenMobile  {
          display: none;
        }

        .k2017showOnlyMobile {
          display: inline;
        }

        #welcomeHTML {
          width: 306px;
          max-width: 306px;
        }

        .large-card {
          width: 100%;
          height: 100%;
          margin-left: 8px;
          margin-right: 8px;
          margin-top: 8px !important;
        }

        .top-card {
          margin-bottom: 16px;
        }

        iron-image, video, .image {
          width: 100%;
          height: 230px;
        }

        .imageCard {
          height: 230px;
        }

        .imageCard[is-video] {
          background-color: transparent;
        }

        .community-name {
          font-size: 20px;
          min-height: 26px;
        }

        .communityDescription {
          padding-bottom: 8px;
        }

        .stats {
        }

        .textBox {
          margin-left: 8px;
        }
      }

      @media (max-width: 420px) {
        iron-image, video, .image {
          height: 225px;
        }

        .imageCard {
          height: 225px;
        }
      }

      @media (max-width: 400px) {
        iron-image, video, .image {
          height: 210px;
        }

        .imageCard {
          height: 210px;
        }
      }

      @media (max-width: 375px) {
        iron-image, video, .image {
          height: 207px;
        }

        .imageCard {
          height: 205px;
        }
      }

      @media (max-width: 360px) {
        iron-image, video, .image {
          height: 200px;
        }

        .imageCard {
          height: 200px;
        }
      }

      @media (max-width: 320px) {
        iron-image, video, .image {
          height: 180px;
        }

        .imageCard {
          height: 180px;
        }
      }

      [hidden] {
        display: none !important;
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      @media (min-width: 1024px) {
        #cardImage[hide-logo-box-except-mobile] {
          display: none;
        }
      }

      .logo-card[hide-box-shadow] {
        box-shadow: none;
      }

      .communityNameSimple {
        font-size: 55px;
        margin-top: 0px;
        font-family: var(--app-header-font-family, Roboto);
      }

      .communityDescriptionSimple {
        padding-top: 16px;
        line-height: 1.2;
        font-weight: bold;
        font-family: var(--app-normal-font-family, Roboto);
        font-size: 22px !important;
      }

      @media (max-width: 1024px) {
        .communityDescriptionSimple {
          padding: 16px;
          padding-bottom: 32px;
        }

        .communityNameSimple {
          font-size: 46px;
          padding: 16px;
        }
      }
    </style>

    <lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal>

    <div class="layout horizontal wrap" aria-label="[[t('community')]]" role="banner">
      <paper-material
              is-video$="[[communityVideoURL]]"
              id="cardImage"
              elevation="3"
              animated
              hide-logo-box-except-mobile$="[[community.configuration.hideLogoBoxExceptOnMobile]]"
              class="large-card logo-card imageCard top-card"
              hide-box-shadow$="[[community.configuration.hideLogoBoxShadow]]"
        >
        <div id="welcomeHTML" hidden$="[[!community.configuration.welcomeHTML]]" class="layout vertical center-center">
        </div>
        <div hidden$="[[community.configuration.welcomeHTML]]">
          <template is="dom-if" if="[[communityVideoURL]]" restamp>
            <template is="dom-if" if="[[useZiggeo]]" restamp>
              <yp-ziggeo-player
                video-token="[[communityVideoURL]]"
                video-active=true
                top-container=true
              >
              </yp-ziggeo-player>
            </template>
            <template is="dom-if" if="[[!useZiggeo]]" restamp>
              <video id="videoPlayer" data-id$="[[communityVideoId]]" controls preload="meta" class="image pointer" src="[[communityVideoURL]]" playsinline poster="[[communityVideoPosterURL]]"></video>
            </template>
          </template>
          <template is="dom-if" if="[[!communityVideoURL]]" restamp>
            <iron-image class="image" sizing="cover" alt$="[[community.name]]" src$="[[communityLogoImagePath]]"></iron-image>
          </template>
        </div>
      </paper-material>
      <template is="dom-if" if="[[useTextOnlyInfoBox]]">
        <div hidden$="[[hasCommunityAccess]]" class="large-card">
          <yp-magic-text text-type="communityName" widetext$="[[wideText]]"
                class="communityNameSimple" content-language="[[community.language]]"
                  largefont$="[[largeFont]]"
                  disable-translation="[[community.configuration.disableNameAutoTranslation]]"
                  text-only content="[[communityNameFull]]" content-id="[[community.id]]">
          </yp-magic-text>
          <yp-magic-text id="description" class="communityDescriptionSimple" widetext$="[[wideText]]"
             largefont$="[[largeFont]]" truncate="[[truncateDescriptionAmount]]" more-text="[[t('readMore')]]" close-dialog-text="[[t('close')]]"
             simple-format
             text-type="communityContent" content-language="[[community.language]]" disable-read-more="[[!useReadMoreForDescription]]"
             content="[[community.description]]" content-id="[[community.id]]">
          </yp-magic-text>
        </div>
      </template>
      <paper-material
              id="card"
              elevation="3"
              animated
              hidden$="[[hideInfoBoxExceptAdmin]]"
              class="large-card textBox"
       >
        <div class="layout vertical">
          <div class="layout horizontal wrap">
            <div class="layout vertical description-and-stats">
              <div class="description">
                <div role="heading" aria-level="1" aria-label="[[community.name]]">
                  <template is="dom-if" if="[[community]]">
                    <yp-magic-text text-type="communityName" widetext$="[[wideText]]" class="community-name" content-language="[[community.language]]"
                                   largefont$="[[largeFont]]"
                                   disable-translation="[[community.configuration.disableNameAutoTranslation]]"
                                   text-only content="[[communityNameFull]]" content-id="[[community.id]]">
                    </yp-magic-text>
                  </template>
                </div>
                <div hidden class="communityAccess">[[_communityAccessText(community.access)]]</div>
                <yp-magic-text id="description" class="communityDescription" widetext$="[[wideText]]"
                               largefont$="[[largeFont]]" truncate="[[truncateDescriptionAmount]]" more-text="[[t('readMore')]]" close-dialog-text="[[t('close')]]"
                               text-type="communityContent" content-language="[[community.language]]" disable-read-more="[[!useReadMoreForDescription]]"
                               content="[[community.description]]" content-id="[[community.id]]">
                </yp-magic-text>
              </div>
            </div>
          </div>
          <paper-menu-button class="edit" vertical-align="top" horizontal-align="[[editMenuAlign]]" hidden$="[[!showMenuItem]]">
            <paper-icon-button aria-label$="[[t('openCommunityMenu')]]" icon="more-vert" slot="dropdown-trigger"></paper-icon-button>
            <paper-listbox slot="dropdown-content" on-iron-select="_menuSelection">
              <paper-item hidden$="[[!hasCommunityAccess]]" id="editMenuItem">[[t('community.edit')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityOrPromoterAccess]]" id="openPromotionApp">[[t('analyticsAndPromotions')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccess]]" id="usersMenuItem">[[t('community.users')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccess]]" id="adminsMenuItem">[[t('community.admins')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccess]]" id="promotersMenuItem">[[t('communityPromoters')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccess]]" id="pagesMenuItem">[[t('pages.managePages')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccessAndNotFolder]]" id="moderationMenuItem">
                [[t('flaggedContent')]] <span hidden$="[[!flaggedContentCount]]">&nbsp; ([[flaggedContentCount]])</span>
              </paper-item>
              <template is="dom-if" if="[[community.configuration.enableFraudDetection]]">
                <paper-item hidden$="[[!hasCommunityAccessAndNotFolder]]" id="fraudManagementMenuItem">
                  [[t('fraudManagement')]] <span hidden hiddentempt$="[[!flaggedContentCount]]">&nbsp; ()</span>
                </paper-item>
                <paper-item hidden$="[[!hasCommunityAccess]]" id="createReportFraudReport">[[t('downloadFraudAuditReports')]]</paper-item>
              </template>
              <paper-item hidden$="[[!hasCommunityAccessAndNotFolder]]" id="moderationAllMenuItem">
                [[t('manageAllContent')]]
              </paper-item>
              <a hidden$="[[!hasCommunityAccess]]" target="_blank" href$="[[exportLoginsUrl]]"><paper-item id="exportLogins">[[t('exportLogins')]]</paper-item></a>
              <paper-item hidden$="[[!hasCommunityAccess]]" id="createReportXlsUsers">[[t('exportUsers')]]</paper-item>

              <paper-item hidden$="[[!hasCommunityAccess]]" id="deleteMenuItem">[[t('community.delete')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccessAndNotFolder]]" id="anonymizeMenuItem">[[t('anonymizeCommunityContent')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccessAndNotFolder]]" id="deleteContentMenuItem">[[t('deleteCommunityContent')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccessAndNotFolder]]" id="bulkStatusUpdateMenuItem">[[t('bulkStatusUpdate')]]</paper-item>
              <paper-item hidden$="[[!hasCommunityAccessAndNotFolder]]" id="cloneMenuItem">[[t('cloneCommunity')]]</paper-item>
              <paper-item id="addGroupMenuItem" hidden$="[[newGroupHidden]]">[[t('group.new')]]</paper-item>
              <paper-item id="addGroupFolderMenuItem" hidden$="[[newGroupHidden]]">[[t('newGroupFolder')]]</paper-item>
              <paper-item  hidden id="addCommunityFolderMenuItem">[[t('newCommunityFolder')]]</paper-item>
              <paper-item id="openAnalyticsApp" hidden$="[[!hasCommunityAccess]]">[[t('openAnalyticsApp')]]</paper-item>
              <paper-item id="openAdminApp" hidden$="[[!hasCommunityAccess]]">[[t('editTranslations')]]</paper-item>
            </paper-listbox>
          </paper-menu-button>
        </div>
        <yp-community-stats hide-groups="[[useReadMoreForDescription]]" class="stats" community="[[community]]"></yp-community-stats>
      </paper-material>
    </div>

    <template is="dom-if" if="[[community]]" restamp>
      <template is="dom-if" if="[[hasCommunityAccess]]" restamp>
        <yp-ajax hidden disable-user-error method="GET" url="/api/communities/[[community.id]]/flagged_content_count" auto on-response="_setFlaggedContentCount"></yp-ajax>
      </template>
    </template>

    <iron-media-query query="(max-width: 800px)" query-matches="{{narrowScreen}}"></iron-media-query>
    <lite-signal on-lite-signal-got-admin-rights="_gotAdminRights"></lite-signal>
    <lite-signal on-lite-signal-got-promoter-rights="_gotPromoterRights"></lite-signal>
    <lite-signal on-lite-signal-yp-pause-media-playback="_pauseMediaPlayback"></lite-signal>
  </template>

  <script>
    Polymer({
      is: 'yp-community-large-card',

      behaviors: [
        Polymer.ypLanguageBehavior,
        Polymer.CommunityBehaviors,
        Polymer.LargeCardBehaviors,
        Polymer.AccessHelpers,
        Polymer.ypGotAdminRightsBehavior,
        Polymer.ypGotPromoterRightsBehavior,
        Polymer.ypGotoBehavior,
        Polymer.ypTruncateBehavior,
        Polymer.ypMediaFormatsBehavior
      ],

      properties: {
        useTextOnlyInfoBox: {
          type: Boolean,
          value: false,
          computed: '_useTextOnlyInfoBox(community, gotAdminRights)'
        },

        community: {
          type: Object,
          observer: '_communityChanged'
        },

        hasCommunityAccess: {
          type: Boolean,
          value: false,
          computed: '_hasCommunityAccess(community, gotAdminRights)'
        },

        newGroupHidden: {
          type: Boolean,
          computed: '_newGroupHidden(community, hasCommunityAccess)'
        },

        hasCommunityPromoterAccess: {
          type: Boolean,
          value: false,
          computed: '_hasCommunityPromoterAccess(community, gotPromoterRights)'
        },

        hasCommunityOrPromoterAccess: {
          type: Boolean,
          value: false,
          computed: '_hasCommunityOrPromoterAccess(hasCommunityAccess, hasCommunityPromoterAccess)'
        },

        showMenuItem: {
          type: Boolean,
          value: false,
          computed: '_showMenuItem(hasCommunityAccess, community, hasCommunityPromoterAccess)'
        },

        communityVideoURL: {
          type: String,
          computed: '_communityVideoURL(community)'
        },

        communityVideoPosterURL: {
          type: String,
          computed: '_communityVideoPosterURL(community)'
        },

        hasCommunityAccessAndNotFolder: {
          type: Boolean,
          computed: '_hasCommunityAccessAndNotFolder(community, hasCommunityAccess)'
        },

        communityVideoId: Number,

        flaggedContentCount: {
          type: Number,
          value: null
        },

        exportLoginsUrl: {
          type: String,
          computed: '_exportLoginsUrl(hasCommunityAccess, community)'
        },

        exportUsersUrl: {
          type: String,
          computed: '_exportUsersUrl(hasCommunityAccess, community)'
        },

        useZiggeo: {
          type: Boolean,
          computed: '_useZiggeo(community)'
        },

        truncateDescriptionAmount: {
          type: Boolean,
          computed: '_truncateDescriptionAmount(community, useReadMoreForDescription)'
        },

        useReadMoreForDescription: {
          type: Boolean,
          computed: '_useReadMoreForDescription(community)'
        },

        hideInfoBoxExceptAdmin: {
          type: Boolean,
          computed: '_hideInfoBoxExceptAdmin(community, hasCommunityAccess)'
        }
      },

      _openClone: function () {
        window.appGlobals.activity('open', 'community.clone');
        Polymer.dom(document).querySelector('yp-app').getDialogAsync("apiActionDialog", function (dialog) {
          dialog.setup('/api/communities/' + this.community.id + '/clone',
            this.t('areYouSureCloneCommunity'),
            this._onCloned.bind(this), this.t('cloneCommunity'), "POST");
          dialog.open({finalDeleteWarning: false});
        }.bind(this));
      },

      _onCloned: function () {
        if (this.community.in_community_folder_id) {
          this.redirectTo("/community_folder/"+this.community.in_community_folder_id);
          this.dispatchEvent(new CustomEvent('yp-refresh-community-folder', {bubbles: true, composed: true}));
        } else {
          this.redirectTo("/domain/"+this.community.domain_id);
          this.dispatchEvent(new CustomEvent('yp-refresh-domain', {bubbles: true, composed: true}));
        }
        this.dispatchEvent(new CustomEvent('yp-refresh-admin-rights', {bubbles: true, composed: true}));
      },

      _newGroupHidden: function (community, hasCommunityAccess) {
        if (community && community.configuration && !community.configuration.only_admins_can_create_groups) {
          return false;
        } else if (community) {
          return community.is_community_folder || !hasCommunityAccess;
        } else {
          return true;
        }
      },

      _hideInfoBoxExceptAdmin: function (community, hasCommunityAccess) {
        if (hasCommunityAccess) {
          return false
        } else if (community && community.configuration && community.configuration.hideInfoBoxExceptForAdmins) {
          return true;
        } else {
          return false;
        }
      },

      _truncateDescriptionAmount: function(community, useReadMoreForDescription) {
        if (community && useReadMoreForDescription) {
          return 250;
        } else {
          return 300;
        }
      },

      _useReadMoreForDescription: function(community) {
        if (community &&
            community.configuration &&
            community.configuration.useReadMoreForDescription) {
          return true;
        } else {
          return false;
        }
      },

      _useTextOnlyInfoBox: function(community,communityAccess) {
        if (community && community.configuration && community.configuration.useTextOnlyInfoBox) {
          return true;
        } else {
          return false;
        }
      },

      _useZiggeo: function (community) {
        if (community && community.configuration) {
          return (community.configuration.useZiggeo ? true : false);
        } else {
          return false;
        }
      },

      _exportLoginsUrl: function (access, community) {
        if (access && community) {
          return '/api/communities/'+community.id+'/export_logins';
        } else {
          return null;
        }
      },

      _exportUsersUrl: function (access, community) {
        if (access && community) {
          return '/api/communities/'+community.id+'/export_users';
        } else {
          return null;
        }
      },

      _hasCommunityAccessAndNotFolder: function (community, hasCommunityAccess) {
        return (community && !community.is_community_folder && hasCommunityAccess) || false
      },

      _communityVideoURL: function (community) {
        if (community && community.configuration &&
          community.configuration.useVideoCover &&
          community.CommunityLogoVideos) {
          var videoURL = this._getVideoURL(community.CommunityLogoVideos);
          if (videoURL) {
            this.set('communityVideoId', community.CommunityLogoVideos[0].id);
            return videoURL;
          } else {
            return null;
          }
        } else {
          return null;
        }
      },

      _communityVideoPosterURL: function (community) {
        if (community && community.configuration &&
          community.configuration.useVideoCover &&
          community.CommunityLogoVideos) {
          var videoPosterURL = this._getVideoPosterURL(community.CommunityLogoVideos, community.CommunityLogoImages);
          if (videoPosterURL) {
            return videoPosterURL;
          } else {
            return null;
          }
        } else {
          return null;
        }
      },

      _showMenuItem: function (hasCommunityAccess, community, hasPromoterAccess) {
        return hasCommunityAccess || hasPromoterAccess || (community && !community.only_admins_can_create_groups)
      },

      _communityChanged: function (community, previousCommunity) {
        if (window.appGlobals.largeFont)
          this.set('largeFont', true);
        else
          this.set('largeFont', false);
        if (community && community.description) {
          this.async(function () {
            if (community.configuration && community.configuration.welcomeHTML &&
              community.configuration.welcomeHTML !== "" &&
              this.$$("#welcomeHTML")) {
                var div = document.createElement('div');
                div.innerHTML = community.configuration.welcomeHTML;
                this.$$("#welcomeHTML").innerHTML = "";
                Polymer.dom(this.$$("#welcomeHTML")).appendChild(div);
            } else if (this.$$("#welcomeHTML")) {
             this.$$("#welcomeHTML").innerHTML = "";
            }
          });

          if (window.innerWidth>480) {
            if (this.largeFont) {
              this.$$("#description").style.fontSize = "14px";
            } else if (community.description.length>250 && community.name && community.name.length>35) {
              this.$$("#description").style.fontSize = "14.3px";
            } else if (community.description.length>220 && community.name && community.name.length>30) {
              this.$$("#description").style.fontSize = "15px";
            } else {
              this.$$("#description").style.fontSize = "16px";
            }
          }
        }
        this.setupMediaEventListeners(community, previousCommunity);
      },

      _hasCommunityAccess: function(community, gotAdminRights) {
        if (community && gotAdminRights) {
          if (this.checkCommunityAccess(community)!=null) {
            return true
          } else {
            return false;
          }
        } else {
          return false;
        }
      },

      _hasCommunityPromoterAccess: function(community, gotPromoterRights) {
        if (community && gotPromoterRights) {
          return (this.checkCommunityPromoterAccess(community)!=null);
        } else {
          return false;
        }
      },

      _hasCommunityOrPromoterAccess: function (communityAccess, promoterAccess) {
        return communityAccess || promoterAccess;
      },

      _communityAccessText: function(access) {
        switch (access) {
          case 0:
            return this.t("community.public");
            break;
          case 1:
            return this.t("community.closed");
            break;
          case 2:
            return this.t("community.secret");
            break;
        }
      },

      _menuSelection: function (event, detail) {
        if (detail.item.id==="editMenuItem")
          this._openEdit();
        else if (detail.item.id==="deleteMenuItem")
          this._openDelete();
        else if (detail.item.id==="usersMenuItem")
          this._openUsersDialog();
        else if (detail.item.id==="adminsMenuItem")
          this._openAdminsDialog();
        else if (detail.item.id==="promotersMenuItem")
          this._openPromotersDialog();
        else if (detail.item.id==="pagesMenuItem")
          this._openPagesDialog();
        else if (detail.item.id==="bulkStatusUpdateMenuItem")
          this._openBulkStatusUpdates();
        else if (detail.item.id==="addGroupMenuItem")
          this.fire('yp-new-group');
        else if (detail.item.id==="addGroupFolderMenuItem")
          this.fire('yp-new-group-folder');
        else if (detail.item.id==="moderationMenuItem")
          this._openContentModeration();
        else if (detail.item.id==="fraudManagementMenuItem")
          this._openFraudManagement();
        else if (detail.item.id==="cloneMenuItem")
          this._openClone();
        else if (detail.item.id==="moderationAllMenuItem")
          this._openAllContentModeration();
        else if (detail.item.id==="anonymizeMenuItem")
          this._openAnonymizeContent();
        else if (detail.item.id==="deleteContentMenuItem")
          this._openDeleteContent();
        else if (detail.item.id==="createReportXlsUsers")
          this._openCreateXlsUsersReport();
        else if (detail.item.id==="createReportFraudReport")
          this.createReportFraudReport();
        else if (detail.item.id==="addCommunityFolderMenuItem")
          this.fire('yp-new-community-folder');
        else if (detail.item.id==="openPromotionApp")
          window.location = "/promotion/community/"+this.community.id;
        else if (detail.item.id==="openAnalyticsApp")
          window.location = "/analytics/community/"+this.community.id;
        else if (detail.item.id==="openAdminApp")
          window.location = "/admin/community/"+this.community.id;
        this.$$("paper-listbox").select(null);
      },

      _openCreateXlsUsersReport: function () {
        window.appGlobals.activity('open', 'createReportXlsUsers');
        Polymer.dom(document).querySelector('yp-app').getCreateReportAsync(function (dialog) {
          dialog.setupAndOpen("usersxls", null, this.community);
        }.bind(this));
      },

      createReportFraudReport: function () {
        window.appGlobals.activity('open', 'createReportFraudReport');
        Polymer.dom(document).querySelector('yp-app').getCreateReportAsync(function (dialog) {
          dialog.setupAndOpen("fraudAuditReport", null, this.community);
        }.bind(this));
      },

      _openContentModeration: function () {
        window.appGlobals.activity('open', 'communityContentModeration');
        Polymer.dom(document).querySelector('yp-app').getContentModerationAsync(function (dialog) {
          dialog.setup(null, this.community.id, null, false);
          dialog.open(this.community.name);
        }.bind(this));
      },

      _openFraudManagement: function () {
        window.appGlobals.activity('open', 'communityFraudManagement');
        Polymer.dom(document).querySelector('yp-app').getFraudManagementAsync(function (dialog) {
          dialog.setup(null, this.community.id, null, false);
          dialog.open(this.community.name);
        }.bind(this));
      },

      _openAllContentModeration: function () {
        window.appGlobals.activity('open', 'communityAllContentModeration');
        Polymer.dom(document).querySelector('yp-app').getContentModerationAsync(function (dialog) {
          dialog.setup(null, this.community.id, null, '/moderate_all_content');
          dialog.open(this.community.name);
        }.bind(this));
      },

      _openBulkStatusUpdates: function () {
        window.appGlobals.activity('open', 'community.bulkStatusUpdates');
        document.dispatchEvent(
          new CustomEvent("lite-signal", {
            bubbles: true,
            compose: true,
            detail: { name: 'open-bulk-status-updates', data: null }
          })
        );

        this.async(function () {
          Polymer.dom(document).querySelector('yp-app').getDialogAsync("bulkStatusUpdateGrid", function (dialog) {
            dialog.open(this.community.id);
          }.bind(this));
        });
      },

      _openUsersDialog: function () {
        window.appGlobals.activity('open', 'community.users');
        Polymer.dom(document).querySelector('yp-app').getUsersGridAsync(function (dialog) {
          dialog.setup(null, this.community.id, null, false);
          dialog.open(this.community.name);
        }.bind(this));
      },

      _openAdminsDialog: function () {
        window.appGlobals.activity('open', 'community.admins');
        Polymer.dom(document).querySelector('yp-app').getUsersGridAsync(function (dialog) {
          dialog.setup(null, this.community.id, null, true);
          dialog.open(this.community.name);
        }.bind(this));
      },

      _openPromotersDialog: function () {
        window.appGlobals.activity('open', 'communityPromoters');
        Polymer.dom(document).querySelector('yp-app').getUsersGridAsync(function (dialog) {
          dialog.setup(null, this.community.id, null, false, true);
          dialog.open(this.community.name);
        }.bind(this));
      },

      _openPagesDialog: function () {
        window.appGlobals.activity('open', 'community.pagesAdmin');
        Polymer.dom(document).querySelector('yp-app').getDialogAsync("pagesGrid", function (dialog) {
          dialog.setup(null, this.community.id, null, false);
          dialog.open();
        }.bind(this));
      },

      _openDelete: function () {
        window.appGlobals.activity('open', 'community.delete');
        Polymer.dom(document).querySelector('yp-app').getDialogAsync("apiActionDialog", function (dialog) {
          dialog.setup('/api/communities/' + this.community.id,
            this.t('communityDeleteConfirmation'),
            this._onDeleted.bind(this));
          dialog.open({finalDeleteWarning: true});
        }.bind(this));
      },

      _openDeleteContent: function () {
        window.appGlobals.activity('open', 'community.deleteContents');
        Polymer.dom(document).querySelector('yp-app').getDialogAsync("apiActionDialog", function (dialog) {
          dialog.setup('/api/communities/' + this.community.id + '/delete_content',
            this.t('communityDeleteContentConfirmation'));
          dialog.open({finalDeleteWarning: true});
        }.bind(this));
      },

      _openAnonymizeContent: function () {
        window.appGlobals.activity('open', 'community.anonymize');
        Polymer.dom(document).querySelector('yp-app').getDialogAsync("apiActionDialog", function (dialog) {
          dialog.setup('/api/communities/' + this.community.id + '/anonymize_content',
            this.t('communityAnonymizeConfirmation'), null, this.t('anonymize'));
          dialog.open({finalDeleteWarning: true});
        }.bind(this));
      },

      _openEdit: function () {
        window.appGlobals.activity('open', 'community.edit');
        Polymer.dom(document).querySelector('yp-app').getDialogAsync("communityEdit", function (dialog) {
          dialog.setup(this.community, false, this._refresh.bind(this));
          dialog.open('edit', {communityId: this.community.id});
        }.bind(this));
      },

      _onDeleted: function () {
        this.redirectTo("/domain/"+this.community.domain_id);
        this.dispatchEvent(new CustomEvent('yp-refresh-domain', {bubbles: true, composed: true}));
      },

      _refresh: function (community) {
        if (community) {
          this.set('community', community);
        }
        this.fire("update-community");
      }
    });
  </script>
</dom-module>
