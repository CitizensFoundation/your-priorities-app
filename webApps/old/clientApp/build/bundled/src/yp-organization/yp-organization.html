<link rel="import"href="../../bower_components/polymer/polymer.html"><link rel="import"href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html"><link rel="import"href="../../bower_components/lite-signal/lite-signal.html"><link rel="import"href="../../bower_components/paper-tabs/paper-tab.html"><link rel="import"href="../../bower_components/paper-tabs/paper-tabs.html"><link rel="import"href="../yp-behaviors/yp-language-behavior.html"><link rel="import"href="../yp-behaviors/yp-media-formats-behavior.html"><link rel="import"href="../yp-theme/yp-theme-behavior.html"><link rel="import"href="../yp-post/yp-post-map.html"><link rel="import"href="../yp-ajax/yp-ajax.html"><link rel="import"href="../yp-page/yp-page.html"><link rel="import"href="../yp-behaviors/yp-goto-behavior.html"><link rel="import"href="yp-organization-large-card.html"><body><dom-module id="yp-organization"><template><style include="iron-flex iron-flex-alignment">.card-container{@apply --layout-horizontal;@apply --layout-wrap;width:100%;}.card{padding:16px;}yp-ajax{background-color:var(--primary-background-color);}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><yp-page id="page"create-fab-icon="group"create-fab-title="[[t('group.add')]]"on-yp-create-fab-tap="_newGroup"><yp-organization-large-card id="organizationCard"slot="largeCard"class="largeCard card"organization="[[organization]]"on-update-organization="_refresh"></yp-organization-large-card><paper-tabs id="paper_tabs"slot="tabs"class="tabs"selected="{{selected}}"focused=""><paper-tab class="tab"><span>[[t('groups')]]</span> &nbsp; (<span>[[groups.length]]</span>)</paper-tab><paper-tab class="tab">[[t('news')]]</paper-tab><paper-tab class="tab">[[t('posts.map')]]</paper-tab></paper-tabs><iron-pages class="tabPages"slot="tabPages"selected="{{selected}}"entry-animation="fade-in-animation"exit-animation="fade-out-animation"><section><div class="layout horizontal center-center wrap"></div></section><section><template is="dom-if"if="[[mapActive]]"restamp=""><yp-post-map organization-id="[[organization.id]]"></yp-post-map></template></section></iron-pages></yp-page><yp-ajax id="ajax"url="/api/organizations"on-response="_response"></yp-ajax></template><script>Polymer({is:"yp-organization",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypThemeBehavior,Polymer.ypGotoBehavior,Polymer.ypMediaFormatsBehavior],properties:{groups:{type:Array},organizationId:{type:Number,value:null,observer:"_organizationIdChanged"},organization:{type:Object},organizationEmpty:{type:Boolean,value:!1},hideAdd:{type:Boolean,value:!0},selected:{type:Number,value:0,observer:"_selectedChanged"},tabName:{type:String,value:null,observer:"_tabNameChanged"},mapActive:{type:Boolean,value:!1}},_tabNameChanged:function(e){e&&("groups"==e?this.set("selected",0):"news"==e?this.set("selected",1):"map"==e&&this.set("selected",2))},_selectedChanged:function(e){this.organization&&(0==e?this.redirectTo("/organization/"+this.organization.id+"/groups"):1==e?this.redirectTo("/organization/"+this.organization.id+"/news"):2==e&&this.redirectTo("/organization/"+this.organization.id+"/map"))},_hideEdit:function(){return!this.organization||(!window.appUser.loggedIn()||window.appUser.user.id!=this.organization.user_id)},_organizationHeaderUrl:function(e){return this.getImageFormatUrl(e.OrganizationHeaderImages,2)},_organizationIdChanged:function(e){e&&(this.set("organization",null),this.set("groups",null),this.$$("#ajax").url="/api/organizations/"+this.organizationId,this.$$("#ajax").generateRequest(),this.hideAdd=!0)},_newGroup:function(){window.appGlobals.activity("open","newGroup"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("groupEdit",function(e){e.setup(null,!0,null),e.open("new",{organizationId:this.organizationId})}.bind(this))},_response:function(e,i){this.set("organization",i.response),this.organization.OrganizationHeaderImages&&0<this.organization.OrganizationHeaderImages.length&&this.$.page.setupTopHeaderImage(this.organization.OrganizationHeaderImages);Math.floor(3*Math.random()),this._organizationHeaderUrl(this.organization);this.set("groups",this.organization.Groups),this.async(function(){var e=this.$$("#organizationCard");e&&(e.setElevation(5),e.lowerCardLater())},20),0===i.response.Groups.length?this.organizationEmpty=!0:this.organizationEmpty=!1,this.fire("change-header",{headerTitle:this.organization.Domain.name,headerDescription:this.organization.Domain.description,headerIcon:"group-work",backPath:"/domain/"+this.organization.domain_id}),0<this.groups.length?this.hideAdd=!0:this.hideAdd=!1},defaultGroupFirst:function(e){for(var i,t=[],a=null,n=0;n<e.length;n++)"default"!=(i=e[n]).short_name?t.push(i):a=i;return t.unshift(a),t},noTestGroup:function(e){for(var i,t=[],a=0;a<e.length;a++)"test"!=(i=e[a]).short_name&&"ac-posts"!=i.short_name&&"development"!=i.short_name&&-1==i.short_name.indexOf("2012")&&-1==i.short_name.indexOf("2013")&&t.push(i);return t},_refresh:function(){this.$$("#ajax").generateRequest()},ready:function(){}})</script></dom-module>