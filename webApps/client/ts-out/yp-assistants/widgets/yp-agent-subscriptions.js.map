{"version":3,"file":"yp-agent-subscriptions.js","sourceRoot":"","sources":["../../../src/yp-assistants/widgets/yp-agent-subscriptions.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, css, nothing } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport { YpBaseElement } from \"../../common/yp-base-element.js\";\n\nimport \"@material/web/radio/radio.js\";\nimport \"@material/web/checkbox/checkbox.js\";\nimport \"@material/web/button/filled-button.js\";\nimport \"@material/web/button/outlined-button.js\";\nimport \"@material/web/progress/circular-progress.js\";\n\n// Extended interface for API response that includes relationships\ninterface YpSubscriptionPlanWithRelations extends YpSubscriptionPlanAttributes {\n  AgentProduct?: YpAgentProductAttributes;\n}\n\ninterface BundleGroup {\n  bundleId: number;\n  name: string;\n  description: string;\n  imageUrl?: string;\n  products: AgentProductWithPlan[];\n}\n\ninterface AgentProductWithPlan {\n  id: number;\n  user_id: number;\n  group_id: number;\n  domain_id: number;\n  name?: string;\n  description?: string;\n  configuration?: YpAgentProductConfiguration;\n  status?: YpAgentProductStatus;\n  plans: YpSubscriptionPlanAttributes[];\n}\n\n@customElement(\"yp-subscriptions\")\nexport class YpSubscriptions extends YpBaseElement {\n  @property({ type: Number })\n  domainId!: number;\n\n  @state()\n  private loading = true;\n\n  @state()\n  private error: string | null = null;\n\n  @state()\n  private bundleGroups: BundleGroup[] = [];\n\n  @state()\n  private selectedFreeProductId: number | null = null;\n\n  @state()\n  private selectedPaidProductIds: Set<number> = new Set();\n\n  @state()\n  private processingPayment = false;\n\n  @state()\n  private stripe: any;\n\n  @state()\n  private elements: any;\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          display: block;\n          padding: 32px;\n          max-width: 1200px;\n          margin: 0 auto;\n        }\n\n        .header {\n          margin-bottom: 48px;\n          text-align: center;\n        }\n\n        .main-title {\n          font-size: 48px;\n          font-weight: 800;\n          margin-bottom: 16px;\n          color: var(--md-sys-color-on-surface);\n          line-height: 1.2;\n        }\n\n        .main-title .highlight {\n          color: #2ecc71;\n        }\n\n        .subtitle {\n          font-size: 20px;\n          color: var(--md-sys-color-on-surface-variant);\n          margin: 0;\n        }\n\n        .agents-container {\n          display: flex;\n          flex-direction: column;\n          gap: 24px;\n        }\n\n        .agent-card {\n          display: flex;\n          align-items: center;\n          gap: 24px;\n          padding: 24px;\n          border-radius: 16px;\n          background: var(--md-sys-color-surface-container);\n          transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;\n          cursor: pointer;\n          position: relative;\n          overflow: hidden;\n        }\n\n        .agent-card:hover {\n          transform: translateY(-2px);\n          box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);\n        }\n\n        .agent-card:before {\n          content: '';\n          position: absolute;\n          top: 0;\n          left: 0;\n          right: 0;\n          height: 4px;\n          background: linear-gradient(90deg, #2ecc71, #3498db);\n          opacity: 0;\n          transition: opacity 0.2s ease-in-out;\n        }\n\n        .agent-card:hover:before {\n          opacity: 1;\n        }\n\n        .agent-number {\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          background: #f1c40f;\n          color: black;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-weight: bold;\n          font-size: 20px;\n          flex-shrink: 0;\n          transition: transform 0.3s ease-in-out;\n        }\n\n        .agent-card:hover .agent-number {\n          transform: rotate(360deg);\n        }\n\n        .agent-image {\n          width: 80px;\n          height: 80px;\n          border-radius: 50%;\n          object-fit: cover;\n          flex-shrink: 0;\n          border: 3px solid var(--md-sys-color-outline);\n          transition: border-color 0.2s ease-in-out;\n        }\n\n        .agent-card:hover .agent-image {\n          border-color: #2ecc71;\n        }\n\n        .agent-content {\n          flex-grow: 1;\n        }\n\n        .agent-title {\n          font-size: 24px;\n          font-weight: 600;\n          margin: 0 0 8px 0;\n          display: flex;\n          align-items: center;\n          gap: 8px;\n        }\n\n        .agent-type {\n          color: var(--md-sys-color-outline);\n          font-weight: normal;\n          font-size: 0.8em;\n          padding: 2px 8px;\n          background: var(--md-sys-color-surface-variant);\n          border-radius: 12px;\n        }\n\n        .agent-description {\n          color: var(--md-sys-color-on-surface-variant);\n          margin: 0;\n          font-size: 16px;\n          line-height: 1.5;\n        }\n\n        .selection-control {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n          align-items: flex-end;\n        }\n\n        .pricing-tag {\n          background: var(--md-sys-color-primary-container);\n          color: var(--md-sys-color-on-primary-container);\n          padding: 4px 12px;\n          border-radius: 16px;\n          font-size: 14px;\n          font-weight: 500;\n        }\n\n        .free-tag {\n          background: #2ecc71;\n          color: white;\n        }\n\n        .payment-section {\n          margin-top: 32px;\n          padding: 24px;\n          border-radius: 16px;\n          background: var(--md-sys-color-surface-container-high);\n        }\n\n        .action-button {\n          width: 100%;\n          max-width: 320px;\n          margin: 32px auto 0;\n          display: block;\n        }\n\n        @media (max-width: 768px) {\n          .agent-card {\n            flex-direction: column;\n            text-align: center;\n            padding: 16px;\n          }\n\n          .selection-control {\n            align-items: center;\n            margin-top: 16px;\n          }\n\n          .agent-content {\n            text-align: center;\n          }\n\n          .agent-title {\n            justify-content: center;\n            flex-wrap: wrap;\n          }\n        }\n      `\n    ];\n  }\n\n  private renderHeader() {\n    return html`\n      <div class=\"header\">\n        <h1 class=\"main-title\">\n          AI agents that make the\n          <span class=\"highlight\">impossible</span>\n          possible\n        </h1>\n        <p class=\"subtitle\">You pick the Agents you need and run them on your schedule</p>\n      </div>\n    `;\n  }\n\n  private processPlanData(plans: YpSubscriptionPlanWithRelations[]) {\n    const bundleMap = new Map<number, BundleGroup>();\n\n    plans.forEach(plan => {\n      const product = plan.AgentProduct;\n      if (!product) return;\n\n      product.AgentBundles?.forEach(bundle => {\n        if (!bundleMap.has(bundle.id)) {\n          bundleMap.set(bundle.id, {\n            bundleId: bundle.id,\n            name: bundle.name,\n            description: bundle.description || '',\n            imageUrl: bundle.configuration?.imageUrl,\n            products: []\n          });\n        }\n\n        const bundleGroup = bundleMap.get(bundle.id)!;\n        const existingProduct = bundleGroup.products.find(p => p.id === product.id);\n\n        if (existingProduct) {\n          existingProduct.plans.push(plan);\n        } else {\n          bundleGroup.products.push({\n            id: product.id,\n            user_id: product.user_id,\n            group_id: product.group_id,\n            domain_id: product.domain_id,\n            name: product.name,\n            description: product.description,\n            configuration: product.configuration,\n            status: product.status,\n            plans: [plan]\n          });\n        }\n      });\n    });\n\n    this.bundleGroups = Array.from(bundleMap.values());\n  }\n\n  private handleProductSelect(productId: number, isFree: boolean) {\n    if (isFree) {\n      this.handleFreeProductSelect(productId);\n    } else {\n      this.handlePaidProductSelect(productId);\n    }\n  }\n\n  private renderAgent(product: AgentProductWithPlan, index: number) {\n    const freePlan = product.plans.find(plan => plan.configuration.type === 'free');\n    const paidPlans = product.plans.filter(plan => plan.configuration.type === 'paid');\n\n    return html`\n      <div class=\"agent-card\" @click=${() => this.handleProductSelect(product.id, freePlan !== undefined)}>\n        <div class=\"agent-number\">${index + 1}</div>\n        <img\n          class=\"agent-image\"\n          src=\"${product.plans[0].configuration?.imageUrl}\"\n          alt=\"${product.name || ''}\"\n        >\n        <div class=\"agent-content\">\n          <h3 class=\"agent-title\">\n            ${product.name}\n            <span class=\"agent-type\">Agent</span>\n          </h3>\n          <p class=\"agent-description\">${product.description}</p>\n        </div>\n        <div class=\"selection-control\">\n          ${freePlan\n            ? html`\n                <md-checkbox\n                  ?checked=${this.selectedFreeProductId === product.id}\n                  @change=${() => this.handleFreeProductSelect(product.id)}\n                ></md-checkbox>\n                <div class=\"pricing-tag free-tag\">Free Trial</div>\n              `\n            : html`\n                <md-radio\n                  ?checked=${this.selectedPaidProductIds.has(product.id)}\n                  @change=${() => this.handlePaidProductSelect(product.id)}\n                ></md-radio>\n                ${paidPlans.map(plan => html`\n                  <div class=\"pricing-tag\">\n                    ${plan.configuration.amount} ${plan.configuration.currency}/${plan.configuration.billing_cycle}\n                  </div>\n                `)}\n              `\n          }\n        </div>\n      </div>\n    `;\n  }\n\n  override render() {\n    if (this.loading) {\n      return html`\n        <div class=\"loading-container\">\n          <md-circular-progress indeterminate></md-circular-progress>\n        </div>\n      `;\n    }\n\n    if (this.error) {\n      return html`\n        <div class=\"error-message\">\n          ${this.error}\n        </div>\n      `;\n    }\n\n    const allProducts = this.bundleGroups.flatMap(group => group.products);\n\n    return html`\n      ${this.renderHeader()}\n      <div class=\"agents-container\">\n        ${allProducts.map((product, index) => this.renderAgent(product, index))}\n      </div>\n\n      ${this.selectedPaidProductIds.size > 0 ? html`\n        <div class=\"payment-section\">\n          <div id=\"payment-element\"></div>\n        </div>\n      ` : nothing}\n\n      <md-filled-button\n        class=\"action-button\"\n        ?disabled=${this.processingPayment ||\n          (!this.selectedFreeProductId && this.selectedPaidProductIds.size === 0)}\n        @click=${this.handleSubscribe}\n      >\n        ${this.processingPayment\n          ? html`<md-circular-progress indeterminate></md-circular-progress>`\n          : 'Get Started'}\n      </md-filled-button>\n    `;\n  }\n\n  constructor() {\n    super();\n    this.initializeStripe();\n  }\n\n  async initializeStripe() {\n    /*const stripeKey = import.meta.env.VITE_STRIPE_PUBLIC_KEY;\n    if (!stripeKey) {\n      console.error('Stripe public key not found');\n      return;\n    }\n\n    this.stripe = await loadStripe(stripeKey);*/\n  }\n\n  override async firstUpdated() {\n    try {\n      await this.loadSubscriptionPlans();\n    } catch (error) {\n      console.error('Error loading subscription plans:', error);\n      this.error = 'Failed to load subscription plans';\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  private async loadSubscriptionPlans() {\n    const response = await fetch('/api/subscriptions/plans');\n    if (!response.ok) throw new Error('Failed to fetch subscription plans');\n\n    const plans = await response.json();\n    this.processPlanData(plans);\n  }\n\n  private handleFreeProductSelect(productId: number) {\n    this.selectedFreeProductId = this.selectedFreeProductId === productId ? null : productId;\n  }\n\n  private handlePaidProductSelect(productId: number) {\n    if (this.selectedPaidProductIds.has(productId)) {\n      this.selectedPaidProductIds.delete(productId);\n    } else {\n      this.selectedPaidProductIds.add(productId);\n    }\n    this.selectedPaidProductIds = new Set(this.selectedPaidProductIds);\n  }\n\n  private async handleSubscribe() {\n    if (!this.selectedFreeProductId && this.selectedPaidProductIds.size === 0) {\n      this.error = 'Please select at least one product';\n      return;\n    }\n\n    if (this.selectedFreeProductId) {\n      await this.handleFreeSubscription();\n    } else {\n      await this.handlePaidSubscription();\n    }\n  }\n\n  private async handleFreeSubscription() {\n    try {\n      const response = await fetch('/api/subscriptions', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          productId: this.selectedFreeProductId,\n          type: 'free'\n        })\n      });\n\n      if (!response.ok) throw new Error('Failed to create subscription');\n\n      window.location.href = `/domain/${this.domainId}/assistant`;\n    } catch (error) {\n      console.error('Error creating free subscription:', error);\n      this.error = 'Failed to create subscription';\n    }\n  }\n\n  private async handlePaidSubscription() {\n    if (!this.stripe) {\n      this.error = 'Payment system not initialized';\n      return;\n    }\n\n    try {\n      this.processingPayment = true;\n\n      // Create payment intent\n      const response = await fetch('/api/subscriptions/payment-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          productIds: Array.from(this.selectedPaidProductIds)\n        })\n      });\n\n      if (!response.ok) throw new Error('Failed to create payment intent');\n\n      const { clientSecret } = await response.json();\n\n      // Confirm payment\n      const { error } = await this.stripe.confirmPayment({\n        elements: this.elements,\n        clientSecret,\n        confirmParams: {\n          return_url: `${window.location.origin}/domain/${this.domainId}/assistant`,\n        },\n      });\n\n      if (error) {\n        throw new Error(error.message);\n      }\n    } catch (error: any) {\n      console.error('Payment error:', error);\n      this.error = error.message || 'Payment failed';\n    } finally {\n      this.processingPayment = false;\n    }\n  }\n}"]}