{"version":3,"file":"yp-agent-run-widget.js","sourceRoot":"","sources":["../../../src/yp-assistants/widgets/yp-agent-run-widget.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAc,IAAI,EAAE,GAAG,EAAE,MAAM,KAAK,CAAC;AAC5C,OAAO,EAAE,aAAa,EAAE,QAAQ,EAAS,MAAM,mBAAmB,CAAC;AACnE,OAAO,EAAE,aAAa,EAAE,MAAM,8BAA8B,CAAC;AAGtD,IAAM,gBAAgB,GAAtB,MAAM,gBAAiB,SAAQ,aAAa;IAA5C;;QAWL,cAAS,GAAG,EAAE,CAAC;QAGf,qBAAgB,GAAG,EAAE,CAAC;QAGtB,kBAAa,GAAG,EAAE,CAAC;QAGnB,mBAAc,GAAG,OAAO,CAAC;IAiU3B,CAAC;IAzTC,IAAI,cAAc;QAChB,IAAI,CAAC;YACH,MAAM,eAAe,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC5C,OAAO,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC;QACrC,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,qCAAqC,EAAE,KAAK,CAAC,CAAC;YAC5D,OAAO,EAAE,gBAAgB,EAAE,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;QAC5C,CAAC;IACH,CAAC;IAED,MAAM,KAAc,MAAM;QACxB,OAAO;YACL,KAAK,CAAC,MAAM;YACZ,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OA+HF;SACF,CAAC;IACJ,CAAC;IAEO,YAAY,CAAC,KAAa;QAChC,IAAI,IAAI,CAAC,cAAc,KAAK,aAAa,EAAE,CAAC;YAC1C,OAAO,EAAE,CAAC;QACZ,CAAC;QACD,IAAI,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,gBAAgB,EAAE,CAAC;YACjD,OAAO,gBAAgB,CAAC;QAC1B,CAAC;QACD,IAAI,KAAK,KAAK,IAAI,CAAC,cAAc,CAAC,gBAAgB,EAAE,CAAC;YACnD,OAAO,IAAI,CAAC,cAAc,KAAK,SAAS,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE,CAAC;QAChE,CAAC;QACD,OAAO,eAAe,CAAC;IACzB,CAAC;IAEO,UAAU,CAAC,IAAoB,EAAE,KAAa,EAAE,UAAmB;QACzE,MAAM,SAAS,GAAG,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;QAE3C,MAAM,eAAe,GAAG,IAAI,CAAA;MAC1B,IAAI,CAAC,mBAAmB,WAAW,IAAI,CAAC,aAAa,EAAE,CAAC;QAE1D,QAAQ,CAAC;QAET,MAAM,QAAQ,GAAG,UAAU,IAAI,IAAI,CAAC,cAAc,KAAK,SAAS,CAAC;QAEjE,OAAO,IAAI,CAAA;;;;;2BAKY,CAAC,QAAQ;;gCAEJ,IAAI,CAAC,mBAAmB;qBACnC,IAAI,CAAC,aAAa;;cAEzB,KAAK,GAAG,CAAC;;;;cAIT,IAAI,CAAC,IAAI,KAAK,8BAA8B;YAC5C,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC;YAC1B,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,CAAC;;;;+CAII,CAAC,QAAQ;;qCAEnB,IAAI,CAAC,SAAS;;;;KAI9C,CAAC;IACJ,CAAC;IAEO,UAAU,CAAC,IAA0B;QAC3C,OAAO,IAAI,KAAK,OAAO;YACrB,CAAC,CAAC,IAAI,CAAA;;;;;;;;;;;;;;;;;;;;;;;;eAwBG;YACT,CAAC,CAAC,IAAI,CAAA;;;;;;;;;;;;eAYG,CAAC;IACd,CAAC;IAEO,iBAAiB;QACvB,OAAO,IAAI,CAAA;wCACyB,IAAI,CAAC,CAAC,CAAC,iBAAiB,CAAC;;;UAGvD,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,CAAC,CAAC,iBAAiB,CAAC;;WAEhD,CAAC;IACV,CAAC;IAED,IAAI,uBAAuB;QACzB,OAAO,IAAI,CAAC,cAAc,KAAK,SAAS,CAAC;IAC3C,CAAC;IAED,IAAI,wBAAwB;QAC1B,OAAO,IAAI,CAAC,cAAc,KAAK,SAAS,CAAC;IAC3C,CAAC;IAED,IAAI,SAAS;QACX,OAAO,IAAI,CAAC,cAAc,KAAK,SAAS,CAAC;IAC3C,CAAC;IAED,wBAAwB;QACtB,OAAO,IAAI,CAAA,0CAA0C,CAAC;IACxD,CAAC;IAED,sBAAsB;QACpB,OAAO,IAAI,CAAA;QACP,IAAI,CAAC,SAAS;YACd,CAAC,CAAC,IAAI,CAAA;;eAEC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC;YAClB;YACJ,CAAC,CAAC,IAAI,CAAA;;wBAEU,IAAI,CAAC,wBAAwB;;eAEtC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC;YAClB;;;;oBAIQ,IAAI,CAAC,uBAAuB;uEACuB,IAAI,CAAC,CAAC,CACnE,MAAM,CACP;;WAEE,CAAC;IACV,CAAC;IAEQ,MAAM;QACb,IACE,CAAC,IAAI,CAAC,QAAQ;YACd,CAAC,IAAI,CAAC,cAAc,CAAC,KAAK;YAC1B,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,EACtC,CAAC;YACD,OAAO,IAAI,CAAA,gDAAgD,CAAC;QAC9D,CAAC;QAED,OAAO,IAAI,CAAA;;UAEL,IAAI,CAAC,iBAAiB,EAAE,IAAI,IAAI,CAAC,sBAAsB,EAAE;;YAEvD,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,EAAE,CAC9C,IAAI,CAAC,UAAU,CACb,IAAI,EACJ,KAAK,EACL,KAAK,KAAK,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAC/C,CACF;;UAED,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,wBAAwB,EAAE;;KAEtD,CAAC;IACJ,CAAC;CACF,CAAA;AAnVC;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;wDACH;AAGxB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;+CACZ;AAGf;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;iDACV;AAGjB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;mDACZ;AAGf;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;0DACL;AAGtB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;uDACR;AAGnB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;wDACF;AAGzB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;kDACT;AAGlB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;yDACF;AA1Bd,gBAAgB;IAD5B,aAAa,CAAC,qBAAqB,CAAC;GACxB,gBAAgB,CAqV5B","sourcesContent":["import { LitElement, html, css } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport { YpBaseElement } from \"../../common/yp-base-element\";\n\n@customElement(\"yp-agent-run-widget\")\nexport class YpAgentRunWidget extends YpBaseElement {\n  @property({ type: Number })\n  agentProductId!: number;\n\n  @property({ type: Number })\n  runId!: number;\n\n  @property({ type: Number })\n  agentId!: number;\n\n  @property({ type: String })\n  agentName = \"\";\n\n  @property({ type: String })\n  agentDescription = \"\";\n\n  @property({ type: String })\n  agentImageUrl = \"\";\n\n  @property({ type: String })\n  workflowStatus = \"ready\";\n\n  @property({ type: String })\n  workflow!: string;\n\n  @property({ type: Number })\n  maxRunsPerCycle!: number;\n\n  get parsedWorkflow(): YpWorkflowConfiguration {\n    try {\n      const decodedWorkflow = atob(this.workflow);\n      return JSON.parse(decodedWorkflow);\n    } catch (error) {\n      console.error(\"Failed to decode or parse workflow:\", error);\n      return { currentStepIndex: 0, steps: [] };\n    }\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n        }\n\n        .container {\n          padding: 16px;\n          border: 1px solid var(--md-sys-color-outline-variant);\n          border-radius: 4px;\n          width: 100%;\n          min-width: 700px;\n        }\n\n        .workflow-step {\n          width: calc(241px - 20px);\n          height: calc(158px - 24px);\n          max-height: calc(86px - 24px);\n          padding: 12px;\n          border: 1px solid var(--md-sys-color-outline-variant);\n          border-radius: 4px;\n          margin-right: 24px;\n          margin-top: 12px;\n          margin-bottom: 12px;\n        }\n\n        .agent-header-title {\n          font-size: 22px;\n          font-weight: 700;\n          color: var(--md-sys-color-on-surface);\n          font-family: var(--md-ref-typeface-brand);\n        }\n\n        .startStopButtons {\n          margin-top: 24px;\n          margin-bottom: 16px;\n        }\n\n        md-outlined-button {\n          --md-outlined-button-icon-size: 26px;\n        }\n\n        md-filled-button {\n          --md-filled-button-icon-size: 26px;\n        }\n\n        .max-runs-per-cycle {\n          font-size: 13px;\n          color: var(--md-sys-color-tertiary);\n          text-transform: uppercase;\n          font-weight: 500;\n          margin-top: 4px;\n        }\n\n        @media (max-width: 700px) {\n          .container {\n            min-width: 100%;\n          }\n\n          .workflow-step {\n            margin: 8px;\n          }\n        }\n\n        .step-number {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          width: 31px;\n          height: 31px;\n          font-weight: 600;\n          border-radius: 50%;\n          font-size: 15px;\n          flex-shrink: 0;\n          transition: background-color 0.3s ease;\n        }\n\n        .step-number[isNotActive] {\n          background-color: #eaeaea !important;\n          color: var(--yp-sys-color-agent-black) !important;\n        }\n\n        .startButton {\n          margin-right: 24px;\n        }\n\n        .startButton,\n        .stopButton {\n          width: 130px;\n        }\n\n        .startButtonFilled {\n          --md-filled-button-disabled-container-color: var(\n            --yp-sys-color-agent-green\n          );\n          --md-filled-button-disabled-label-text-color: #fff;\n          --md-filled-button-disabled-container-opacity: 1;\n          --md-filled-button-disabled-label-text-opacity: 1;\n          --md-filled-button-disabled-icon-color: #fff;\n          --md-filled-button-disabled-icon-opacity: 1;\n          --md-sys-color-on-primary: #ffffff;\n        }\n\n        .step-content[notActive] {\n          opacity: 0.5;\n        }\n\n        .step-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: 0px;\n        }\n\n        .step-title {\n          font-size: 15px;\n          font-family: var(--md-ref-typeface-brand);\n          font-weight: 600;\n          line-height: 22.68px;\n          margin-top: 12px;\n          margin-bottom: 0px;\n        }\n\n        .step-icon {\n          width: 20px;\n          height: 20px;\n          color: var(--md-sys-color-outline);\n          fill: currentColor;\n        }\n      `,\n    ];\n  }\n\n  private getStepClass(index: number): string {\n    if (this.workflowStatus === \"not_started\") {\n      return \"\";\n    }\n    if (index < this.parsedWorkflow.currentStepIndex) {\n      return \"step-completed\";\n    }\n    if (index === this.parsedWorkflow.currentStepIndex) {\n      return this.workflowStatus === \"running\" ? \"step-active\" : \"\";\n    }\n    return \"step-disabled\";\n  }\n\n  private renderStep(step: YpWorkflowStep, index: number, isSelected: boolean) {\n    const stepClass = this.getStepClass(index);\n\n    const activeStepStyle = html`background-color:\n    ${step.stepBackgroundColor};color: ${step.stepTextColor}`;\n\n    debugger;\n\n    const isActive = isSelected && this.workflowStatus !== \"running\";\n\n    return html`\n      <div class=\"workflow-step layout vertical\">\n        <div class=\"layout horizontal\">\n          <div\n            class=\"step-number\"\n            ?isNotActive=${!isActive}\n            style=\"\n            background-color: ${step.stepBackgroundColor};\n            color: ${step.stepTextColor}\"\n          >\n            ${index + 1}\n          </div>\n          <div class=\"flex\"></div>\n          <div>\n            ${step.type === \"engagmentFromOutputConnector\"\n              ? this.renderIcon(\"users\")\n              : this.renderIcon(\"sparkles\")}\n          </div>\n        </div>\n\n        <div class=\"step-content\" ?notActive=${!isActive}>\n          <div class=\"step-header\">\n            <h3 class=\"step-title\">${step.shortName}</h3>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderIcon(type: \"users\" | \"sparkles\") {\n    return type === \"users\"\n      ? html`<svg\n          class=\"step-icon\"\n          width=\"20\"\n          height=\"20\"\n          viewBox=\"0 0 20 20\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M13.8918 10.9417C15.0335 11.7167 15.8335 12.7667 15.8335 14.1667V16.6667H19.1668V14.1667C19.1668 12.35 16.1918 11.275 13.8918 10.9417Z\"\n            fill=\"currentColor\"\n          />\n          <path\n            d=\"M12.5002 10C14.3418 10 15.8335 8.50837 15.8335 6.66671C15.8335 4.82504 14.3418 3.33337 12.5002 3.33337C12.1085 3.33337 11.7418 3.41671 11.3918 3.53337C12.0835 4.39171 12.5002 5.48337 12.5002 6.66671C12.5002 7.85004 12.0835 8.94171 11.3918 9.80004C11.7418 9.91671 12.1085 10 12.5002 10Z\"\n            fill=\"currentColor\"\n          />\n          <path\n            d=\"M7.50016 10C9.34183 10 10.8335 8.50837 10.8335 6.66671C10.8335 4.82504 9.34183 3.33337 7.50016 3.33337C5.6585 3.33337 4.16683 4.82504 4.16683 6.66671C4.16683 8.50837 5.6585 10 7.50016 10ZM7.50016 5.00004C8.41683 5.00004 9.16683 5.75004 9.16683 6.66671C9.16683 7.58337 8.41683 8.33337 7.50016 8.33337C6.5835 8.33337 5.8335 7.58337 5.8335 6.66671C5.8335 5.75004 6.5835 5.00004 7.50016 5.00004Z\"\n            fill=\"currentColor\"\n          />\n          <path\n            d=\"M7.50016 10.8334C5.27516 10.8334 0.833496 11.95 0.833496 14.1667V16.6667H14.1668V14.1667C14.1668 11.95 9.72516 10.8334 7.50016 10.8334ZM12.5002 15H2.50016V14.175C2.66683 13.575 5.25016 12.5 7.50016 12.5C9.75016 12.5 12.3335 13.575 12.5002 14.1667V15Z\"\n            fill=\"currentColor\"\n          />\n        </svg>`\n      : html`<svg\n          class=\"step-icon\"\n          width=\"20\"\n          height=\"20\"\n          viewBox=\"0 0 20 20\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M19.9994 10.0001C15.0056 10.0001 10.0117 5.01187 10 0.0177776V0.000277886C10 0.00305563 9.99972 0.00611118 9.99972 0.00888892C9.99972 0.0058334 9.99944 0.00305551 9.99944 0V0.0174999C9.98778 5.01187 4.99417 10.0001 0 10.0001C5 10.0001 10 15.0001 10 20C10 15.0001 15 10.0001 20 10.0001H19.9994Z\"\n            fill=\"currentColor\"\n          />\n        </svg>`;\n  }\n\n  private renderAgentHeader() {\n    return html`<div class=\"agent-header layout horizontal\">\n      <div class=\"agent-header-title\">${this.t(\"agentController\")}</div>\n      <div class=\"flex\"></div>\n      <div class=\"max-runs-per-cycle\">\n        ${this.maxRunsPerCycle} ${this.t(\"reportsPerMonth\")}\n      </div>\n    </div>`;\n  }\n\n  get shouldDisableStopButton() {\n    return this.workflowStatus !== \"running\";\n  }\n\n  get shouldDisableStartButton() {\n    return this.workflowStatus === \"running\";\n  }\n\n  get isRunning() {\n    return this.workflowStatus === \"running\";\n  }\n\n  renderAgentRunningStatus() {\n    return html`<div class=\"agent-running-status\"></div>`;\n  }\n\n  renderStartStopButtons() {\n    return html`<div class=\"layout horizontal startStopButtons\">\n      ${this.isRunning\n        ? html` <md-filled-button class=\"startButton startButtonFilled\" disabled\n            ><md-icon slot=\"icon\" class=\"startIcon\">play_circle</md-icon\n            >${this.t(\"start\")}</md-filled-button\n          >`\n        : html` <md-outlined-button\n            class=\"startButton\"\n            ?disabled=${this.shouldDisableStartButton}\n            ><md-icon slot=\"icon\" class=\"startIcon\">play_circle</md-icon\n            >${this.t(\"start\")}</md-outlined-button\n          >`}\n\n      <md-outlined-button\n        class=\"stopButton\"\n        ?disabled=${this.shouldDisableStopButton}\n        ><md-icon slot=\"icon\" class=\"stopIcon\">stop_circle</md-icon> ${this.t(\n          \"stop\"\n        )}</md-outlined-button\n      >\n    </div>`;\n  }\n\n  override render() {\n    if (\n      !this.workflow ||\n      !this.parsedWorkflow.steps ||\n      this.parsedWorkflow.steps.length === 0\n    ) {\n      return html`<div>No workflow configuration available</div>`;\n    }\n\n    return html`\n      <div class=\"layout vertical container\">\n        ${this.renderAgentHeader()} ${this.renderStartStopButtons()}\n        <div class=\"layout horizontal wrap\">\n          ${this.parsedWorkflow.steps.map((step, index) =>\n            this.renderStep(\n              step,\n              index,\n              index === this.parsedWorkflow.currentStepIndex\n            )\n          )}\n        </div>\n        ${this.isRunning && this.renderAgentRunningStatus()}\n      </div>\n    `;\n  }\n}\n"]}