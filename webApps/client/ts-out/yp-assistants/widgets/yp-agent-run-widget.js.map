{"version":3,"file":"yp-agent-run-widget.js","sourceRoot":"","sources":["../../../src/yp-assistants/widgets/yp-agent-run-widget.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, html, css, nothing, TemplateResult } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport { YpBaseElement } from \"../../common/yp-base-element.js\";\nimport { PsServerApi } from \"../../policySynth/PsServerApi.js\";\nimport { YpNavHelpers } from \"../../common/YpNavHelpers.js\";\nimport { resolveMarkdown } from \"../../common/litMarkdown/litMarkdown.js\";\n\n// Assuming we have an API client\n\n@customElement(\"yp-agent-run-widget\")\nexport class YpAgentRunWidget extends YpBaseElement {\n  @property({ type: Number })\n  agentProductId!: number;\n\n  @property({ type: Number })\n  runId!: number;\n\n  @property({ type: Number })\n  agentId!: number;\n\n  @property({ type: String })\n  wsClientId!: string;\n\n  @property({ type: Number })\n  workflowGroupId!: number;\n\n  @property({ type: String })\n  agentName = \"\";\n\n  @property({ type: String })\n  agentDescription = \"\";\n\n  @property({ type: String })\n  agentImageUrl = \"\";\n\n  @property({ type: String })\n  runStatus: YpAgentProductRunStatus = \"ready\";\n\n  @state()\n  private agentState: \"running\" | \"paused\" | \"stopped\" | \"error\" | \"completed\" =\n    \"stopped\";\n\n  @state()\n  private latestMessage: string = \"\";\n\n  @state()\n  private progress: number | undefined;\n\n  private statusInterval: number | undefined;\n\n  @property({ type: String })\n  workflow!: string;\n\n  @property({ type: Number })\n  maxRunsPerCycle!: number;\n\n  private api: PsServerApi;\n\n  constructor() {\n    super();\n    this.api = new PsServerApi();\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    const workflow = this.parsedWorkflow;\n\n    // Go through the workflow and set the this.agentId to the correct agent based on the workflow step\n    if (\n      workflow.steps[workflow.currentStepIndex] &&\n      workflow.steps[workflow.currentStepIndex].agentId\n    ) {\n      this.agentId = workflow.steps[workflow.currentStepIndex].agentId!;\n    } else {\n      console.error(\"No agentId found in workflow\");\n    }\n    this.workflowGroupId = workflow.workflowGroupId!;\n\n    this.updateAgentStatus();\n\n    this.addGlobalListener(\n      \"yp-updated-agent-workflow\",\n      this.updateWorkflow.bind(this)\n    );\n  }\n\n  updateWorkflow(updatedWorkflow: {\n    workflow: YpWorkflowConfiguration;\n    status: YpAgentProductRunStatus;\n  }) {\n    this.workflow = btoa(JSON.stringify(updatedWorkflow.workflow));\n    this.runStatus = updatedWorkflow.status;\n    this.requestUpdate();\n  }\n\n  get parsedWorkflow(): YpWorkflowConfiguration {\n    try {\n      const decodedWorkflow = atob(this.workflow);\n      return JSON.parse(decodedWorkflow);\n    } catch (error) {\n      console.error(\"Failed to decode or parse workflow:\", error);\n      return { currentStepIndex: 0, steps: [] };\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.stopStatusUpdates();\n    this.removeGlobalListener(\n      \"yp-updated-agent-workflow\",\n      this.updateWorkflow.bind(this)\n    );\n  }\n\n  private startStatusUpdates() {\n    this.statusInterval = window.setInterval(\n      () => this.updateAgentStatus(),\n      1200\n    );\n  }\n\n  private stopStatusUpdates() {\n    if (this.statusInterval) {\n      clearInterval(this.statusInterval);\n      this.statusInterval = undefined;\n    }\n  }\n\n  get latestMessageMarkdown(): string {\n    if (this.latestMessage && this.latestMessage.includes(\"<markdownReport>\")) {\n      const startIndex = this.latestMessage.indexOf(\"<markdownReport>\");\n      const endIndex = this.latestMessage.indexOf(\"</markdownReport>\");\n      if (startIndex !== -1 && endIndex !== -1) {\n        return this.latestMessage.substring(startIndex + 16, endIndex);\n      }\n    }\n    return \"\";\n  }\n\n  private async updateAgentStatus() {\n    try {\n      const status = await this.api.getAgentStatus(\n        this.workflowGroupId,\n        this.agentId\n      );\n      if (status) {\n        this.agentState = status.state as\n          | \"running\"\n          | \"paused\"\n          | \"stopped\"\n          | \"completed\"\n          | \"error\";\n        this.progress = status.progress;\n        this.latestMessage = status.messages[status.messages.length - 1] || \"\";\n\n        if (\n          this.agentState === \"stopped\" ||\n          this.agentState === \"error\" ||\n          this.agentState === \"completed\"\n        ) {\n          this.stopStatusUpdates();\n        } else if (this.agentState === \"running\" && !this.statusInterval) {\n          this.startStatusUpdates();\n        }\n\n        if (this.agentState === \"completed\") {\n          const updatedWorkflow = await this.api.getUpdatedWorkflow(\n            this.workflowGroupId,\n            this.runId\n          );\n          if (updatedWorkflow) {\n            this.updateWorkflow(updatedWorkflow);\n          }\n        }\n\n        this.requestUpdate();\n      }\n    } catch (error) {\n      console.error(\"Failed to get agent status:\", error);\n    }\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n        }\n\n        .completedContainer {\n          margin: 16px;\n        }\n\n        .inviteContainer {\n          margin-right: 24px;\n          margin-left: 8px;\n        }\n\n        .inviteHeader {\n          margin-top: 16px;\n          font-size: 16px;\n          font-weight: 700;\n          margin-bottom: 12px;\n          font-family: var(--md-ref-typeface-brand);\n        }\n\n        .viewListButton {\n          --md-filled-button-container-color: var(--yp-sys-color-agent-blue);\n          --md-filled-button-label-text-color: #fff;\n        }\n\n        .inviteButton {\n          margin-top: 16px;\n          max-width: 140px;\n          margin-left: auto;\n          margin-bottom: 24px;\n        }\n\n        .waitingOnUserContainer {\n          height: 100%;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          margin-top: 16px;\n        }\n\n        .container {\n          padding: 16px;\n          padding-right: 0;\n          border: 1px solid var(--md-sys-color-outline-variant);\n          border-radius: 4px;\n          width: 100%;\n          min-width: 804px;\n          min-height: 500px;\n        }\n\n        .workflow-step {\n          width: calc(241px - 20px);\n          height: calc(158px - 24px);\n          max-height: calc(86px - 24px);\n          padding: 12px;\n          border: 1px solid var(--md-sys-color-outline-variant);\n          border-radius: 4px;\n          margin-right: 24px;\n          margin-top: 12px;\n          margin-bottom: 12px;\n        }\n\n        .agent-header-title {\n          font-size: 22px;\n          font-weight: 700;\n          color: var(--md-sys-color-on-surface);\n          font-family: var(--md-ref-typeface-brand);\n        }\n\n        .startStopButtons {\n          margin-top: 24px;\n          margin-bottom: 16px;\n        }\n\n        md-linear-progress {\n          --md-linear-progress-active-indicator-color: var(\n            --yp-sys-color-agent-green\n          );\n          max-width: 420px;\n          width: 420px;\n          margin: 24px;\n        }\n\n        @media (max-width: 700px) {\n          md-linear-progress {\n            max-width: 300px;\n            width: 300px;\n          }\n        }\n\n        md-outlined-button {\n          --md-outlined-button-icon-size: 26px;\n        }\n\n        md-filled-button {\n          --md-filled-button-icon-size: 26px;\n        }\n\n        md-filled-button.startButton[has-static-theme] {\n          --md-filled-button-container-color: var(\n            --md-sys-color-primary-container\n          );\n          --md-sys-color-on-primary: var(--md-sys-color-on-primary-container);\n        }\n\n        .max-runs-per-cycle {\n          font-size: 13px;\n          color: var(--yp-sys-color-agent-blue);\n          text-transform: uppercase;\n          font-weight: 500;\n          margin-top: 4px;\n          margin-right: 16px;\n        }\n\n        @media (max-width: 700px) {\n          .container {\n            min-width: 100%;\n          }\n\n          .workflow-step {\n            margin: 8px;\n          }\n        }\n\n        .step-number {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          width: 31px;\n          height: 31px;\n          font-weight: 600;\n          border-radius: 50%;\n          font-size: 15px;\n          flex-shrink: 0;\n          transition: background-color 0.3s ease;\n        }\n\n        .step-number[isNotActive] {\n          background-color: #eaeaea !important;\n          color: var(--yp-sys-color-agent-black) !important;\n        }\n\n        .startButton {\n          margin-right: 24px;\n        }\n\n        .startButton,\n        .stopButton {\n          --md-filled-button-label-text-weight: 600;\n        }\n\n        .startButtonFilled {\n          --md-filled-button-disabled-container-color: var(\n            --yp-sys-color-agent-green\n          );\n          --md-filled-button-disabled-label-text-color: #fff;\n          --md-filled-button-disabled-container-opacity: 1;\n          --md-filled-button-disabled-label-text-opacity: 1;\n          --md-filled-button-disabled-icon-color: #fff;\n          --md-filled-button-disabled-icon-opacity: 1;\n          --md-sys-color-on-primary: #ffffff;\n        }\n\n        .step-content[notActive] {\n          opacity: 0.5;\n        }\n\n        .step-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: 0px;\n        }\n\n        .step-title {\n          font-size: 15px;\n          font-family: var(--md-ref-typeface-brand);\n          font-weight: 600;\n          line-height: 22.68px;\n          margin-top: 12px;\n          margin-bottom: 0px;\n        }\n\n        .step-icon {\n          width: 20px;\n          height: 20px;\n          color: var(--md-sys-color-outline);\n          fill: currentColor;\n        }\n\n        .agent-running-status {\n          margin-top: 16px;\n        }\n\n        .statusMessage {\n          font-size: 15px;\n          text-align: center;\n          margin: 16px;\n          margin-top: 8px;\n          flex-grow: 1;\n          color: var(--md-sys-color-on-surface-variant);\n        }\n      `,\n    ];\n  }\n\n  private getStepClass(index: number): string {\n    if (this.runStatus === \"cancelled\" || this.runStatus === \"ready\") {\n      return \"\";\n    }\n    if (index < this.parsedWorkflow.currentStepIndex) {\n      return \"step-completed\";\n    }\n    if (index === this.parsedWorkflow.currentStepIndex) {\n      return this.runStatus === \"running\" ? \"step-active\" : \"\";\n    }\n    return \"step-disabled\";\n  }\n\n  private renderStep(step: YpWorkflowStep, index: number, isSelected: boolean) {\n    const stepClass = this.getStepClass(index);\n\n    const isActive =\n      isSelected &&\n      (this.runStatus === \"running\" ||\n        this.runStatus === \"waiting_on_user\" ||\n        this.runStatus === \"completed\");\n\n    return html`\n      <div class=\"workflow-step layout vertical\">\n        <div class=\"layout horizontal\">\n          <div\n            class=\"step-number\"\n            ?isNotActive=${!isActive}\n            style=\"\n            background-color: ${step.stepBackgroundColor};\n            color: ${step.stepTextColor}\"\n          >\n            ${index + 1}\n          </div>\n          <div class=\"flex\"></div>\n          <div>\n            ${step.type === \"engagmentFromOutputConnector\"\n              ? this.renderIcon(\"users\")\n              : this.renderIcon(\"sparkles\")}\n          </div>\n        </div>\n\n        <div class=\"step-content\" ?notActive=${!isActive}>\n          <div class=\"step-header\">\n            <h3 class=\"step-title\">${step.shortName}</h3>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  private renderIcon(type: \"users\" | \"sparkles\") {\n    return type === \"users\"\n      ? html`<svg\n          class=\"step-icon\"\n          width=\"20\"\n          height=\"20\"\n          viewBox=\"0 0 20 20\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M13.8918 10.9417C15.0335 11.7167 15.8335 12.7667 15.8335 14.1667V16.6667H19.1668V14.1667C19.1668 12.35 16.1918 11.275 13.8918 10.9417Z\"\n            fill=\"currentColor\"\n          />\n          <path\n            d=\"M12.5002 10C14.3418 10 15.8335 8.50837 15.8335 6.66671C15.8335 4.82504 14.3418 3.33337 12.5002 3.33337C12.1085 3.33337 11.7418 3.41671 11.3918 3.53337C12.0835 4.39171 12.5002 5.48337 12.5002 6.66671C12.5002 7.85004 12.0835 8.94171 11.3918 9.80004C11.7418 9.91671 12.1085 10 12.5002 10Z\"\n            fill=\"currentColor\"\n          />\n          <path\n            d=\"M7.50016 10C9.34183 10 10.8335 8.50837 10.8335 6.66671C10.8335 4.82504 9.34183 3.33337 7.50016 3.33337C5.6585 3.33337 4.16683 4.82504 4.16683 6.66671C4.16683 8.50837 5.6585 10 7.50016 10ZM7.50016 5.00004C8.41683 5.00004 9.16683 5.75004 9.16683 6.66671C9.16683 7.58337 8.41683 8.33337 7.50016 8.33337C6.5835 8.33337 5.8335 7.58337 5.8335 6.66671C5.8335 5.75004 6.5835 5.00004 7.50016 5.00004Z\"\n            fill=\"currentColor\"\n          />\n          <path\n            d=\"M7.50016 10.8334C5.27516 10.8334 0.833496 11.95 0.833496 14.1667V16.6667H14.1668V14.1667C14.1668 11.95 9.72516 10.8334 7.50016 10.8334ZM12.5002 15H2.50016V14.175C2.66683 13.575 5.25016 12.5 7.50016 12.5C9.75016 12.5 12.3335 13.575 12.5002 14.1667V15Z\"\n            fill=\"currentColor\"\n          />\n        </svg>`\n      : html`<svg\n          class=\"step-icon\"\n          width=\"20\"\n          height=\"20\"\n          viewBox=\"0 0 20 20\"\n          fill=\"none\"\n          xmlns=\"http://www.w3.org/2000/svg\"\n        >\n          <path\n            d=\"M19.9994 10.0001C15.0056 10.0001 10.0117 5.01187 10 0.0177776V0.000277886C10 0.00305563 9.99972 0.00611118 9.99972 0.00888892C9.99972 0.0058334 9.99944 0.00305551 9.99944 0V0.0174999C9.98778 5.01187 4.99417 10.0001 0 10.0001C5 10.0001 10 15.0001 10 20C10 15.0001 15 10.0001 20 10.0001H19.9994Z\"\n            fill=\"currentColor\"\n          />\n        </svg>`;\n  }\n\n  private renderAgentHeader() {\n    return html`<div class=\"agent-header layout horizontal\">\n      <div class=\"agent-header-title\">${this.t(\"agentController\")}</div>\n      <div class=\"flex\"></div>\n      <div class=\"max-runs-per-cycle\">\n        ${/*this.maxRunsPerCycle*/ 1} ${this.t(\"reportPerMonth\")}\n      </div>\n    </div>`;\n  }\n\n  get shouldDisableStopButton() {\n    return this.runStatus !== \"running\";\n  }\n\n  get shouldDisableStartButton() {\n    return this.runStatus === \"running\";\n  }\n\n  get isRunning() {\n    return this.runStatus === \"running\";\n  }\n\n  get isWaitingOnUser() {\n    return this.runStatus === \"waiting_on_user\";\n  }\n\n  get isCompleted() {\n    return this.runStatus === \"completed\";\n  }\n\n  private renderAgentRunningStatus() {\n    return html`<div class=\"agent-running-status layout vertical center-center\">\n      ${this.progress !== undefined\n        ? html`<md-linear-progress indeterminate\n            value=\"${this.progress / 100}\"\n          ></md-linear-progress>`\n        : html`<md-linear-progress indeterminate></md-linear-progress>`}\n      <div class=\"statusMessage\">${this.latestMessage}</div>\n    </div>`;\n  }\n\n  get runStatusForButton() {\n    return this.runStatus === \"running\" ? \"stop\" : \"start\";\n  }\n\n  renderStartStopButtons() {\n    return html`<div class=\"layout horizontal startStopButtons\">\n      ${this.isRunning\n        ? html` <md-filled-button class=\"startButton startButtonFilled\" disabled\n            ><md-icon slot=\"icon\" class=\"startIcon\">play_circle</md-icon\n            >${this.t(this.runStatus)}</md-filled-button\n          >`\n        : html` <md-filled-button\n            class=\"startButton\"\n            ?has-static-theme=${this.hasStaticTheme}\n            ?disabled=${this.shouldDisableStartButton}\n            ><md-icon slot=\"icon\" class=\"startIcon\">play_circle</md-icon\n            >${this.t(this.runStatusForButton)}</md-filled-button\n          >`}\n\n      <md-outlined-button\n        class=\"stopButton\"\n        ?disabled=${this.shouldDisableStopButton}\n        ><md-icon slot=\"icon\" class=\"stopIcon\">stop_circle</md-icon> ${this.t(\n          \"stop\"\n        )}</md-outlined-button\n      >\n    </div>`;\n  }\n\n  get groupId() {\n    return this.parsedWorkflow.steps[this.parsedWorkflow.currentStepIndex]\n      .groupId;\n  }\n\n  private viewList() {\n    window.open(`/group/${this.groupId}?forAgentBundle=true`, \"_blank\");\n    //YpNavHelpers.redirectTo(`/group/${this.groupId}`);\n  }\n\n  openMarkdownReport() {\n    this.fire(\"yp-open-markdown-report\", {\n      markdownReport: this.latestMessageMarkdown\n    });\n  }\n\n  renderCompleted(): TemplateResult {\n    return html`<div\n    class=\"layout horizontal center-center waitingOnUserContainer\"\n  >\n    <div class=\"layout horizontal center-center flex\">\n      <md-filled-button class=\"viewListButton\" @click=${this.openMarkdownReport}\n        >${this.t(\"viewReport\")}</md-filled-button\n      >\n    </div>` as unknown as TemplateResult;\n  }\n\n  renderWaitingOnUser() {\n    return html`<div\n      class=\"layout horizontal center-center waitingOnUserContainer\"\n    >\n      <div class=\"layout horizontal center-center flex\">\n        <md-filled-button class=\"viewListButton\" @click=${this.viewList}\n          >${this.t(\"viewList\")}</md-filled-button\n        >\n      </div>\n      <div class=\"layout vertical inviteContainer\">\n        <div class=\"inviteHeader\">${this.t(\"invitePeopleAsReviewers\")}</div>\n        <md-outlined-text-field\n          type=\"textarea\"\n          rows=\"7\"\n          label=\"${this.t(\"enterOneEmailPerLine\")}\"\n        ></md-outlined-text-field>\n        <md-filled-button class=\"inviteButton\"\n          >${this.t(\"inviteToList\")}</md-filled-button\n        >\n      </div>\n    </div>`;\n  }\n\n  override render() {\n    if (\n      !this.workflow ||\n      !this.parsedWorkflow.steps ||\n      this.parsedWorkflow.steps.length === 0\n    ) {\n      return html`<div>No workflow configuration available</div>`;\n    }\n\n    return html`\n      <div class=\"layout vertical container\">\n        ${this.renderAgentHeader()} ${this.renderStartStopButtons()}\n        <div class=\"layout horizontal wrap\">\n          ${this.parsedWorkflow.steps.map((step, index) =>\n            this.renderStep(\n              step,\n              index,\n              index === this.parsedWorkflow.currentStepIndex\n            )\n          )}\n        </div>\n        ${this.isCompleted ? this.renderCompleted() : nothing}\n        ${this.isRunning ? this.renderAgentRunningStatus() : nothing}\n        ${this.isWaitingOnUser ? this.renderWaitingOnUser() : nothing}\n      </div>\n    `;\n  }\n}\n"]}