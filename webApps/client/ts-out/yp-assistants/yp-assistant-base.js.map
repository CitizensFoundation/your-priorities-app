{"version":3,"file":"yp-assistant-base.js","sourceRoot":"","sources":["../../src/yp-assistants/yp-assistant-base.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing, PropertyValueMap } from \"lit\";\nimport { property, customElement, state, query } from \"lit/decorators.js\";\nimport { YpChatbotBase } from \"../yp-chatbots/yp-chatbot-base.js\";\nimport \"./yp-assistant-item-base.js\";\nimport { literal } from \"lit/static-html.js\";\nimport { WavRecorder } from \"../tools/wavTools/wav_recorder.js\";\nimport { WavStreamPlayer } from \"../tools/wavTools/wav_stream_player.js\";\nimport { YpAssistantServerApi } from \"./AssistantServerApi.js\";\nimport { WavRenderer } from \"./wave-renderer.js\";\nimport { YpConfirmationDialog } from \"../yp-dialog-container/yp-confirmation-dialog.js\";\nimport { YpServerApi } from \"../common/YpServerApi.js\";\n\nimport \"./yp-assistant-welcome.js\";\nimport { cache } from \"lit/directives/cache.js\";\nimport { resolveMarkdown } from \"../common/litMarkdown/litMarkdown.js\";\nimport { YpSnackbar } from \"../yp-app/yp-snackbar.js\";\n\nimport \"@material/web/progress/circular-progress.js\";\n\n@customElement(\"yp-assistant-base\")\nexport abstract class YpAssistantBase extends YpChatbotBase {\n  @property({ type: Boolean })\n  voiceEnabled = false;\n\n  @property({ type: Number })\n  domainId!: number;\n\n  @property({ type: String })\n  mainAssistantAvatarUrl: string | undefined;\n\n  @property({ type: String })\n  directAgentAvatarUrl: string | undefined;\n\n  @property({ type: Boolean })\n  override useMainWindowScroll = true;\n\n  @property({ type: String })\n  directAgentName: string | null = null;\n\n  @property({ type: Boolean })\n  welcomeScreenOpen = true;\n\n  @property({ type: String })\n  currentAgentId: string | undefined;\n\n  //TODO: Read from agentbundle db object\n  @property({ type: String })\n  welcomeTextHtml = `I am your assistant for Evoly and I can talk, just <span class=\"green\">click the button</span>`;\n\n  @state()\n  private mediaRecorder: WavRecorder | null = null;\n\n  @state()\n  private wavStreamPlayer: WavStreamPlayer | null = null;\n\n  @state()\n  private isRecording = false;\n\n  @state()\n  userIsSpeaking = false;\n\n  @state()\n  aiIsSpeaking = false;\n\n  @property({ type: Boolean })\n  override onlyUseTextField = true;\n\n  @property({ type: Array })\n  chatLogFromServer: YpAssistantMessage[] | undefined;\n\n  @state()\n  currentMode = \"\";\n\n  @state()\n  markdownReportOpen = false;\n\n  @state()\n  currentMarkdownReport: string | undefined;\n\n  @state()\n  isExpanded = false;\n\n  @state()\n  dialogOpen = false;\n\n  @query(\"#voiceButton\")\n  voiceButton!: HTMLElement;\n\n  @property({ type: String })\n  override textInputLabel = \"Message the assistant\";\n\n  @property({ type: String })\n  override defaultInfoMessage: string | undefined =\n    \"I'm your friendly chat assistant\";\n\n  override chatbotItemComponentName = literal`yp-assistant-item-base`;\n\n  @state()\n  private isDownloading = false;\n\n  @query(\"#waveformCanvas\")\n  private waveformCanvas!: HTMLCanvasElement;\n\n  private canvasCtx: CanvasRenderingContext2D | null = null;\n  private renderLoopActive = false;\n\n  private haveLoggedIn = false;\n\n  aiSpeakingTimeout: NodeJS.Timeout | undefined;\n\n  serverApi!: YpAssistantServerApi;\n\n  clientMemoryUuid: string;\n\n  private dialogClosingTimeout: NodeJS.Timeout | undefined;\n\n  private storageKey = `yp-assistant-${this.domainId}-client-uuid-v2`;\n\n  constructor() {\n    super();\n    this.setupVoiceCapabilities();\n    const savedUuid = localStorage.getItem(this.storageKey);\n    if (savedUuid) {\n      this.clientMemoryUuid = savedUuid;\n      window.appGlobals.currentClientMemoryUuid = savedUuid;\n    } else {\n      this.clientMemoryUuid = crypto.randomUUID();\n      localStorage.setItem(this.storageKey, this.clientMemoryUuid);\n      window.appGlobals.currentClientMemoryUuid = this.clientMemoryUuid;\n    }\n    this.setupServerApi();\n  }\n\n  clearClientMemoryUuid() {\n    localStorage.removeItem(this.storageKey);\n    window.appGlobals.currentClientMemoryUuid = undefined;\n  }\n\n  override async setupServerApi(): Promise<void> {\n    this.serverApi = new YpAssistantServerApi(this.clientMemoryUuid);\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.getMemoryFromServer();\n    this.addGlobalListener(\"yp-logged-in\", this.userLoggedIn.bind(this));\n    this.addGlobalListener(\n      \"agent-configuration-submitted\",\n      this.agentConfigurationSubmitted.bind(this)\n    );\n    this.addListener(\n      \"yp-open-markdown-report\",\n      this.openMarkdownReport.bind(this)\n    );\n    this.addListener(\"yp-start-next-workflow-step\", this.startNextWorkflowStep);\n    this.addListener(\n      \"yp-stop-current-workflow-step\",\n      this.stopCurrentWorkflowStep\n    );\n    this.addGlobalListener(\n      \"yp-send-email-invites-for-anons\",\n      this.sendEmailInvitesForAnons.bind(this)\n    );\n    this.addGlobalListener(\"yp-dialog-opened\", this.handleDialogOpen.bind(this));\n    this.addGlobalListener(\"yp-dialog-closed\", this.handleDialogClose.bind(this));\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.stopCanvasRendering();\n\n    this.stopRecording();\n    this.removeGlobalListener(\"yp-logged-in\", this.userLoggedIn.bind(this));\n    this.removeGlobalListener(\n      \"agent-configuration-submitted\",\n      this.agentConfigurationSubmitted.bind(this)\n    );\n    this.removeGlobalListener(\n      \"yp-open-markdown-report\",\n      this.openMarkdownReport.bind(this)\n    );\n    this.removeGlobalListener(\n      \"yp-send-email-invites-for-anons\",\n      this.sendEmailInvitesForAnons.bind(this)\n    );\n    this.removeGlobalListener(\"yp-dialog-opened\", this.handleDialogOpen.bind(this));\n    this.removeGlobalListener(\"yp-dialog-closed\", this.handleDialogClose.bind(this));\n  }\n\n  async sendEmailInvitesForAnons(event: CustomEvent) {\n    if (!event.detail) {\n      return;\n    }\n\n    try {\n      await this.serverApi.sendEmailInvitesForAnons(\n        event.detail.groupId,\n        event.detail.agentId,\n        event.detail.agentRunId,\n        event.detail.emails\n      );\n      window.appDialogs.getDialogAsync(\"masterToast\", (toast: YpSnackbar) => {\n        toast.labelText = this.t(\"haveSentInvites\");\n        toast.open = true;\n        debugger;\n      });\n    } catch (error) {\n      console.error(\"Error sending email invites for anons:\", error);\n    }\n  }\n\n  async startNextWorkflowStep(event: CustomEvent) {\n    this.sendChatMessage(\n      \"Please start the next workflow step, I confirm and accept\"\n    );\n    //TODO: Do this later\n    //await this.serverApi.startNextWorkflowStep(event.detail.agentId);\n  }\n\n  async stopCurrentWorkflowStep(event: CustomEvent) {\n    this.sendChatMessage(\n      \"Please stop the current workflow step, I confirm and accept\"\n    );\n    //TODO: Do this later\n    //await this.serverApi.stopCurrentWorkflowStep(event.detail.agentId);\n  }\n\n  async openMarkdownReport(event: CustomEvent) {\n    if (!event.detail) {\n      return;\n    }\n    this.currentMarkdownReport = event.detail.markdownReport;\n    this.currentAgentId = event.detail.agentId;\n    if (this.currentMarkdownReport) {\n      this.markdownReportOpen = true;\n      window.scrollTo(0, 0);\n    }\n  }\n\n  async agentConfigurationSubmitted() {\n    const clientSystemMessage: YpAssistantMessage = {\n      type: \"client_system_message\",\n      sender: \"system\",\n      message: \"agent_configuration_submitted\",\n    };\n    this.sendClientMessage(JSON.stringify(clientSystemMessage));\n\n    /*window.appDialogs.getDialogAsync(\"masterToast\", (toast: YpSnackbar) => {\n      toast.labelText = this.t(\"agentConfigurationSubmitted\");\n      toast.open = true;\n    });*/\n  }\n\n  async agentRunChanged() {\n    const clientSystemMessage: YpAssistantMessage = {\n      type: \"client_system_message\",\n      sender: \"system\",\n      message: \"agent_run_changed\",\n    };\n    this.sendClientMessage(JSON.stringify(clientSystemMessage));\n  }\n\n  async userLoggedIn(event: CustomEvent) {\n    if (!event.detail) {\n      return;\n    }\n\n    if (this.haveLoggedIn) {\n      console.log(\"User already logged in for assistant\");\n      return;\n    }\n    this.haveLoggedIn = true;\n    await this.serverApi.updateAssistantMemoryUserLoginStatus(this.domainId);\n\n    const clientSystemMessage: YpAssistantMessage = {\n      type: \"client_system_message\",\n      sender: \"system\",\n      message: \"user_logged_in\",\n    };\n    this.sendClientMessage(JSON.stringify(clientSystemMessage));\n  }\n\n  override firstUpdated(\n    changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>\n  ) {\n    if (changedProperties) {\n      super.firstUpdated(changedProperties);\n    }\n\n    this.scrollDown();\n  }\n\n  async getMemoryFromServer() {\n    if (!this.chatLog || this.chatLog.length === 0) {\n      try {\n        window.appGlobals.retryMethodAfter401Login = this.getMemoryFromServer.bind(this);\n        const { chatLog, modeData, currentMode } =\n          (await this.serverApi.getMemoryFromServer(\n            this.domainId\n          )) as YpBaseAssistantMemoryData;\n\n        this.currentMode = currentMode;\n\n        if (chatLog && chatLog.length > 0) {\n          this.loadLastDirectAvatarUrlAndName();\n          this.chatLogFromServer = chatLog.map((chatLogItem: any) => ({\n            ...chatLogItem,\n            date: new Date(chatLogItem.date),\n            sender: chatLogItem.sender as YpSenderType,\n          }));\n          this.chatLog = this.chatLogFromServer;\n          this.requestUpdate();\n          await this.updateComplete;\n          //TODO: Figure this out better\n          await new Promise((resolve) => setTimeout(resolve, 15));\n          this.scrollDown();\n        }\n      } catch (error) {\n        console.error(\"Error getting chat log from server:\", error);\n      }\n    }\n  }\n\n  private setupCanvasRendering() {\n    if (this.renderLoopActive) return;\n\n    this.renderLoopActive = true;\n    this.renderLoop();\n  }\n\n  private renderLoop = () => {\n    if (!this.renderLoopActive) return;\n\n    if (this.waveformCanvas) {\n      // Set up canvas if needed\n      if (!this.waveformCanvas.width || !this.waveformCanvas.height) {\n        this.waveformCanvas.width = this.waveformCanvas.offsetWidth;\n        this.waveformCanvas.height = this.waveformCanvas.offsetHeight;\n      }\n      this.canvasCtx = this.canvasCtx || this.waveformCanvas.getContext(\"2d\");\n\n      if (this.canvasCtx) {\n        this.canvasCtx.clearRect(\n          0,\n          0,\n          this.waveformCanvas.width,\n          this.waveformCanvas.height\n        );\n\n        // Get frequencies based on who is speaking\n        let frequencies = new Float32Array([0]);\n        let color = \"#ffdc2f\"; // default color\n\n        try {\n          if (this.userIsSpeaking) {\n            frequencies = this.mediaRecorder?.getFrequencies(\"voice\")?.values!;\n            // GO throught the frequencies and lower them all by 30%\n            for (let i = 0; i < frequencies.length; i++) {\n              frequencies[i] = frequencies[i] * 0.15;\n            }\n            color = \"#ffdc2f\";\n          } else if (this.aiIsSpeaking) {\n            frequencies =\n              this.wavStreamPlayer?.getFrequencies(\"voice\")?.values!;\n            color = \"#2ecc71\";\n            for (let i = 0; i < frequencies.length; i++) {\n              frequencies[i] = frequencies[i] * 0.15;\n            }\n          }\n\n          WavRenderer.drawBars(\n            this.waveformCanvas,\n            this.canvasCtx,\n            frequencies,\n            color,\n            10,\n            0,\n            8\n          );\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    }\n\n    requestAnimationFrame(this.renderLoop);\n  };\n\n  private stopCanvasRendering() {\n    this.renderLoopActive = false;\n  }\n\n  async setupVoiceCapabilities() {}\n\n  get talkingHeadImageUrl() {\n    if (this.aiIsSpeaking) {\n      return \"https://assets.evoly.ai/dl/8ddaf573eea398f9042aec7134e5dc37--retina-1.png\";\n    } else if (this.userIsSpeaking) {\n      return \"https://assets.evoly.ai/dl/8ddaf573eea398f9042aec7134e5dc37--retina-1.png\";\n    } else\n      return \"https://assets.evoly.ai/dl/8ddaf573eea398f9042aec7134e5dc37--retina-1.png\";\n  }\n\n  renderVoiceTalkingHead() {\n    return html`\n      <div class=\"layout horizontal\" ?voice-not-enabled=\"${!this.voiceEnabled}\">\n        <img\n          class=\"talking-head-image\"\n          src=\"${this.directAgentAvatarUrl\n            ? this.directAgentAvatarUrl\n            : this.talkingHeadImageUrl}\"\n          alt=\"Voice Assistant\"\n        />\n      </div>\n    `;\n  }\n\n  get chatLogWithDeduplicatedWidgets() {\n    // Keep track of seen tokens and their last occurrence\n    const tokenLastIndex = new Map<string, number>();\n\n    // First pass: find last occurrence of each token\n    this.chatLog.forEach((element, index) => {\n      if (element.uniqueToken) {\n        tokenLastIndex.set(element.uniqueToken, index);\n      }\n    });\n\n    // Second pass: filter out elements with tokens unless they're the last occurrence\n    return this.chatLog.filter((element, index) => {\n      if (!element.uniqueToken) return true;\n      return tokenLastIndex.get(element.uniqueToken) === index;\n    });\n  }\n\n  async startInVoiceMode() {\n    this.welcomeScreenOpen = false;\n    this.toggleVoiceMode();\n\n    window.appGlobals.activity(`Assistant - start voice mode`);\n\n    await this.updateComplete;\n\n    await new Promise((resolve) => setTimeout(resolve, 10));\n    this.scrollDown();\n  }\n\n  wrapText(text: string, font: any, fontSize: number, maxWidth: number) {\n    const words = text.split(/\\s+/);\n    const lines: string[] = [];\n    let currentLine: string[] = [];\n\n    for (const word of words) {\n      const linePlusWord = [...currentLine, word].join(\" \");\n      const lineWidth = font.widthOfTextAtSize(linePlusWord, fontSize);\n      if (lineWidth < maxWidth) {\n        currentLine.push(word);\n      } else {\n        lines.push(currentLine.join(\" \"));\n        currentLine = [word];\n      }\n    }\n\n    // push the last line if it exists\n    if (currentLine.length > 0) {\n      lines.push(currentLine.join(\" \"));\n    }\n\n    return lines;\n  }\n\n  async startInTextMode() {\n    this.welcomeScreenOpen = false;\n    await this.updateComplete;\n    window.appGlobals.activity(`Assistant - start text mode`);\n\n    this.sendChatMessage(\n      \"Show me the agents\"\n    );\n\n    // wait 10 ms\n    await new Promise((resolve) => setTimeout(resolve, 10));\n    this.scrollDown();\n\n    // wait 300 ms\n    setTimeout(() => {\n      this.scrollDown();\n      this.chatInputField!.focus();\n    }, 200);\n  }\n\n  async closeMarkdownReport() {\n    this.markdownReportOpen = false;\n    await this.updateComplete;\n    this.scrollDown();\n  }\n\n  private async handleDownloadReport() {\n    try {\n      this.isDownloading = true;\n      const response = await fetch(\n        `/api/assistants/${this.domainId}/${this.currentAgentId}/getDocxReport`,\n        {\n          mode: \"cors\",\n        }\n      );\n      if (!response.ok) {\n        // handle error\n        throw new Error(\"Download failed\");\n      }\n\n      const blob = await response.blob();\n\n      // Create a temporary <a> tag and trigger a download\n      const tempUrl = window.URL.createObjectURL(blob);\n      const tempAnchor = document.createElement(\"a\");\n      tempAnchor.href = tempUrl;\n      tempAnchor.download = \"report.docx\";\n      tempAnchor.click();\n      window.URL.revokeObjectURL(tempUrl);\n    } catch (err) {\n      console.error(\"Download error details:\", {\n        error: err,\n        message: err instanceof Error ? err.message : 'Unknown error',\n        stack: err instanceof Error ? err.stack : undefined\n      });\n    } finally {\n      this.isDownloading = false;\n    }\n  }\n\n  renderMarkdownReport() {\n    return html`<div class=\"markdownContainer layout vertical\">\n      <div class=\"markdownInnerContainer\">\n        <div class=\"layout horizontal\">\n          <md-filled-tonal-icon-button\n            class=\"closeMarkdownReportButton\"\n            @click=${this.closeMarkdownReport}\n            ><md-icon>close</md-icon></md-filled-tonal-icon-button\n          >\n          <div class=\"flex\"></div>\n          <md-circular-progress\n            ?indeterminate=${true}\n            ?hidden=${!this.isDownloading}\n          ></md-circular-progress>\n          <md-filled-button\n            ?has-static-theme=\"${this.hasStaticTheme}\"\n            class=\"downloadPdfButton\"\n            @click=${this.handleDownloadReport}\n          >\n            ${this.t(\"downloadDocx\")}\n          </md-filled-button>\n        </div>\n        ${resolveMarkdown(this.currentMarkdownReport!, {\n          includeImages: true,\n          includeCodeBlockClassNames: true,\n          handleJsonBlocks: true,\n          targetElement: this,\n        })}\n      </div>\n    </div>`;\n  }\n\n  override render() {\n    if (this.welcomeScreenOpen && this.chatLog.length === 0) {\n      return html`<yp-assistant-welcome\n        @yp-start-voice-mode=\"${this.startInVoiceMode}\"\n        @yp-start-text-mode=\"${this.startInTextMode}\"\n        .welcomeTextHtml=\"${this.welcomeTextHtml}\"\n        .avatarUrl=\"${this.directAgentAvatarUrl\n          ? this.directAgentAvatarUrl\n          : this.talkingHeadImageUrl}\"\n      ></yp-assistant-welcome>`;\n    }\n\n    if (this.markdownReportOpen && this.currentMarkdownReport) {\n      return this.renderMarkdownReport();\n    }\n\n    return html`${cache(html`\n      <div class=\"chat-window\" id=\"chat-window\" ?expanded=\"${this.isExpanded}\">\n        <div class=\"voice-input-container\" ?dialog-open=\"${this.dialogOpen}\">\n          <div class=\"voice-input\">${this.renderVoiceInput()}</div>\n        </div>\n        <div class=\"hybrid-chat-messages\" id=\"chat-messages\">\n          <yp-assistant-item-base\n            ?hidden=\"${true || !this.defaultInfoMessage}\"\n            class=\"chatElement assistant-chat-element\"\n            .detectedLanguage=\"${this.language}\"\n            .message=\"${this.defaultInfoMessage}\"\n            type=\"info\"\n            sender=\"assistant\"\n          ></yp-assistant-item-base>\n          ${this.chatLogWithDeduplicatedWidgets\n            .filter(\n              (chatElement) =>\n                !chatElement.hidden &&\n                chatElement.type !== \"hiddenContextMessage\" &&\n                chatElement.type !== \"thinking\" &&\n                (chatElement.message != \"\" || chatElement.html != \"\")\n            )\n            .map(\n              (chatElement) => html`\n                <yp-assistant-item-base\n                  ?thinking=\"${chatElement.type === \"thinking\" ||\n                  chatElement.type === \"noStreaming\"}\"\n                  @followup-question=\"${this.followUpQuestion}\"\n                  .clusterId=\"${this.clusterId}\"\n                  class=\"chatElement ${chatElement.sender}-chat-element\"\n                  .detectedLanguage=\"${this.language}\"\n                  .avatarUrl=\"${chatElement.avatarUrl ||\n                  this.talkingHeadImageUrl}\"\n                  .message=\"${chatElement.message || \"\"}\"\n                  .htmlToRender=\"${chatElement.html || \"\"}\"\n                  @scroll-down-enabled=\"${() => (this.userScrolled = false)}\"\n                  .type=\"${chatElement.type || \"message\"}\"\n                  .sender=\"${chatElement.sender || \"assistant\"}\"\n                ></yp-assistant-item-base>\n              `\n            )}\n        </div>\n        <div class=\"chat-input-container\" ?dialog-open=\"${this.dialogOpen}\">\n          <div class=\"chat-input\">${this.renderChatAssistantInput()}</div>\n        </div>\n      </div>\n    `)}`;\n  }\n\n  toggleRecording() {\n    if (this.isRecording) {\n      this.stopRecording();\n    } else {\n      this.startRecording();\n    }\n  }\n\n  async startRecording() {\n    await this.serverApi.startVoiceSession(\n      this.domainId,\n      this.wsClientId,\n      this.currentMode\n    );\n    this.mediaRecorder = new WavRecorder({ sampleRate: 24000 }) as WavRecorder;\n    this.isRecording = true;\n\n    await this.mediaRecorder.begin();\n\n    await this.mediaRecorder.record((data: any) => this.handleVoiceInput(data));\n\n    this.wavStreamPlayer = new WavStreamPlayer({ sampleRate: 24000 });\n\n    await this.wavStreamPlayer?.connect();\n  }\n\n  stopRecording() {\n    this.mediaRecorder?.end();\n    this.mediaRecorder = null;\n\n    this.wavStreamPlayer?.interrupt();\n    this.wavStreamPlayer = null;\n    this.isRecording = false;\n  }\n\n  static floatTo16BitPCM(float32Array: Float32Array) {\n    const buffer = new ArrayBuffer(float32Array.length * 2);\n    const view = new DataView(buffer);\n    let offset = 0;\n    for (let i = 0; i < float32Array.length; i++, offset += 2) {\n      let s = Math.max(-1, Math.min(1, float32Array[i]));\n      view.setInt16(offset, s < 0 ? s * 0x8000 : s * 0x7fff, true);\n    }\n    return buffer;\n  }\n\n  static arrayBufferToBase64(arrayBuffer: ArrayBuffer | Iterable<number>) {\n    if (arrayBuffer instanceof Float32Array) {\n      arrayBuffer = this.floatTo16BitPCM(arrayBuffer);\n    } else if (arrayBuffer instanceof Int16Array) {\n      arrayBuffer = arrayBuffer.buffer;\n    }\n    let binary = \"\";\n    let bytes = new Uint8Array(arrayBuffer as any);\n    const chunkSize = 0x8000; // 32KB chunk size\n    for (let i = 0; i < bytes.length; i += chunkSize) {\n      let chunk = bytes.subarray(i, i + chunkSize);\n      binary += String.fromCharCode.apply(null, chunk as any);\n    }\n    return btoa(binary);\n  }\n\n  async handleVoiceInput(data: { mono: ArrayBuffer; raw: ArrayBuffer }) {\n    // Convert ArrayBuffer to base64 using browser APIs\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.ws.send(\n        JSON.stringify({\n          type: \"voice_input\",\n          audio: YpAssistantBase.arrayBufferToBase64(data.mono),\n          clientId: this.wsClientId,\n        })\n      );\n    }\n  }\n\n  saveLastDirectAvatarUrlAndName() {\n    localStorage.setItem(\n      \"lastDirectAvatarUrl\",\n      this.directAgentAvatarUrl || \"\"\n    );\n    localStorage.setItem(\"lastDirectAvatarName\", this.directAgentName || \"\");\n  }\n\n  loadLastDirectAvatarUrlAndName() {\n    this.directAgentAvatarUrl =\n      localStorage.getItem(\"lastDirectAvatarUrl\") || undefined;\n    this.directAgentName = localStorage.getItem(\"lastDirectAvatarName\") || null;\n  }\n\n  resetLastDirectAvatarUrlAndName() {\n    localStorage.removeItem(\"lastDirectAvatarUrl\");\n    localStorage.removeItem(\"lastDirectAvatarName\");\n  }\n\n  async resetWaveformPlayer() {\n    await this.wavStreamPlayer?.interrupt();\n    this.wavStreamPlayer = new WavStreamPlayer({ sampleRate: 24000 });\n\n    await this.wavStreamPlayer?.connect();\n  }\n\n  override async onMessage(event: MessageEvent) {\n    const data = JSON.parse(event.data) as YpAssistantMessage;\n\n    // Handle messages with HTML content\n    if (data.sender === \"assistant\" && data.html) {\n      // Add message to chat log with reference to component\n      this.addChatBotElement({\n        sender: \"assistant\",\n        type: \"html\",\n        message: data.message || \"\",\n        html: data.html,\n        avatarUrl: data.avatarUrl,\n        uniqueToken: data.uniqueToken,\n      });\n\n      await this.updateComplete;\n\n      await new Promise((resolve) => setTimeout(resolve, 50));\n      this.scrollDown();\n      return;\n    }\n\n    switch (data.type) {\n      case \"ui_click\":\n        const type = data.message as YpAssistantUiClickTypes;\n        if (type === \"login-button-main\") {\n          this.fireGlobal(\"assistant-requested-login-main-button-click\");\n        } else if (type === \"login-button-google\") {\n          this.fireGlobal(\"assistant-requested-login-google-button-click\");\n        } else if (type === \"logout\") {\n          this.fireGlobal(\"assistant-requested-logout-button-click\");\n        } else if (type === \"submit-agent-configuration\") {\n          this.fireGlobal(\"assistant-requested-submit-agent-configuration\");\n        } else {\n          console.error(\"No mode received in current_mode message\");\n        }\n        break;\n      case \"current_mode\":\n        if (data.mode) {\n          this.currentMode = data.mode;\n        } else {\n          console.error(\"No mode received in current_mode message\");\n        }\n        break;\n      case \"audio\":\n        if (data.base64Audio) {\n          const audioData = this.base64ToArrayBuffer(data.base64Audio);\n          this.wavStreamPlayer?.add16BitPCM(audioData);\n\n          this.aiIsSpeaking = true;\n\n          clearTimeout(this.aiSpeakingTimeout);\n\n          this.aiSpeakingTimeout = setTimeout(() => {\n            //this.aiIsSpeaking = false;\n          }, 2500);\n        }\n        break;\n      case \"updated_workflow\":\n        if (data.updatedWorkflow) {\n          try {\n            this.agentRunChanged();\n            this.fireGlobal(\"yp-updated-agent-workflow\", data.updatedWorkflow);\n          } catch (e) {\n            console.error(\"Error parsing updated workflow\", e);\n          }\n        }\n        break;\n      case \"current_mode\":\n        if (data.mode) {\n          this.currentMode = data.mode;\n        } else {\n          console.error(\"No mode received in current_mode message\");\n        }\n        break;\n      case \"avatar_url_change\":\n        if (data.url == null || data.data == null) {\n          this.directAgentAvatarUrl = undefined;\n          this.directAgentName = null;\n          this.resetLastDirectAvatarUrlAndName();\n        } else {\n          this.directAgentAvatarUrl = data.url;\n          this.directAgentName = data.data as string;\n          this.saveLastDirectAvatarUrlAndName();\n        }\n        break;\n\n      case \"clear_audio_buffer\":\n        await this.resetWaveformPlayer();\n        this.aiIsSpeaking = false;\n        break;\n      case \"listening_start\":\n        if (this.lastChatUiElement) {\n          this.lastChatUiElement.isSpeaking = true;\n        }\n        this.userIsSpeaking = true;\n        this.aiIsSpeaking = false;\n\n        await this.resetWaveformPlayer();\n        break;\n\n      case \"listening_stop\":\n        if (this.lastChatUiElement) {\n          this.lastChatUiElement.isSpeaking = false;\n        }\n        this.userIsSpeaking = false;\n        break;\n\n      case \"ai_speaking_start\":\n        this.aiIsSpeaking = true;\n        break;\n\n      case \"ai_speaking_stop\":\n        this.aiIsSpeaking = false;\n        break;\n\n      default:\n        await super.onMessage(event);\n    }\n  }\n\n  base64ToArrayBuffer(base64: string): ArrayBuffer {\n    const binaryString = window.atob(base64);\n    const length = binaryString.length;\n    const bytes = new Uint8Array(length);\n\n    for (let i = 0; i < length; i++) {\n      bytes[i] = binaryString.charCodeAt(i);\n    }\n\n    return bytes.buffer;\n  }\n\n  async toggleVoiceMode() {\n    this.voiceEnabled = !this.voiceEnabled;\n    this.isExpanded = this.voiceEnabled;\n\n    this.fireGlobal(\"yp-hide-collection-header-status\", this.isExpanded);\n\n    if (!this.voiceEnabled && this.isRecording) {\n      this.stopRecording();\n    } else if (this.voiceEnabled && !this.isRecording) {\n      await this.startRecording();\n    }\n\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      this.ws.send(\n        JSON.stringify({\n          type: \"voice_mode\",\n          enabled: this.voiceEnabled,\n          clientId: this.wsClientId,\n        })\n      );\n    }\n\n    if (this.voiceEnabled) {\n      this.setupCanvasRendering();\n    } else {\n      this.stopCanvasRendering();\n    }\n  }\n\n  async reallyClearHistory() {\n    window.appGlobals.activity(`Assistant - really clear history`);\n    await this.serverApi.clearChatLogFromServer(this.domainId);\n    this.chatLog = [];\n    this.welcomeScreenOpen = true;\n    this.directAgentAvatarUrl = undefined;\n    this.resetLastDirectAvatarUrlAndName();\n    this.stopCanvasRendering();\n    this.requestUpdate();\n    this.clearClientMemoryUuid();\n    await window.appUser.logout();\n    location.reload();\n  }\n\n  async clearHistory() {\n    window.appGlobals.activity(`Assistant - clear history`);\n    window.appDialogs.getDialogAsync(\n      \"confirmationDialog\",\n      (dialog: YpConfirmationDialog) => {\n        dialog.open(\n          this.t(\"confirmClearHistory\"),\n          this.reallyClearHistory.bind(this)\n        );\n      }\n    );\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        .markdownContainer {\n          padding-top: 48px;\n        }\n\n        md-circular-progress {\n          --md-circular-progress-size: 40px;\n          margin-right: 8px;\n        }\n\n        md-filled-button[has-static-theme] {\n          --md-filled-button-container-color: var(\n            --md-sys-color-primary-container\n          );\n          --md-sys-color-on-primary: var(--md-sys-color-on-primary-container);\n        }\n\n        .sendChatIcon {\n          margin-right: 24px;\n        }\n        .closeMarkdownReportButton,\n        .downloadPdfButton {\n          margin-bottom: 8px;\n        }\n\n        .markdownInnerContainer {\n          max-width: 900px;\n          border: 1px solid var(--md-sys-color-outline-variant, #f00);\n          padding: 32px;\n          padding-left: 48px;\n          padding-right: 48px;\n          padding-top: 20px;\n        }\n\n        .markdownInnerContainer img {\n          display: block;\n          max-width: 100%;\n          height: auto;\n          aspect-ratio: 16/9;\n          object-fit: cover;\n          margin: 0 auto 24px auto;\n        }\n\n        @keyframes pulse {\n          0% {\n            transform: scale(1);\n            opacity: 1;\n          }\n          50% {\n            transform: scale(1.2);\n            opacity: 1;\n          }\n          100% {\n            transform: scale(1);\n            opacity: 1;\n          }\n        }\n\n        .pulsing {\n          animation: pulse 2.75s infinite;\n        }\n\n        .voice-mode-toggle {\n          margin-top: 16px;\n        }\n\n        .chat-window {\n          display: flex;\n          flex-direction: column;\n          height: 100%;\n          min-height: 45vh;\n          width: 100%;\n          max-width: 768px;\n          margin: 0 auto;\n          border-radius: 10px;\n          overflow: hidden;\n        }\n\n        .hybrid-chat-messages {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          overflow-y: visible;\n          max-width: 768px;\n        }\n\n        .talkToTheAssistantButton {\n          --md-elevated-button-label-text-color: #fff;\n          --md-elevated-button-focus-label-text-color: #fff;\n          --md-elevated-button-hover-label-text-color: #fff;\n          --md-elevated-button-container-shadow-color: var(\n            --yp-sys-color-agent-green\n          );\n          --md-elevated-button-container-height: 39px;\n          --md-elevated-button-container-color: var(--yp-sys-color-agent-green);\n          --md-elevated-button-label-text-weight: 600;\n          --md-elevated-button-label-text-size: 14px;\n          height: 39px;\n          margin-top: 32px;\n        }\n\n        .resetChatButton {\n          margin-top: 32px;\n          margin-left: 24px;\n          height: 39px;\n          --md-text-button-label-text-weight: 600;\n          --md-text-button-label-text-size: 14px;\n          --md-text-button-label-text-color: var(--yp-sys-color-agent-black);\n          --md-text-button-focus-label-text-color: var(\n            --yp-sys-color-agent-black\n          );\n          --md-text-button-hover-label-text-color: var(\n            --yp-sys-color-agent-black\n          );\n          --md-text-button-container-color: var(--yp-sys-color-agent-black);\n        }\n\n        .stopVoiceButton {\n          height: 39px;\n          margin-top: 32px;\n          --md-outlined-button-label-text-color: var(\n            --yp-sys-color-agent-black\n          );\n          --md-outlined-button-focus-label-text-color: var(\n            --yp-sys-color-agent-black\n          );\n          --md-outlined-button-hover-label-text-color: var(\n            --yp-sys-color-agent-black\n          );\n          --md-outlined-button-label-text-weight: 600;\n          --md-outlined-button-label-text-size: 14px;\n        }\n\n        .you-chat-element {\n          align-self: flex-start;\n          justify-content: flex-start;\n        }\n\n        .assistant-chat-element {\n          align-self: flex-start;\n          justify-content: flex-start;\n          width: 100%;\n          max-width: 100%;\n        }\n\n        .chat-input {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n          padding: 0;\n        }\n\n        .chat-window {\n          width: 100%;\n          max-width: 768px;\n          margin: 0 auto;\n          border-radius: 10px;\n        }\n\n        .voice-input-container {\n          position: fixed;\n          padding-top: 12px;\n          top: 0;\n          left: 50%;\n          transform: translateX(-50%);\n          z-index: 2;\n          width: 768px;\n          height: 124px;\n          background: var(--md-sys-color-surface-container-lowest);\n        }\n\n        .voice-input-container[dialog-open] {\n          z-index: 1;\n        }\n\n        .voice-input {\n          position: fixed;\n          top: 0;\n          padding-top: 28px;\n          padding-bottom: 8px;\n          left: 50%;\n          transform: translateX(-50%);\n          width: 768px;\n          background: var(--md-sys-color-surface-container-lowest);\n        }\n\n        @media (max-width: 820px) {\n          .voice-input {\n            width: 100%;\n          }\n        }\n\n        .chat-input-container {\n          position: fixed;\n          bottom: 0;\n          left: 0;\n          width: 100vw;\n          z-index: 1;\n          height: 56px;\n          background: var(--md-sys-color-surface-container-lowest);\n        }\n\n        .chat-input-container[dialog-open] {\n          z-index: 0;\n        }\n\n        .chat-input {\n          position: fixed;\n          bottom: 0;\n          left: 0;\n          right: 0;\n          z-index: 1;\n          left: 50%;\n          height: 56px;\n          transform: translateX(-50%);\n          z-index: 1;\n          width: 768px;\n          padding: 0;\n          margin-bottom: 24px;\n          background: var(--md-sys-color-surface-container-lowest);\n        }\n\n        .hybrid-chat-messages {\n          padding-top: 140px;\n          padding-bottom: 130px;\n        }\n\n        /* Remove flex properties and height constraints */\n        .chat-window,\n        .hybrid-chat-messages {\n          display: block;\n          height: auto;\n          overflow: visible;\n        }\n\n        .assistantName {\n          font-size: 22px;\n          font-weight: 700;\n          color: var(--md-sys-color-on-surface);\n          line-height: 33px;\n          font-family: var(--md-ref-typeface-brand);\n          margin-top: -6px;\n          margin-left: 8px;\n        }\n\n        .nameAndStartStop {\n          margin-left: 24px;\n        }\n\n        .voiceClose {\n          margin-left: 20px;\n          margin-right: 6px;\n        }\n\n        .voiceAvatar {\n          align-items: left;\n          align-self: flex-start;\n        }\n\n        md-icon.voiceModeToggleIcon {\n          --md-icon-size: 40px;\n          width: 40px;\n          height: 40px;\n        }\n\n        md-fab {\n          --md-fab-container-shape: 4px;\n          --md-fab-label-text-size: 15px !important;\n          --md-fab-label-text-weight: 500 !important;\n          --md-fab-container-elevation: 0;\n          --md-fab-container-shadow-color: transparent;\n        }\n\n        md-fab:not([has-static-theme]) {\n          --md-sys-color-primary-container: var(--md-sys-color-primary);\n          --md-sys-color-on-primary-container: var(--md-sys-color-on-primary);\n        }\n\n        .currentMode {\n          font-size: 17px;\n          font-weight: 700;\n          color: var(--md-sys-color-on-surface);\n          margin-bottom: 16px;\n          font-family: var(--md-ref-typeface-brand);\n        }\n\n        .voice-header {\n          align-items: left;\n        }\n\n        .voice-header[voice-not-enabled] {\n          filter: grayscale(100%);\n        }\n\n        .talking-head-image {\n          width: 100px;\n          height: 100px;\n          border-radius: 50%;\n          object-fit: cover;\n        }\n\n        .waveform-canvas {\n          width: 100%;\n          height: 60px;\n          margin-top: 8px;\n          margin-left: 24px;\n          background: transparent;\n          border-radius: 0;\n          max-width: 100px;\n        }\n\n        .voice-controls {\n        }\n\n        md-filled-tonal-button {\n          border-radius: 4px;\n        }\n\n        .voice-button {\n          --md-icon-button-icon-size: 24px;\n          margin-right: 24px;\n        }\n\n        .voice-button[recording] {\n          --md-icon-button-container-color: var(--md-sys-color-error);\n          --md-icon-button-icon-color: var(--md-sys-color-on-error);\n          /* animation: pulse 2s infinite; */\n        }\n\n        @keyframes pulse {\n          0% {\n            transform: scale(1);\n            opacity: 1;\n          }\n          50% {\n            transform: scale(1.1);\n            opacity: 0.8;\n          }\n          100% {\n            transform: scale(1);\n            opacity: 1;\n          }\n        }\n\n        .infoMessage {\n          margin-top: 8px;\n        }\n\n        .chat-window {\n          display: flex;\n          flex-direction: column;\n          height: calc(100vh - 60px);\n          width: 768px;\n          max-width: 768px;\n          margin: 0 auto;\n          border-radius: 10px;\n        }\n\n        /* .chat-window[expanded] {\n          height: calc(100vh - 148px);\n        } */\n\n        .chat-messages {\n          display: flex;\n          flex-direction: column;\n          flex: 1;\n          padding: 20px;\n          overflow-y: scroll;\n        }\n\n        .you-chat-element {\n          align-self: flex-start;\n          max-width: 100%;\n          justify-content: flex-start;\n          margin-right: 32px;\n        }\n\n        .assistant-chat-element {\n          align-self: flex-start;\n          justify-content: flex-start;\n          width: 100%;\n          max-width: 100%;\n        }\n\n        .chat-input {\n          display: flex;\n          align-items: center;\n          justify-content: space-between;\n        }\n\n        md-filled-text-field {\n          flex: 1;\n          --md-filled-text-field-container-shape: 32px;\n          --md-filled-text-field-focus-active-indicator-color: transparent;\n          --md-filled-field-active-indicator-height: 0;\n          --md-filled-field-focus-active-indicator-height: 0;\n          --md-filled-field-hover-active-indicator-color: transparent;\n          --md-filled-field-leading-space: 24px;\n\n          border: none;\n          margin: 16px;\n          margin-bottom: 16px;\n          margin-left: 0;\n          margin-right: 0;\n          padding: 0px;\n          width: 768px !important;\n          --md-filled-text-field-container-color: #f4f4f4;\n          --md-filled-text-field-hover-container-color: #f4f4f4;\n          --md-icon-size: 32px;\n          --md-filled-text-field-label-text-color: #808080;\n        }\n\n        md-filled-text-field[dark-mode] {\n          --md-filled-text-field-container-color: var(\n            --md-sys-color-surface-container-highest\n          );\n        }\n\n        .chatElement[thinking] {\n          margin-top: 16px;\n          margin-bottom: 8px;\n        }\n\n        @media (max-width: 450px) {\n          md-filled-text-field {\n            width: 350px;\n          }\n\n          md-filled-text-field[focused] {\n            width: 100%;\n          }\n        }\n\n        @media (max-width: 400px) {\n          md-filled-text-field {\n            width: 320px;\n          }\n\n          md-filled-text-field[focused] {\n            width: 100%;\n          }\n        }\n\n        .agentBundleLogo {\n          width: 125px;\n          height: 39px;\n          margin-right: 64px;\n          z-index: 1;\n        }\n\n        .logoContainer {\n          padding: 16px;\n          z-index: 1;\n          position: fixed;\n          top: -15px;\n          left: -230px;\n        }\n\n        @media (max-width: 600px) {\n          .chat-window {\n          }\n\n          .you-chat-element {\n            margin-right: 0;\n          }\n        }\n      `,\n    ];\n  }\n\n  renderVoiceStartButton() {\n    return html`<svg\n      width=\"40\"\n      height=\"40\"\n      viewBox=\"0 0 40 40\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <circle cx=\"20\" cy=\"20\" r=\"20\" fill=\"#2ECC71\" />\n      <rect width=\"24\" height=\"24\" transform=\"translate(8 8)\" fill=\"#2ECC71\" />\n      <path\n        d=\"M15 29.5H17V31.5H15V29.5ZM20 20.5C21.66 20.5 23 19.16 23 17.5V11.5C23 9.84 21.66 8.5 20 8.5C18.34 8.5 17 9.84 17 11.5V17.5C17 19.16 18.34 20.5 20 20.5ZM19 11.5C19 10.95 19.45 10.5 20 10.5C20.55 10.5 21 10.95 21 11.5V17.5C21 18.06 20.56 18.5 20 18.5C19.45 18.5 19 18.05 19 17.5V11.5ZM19 29.5H21V31.5H19V29.5ZM23 29.5H25V31.5H23V29.5ZM27 17.5H25.3C25.3 20.5 22.76 22.6 20 22.6C17.24 22.6 14.7 20.5 14.7 17.5H13C13 20.91 15.72 23.73 19 24.22V27.5H21V24.22C24.28 23.73 27 20.91 27 17.5Z\"\n        fill=\"white\"\n      />\n    </svg> `;\n  }\n\n  renderBottomDisclaimer() {\n    return html`<div class=\"bottomDisclaimer\">\n      ${this.t(\"bottomAmplifierDisclaimer\")}\n    </div>`;\n  }\n\n  renderChatAssistantInput() {\n    return html`\n      ${this.showCleanupButton\n        ? html`\n            <md-outlined-icon-button\n              class=\"restartButton\"\n              @click=\"${() => this.fire(\"reset-chat\")}\"\n              ><md-icon>refresh</md-icon></md-outlined-icon-button\n            >\n          `\n        : nothing}\n      ${this.showCloseButton\n        ? html`\n            <md-outlined-icon-button\n              class=\"closeButton\"\n              @click=\"${() => this.fire(\"chatbot-close\")}\"\n              ><md-icon>close</md-icon></md-outlined-icon-button\n            >\n          `\n        : nothing}\n\n      <md-filled-text-field\n        class=\"textInput\"\n        type=\"text\"\n        ?dark-mode=\"${this.themeDarkMode}\"\n        hasTrailingIcon\n        id=\"chatInput\"\n        @focus=\"${() => (this.inputIsFocused = true)}\"\n        @blur=\"${() => (this.inputIsFocused = true)}\"\n        @keyup=\"${(e: KeyboardEvent) => {\n          if (e.key === \"Enter\") {\n            this.sendChatMessage();\n          }\n        }}\"\n        .label=\"${this.textInputLabel}\"\n      >\n        <div\n          class=\"sendChatIcon\"\n          @click=\"${() => this.sendChatMessage()}\"\n          slot=\"trailing-icon\"\n          id=\"sendButton\"\n          ?input-is-focused=\"${this.inputIsFocused}\"\n        >\n          <svg\n            width=\"32\"\n            height=\"32\"\n            viewBox=\"0 0 32 32\"\n            fill=\"none\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n          >\n            <circle cx=\"16\" cy=\"16\" r=\"16\" fill=\"#D7D7D7\" />\n            <path\n              d=\"M8.5332 16L9.8492 17.316L15.0665 12.108V23.4667H16.9332V12.108L22.1412 17.3253L23.4665 16L15.9999 8.53333L8.5332 16Z\"\n              fill=\"#F4F4F4\"\n            />\n          </svg>\n        </div>\n      </md-filled-text-field>\n    `;\n  }\n\n  startVoiceButtonClick() {\n    window.appGlobals.activity(`Assistant - start talking`);\n    this.toggleVoiceMode();\n  }\n\n  stopVoiceButtonClick() {\n    window.appGlobals.activity(`Assistant - stop talking`);\n    this.toggleVoiceMode();\n  }\n\n  renderStartStopVoiceIconButton() {\n    return html`\n      <md-icon-button\n        class=\"voice-mode-toggle ${this.voiceEnabled ? \"pulsing\" : \"\"}\"\n        @click=\"${this.startVoiceButtonClick}\"\n        .label=\"${this.voiceEnabled\n          ? this.t(\"closeAssistant\")\n          : this.t(\"voiceAssistant\")}\"\n        aria-pressed=\"${this.voiceEnabled}\"\n        aria-label=\"${this.voiceEnabled\n          ? this.t(\"closeAssistant\")\n          : this.t(\"voiceAssistant\")}\"\n      >\n        <md-icon class=\"voiceModeToggleIcon\">\n          ${this.renderVoiceStartButton()}\n        </md-icon>\n      </md-icon-button>\n\n      ${this.voiceEnabled\n        ? html`\n            <md-icon-button\n              hidden\n              class=\"voice-mode-toggle\"\n              @click=\"${this.stopVoiceButtonClick}\"\n              .label=\"${!this.voiceEnabled\n                ? this.t(\"voiceAssistant\")\n                : this.t(\"closeAssistant\")}\"\n            >\n              <md-icon class=\"voiceModeToggleIcon\"> cancel</md-icon>\n            </md-icon-button>\n          `\n        : nothing}\n    `;\n  }\n\n  renderStartStopVoiceButton() {\n    return html`\n      ${this.voiceEnabled\n        ? html`\n            <md-outlined-button\n              class=\"stopVoiceButton\"\n              @click=\"${this.stopVoiceButtonClick}\"\n            >\n              ${this.t(\"stopTalking\")}\n            </md-outlined-button>\n          `\n        : html`<md-elevated-button\n            class=\"talkToTheAssistantButton\"\n            @click=\"${this.startVoiceButtonClick}\"\n          >\n            ${this.t(\"startTalking\")}\n          </md-elevated-button>`}\n    `;\n  }\n\n  renderResetChatButton() {\n    return html`<md-text-button\n      class=\"resetChatButton\"\n      @click=\"${this.clearHistory}\"\n      >${this.t(\"resetWorkflow\")}</md-text-button\n    >`;\n  }\n\n  renderAssistantName() {\n    return html`<div class=\"assistantName\">\n      ${this.directAgentName ? this.directAgentName : this.t(\"mainAssistant\")}\n    </div>`;\n  }\n\n  renderVoiceInput() {\n    return html`\n      <div class=\"layout horizontal voiceAvatar\">\n        ${this.renderVoiceTalkingHead()}\n        <div class=\"nameAndStartStop layout vertical\">\n          ${this.renderAssistantName()}\n          <div class=\"layout horizontal\">\n            ${this.renderStartStopVoiceButton()}\n            <canvas\n              ?hidden=\"${!this.voiceEnabled}\"\n              id=\"waveformCanvas\"\n              class=\"waveform-canvas\"\n            ></canvas>\n            ${this.voiceEnabled ? html`` : this.renderResetChatButton()}\n          </div>\n        </div>\n        <div hidden class=\"currentMode\">${this.t(this.currentMode)}</div>\n      </div>\n    `;\n  }\n\n  private handleDialogOpen() {\n    // Clear any existing timeout\n    if (this.dialogClosingTimeout) {\n      clearTimeout(this.dialogClosingTimeout);\n    }\n    this.dialogOpen = true;\n  }\n\n  private handleDialogClose() {\n    // Set timeout to delay the dialog state change\n    this.dialogClosingTimeout = setTimeout(() => {\n      this.dialogOpen = false;\n    }, 500);\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"yp-assistant-base\": YpAssistantBase;\n  }\n}\n"]}