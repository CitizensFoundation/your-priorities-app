{"version":3,"file":"ps-agent-node.js","sourceRoot":"","sources":["../../src/policySynth/ps-agent-node.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from \"lit\";\nimport { property, query, customElement, state } from \"lit/decorators.js\";\n\nimport \"@material/web/iconbutton/icon-button.js\";\nimport \"@material/web/progress/circular-progress.js\";\nimport \"@material/web/progress/linear-progress.js\";\nimport \"@material/web/menu/menu.js\";\nimport \"@material/web/menu/menu-item.js\";\nimport \"@trystan2k/fleshy-jsoneditor/fleshy-jsoneditor.js\";\n\nimport { PsServerApi } from \"./PsServerApi.js\";\nimport { PsOperationsBaseNode } from \"./ps-operations-base-node.js\";\nimport { MdMenu } from \"@material/web/menu/menu.js\";\nimport { MdDialog } from \"@material/web/dialog/dialog.js\";\n\n@customElement(\"ps-agent-node\")\nexport class PsAgentNode extends PsOperationsBaseNode {\n  @property({ type: Object })\n  agent!: PsAgentAttributes;\n\n  @property({ type: Number })\n  agentId!: number;\n\n  @property({ type: Number }) groupId!: number;\n\n  @property({ type: Boolean, reflect: true }) running = false;\n\n  @state()\n  private agentState: \"running\" | \"paused\" | \"stopped\" | \"error\" | \"completed\" =\n    \"stopped\";\n\n  @state()\n  private latestMessage: string = \"\";\n\n  @state()\n  private progress: number | undefined;\n\n  @state()\n  private menuOpen = false;\n\n  @state()\n  private agentMemory: object | null = null;\n\n  @query(\"#connectorMenuAnchor\")\n  connectorMenuAnchor!: HTMLElement;\n\n  @query(\"#agentConnectorMenu\")\n  agentConnectorMenu!: MdMenu;\n\n  @query(\"#mainMenuAnchor\")\n  mainMenuAnchor!: HTMLElement;\n\n  @query(\"#agentMainMenu\")\n  agentMainMenu!: MdMenu;\n\n  @query(\"#memoryDialog\")\n  memoryDialog!: MdDialog;\n\n  override api: PsServerApi;\n  private statusInterval: number | undefined;\n\n  constructor() {\n    super();\n    this.api = new PsServerApi();\n  }\n\n  override firstUpdated() {\n    if (this.agentConnectorMenu && this.connectorMenuAnchor) {\n      (this.agentConnectorMenu as MdMenu).anchorElement =\n        this.connectorMenuAnchor;\n    }\n\n    if (this.agentMainMenu && this.mainMenuAnchor) {\n      (this.agentMainMenu as MdMenu).anchorElement = this.mainMenuAnchor;\n    }\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    this.agent = window.psAppGlobals.getAgentInstance(this.agentId)!;\n    this.updateAgentStatus(); // Initial status check\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.stopStatusUpdates();\n  }\n\n  toggleConnectorMenu(e: Event) {\n    e.stopPropagation();\n    if (this.agentConnectorMenu) {\n      this.agentConnectorMenu.open = !this.agentConnectorMenu.open;\n    }\n  }\n\n  toggleMainMenu(e: Event) {\n    e.stopPropagation();\n    if (this.agentMainMenu) {\n      this.agentMainMenu.open = !this.agentMainMenu.open;\n    }\n  }\n\n  async fetchAgentMemory() {\n    try {\n      const memory = await this.api.getAgentMemory(this.groupId, this.agent.id);\n      this.agentMemory = memory;\n      if (!this.agentMemory) {\n        this.agentMemory = { error: \"No memory available\" };\n      }\n    } catch (error) {\n      console.error(\"Error fetching agent memory:\", error);\n      this.agentMemory = { error: \"Failed to fetch agent memory\" };\n    }\n  }\n\n  openMemoryDialog() {\n    this.fetchAgentMemory();\n    this.memoryDialog.show();\n  }\n\n  addInputConnector() {\n    this.fire(\"add-connector\", { agentId: this.agent.id, type: \"input\" });\n    this.menuOpen = false;\n  }\n\n  addOutputConnector() {\n    this.fire(\"add-connector\", { agentId: this.agent.id, type: \"output\" });\n    this.menuOpen = false;\n  }\n\n  startStatusUpdates() {\n    this.statusInterval = window.setInterval(\n      () => this.updateAgentStatus(),\n      1000\n    );\n  }\n\n  stopStatusUpdates() {\n    if (this.statusInterval) {\n      clearInterval(this.statusInterval);\n      this.statusInterval = undefined;\n    }\n  }\n\n  async updateAgentStatus() {\n    try {\n      const status = await this.api.getAgentStatus(this.groupId, this.agent.id);\n      if (status) {\n        this.agentState = status.state as\n          | \"running\"\n          | \"paused\"\n          | \"stopped\"\n          | \"completed\"\n          | \"error\";\n        this.progress = status.progress;\n        this.latestMessage = status.messages[status.messages.length - 1] || \"\";\n\n        if (this.agentState === \"stopped\" || this.agentState === \"error\") {\n          this.stopStatusUpdates();\n        } else if (this.agentState === \"running\" && !this.statusInterval) {\n          console.log(\"Starting status updates from server\");\n          this.startStatusUpdates();\n        }\n\n        this.requestUpdate();\n        this.fire(\"get-costs\");\n\n        if (this.agentState === \"running\") {\n          this.running = true;\n        } else {\n          this.running = false;\n        }\n      }\n    } catch (error) {\n      console.error(\"Failed to get agent status:\", error);\n    }\n  }\n\n  async startAgent() {\n    try {\n      await this.api.startAgent(this.groupId, this.agent.id);\n      this.agentState = \"running\";\n      window.psAppGlobals.setCurrentRunningAgentId(this.agent.id);\n      this.startStatusUpdates();\n      this.requestUpdate();\n    } catch (error) {\n      console.error(\"Failed to start agent:\", error);\n    }\n  }\n\n  async pauseAgent() {\n    try {\n      await this.api.pauseAgent(this.groupId, this.agent.id);\n      this.agentState = \"paused\";\n      this.requestUpdate();\n    } catch (error) {\n      console.error(\"Failed to pause agent:\", error);\n    }\n  }\n\n  async stopAgent() {\n    try {\n      await this.api.stopAgent(this.groupId, this.agent.id);\n      this.agentState = \"stopped\";\n      window.psAppGlobals.setCurrentRunningAgentId(undefined);\n      this.stopStatusUpdates();\n      this.requestUpdate();\n    } catch (error) {\n      console.error(\"Failed to stop agent:\", error);\n    }\n  }\n\n  override editNode() {\n    this.fire(\"edit-node\", {\n      nodeId: this.nodeId,\n      element: this.agent,\n    });\n  }\n\n  renderMemoryDialog() {\n    return html`\n      <md-dialog id=\"memoryDialog\">\n        <div slot=\"headline\">${this.t(\"agentMemoryExplorer\")}</div>\n        <div slot=\"content\">\n          ${this.agentMemory && !(this.agentMemory as any).error\n            ? html`\n                <fleshy-jsoneditor\n                  style=\"height: 100%;\"\n                  .json=${this.agentMemory}\n                  mode=\"view\"\n                ></fleshy-jsoneditor>\n              `\n            : this.agentMemory && (this.agentMemory as any).error\n            ? html`${(this.agentMemory as any).error}`\n            : html`<md-linear-progress indeterminate></md-linear-progress>`}\n        </div>\n        <div slot=\"actions\">\n          <md-text-button @click=${() => this.memoryDialog.close()}>\n            ${this.t(\"close\")}\n          </md-text-button>\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  renderActionButtons() {\n    switch (this.agentState) {\n      case \"running\":\n        return html`\n          <md-icon-button class=\"playButtons\" @click=\"${this.pauseAgent}\" disabled>\n            <md-icon>pause</md-icon>\n          </md-icon-button>\n          <md-icon-button class=\"playButtons\" @click=\"${this.stopAgent}\">\n            <md-icon>stop</md-icon>\n          </md-icon-button>\n        `;\n      case \"paused\":\n        return html`\n          <md-icon-button class=\"playButtons\" @click=\"${this.startAgent}\">\n            <md-icon>play_circle</md-icon>\n          </md-icon-button>\n          <md-icon-button class=\"playButtons\" @click=\"${this.stopAgent}\">\n            <md-icon>stop</md-icon>\n          </md-icon-button>\n        `;\n      case \"stopped\":\n      case \"completed\":\n      case \"error\":\n        return html`\n          <md-icon-button class=\"playButtons\" @click=\"${this.startAgent}\">\n            <md-icon>play_circle</md-icon>\n          </md-icon-button>\n        `;\n    }\n  }\n\n  renderProgress() {\n    if (this.progress === undefined) {\n      return html`<md-linear-progress indeterminate></md-linear-progress>`;\n    } else {\n      const progress = Math.min(1, Math.max(0, this.progress / 100));\n      return html`<md-linear-progress\n        value=\"${progress}\"\n      ></md-linear-progress>`;\n    }\n  }\n\n  renderConnectorMenu() {\n    return html`\n      <md-icon-button\n        id=\"connectorMenuAnchor\"\n        @click=\"${this.toggleConnectorMenu}\"\n      >\n        <md-icon>add</md-icon>\n      </md-icon-button>\n      <md-menu id=\"agentConnectorMenu\" positioning=\"popover\">\n        <md-menu-item @click=\"${this.addInputConnector}\">\n          <div slot=\"headline\">Add Input Connector</div>\n        </md-menu-item>\n        <md-menu-item @click=\"${this.addOutputConnector}\">\n          <div slot=\"headline\">Add Output Connector</div>\n        </md-menu-item>\n      </md-menu>\n    `;\n  }\n\n  renderMainMenu() {\n    return html` <md-icon-button\n        id=\"mainMenuAnchor\"\n        @click=\"${this.toggleMainMenu}\"\n      >\n        <md-icon>more_horiz</md-icon>\n      </md-icon-button>\n      <md-menu id=\"agentMainMenu\" positioning=\"popover\">\n        <md-menu-item @click=\"${this.openMemoryDialog}\">\n          <div slot=\"headline\">Explore Memory</div>\n        </md-menu-item>\n        <md-menu-item @click=\"${this.editNode}\">\n          <div slot=\"headline\">Settings</div>\n        </md-menu-item>\n      </md-menu>`;\n  }\n  override render() {\n    if (!this.agent) return nothing;\n\n    return html`\n      <div class=\"mainContainer\">\n        <img\n          class=\"image\"\n          src=\"${this.agent.Class?.configuration.imageUrl}\"\n          alt=\"${this.agent.Class?.name}\"\n        />\n        <div class=\"contentContainer\">\n        <div class=\"agentClassName\">${this.agent.Class?.name}</div>\n        <div class=\"agentName\">${this.agent.configuration[\"name\"]}</div>\n          ${this.agentState === \"running\" ? this.renderProgress() : nothing}\n          <div class=\"statusMessage\">${this.latestMessage}</div>\n        </div>\n        <div class=\"buttonContainer\">\n          ${this.renderConnectorMenu()}\n          <div class=\"flex\"></div>\n\n          ${this.renderActionButtons()}\n          <div class=\"flex\"></div>\n\n          ${this.renderMainMenu()}\n        </div>\n      </div>\n      ${this.renderMemoryDialog()}\n    `;\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          display: block;\n        }\n\n        .playButtons {\n          --md-icon-button-icon-size: 34px;\n          width: 42px;\n          height: 42px;\n          margin-top: -16px;\n        }\n\n        #connectorMenuAnchor {\n          margin-bottom: 4px;\n        }\n\n        #mainMenuAnchor {\n          margin-bottom: 8px;\n        }\n\n        #memoryDialog {\n          width: 95vw;\n          height: 95vh;\n          max-width: 97vw;\n          max-height: 97vh;\n        }\n\n        .buttonContainer {\n          display: flex;\n          padding: 0px;\n          bottom: 0;\n          left: 0;\n          right: 0;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          position: absolute;\n        }\n\n        md-icon-button {\n          margin: 0 4px;\n        }\n\n        :host {\n          display: block;\n          position: relative;\n        }\n\n        .mainContainer {\n          position: relative;\n        }\n\n        md-menu {\n          --md-menu-container-color: var(--md-sys-color-surface-container);\n          --md-menu-container-elevation: 2;\n          z-index: 2000;\n        }\n\n        md-linear-progress {\n          margin: 16px;\n          margin-bottom: 8px;\n          margin-top: 8px;\n        }\n\n        .mainContainer {\n          height: 300px;\n          border-radius: 16px;\n          display: flex;\n          flex-direction: column;\n          overflow: hidden;\n          position: relative;\n        }\n\n        .image {\n          width: 100%;\n          height: 113px;\n          object-fit: cover;\n          border-radius: 16px 16px 0 0;\n        }\n\n        .contentContainer {\n          flex-grow: 1;\n          display: flex;\n          flex-direction: column;\n          padding: 8px;\n        }\n\n        .agentClassName {\n          font-size: 10px;\n          text-align: left;\n          margin: 8px;\n          margin-top: 0;\n          line-height: 15px;\n          font-weight: 500;\n          color: var(--md-sys-color-primary);\n          text-transform: uppercase;\n        }\n\n        .agentName {\n          font-size: 14px;\n          text-align: left;\n          font-weight: 700;\n          margin: 8px;\n          margin-top: 0;\n          margin-bottom: 0;\n          line-height: 22px;\n          font-family: var(--md-ref-typeface-brand);\n        }\n\n        .statusMessage {\n          font-size: 11px;\n          text-align: center;\n          margin-top: 8px;\n          border-radius: 16px;\n          flex-grow: 1;\n          color: var(--md-sys-color-on-surface-variant);\n        }\n\n\n        md-circular-progress {\n          --md-circular-progress-size: 28px;\n        }\n\n        md-menu {\n          --md-menu-z-index: 1000;\n          z-index: 1000;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      `,\n    ];\n  }\n}\n"]}