{"version":3,"file":"ps-agent-node.js","sourceRoot":"","sources":["../../src/policySynth/ps-agent-node.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from \"lit\";\nimport { property, query, customElement, state } from \"lit/decorators.js\";\n\nimport \"@material/web/iconbutton/icon-button.js\";\nimport \"@material/web/progress/circular-progress.js\";\nimport \"@material/web/progress/linear-progress.js\";\nimport \"@material/web/menu/menu.js\";\nimport \"@material/web/menu/menu-item.js\";\nimport \"@material/web/menu/sub-menu.js\";\nimport \"@material/web/divider/divider.js\";\n\nimport \"@trystan2k/fleshy-jsoneditor/fleshy-jsoneditor.js\";\n\nimport { PsServerApi } from \"./PsServerApi.js\";\nimport { PsOperationsBaseNode } from \"./ps-operations-base-node.js\";\nimport { MdMenu } from \"@material/web/menu/menu.js\";\nimport { MdDialog } from \"@material/web/dialog/dialog.js\";\nimport { YpConfirmationDialog } from \"../yp-dialog-container/yp-confirmation-dialog.js\";\n\n@customElement(\"ps-agent-node\")\nexport class PsAgentNode extends PsOperationsBaseNode {\n  @property({ type: Object })\n  agent!: PsAgentAttributes;\n\n  @property({ type: Number })\n  agentId!: number;\n\n  @property({ type: Boolean, reflect: true })\n  override hasStaticTheme!: boolean;\n\n  @property({ type: Number }) groupId!: number;\n\n  @property({ type: Boolean, reflect: true }) running = false;\n\n  @state()\n  private agentState: \"running\" | \"paused\" | \"stopped\" | \"error\" | \"completed\" =\n    \"stopped\";\n\n  @state()\n  private latestMessage: string = \"\";\n\n  @state()\n  private progress: number | undefined;\n\n  @state()\n  private menuOpen = false;\n\n  @state()\n  private agentMemory: object | null = null;\n\n  @query(\"#connectorMenuAnchor\")\n  connectorMenuAnchor!: HTMLElement;\n\n  @query(\"#agentConnectorMenu\")\n  agentConnectorMenu!: MdMenu;\n\n  @query(\"#mainMenuAnchor\")\n  mainMenuAnchor!: HTMLElement;\n\n  @query(\"#agentMainMenu\")\n  agentMainMenu!: MdMenu;\n\n  @query(\"#memoryDialog\")\n  memoryDialog!: MdDialog;\n\n  @query(\"#fileInput\")\n  fileInput!: HTMLInputElement;\n\n  override api: PsServerApi;\n  private statusInterval: number | undefined;\n\n  constructor() {\n    super();\n    this.api = new PsServerApi();\n  }\n\n  override firstUpdated() {\n    if (this.agentConnectorMenu && this.connectorMenuAnchor) {\n      (this.agentConnectorMenu as MdMenu).anchorElement =\n        this.connectorMenuAnchor;\n    }\n\n    if (this.agentMainMenu && this.mainMenuAnchor) {\n      (this.agentMainMenu as MdMenu).anchorElement = this.mainMenuAnchor;\n    }\n  }\n\n  override connectedCallback(): void {\n    super.connectedCallback();\n    this.agent = window.psAppGlobals.getAgentInstance(this.agentId)!;\n    this.updateAgentStatus(); // Initial status check\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.stopStatusUpdates();\n  }\n\n  private getSafeFileName(name: string): string {\n    const safeName = name.toLowerCase().replace(/\\s+/g, \"_\");\n    const date = new Date();\n    const dateString = `${date.getFullYear()}${(date.getMonth() + 1)\n      .toString()\n      .padStart(2, \"0\")}${date.getDate().toString().padStart(2, \"0\")}_${date\n      .getHours()\n      .toString()\n      .padStart(2, \"0\")}${date.getMinutes().toString().padStart(2, \"0\")}`;\n    return `${safeName}_memory_${dateString}.json`;\n  }\n\n  async saveMemoryToFile() {\n    try {\n      const memory = await this.api.getAgentMemory(this.groupId, this.agent.id);\n      if (memory) {\n        const fileName = this.getSafeFileName(this.agent.configuration.name);\n        const jsonString = JSON.stringify(memory, null, 2);\n        const blob = new Blob([jsonString], { type: \"application/json\" });\n        const url = URL.createObjectURL(blob);\n\n        const link = document.createElement(\"a\");\n        link.href = url;\n        link.download = fileName;\n\n        // Append to the document body to work in Firefox\n        document.body.appendChild(link);\n        link.click();\n\n        // Clean up\n        document.body.removeChild(link);\n        URL.revokeObjectURL(url);\n      } else {\n        console.error(\"No memory available to save\");\n      }\n    } catch (error) {\n      console.error(\"Error saving agent memory:\", error);\n    }\n  }\n\n  triggerFileInput() {\n    this.fileInput.click();\n  }\n\n  handleFileSelect(event: Event) {\n    const file = (event.target as HTMLInputElement).files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        try {\n          const content = JSON.parse(e.target?.result as string);\n          this.confirmLoadMemory(content);\n        } catch (error) {\n          console.error(\"Error parsing JSON file:\", error);\n        }\n      };\n      reader.readAsText(file);\n    }\n  }\n\n  confirmLoadMemory(content: any) {\n    window.appDialogs.getDialogAsync(\n      \"confirmationDialog\",\n      (dialog: YpConfirmationDialog) => {\n        dialog.open(\n          this.t(\"confirmLoadAndOverrideMemory\"),\n          () =>\n            this.loadMemoryFromContent(content),\n          true,\n          true\n        );\n      }\n    );\n  }\n\n  async loadMemoryFromContent(content: any) {\n    try {\n      await this.api.replaceAgentMemory(this.groupId, this.agent.id, content);\n      this.agentMemory = content;\n      this.requestUpdate();\n    } catch (error) {\n      console.error(\"Error loading agent memory:\", error);\n    }\n  }\n\n  toggleConnectorMenu(e: Event) {\n    e.stopPropagation();\n    if (this.agentConnectorMenu) {\n      this.agentConnectorMenu.open = !this.agentConnectorMenu.open;\n    }\n  }\n\n  toggleMainMenu(e: Event) {\n    e.stopPropagation();\n    if (this.agentMainMenu) {\n      this.agentMainMenu.open = !this.agentMainMenu.open;\n    }\n  }\n\n  async fetchAgentMemory() {\n    try {\n      const memory = await this.api.getAgentMemory(this.groupId, this.agent.id);\n      this.agentMemory = memory;\n      if (!this.agentMemory) {\n        this.agentMemory = { error: \"No memory available\" };\n      }\n    } catch (error) {\n      console.error(\"Error fetching agent memory:\", error);\n      this.agentMemory = { error: \"Failed to fetch agent memory\" };\n    }\n  }\n\n  openMemoryDialog() {\n    this.fetchAgentMemory();\n    this.memoryDialog.show();\n  }\n\n  addInputConnector() {\n    this.fire(\"add-connector\", { agentId: this.agent.id, type: \"input\" });\n    this.menuOpen = false;\n  }\n\n  addOutputConnector() {\n    this.fire(\"add-connector\", { agentId: this.agent.id, type: \"output\" });\n    this.menuOpen = false;\n  }\n\n  addExistingConnector(connectorId: number, type: \"input\" | \"output\") {\n    this.fire(\"add-existing-connector\", {\n      agentId: this.agent.id,\n      connectorId,\n      type,\n    });\n  }\n\n  startStatusUpdates() {\n    this.statusInterval = window.setInterval(\n      () => this.updateAgentStatus(),\n      1000\n    );\n  }\n\n  stopStatusUpdates() {\n    if (this.statusInterval) {\n      clearInterval(this.statusInterval);\n      this.statusInterval = undefined;\n    }\n  }\n\n  async updateAgentStatus() {\n    try {\n      const status = await this.api.getAgentStatus(this.groupId, this.agent.id);\n      if (status) {\n        this.agentState = status.state as\n          | \"running\"\n          | \"paused\"\n          | \"stopped\"\n          | \"completed\"\n          | \"error\";\n        this.progress = status.progress;\n        this.latestMessage = status.messages[status.messages.length - 1] || \"\";\n\n        if (this.agentState === \"stopped\" || this.agentState === \"error\") {\n          this.stopStatusUpdates();\n        } else if (this.agentState === \"running\" && !this.statusInterval) {\n          console.log(\"Starting status updates from server\");\n          this.startStatusUpdates();\n        }\n\n        this.requestUpdate();\n        this.fire(\"get-costs\");\n\n        if (this.agentState === \"running\") {\n          this.running = true;\n        } else {\n          this.running = false;\n        }\n      }\n    } catch (error) {\n      console.error(\"Failed to get agent status:\", error);\n    }\n  }\n\n  async startAgent() {\n    try {\n      await this.api.startAgent(this.groupId, this.agent.id);\n      this.agentState = \"running\";\n      window.psAppGlobals.setCurrentRunningAgentId(this.agent.id);\n      this.startStatusUpdates();\n      this.requestUpdate();\n    } catch (error) {\n      console.error(\"Failed to start agent:\", error);\n    }\n  }\n\n  async pauseAgent() {\n    try {\n      await this.api.pauseAgent(this.groupId, this.agent.id);\n      this.agentState = \"paused\";\n      this.requestUpdate();\n    } catch (error) {\n      console.error(\"Failed to pause agent:\", error);\n    }\n  }\n\n  async stopAgent() {\n    try {\n      await this.api.stopAgent(this.groupId, this.agent.id);\n      this.agentState = \"stopped\";\n      window.psAppGlobals.setCurrentRunningAgentId(undefined);\n      this.stopStatusUpdates();\n      this.requestUpdate();\n    } catch (error) {\n      console.error(\"Failed to stop agent:\", error);\n    }\n  }\n\n  override editNode() {\n    this.fire(\"edit-node\", {\n      nodeId: this.nodeId,\n      element: this.agent,\n    });\n  }\n\n  renderMemoryDialog() {\n    return html`\n      <md-dialog id=\"memoryDialog\">\n        <div slot=\"headline\">${this.t(\"agentMemoryExplorer\")}</div>\n        <div slot=\"content\">\n          ${this.agentMemory && !(this.agentMemory as any).error\n            ? html`\n                <fleshy-jsoneditor\n                  style=\"height: 100%;\"\n                  .json=${this.agentMemory}\n                  mode=\"view\"\n                ></fleshy-jsoneditor>\n              `\n            : this.agentMemory && (this.agentMemory as any).error\n            ? html`${(this.agentMemory as any).error}`\n            : html`<md-linear-progress indeterminate></md-linear-progress>`}\n        </div>\n        <div slot=\"actions\">\n          <md-text-button @click=${() => this.memoryDialog.close()}>\n            ${this.t(\"close\")}\n          </md-text-button>\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  renderActionButtons() {\n    switch (this.agentState) {\n      case \"running\":\n        return html`\n          <md-icon-button hidden\n            class=\"playButtons\"\n            @click=\"${this.pauseAgent}\"\n            disabled\n          >\n            <md-icon>pause</md-icon>\n          </md-icon-button>\n          <md-icon-button class=\"playButtons\" @click=\"${this.stopAgent}\">\n            <md-icon>stop</md-icon>\n          </md-icon-button>\n        `;\n      case \"paused\":\n        return html`\n          <md-icon-button class=\"playButtons\" @click=\"${this.startAgent}\">\n            <md-icon>play_circle</md-icon>\n          </md-icon-button>\n          <md-icon-button class=\"playButtons\" @click=\"${this.stopAgent}\">\n            <md-icon>stop</md-icon>\n          </md-icon-button>\n        `;\n      case \"stopped\":\n      case \"completed\":\n      case \"error\":\n        return html`\n          <md-icon-button class=\"playButtons\" @click=\"${this.startAgent}\">\n            <md-icon>play_circle</md-icon>\n          </md-icon-button>\n        `;\n    }\n  }\n\n  renderProgress() {\n    if (this.progress === undefined) {\n      return html`<md-linear-progress indeterminate></md-linear-progress>`;\n    } else {\n      const progress = Math.min(1, Math.max(0, this.progress / 100));\n      return html`<md-linear-progress\n        value=\"${progress}\"\n      ></md-linear-progress>`;\n    }\n  }\n\n  renderConnectorMenu() {\n    if (window.psAppGlobals.activeConnectorsInstanceRegistry) {\n      const allConnectors = Array.from(\n        window.psAppGlobals.activeConnectorsInstanceRegistry.values()\n      );\n      const currentConnectorIds = new Set([\n        ...(this.agent.InputConnectors?.map((c) => c.id) || []),\n        ...(this.agent.OutputConnectors?.map((c) => c.id) || []),\n      ]);\n      const availableConnectors = allConnectors.filter(\n        (c) => !currentConnectorIds.has(c.id)\n      );\n\n      return html`\n        <md-icon-button\n          id=\"connectorMenuAnchor\"\n          @click=\"${this.toggleConnectorMenu}\"\n        >\n          <md-icon>add</md-icon>\n        </md-icon-button>\n        <md-menu\n          has-overflow\n          id=\"agentConnectorMenu\"\n          anchor=\"connectorMenuAnchor\"\n          positioning=\"popover\"\n          quick\n        >\n          <md-menu-item @click=\"${this.addInputConnector}\">\n            <div slot=\"headline\">Add Input Connector</div>\n          </md-menu-item>\n          <md-menu-item @click=\"${this.addOutputConnector}\">\n            <div slot=\"headline\">Add Output Connector</div>\n          </md-menu-item>\n\n          ${availableConnectors.length > 0\n            ? html`\n                <md-divider></md-divider>\n                <md-sub-menu positioning=\"popover\">\n                  <md-menu-item slot=\"item\">\n                    <div slot=\"headline\">Add Existing Connector</div>\n                    <md-icon slot=\"end\">arrow_right</md-icon>\n                  </md-menu-item>\n                  <md-menu slot=\"menu\" positioning=\"popover\">\n                    ${availableConnectors.map(\n                      (connector) => html`\n                        <md-sub-menu>\n                          <md-menu-item slot=\"item\">\n                            <div slot=\"headline\">\n                              ${connector.configuration.name}\n                            </div>\n                            <md-icon slot=\"end\">arrow_right</md-icon>\n                          </md-menu-item>\n                          <md-menu slot=\"menu\" positioning=\"popover\">\n                            <md-menu-item\n                              @click=\"${() =>\n                                this.addExistingConnector(\n                                  connector.id,\n                                  \"input\"\n                                )}\"\n                            >\n                              <div slot=\"headline\">Add as Input</div>\n                            </md-menu-item>\n                            <md-menu-item\n                              @click=\"${() =>\n                                this.addExistingConnector(\n                                  connector.id,\n                                  \"output\"\n                                )}\"\n                            >\n                              <div slot=\"headline\">Add as Output</div>\n                            </md-menu-item>\n                          </md-menu>\n                        </md-sub-menu>\n                      `\n                    )}\n                  </md-menu>\n                </md-sub-menu>\n              `\n            : \"\"}\n        </md-menu>\n      `;\n    } else {\n      console.warn(\"activeConnectorsInstanceRegistry is not available\");\n      return nothing;\n    }\n  }\n\n  renderMainMenu() {\n    return html` <md-icon-button\n        id=\"mainMenuAnchor\"\n        @click=\"${this.toggleMainMenu}\"\n      >\n        <md-icon>more_horiz</md-icon>\n      </md-icon-button>\n      <md-menu id=\"agentMainMenu\" positioning=\"popover\">\n        <md-menu-item @click=\"${this.editNode}\">\n          <div slot=\"headline\">Settings</div>\n        </md-menu-item>\n        <md-menu-item @click=\"${this.saveMemoryToFile}\">\n          <div slot=\"headline\">Save Memory to File</div>\n        </md-menu-item>\n        <md-menu-item @click=\"${this.triggerFileInput}\">\n          <div slot=\"headline\">Load Memory from File</div>\n        </md-menu-item>\n        <md-menu-item @click=\"${this.openMemoryDialog}\">\n          <div slot=\"headline\">Explore Memory</div>\n        </md-menu-item>\n      </md-menu>\n      <input\n        type=\"file\"\n        id=\"fileInput\"\n        @change=\"${this.handleFileSelect}\"\n        accept=\".json\"\n        style=\"display: none;\"\n      />`;\n  }\n\n  override render() {\n    if (!this.agent) return nothing;\n\n    return html`\n      <div class=\"mainContainer\">\n        <img\n          class=\"image\"\n          src=\"${this.agent.Class?.configuration.imageUrl}\"\n          alt=\"${this.agent.Class?.name}\"\n        />\n        <div class=\"contentContainer\">\n          <div class=\"agentClassName\">${this.agent.Class?.name}</div>\n          <div class=\"agentName\">${this.agent.configuration[\"name\"]}</div>\n          ${this.agentState === \"running\" ? this.renderProgress() : nothing}\n          <div class=\"statusMessage\">${this.latestMessage}</div>\n        </div>\n        <div class=\"buttonContainer\">\n          ${this.renderConnectorMenu()}\n          <div class=\"flex\"></div>\n\n          ${this.renderActionButtons()}\n          <div class=\"flex\"></div>\n\n          ${this.renderMainMenu()}\n        </div>\n      </div>\n      ${this.renderMemoryDialog()}\n    `;\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          display: block;\n        }\n\n        .playButtons {\n          --md-icon-button-icon-size: 34px;\n          width: 42px;\n          height: 42px;\n          margin-top: -16px;\n        }\n\n        #connectorMenuAnchor {\n          margin-bottom: 4px;\n        }\n\n        #mainMenuAnchor {\n          margin-bottom: 8px;\n        }\n\n        #memoryDialog {\n          width: 95vw;\n          height: 95vh;\n          max-width: 97vw;\n          max-height: 97vh;\n        }\n\n        .buttonContainer {\n          display: flex;\n          padding: 0px;\n          bottom: 0;\n          left: 0;\n          right: 0;\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          position: absolute;\n        }\n\n        md-icon-button {\n          margin: 0 4px;\n        }\n\n        :host {\n          display: block;\n          position: relative;\n        }\n\n        .mainContainer {\n          position: relative;\n        }\n\n        md-menu {\n          --md-menu-container-color: var(--md-sys-color-surface-container);\n          --md-menu-container-elevation: 2;\n          z-index: 2000;\n        }\n\n        md-linear-progress {\n          margin: 16px;\n          margin-bottom: 8px;\n          margin-top: 8px;\n        }\n\n        .mainContainer {\n          height: 300px;\n          border-radius: 16px;\n          display: flex;\n          flex-direction: column;\n          overflow: hidden;\n          position: relative;\n        }\n\n        .image {\n          width: 100%;\n          height: 113px;\n          object-fit: cover;\n          border-radius: 16px 16px 0 0;\n        }\n\n        .contentContainer {\n          flex-grow: 1;\n          display: flex;\n          flex-direction: column;\n          padding: 8px;\n        }\n\n        .agentClassName {\n          font-size: 10px;\n          text-align: left;\n          margin: 8px;\n          margin-top: 0;\n          line-height: 15px;\n          font-weight: 500;\n          color: var(--md-sys-color-tertiary);\n          text-transform: uppercase;\n        }\n\n        .agentName {\n          font-size: 14px;\n          text-align: left;\n          font-weight: 700;\n          margin: 8px;\n          margin-top: 0;\n          margin-bottom: 0;\n          line-height: 22px;\n          font-family: var(--md-ref-typeface-brand);\n        }\n\n        .statusMessage {\n          font-size: 11px;\n          text-align: center;\n          margin-top: 8px;\n          border-radius: 16px;\n          flex-grow: 1;\n          color: var(--md-sys-color-on-surface-variant);\n        }\n\n        md-circular-progress {\n          --md-circular-progress-size: 28px;\n        }\n\n        md-menu {\n          --md-menu-z-index: 1000;\n          z-index: 1000;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      `,\n    ];\n  }\n}\n"]}