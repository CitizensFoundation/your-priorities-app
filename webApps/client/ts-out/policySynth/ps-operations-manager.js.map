{"version":3,"file":"ps-operations-manager.js","sourceRoot":"","sources":["../../src/policySynth/ps-operations-manager.ts"],"names":[],"mappings":"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","sourcesContent":["import { PropertyValueMap, css, html, nothing } from \"lit\";\nimport { property, customElement, query, state } from \"lit/decorators.js\";\n\nimport \"@material/web/iconbutton/icon-button.js\";\nimport \"@material/web/progress/linear-progress.js\";\nimport \"@material/web/tabs/tabs.js\";\nimport \"@material/web/tabs/primary-tab.js\";\nimport \"@material/web/textfield/outlined-text-field.js\";\nimport \"@material/web/iconbutton/outlined-icon-button.js\";\nimport \"@material/web/button/filled-tonal-button.js\";\nimport \"@vaadin/grid\";\nimport \"@vaadin/grid/vaadin-grid-sort-column.js\";\n\nimport { MdOutlinedTextField } from \"@material/web/textfield/outlined-text-field.js\";\nimport { MdTabs } from \"@material/web/tabs/tabs.js\";\n\nimport \"./ps-operations-view.js\";\nimport \"./PsServerApi.js\";\nimport { PsServerApi } from \"./PsServerApi.js\";\n\nimport \"./ps-edit-node-dialog.js\";\nimport \"./ps-add-agent-dialog.js\";\nimport \"./ps-add-connector-dialog.js\";\n\nimport { PsOperationsView } from \"./ps-operations-view.js\";\nimport { PsAiModelSize } from \"@policysynth/agents/aiModelTypes.js\";\nimport { PsBaseWithRunningAgentObserver } from \"./ps-base-with-running-agents.js\";\nimport { PsAppGlobals } from \"./PsAppGlobals.js\";\nimport { YpFormattingHelpers } from \"../common/YpFormattingHelpers.js\";\n\n@customElement(\"ps-operations-manager\")\nexport class PsOperationsManager extends PsBaseWithRunningAgentObserver {\n  @property({ type: Number })\n  currentAgentId: number | undefined = 1;\n\n  @property({ type: Number })\n  totalCosts: number | undefined;\n\n  @property({ type: Object })\n  currentAgent: PsAgentAttributes | undefined;\n\n  @property({ type: Boolean })\n  isFetchingAgent = false;\n\n  @property({ type: Object })\n  nodeToEditInfo: PsAgentAttributes | PsAgentConnectorAttributes | undefined;\n\n  @property({ type: Number })\n  activeTabIndex = 0;\n\n  @property({ type: Boolean })\n  showEditNodeDialog = false;\n\n  @property({ type: Boolean })\n  showAddAgentDialog = false;\n\n  @property({ type: Boolean })\n  showAddConnectorDialog = false;\n\n  @property({ type: Number })\n  selectedAgentIdForConnector: number | null = null;\n\n  @property({ type: String })\n  selectedInputOutputType: string | null = null;\n\n  @query(\"ps-operations-view\")\n  agentElement!: PsOperationsView;\n\n  @property({ type: Number })\n  groupId = 30995; //!: number;\n\n  @state()\n  detailedCosts: PsDetailedAgentCostResults[] = [];\n\n  private activeAiModels: PsAiModelAttributes[] = [];\n\n  api: PsServerApi;\n\n  constructor() {\n    super();\n    this.api = new PsServerApi();\n    window.psAppGlobals = new PsAppGlobals(this.api);\n  }\n\n  async getAgent() {\n    this.isFetchingAgent = true;\n    try {\n      if (!this.groupId) {\n        throw new Error(\"Current group ID is not set\");\n      }\n      const agent = await this.api.getAgent(this.groupId);\n      this.currentAgent = agent;\n      this.currentAgentId = agent.id;\n    } catch (error) {\n      console.error(\"Error fetching agent:\", error);\n    } finally {\n      this.isFetchingAgent = false;\n    }\n  }\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    this.getAgent();\n\n    this.addEventListener(\n      \"edit-node\",\n      this.openEditNodeDialog as EventListenerOrEventListenerObject\n    );\n    this.addEventListener(\n      \"add-connector\",\n      this.openAddConnectorDialog as EventListenerOrEventListenerObject\n    );\n    this.addEventListener(\n      \"get-costs\",\n      this.fetchAgentCosts as EventListenerOrEventListenerObject\n    );\n    this.addEventListener(\n      \"add-agent\",\n      this.openAddAgentDialog as EventListenerOrEventListenerObject\n    );\n  }\n\n  async fetchAgentCosts() {\n    if (this.currentAgentId) {\n      try {\n        this.totalCosts = await this.api.getAgentCosts(\n          this.groupId,\n          this.currentAgentId\n        );\n      } catch (error) {\n        console.error(\"Error fetching agent costs:\", error);\n      }\n    }\n  }\n\n  // Add this method to fetch and set active AI models\n  async fetchActiveAiModels() {\n    try {\n      this.activeAiModels = await this.api.getActiveAiModels(this.groupId);\n    } catch (error) {\n      console.error(\"Error fetching active AI models:\", error);\n    }\n  }\n\n  async handleEditDialogSave(event: CustomEvent) {\n    const { updatedConfig, aiModelUpdates } = event.detail;\n    const isInputConnector = event.detail.connectorType === \"input\";\n\n    if (!this.nodeToEditInfo) return;\n\n    try {\n      const nodeType =\n        \"Class\" in this.nodeToEditInfo &&\n        this.nodeToEditInfo.Class?.name.toLowerCase().includes(\"agent\")\n          ? \"agent\"\n          : \"connector\";\n      const nodeId = this.nodeToEditInfo.id;\n\n      await this.api.updateNodeConfiguration(\n        this.groupId,\n        nodeType,\n        nodeId,\n        updatedConfig\n      );\n\n      // Handle AI model updates for agents\n      if (nodeType === \"agent\" && aiModelUpdates) {\n        const currentAiModels = await this.api.getAgentAiModels(\n          this.groupId,\n          nodeId\n        );\n\n        for (const update of aiModelUpdates) {\n          const currentModel = currentAiModels.find(\n            (m) => m.configuration.modelSize === update.size\n          );\n\n          if (currentModel && update.modelId === null) {\n            await this.api.removeAgentAiModel(\n              this.groupId,\n              nodeId,\n              currentModel.id\n            );\n          } else if (\n            update.modelId !== null &&\n            currentModel?.id !== update.modelId\n          ) {\n            if (currentModel) {\n              await this.api.removeAgentAiModel(\n                this.groupId,\n                nodeId,\n                currentModel.id\n              );\n            }\n            await this.api.addAgentAiModel(\n              this.groupId,\n              nodeId,\n              update.modelId,\n              update.size\n            );\n          }\n        }\n      }\n\n      // Update the local state\n      if (nodeType === \"agent\") {\n        this.currentAgent = {\n          ...this.currentAgent!,\n          configuration: {\n            ...this.currentAgent!.configuration,\n            ...updatedConfig,\n          },\n        };\n\n        // Update AI models in local state\n        if (aiModelUpdates) {\n          const updatedAiModels = this.currentAgent!.AiModels!.filter(\n            (model) =>\n              !aiModelUpdates.some(\n                (update: { size: PsAiModelSize; modelId: number | null }) =>\n                  update.size === model.configuration.modelSize\n              )\n          );\n\n          for (const update of aiModelUpdates) {\n            if (update.modelId !== null) {\n              const newModel = this.activeAiModels.find(\n                (m) => m.id === update.modelId\n              );\n              if (newModel) {\n                updatedAiModels.push(newModel);\n              }\n            }\n          }\n\n          this.currentAgent = {\n            ...this.currentAgent!,\n            AiModels: updatedAiModels,\n          };\n        }\n      } else {\n        // Update connector (unchanged from your original code)\n        if (isInputConnector) {\n          const updatedInputConnectors =\n            this.currentAgent!.InputConnectors!.map((connector) =>\n              connector.id === nodeId\n                ? {\n                    ...connector,\n                    configuration: {\n                      ...connector.configuration,\n                      ...updatedConfig,\n                    },\n                  }\n                : connector\n            );\n          this.currentAgent = {\n            ...this.currentAgent!,\n            InputConnectors: updatedInputConnectors,\n          };\n        } else {\n          const updatedOutputConnectors =\n            this.currentAgent!.OutputConnectors!.map((connector) =>\n              connector.id === nodeId\n                ? {\n                    ...connector,\n                    configuration: {\n                      ...connector.configuration,\n                      ...updatedConfig,\n                    },\n                  }\n                : connector\n            );\n          this.currentAgent = {\n            ...this.currentAgent!,\n            OutputConnectors: updatedOutputConnectors,\n          };\n        }\n      }\n\n      this.requestUpdate();\n      this.showEditNodeDialog = false;\n    } catch (error) {\n      console.error(\"Failed to update node configuration:\", error);\n      // You might want to show an error message to the user here\n    }\n  }\n\n  openEditNodeDialog(event: CustomEvent) {\n    this.nodeToEditInfo = event.detail.element;\n    this.showEditNodeDialog = true;\n  }\n\n  openAddConnectorDialog(event: CustomEvent) {\n    this.selectedAgentIdForConnector = event.detail.agentId;\n    this.selectedInputOutputType = event.detail.type;\n    this.showAddConnectorDialog = true;\n  }\n\n  openAddAgentDialog(event: CustomEvent) {\n    this.showAddAgentDialog = true;\n  }\n\n  randomizeTheme() {\n    const randomColor = Math.floor(Math.random() * 16777215).toString(16);\n    this.fire(\"yp-theme-color\", `#${randomColor}`);\n  }\n\n  renderTotalCosts() {\n    return html`${this.t(\"Costs\")}\n    ${this.totalCosts !== undefined ? `($${this.totalCosts.toFixed(2)})` : \"\"}`;\n  }\n\n  async getDetailedAgentCosts() {\n    if (this.currentAgentId) {\n      try {\n        this.detailedCosts = await this.api.getDetailedAgentCosts(\n          this.groupId,\n          this.currentAgentId\n        );\n        this.requestUpdate();\n      } catch (error) {\n        console.error(\"Error fetching detailed agent costs:\", error);\n      }\n    }\n  }\n\n  renderDetailedCostsTab() {\n    return html`\n      <vaadin-grid .items=\"${this.detailedCosts}\">\n        <vaadin-grid-sort-column\n          hidden\n          path=\"createdAt\"\n          header=\"${this.t(\"Date\")}\"\n        ></vaadin-grid-sort-column>\n        <vaadin-grid-sort-column\n          path=\"agentName\"\n          header=\"${this.t(\"Agent\")}\"\n        ></vaadin-grid-sort-column>\n        <vaadin-grid-sort-column\n          path=\"aiModelName\"\n          header=\"${this.t(\"AI Model\")}\"\n          auto-width\n        ></vaadin-grid-sort-column>\n        <vaadin-grid-sort-column\n          path=\"tokenInCount\"\n          header=\"${this.t(\"Tokens In\")}\"\n          .renderer=\"${(\n            root: HTMLElement,\n            _column: unknown,\n            rowData: { item: PsDetailedAgentCostResults }\n          ) => {\n            root.textContent = `${YpFormattingHelpers.number(\n              rowData.item.tokenInCount\n            )}`;\n          }}\"\n        ></vaadin-grid-sort-column>\n        <vaadin-grid-sort-column\n          path=\"tokenOutCount\"\n          header=\"${this.t(\"Tokens Out\")}\"\n          .renderer=\"${(\n            root: HTMLElement,\n            _column: unknown,\n            rowData: { item: PsDetailedAgentCostResults }\n          ) => {\n            root.textContent = `${YpFormattingHelpers.number(\n              rowData.item.tokenOutCount\n            )}`;\n          }}\"\n        ></vaadin-grid-sort-column>\n        <vaadin-grid-sort-column\n          path=\"costIn\"\n          header=\"${this.t(\"Cost In\")}\"\n          .renderer=\"${(\n            root: HTMLElement,\n            _column: unknown,\n            rowData: { item: PsDetailedAgentCostResults }\n          ) => {\n            root.textContent = `$${rowData.item.costIn.toFixed(4)}`;\n          }}\"\n        >\n        </vaadin-grid-sort-column>\n        <vaadin-grid-sort-column\n          path=\"costOut\"\n          header=\"${this.t(\"Cost Out\")}\"\n          .renderer=\"${(\n            root: HTMLElement,\n            _column: unknown,\n            rowData: { item: PsDetailedAgentCostResults }\n          ) => {\n            root.textContent = `$${rowData.item.costOut.toFixed(4)}`;\n          }}\"\n        >\n        </vaadin-grid-sort-column>\n        <vaadin-grid-sort-column\n          path=\"totalCost\"\n          header=\"${this.t(\"Total Cost\")}\"\n          .renderer=\"${(\n            root: HTMLElement,\n            _column: unknown,\n            rowData: { item: PsDetailedAgentCostResults }\n          ) => {\n            root.textContent = `$${rowData.item.totalCost.toFixed(4)}`;\n          }}\"\n        >\n        </vaadin-grid-sort-column>\n      </vaadin-grid>\n    `;\n  }\n\n  tabChanged() {\n    this.activeTabIndex = (this.$$(\"#tabBar\") as MdTabs).activeTabIndex;\n    if (this.activeTabIndex === 2) {\n      // Assuming the costs tab is the third tab (index 2)\n      this.getDetailedAgentCosts();\n    }\n  }\n\n  override render() {\n    if (this.isFetchingAgent) {\n      return html`<md-linear-progress indeterminate></md-linear-progress>`;\n    } else {\n      return html`\n        <ps-edit-node-dialog\n          ?open=\"${this.showEditNodeDialog}\"\n          .nodeToEditInfo=\"${this.nodeToEditInfo}\"\n          .groupId=\"${this.groupId}\"\n          @save=\"${this.handleEditDialogSave}\"\n          @close=\"${() => (this.showEditNodeDialog = false)}\"\n        ></ps-edit-node-dialog>\n\n        <ps-add-agent-dialog\n          ?open=\"${this.showAddAgentDialog}\"\n          @close=\"${() => (this.showAddAgentDialog = false)}\"\n          @agent-added=\"${this.getAgent}\"\n          .parentAgentId=\"${this.currentAgent?.id}\"\n          .groupId=\"${this.groupId}\"\n        ></ps-add-agent-dialog>\n\n        <ps-add-connector-dialog\n          ?open=\"${this.showAddConnectorDialog}\"\n          .groupId=\"${this.groupId}\"\n          @connector-added=\"${this.getAgent}\"\n          .selectedAgentId=\"${this.selectedAgentIdForConnector}\"\n          .selectedInputOutputType=\"${this.selectedInputOutputType}\"\n          @close=\"${() => (this.showAddConnectorDialog = false)}\"\n        ></ps-add-connector-dialog>\n\n        <md-tabs id=\"tabBar\" @change=\"${this.tabChanged}\">\n          <md-primary-tab id=\"configure-tab\" aria-controls=\"configure-panel\">\n            <md-icon slot=\"icon\">support_agent</md-icon>\n            ${this.t(\"Agents Operations\")}\n          </md-primary-tab>\n          <md-primary-tab id=\"crt-tab\" aria-controls=\"crt-panel\">\n            <md-icon slot=\"icon\">checklist</md-icon>\n            ${this.t(\"Audit Log\")}\n          </md-primary-tab>\n          <md-primary-tab id=\"costs-tab\" aria-controls=\"costs-panel\">\n            <md-icon slot=\"icon\">account_balance</md-icon>\n            ${this.renderTotalCosts()}\n          </md-primary-tab>\n        </md-tabs>\n\n        ${this.activeTabIndex === 0\n          ? html`\n              <ps-operations-view\n                .currentAgent=\"${this.currentAgent}\"\n                .groupId=\"${this.groupId}\"\n              ></ps-operations-view>\n            `\n          : \"\"}\n        ${this.activeTabIndex === 1\n          ? html` <!-- Render Audit Log tab content here --> `\n          : \"\"}\n        ${this.activeTabIndex === 2 ? this.renderDetailedCostsTab() : \"\"}\n        ${this.renderThemeToggle()}\n      `;\n    }\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        md-tabs {\n          margin-bottom: 64px;\n        }\n        md-filled-select {\n          width: 100%;\n          margin-bottom: 16px;\n        }\n        .nodeEditHeadlineImage {\n          max-width: 100px;\n          margin-right: 16px;\n        }\n\n        .nodeEditHeadlineTitle {\n          display: flex;\n          align-items: center;\n          justify-content: center; /* This will also center the content horizontally */\n          height: 55px; /* Make sure this element has a defined height */\n        }\n\n        .childEditing {\n          color: var(--md-sys-color-on-surface-variant);\n          background-color: var(--md-sys-color-surface-variant);\n          padding: 16px;\n          border-radius: 8px;\n        }\n\n        .childrenList {\n          height: 100px;\n          overflow-y: auto;\n        }\n\n        md-icon-button {\n          margin-top: 32px;\n        }\n\n        .createOptionsButtons {\n          display: flex;\n          justify-content: center;\n          position: absolute;\n          bottom: 0;\n          left: 0;\n          right: 0;\n          padding-left: 8px;\n          padding-right: 8px;\n        }\n\n        .deleteButton {\n          --md-sys-color-primary: var(--md-sys-color-error);\n        }\n\n        md-circular-progress {\n          margin-bottom: 6px;\n        }\n\n        md-filled-text-field,\n        md-outlined-text-field {\n          width: 600px;\n          margin-bottom: 16px;\n        }\n\n        [type=\"textarea\"] {\n          min-height: 150px;\n        }\n\n        [type=\"textarea\"][supporting-text] {\n          min-height: 76px;\n        }\n\n        .formContainer {\n          margin-top: 32px;\n        }\n\n        md-filled-button,\n        md-outlined-button {\n          margin-top: 8px;\n          margin-left: 8px;\n          margin-right: 8px;\n          margin-bottom: 8px;\n        }\n\n        .aiConfigReview {\n          margin-left: 8px;\n          margin-right: 8px;\n          padding: 16px;\n          margin-top: 8px;\n          margin-bottom: 8px;\n          border-radius: 12px;\n          max-width: 560px;\n          font-size: 14px;\n          background-color: var(--md-sys-color-primary-container);\n          color: var(--md-sys-color-on-primary-container);\n        }\n\n        .agentUDEDescription {\n          font-size: 18px;\n          margin: 32px;\n          margin-bottom: 0;\n          padding: 24px;\n          border-radius: 12px;\n          background-color: var(--md-sys-color-primary);\n          color: var(--md-sys-color-on-primary);\n        }\n\n        md-tabs,\n        agent-tab,\n        configure-tab {\n          width: 100%;\n        }\n\n        .themeToggle {\n          margin-top: 32px;\n        }\n\n        ltp-chat-assistant {\n          height: 100%;\n          max-height: 100%;\n          width: 100%;\n          height: 100%;\n        }\n\n        md-linear-progress {\n          width: 600px;\n        }\n\n        .darkModeButton {\n          margin-right: 8px;\n          margin-left: 8px;\n        }\n\n        .topDiv {\n          margin-bottom: 256px;\n        }\n\n        md-outlined-select {\n          z-index: 1500px;\n          margin: 16px;\n          margin-left: 0;\n          max-width: 250px;\n        }\n\n        .automaticCreateButton {\n          max-width: 300px;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n\n        vaadin-grid {\n          background-color: var(--md-sys-color-surface);\n          color: var(--md-sys-color-on-surface);\n          font-family: var(--md-sys-typescale-body-medium-font-family-name);\n          font-size: var(--md-sys-typescale-body-medium-font-size);\n          font-weight: var(--md-sys-typescale-body-medium-font-weight);\n          line-height: var(--md-sys-typescale-body-medium-line-height);\n        }\n\n        vaadin-grid::part(header-cell) {\n          background-color: var(--md-sys-color-surface-container);\n          color: var(--md-sys-color-on-surface-variant);\n          font-weight: var(--md-sys-typescale-title-small-font-weight);\n        }\n\n        vaadin-grid::part(cell) {\n          color: var(--md-sys-color-on-surface-container);\n        }\n\n        vaadin-grid::part(body-cell) {\n          background-color: var(--md-sys-color-surface-container-lowest);\n          border-bottom: 1px solid var(--md-sys-color-outline-variant);\n        }\n\n        vaadin-grid::part(row) {\n          background-color: var(--md-sys-color-surface-container-lowest);\n          color: var(--md-sys-color-on-surface);\n        }\n\n        vaadin-grid::part(row):nth-child(even) {\n          background-color: var(--md-sys-color-surface-variant);\n        }\n\n        vaadin-grid::part(row:hover) {\n          background-color: var(--md-sys-color-surface-container-highest);\n        }\n\n        vaadin-grid::part(selected-row) {\n          background-color: var(--md-sys-color-secondary-container);\n          color: var(--md-sys-color-on-secondary-container);\n        }\n\n        /* Ensure proper spacing and alignment */\n        vaadin-grid-cell-content {\n          padding: 12px 16px;\n        }\n\n        /* Style for the sort indicators */\n        vaadin-grid-sorter {\n          color: var(--md-sys-color-on-surface-variant);\n        }\n\n        vaadin-grid-sorter[direction] {\n          color: var(--md-sys-color-primary);\n        }\n\n        /* Adjust these values as needed for your specific layout */\n        vaadin-grid {\n          height: 400px;\n          margin-top: 16px;\n          margin-bottom: 16px;\n        }\n      `,\n    ];\n  }\n}\n"]}