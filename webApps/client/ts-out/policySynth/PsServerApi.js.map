{"version":3,"file":"PsServerApi.js","sourceRoot":"","sources":["../../src/policySynth/PsServerApi.ts"],"names":[],"mappings":"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","sourcesContent":["import { YpServerApiBase } from '../common/YpServerApiBase.js';\nimport { PsAiModelSize } from '@policysynth/agents/aiModelTypes.js';\n\nexport class PsServerApi extends YpServerApiBase {\n  baseAgentsPath = '/agents/';\n  constructor(urlPath: string = '/api') {\n    super();\n    this.baseUrlPath = urlPath;\n  }\n\n  public async getAgent(groupId: number): Promise<PsAgentAttributes> {\n    return (await this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}`,\n      {},\n      false\n    )) as unknown as PsAgentAttributes;\n  }\n\n  public async removeAgentAiModel(\n    groupId: number,\n    agentId: number,\n    modelId: number\n  ): Promise<void> {\n    return this.fetchWrapper(\n      `${this.baseUrlPath}/agents/${groupId}/${agentId}/ai-models/${modelId}`,\n      {\n        method: 'DELETE',\n      }\n    );\n  }\n\n  public async getDetailedAgentCosts(groupId: number, agentId: number): Promise<PsDetailedAgentCostResults[]> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}/${agentId}/costs/detail`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsDetailedAgentCostResults[]>;\n  }\n\n  public async addAgentAiModel(\n    groupId: number,\n    agentId: number,\n    modelId: number,\n    size: PsAiModelSize\n  ): Promise<void> {\n    return this.fetchWrapper(\n      `${this.baseUrlPath}/agents/${groupId}/${agentId}/ai-models`,\n      {\n        method: 'POST',\n        body: JSON.stringify({ modelId, size }),\n      }\n    );\n  }\n\n\n  public async updateAgentConfiguration(\n    groupId: number,\n    agentId: number,\n    updatedConfig: Partial<PsAgentAttributes['configuration']>\n  ): Promise<void> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}/${agentId}/configuration`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updatedConfig),\n      },\n      false\n    ) as Promise<void>;\n  }\n\n  public async createAgent(\n    name: string,\n    agentClassId: number,\n    aiModels: { [key: string]: number },\n    parentAgentId: number,\n    groupId?: number\n  ): Promise<PsAgentAttributes> {\n    return this.fetchWrapper(\n      this.baseUrlPath + this.baseAgentsPath+`${groupId}`,\n      {\n        method: 'POST',\n        body: JSON.stringify({\n          name,\n          agentClassId,\n          aiModels,\n          parentAgentId,\n          groupId,\n        }),\n      },\n      false\n    ) as Promise<PsAgentAttributes>;\n  }\n\n  public async getAgentAiModels(\n    groupId: number,\n    agentId: number\n  ): Promise<PsAiModelAttributes[]> {\n    return this.fetchWrapper(\n      `${this.baseUrlPath}/agents/${groupId}/${agentId}/ai-models`\n    ) as Promise<PsAiModelAttributes[]>;\n  }\n\n  public async getActiveAiModels(\n    groupId: number\n  ): Promise<PsAiModelAttributes[]> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}/registry/aiModels`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsAiModelAttributes[]>;\n  }\n\n  public async getActiveAgentClasses( groupId: number): Promise<PsAgentClassAttributes[]> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}/registry/agentClasses`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsAgentClassAttributes[]>;\n  }\n\n  public async getActiveConnectorClasses(groupId: number): Promise<\n    PsAgentConnectorClassAttributes[]\n  > {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}/registry/connectorClasses`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsAgentConnectorClassAttributes[]>;\n  }\n\n\n\n  public async getAgentCosts(groupId: number, agentId: number): Promise<number> {\n    const response = (await this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}/${agentId}/costs`,\n      {\n        method: 'GET',\n      },\n      false\n    )) as { totalCost: string };\n    return parseFloat(response.totalCost);\n  }\n\n\n  async createConnector(\n    groupId: number,\n    agentId: number,\n    connectorClassId: number,\n    name: string,\n    type: 'input' | 'output'\n  ): Promise<PsAgentConnectorAttributes> {\n    const response = await fetch(`/api/agents/${groupId}/${agentId}/${type}Connectors`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ connectorClassId, name }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to create ${type} connector`);\n    }\n\n    return response.json();\n  }\n\n  public updateNode(\n    groupId: number,\n    agentId: number,\n    updatedNode: PsAgentAttributes\n  ): Promise<void> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}/${agentId}`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updatedNode),\n      },\n      false\n    ) as Promise<void>;\n  }\n\n  public async updateNodeConfiguration(\n    groupId: number,\n    nodeType: 'agent' | 'connector',\n    nodeId: number,\n    updatedConfig: Partial<\n      | PsAgentAttributes['configuration']\n      | PsAgentConnectorAttributes['configuration']\n    >\n  ): Promise<void> {\n    return this.fetchWrapper(\n      this.baseUrlPath +\n        `${this.baseAgentsPath}${groupId}/${nodeId}/${nodeType}/configuration`,\n      {\n        method: 'PUT',\n        body: JSON.stringify(updatedConfig),\n      },\n      false\n    ) as Promise<void>;\n  }\n\n  public async getAgentStatus(groupId: number, agentId: number): Promise<PsAgentStatus> {\n    return this.fetchWrapper(\n      this.baseUrlPath + `${this.baseAgentsPath}${groupId}/${agentId}/status`,\n      {\n        method: 'GET',\n      },\n      false\n    ) as Promise<PsAgentStatus>;\n  }\n\n  async controlAgent(groupId: number, agentId: number, action: 'start' | 'pause' | 'stop') {\n    return this.fetchWrapper(`/api/agents/${groupId}/${agentId}/control`, {\n      method: 'POST',\n      body: JSON.stringify({ action: action }),\n    });\n  }\n\n  async startAgent(groupId: number, agentId: number) {\n    return this.controlAgent(groupId, agentId, 'start');\n  }\n\n  async pauseAgent(groupId: number,agentId: number) {\n    return this.controlAgent(groupId,agentId, 'pause');\n  }\n\n  async stopAgent(groupId: number, agentId: number) {\n    return this.controlAgent(groupId, agentId, 'stop');\n  }\n}\n"]}