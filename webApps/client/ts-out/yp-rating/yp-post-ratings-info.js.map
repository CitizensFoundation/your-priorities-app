{"version":3,"file":"yp-post-ratings-info.js","sourceRoot":"","sources":["../../src/yp-rating/yp-post-ratings-info.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, css, nothing } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\n\nimport { YpBaseElement } from '../common/yp-base-element.js';\nimport { YpFormattingHelpers } from '../common/YpFormattingHelpers.js';\nimport { YpDialogRatings } from './yp-dialog-ratings.js';\n\n@customElement('yp-post-ratings-info')\nexport class YpPostRatingsInfo extends YpBaseElement {\n  @property({ type: Object })\n  post: YpPostData | undefined;\n\n  @property({ type: Boolean })\n  hasWidthA = false;\n\n  @property({ type: Boolean })\n  hasWidthB = false;\n\n  @property({ type: Boolean })\n  hasWidthC = false;\n\n  @property({ type: Boolean })\n  hasWidthD = false;\n\n  @property({ type: Boolean })\n  active = false;\n\n  @property({ type: Boolean })\n  allDisabled = false;\n\n  @property({ type: Boolean })\n  votingDisabled = false;\n\n  @property({ type: Boolean })\n  isEndorsed = false;\n\n  @property({ type: Boolean })\n  cardMode = false;\n\n  @property({ type: Array })\n  customRatings: Array<YpCustomRatingsData> | undefined;\n\n  override updated(changedProperties: Map<string | number | symbol, unknown>) {\n    super.updated(changedProperties);\n\n    if (changedProperties.has('post')) {\n      this._onPostChanged();\n    }\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          display: block;\n        }\n\n        .ratingsCount {\n          font-size: 0.6em;\n        }\n\n        .ratingContainer {\n          margin-left: 16px;\n          margin-bottom: 4px;\n        }\n\n        .ratingContainer[widtha] {\n          width: 125px;\n        }\n\n        .ratingContainer[widthb] {\n          width: 110px;\n        }\n\n        .ratingContainer[widthc] {\n          width: 100px;\n        }\n\n        .ratingContainer[widthd] {\n          width: 90px;\n        }\n\n        .ratingContainerMain {\n          text-align: right;\n          margin-right: 8px;\n          max-width: 230px;\n        }\n\n        .topDiv {\n          cursor: pointer;\n        }\n\n        .topDiv[voting-disabled] {\n          cursor: initial;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return html`\n      <div\n        class=\"layout vertical center-center topDiv\"\n        votingDisabled=\"${this.votingDisabled}\"\n        .ariaLabel=\"${this.t('evaluatePost')}\"\n        .title=\"${this.t('evaluatePost')}\"\n        on-tap=\"openRatingsDialog\">\n        ${this.post\n          ? html`\n              <div\n                id=\"ratingContainerMain\"\n                class=\"ratingContainerMain layout horizontal center-center  wrap\"\n                style=\"display: flex; justify-content: flex-end\"\n                .cardMode=\"${this.cardMode}\">\n                ${this.customRatings?.map(\n                  (rating, index) => html`\n                    <div\n                      class=\"layout horizontal ratingContainer\"\n                      widtha=\"${this.hasWidthA}\"\n                      widthb=\"${this.hasWidthB}\"\n                      widthc=\"${this.hasWidthC}\"\n                      widthd=\"${this.hasWidthD}\">\n                      <yp-rating\n                        .title=\"${rating.name}\"\n                        readOnly\n                        postId=\"${this.post!.id}\"\n                        ratingIndex=\"${index}\"\n                        .votingDisabled=\"${this.votingDisabled}\"\n                        .emoji=\"${rating.emoji}\"\n                        .rate=\"${this.getRating(index)}\"\n                        .numberOf=\"${rating.numberOf}\"></yp-rating>\n                      <div class=\"ratingsCount\">\n                        ${this.getRatingsCount(index)}\n                      </div>\n                    </div>\n                  `\n                )}\n              </div>\n            `\n          : nothing}\n      </div>\n    `;\n  }\n\n  getRating(ratingIndex: number) {\n    if (\n      this.post &&\n      this.post.public_data &&\n      this.post.public_data.ratings &&\n      this.post.public_data.ratings[ratingIndex]\n    )\n      return this.post.public_data.ratings[ratingIndex].averageRating;\n    else return 0;\n  }\n\n  getRatingsCount(ratingIndex: number) {\n    if (\n      this.post &&\n      this.post.public_data &&\n      this.post.public_data.ratings &&\n      this.post.public_data.ratings[ratingIndex]\n    )\n      return YpFormattingHelpers.number(\n        this.post.public_data.ratings[ratingIndex].count\n      );\n    //          return this.formatNumber(1*(Math.floor(Math.random() * 10000) + 1)) //this.formatNumber(this.post.public_data.ratings[ratingIndex].count);\n    else return 0;\n  }\n\n  _fireRefresh() {\n    this.fire('refresh', { id: this.post?.id });\n  }\n\n  openRatingsDialog() {\n    if (this.post && !this.post.Group.configuration.canVote === false) {\n      window.appGlobals.activity('open', 'post.ratings');\n      if (window.appUser.loggedIn() === true) {\n        window.appDialogs.getRatingsDialogAsync((dialog: YpDialogRatings) => {\n          dialog.open(this.post!, this._fireRefresh.bind(this));\n        });\n      } else {\n        window.appUser.loginForRatings(this);\n      }\n    }\n  }\n\n  _onPostChanged() {\n    this.isEndorsed = false;\n    if (this.post && this.post.Group) {\n      if (\n        this.post.Group.configuration &&\n        this.post.Group.configuration.customRatings\n      ) {\n        if (this.post.Group.configuration.canVote === false) {\n          this.votingDisabled = true;\n        } else {\n          this.votingDisabled = false;\n        }\n\n        this.customRatings = [];\n        setTimeout(() => {\n          this.customRatings = this.post!.Group!.configuration!.customRatings!.slice(\n            0,\n            4\n          );\n        });\n\n        let maxCount = 0;\n        if (this.post.public_data && this.post.public_data.ratings) {\n          if (this.post.public_data && this.post.public_data.ratings) {\n            for (const item in this.post.public_data.ratings) {\n              // eslint-disable-next-line no-prototype-builtins\n              if (this.post.public_data.ratings.hasOwnProperty(item)) {\n                if (this.post.public_data.ratings[item].count > maxCount) {\n                  maxCount = this.post.public_data.ratings[item].count;\n                }\n              }\n            }\n          }\n        }\n\n        if (maxCount > 100000) {\n          this.hasWidthA = true;\n          this.hasWidthB = false;\n          this.hasWidthC = false;\n          this.hasWidthD = false;\n          (this.$$('#ratingContainerMain') as HTMLElement).style.maxWidth =\n            '285px';\n        } else if (maxCount > 1000) {\n          this.hasWidthA = false;\n          this.hasWidthB = true;\n          this.hasWidthC = false;\n          this.hasWidthD = false;\n          (this.$$('#ratingContainerMain') as HTMLElement).style.maxWidth =\n            '255px';\n        } else if (maxCount > 10) {\n          this.hasWidthA = false;\n          this.hasWidthB = false;\n          this.hasWidthC = true;\n          this.hasWidthD = false;\n          (this.$$('#ratingContainerMain') as HTMLElement).style.maxWidth =\n            '235px';\n        } else {\n          this.hasWidthA = false;\n          this.hasWidthB = false;\n          this.hasWidthC = false;\n          this.hasWidthD = true;\n          (this.$$('#ratingContainerMain') as HTMLElement).style.maxWidth =\n            '215px';\n        }\n      }\n      if (\n        this.post &&\n        this.post.Group &&\n        this.post.Group.configuration &&\n        this.post.Group.configuration.canVote != undefined &&\n        this.post.Group.configuration.canVote == false\n      ) {\n        this.votingDisabled = true;\n        this.allDisabled = true;\n        this.title = this.t('votingDisabled');\n      } else {\n        this.title = '';\n        this.votingDisabled = false;\n        this.allDisabled = false;\n      }\n\n      if (this.post.Group.configuration) {\n        this.post.Group.configuration.originalHideVoteCount = this.post.Group.configuration.hideVoteCount;\n        if (this.post.Group.configuration.hideVoteCountUntilVoteCompleted) {\n          this.post.Group.configuration.hideVoteCount = true;\n        }\n      }\n    } else {\n      this.customRatings = [];\n      console.warn('No post found for post actions');\n    }\n  }\n}\n"]}