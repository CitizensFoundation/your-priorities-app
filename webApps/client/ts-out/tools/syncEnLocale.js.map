{"version":3,"file":"syncEnLocale.js","sourceRoot":"","sources":["../../src/tools/syncEnLocale.ts"],"names":[],"mappings":"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","sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport glob from 'glob';\n\n// Define paths\nconst srcDirectory = 'src/';\nconst translationFilePath = 'locales/en/translation.json';\nconst outputFilePath = '/tmp/translation.json';\n\n// Function to find all .js and .ts files in srcDirectory\nfunction getFiles(srcPath: string): Promise<string[]> {\n    return new Promise((resolve, reject) => {\n        //@ts-ignore\n        glob(`${srcPath}/**/*.{js,ts}`, (err: Error | null, files: string[]) => {\n            if (err) {\n                reject(err);\n            } else {\n                resolve(files);\n            }\n        });\n    });\n}\n// Function to read file content\nasync function readFileContent(filePath: string): Promise<string> {\n    return fs.promises.readFile(filePath, 'utf8');\n}\n\n// Function to extract translation keys using regex\nfunction extractTranslationKeys(fileContent: string): string[] {\n    const regex = /this\\.t\\(['\"`](.*?)['\"`]\\)/g;\n    const keys = [];\n    let match;\n\n    while ((match = regex.exec(fileContent)) !== null) {\n        keys.push(match[1]);\n    }\n\n    return keys;\n}\n\n// Function to read and parse the translation file\nasync function readTranslationFile(filePath: string): Promise<any> {\n    const content = await fs.promises.readFile(filePath, 'utf8');\n    return JSON.parse(content);\n}\n\n// Function to save the updated translation file\nasync function saveUpdatedTranslationFile(filePath: string, content: any): Promise<void> {\n    await fs.promises.writeFile(filePath, JSON.stringify(content, null, 2));\n}\n\n// Function to deeply check and remove unused keys, and count changes\nfunction updateTranslations(usedKeys: string[], translations: any): { updatedTranslations: any, deletedCount: number, newCount: number } {\n    const result = {};\n    let deletedCount = 0;\n    let newCount = 0;\n\n    const checkAndUpdate = (keys: string[], current: any, currentResult: any, path: string) => {\n        Object.keys(current).forEach(key => {\n            const newPath = path ? `${path}.${key}` : key;\n            if (keys.includes(newPath)) {\n                currentResult[key] = current[key];\n            } else {\n                deletedCount++;\n            }\n        });\n\n        keys.forEach(key => {\n            if (!current[key]) {\n                newCount++;\n                // Assuming you want to add new keys with a placeholder value\n                currentResult[key] = `MISSING TRANSLATION for ${key}`;\n            }\n        });\n    };\n\n    checkAndUpdate(usedKeys, translations, result, '');\n\n    return { updatedTranslations: result, deletedCount, newCount };\n}\n\n// Main function to process translations\nasync function processTranslations() {\n    try {\n        const files = await getFiles(srcDirectory);\n        const translationKeys = new Set<string>();\n        const translations = await readTranslationFile(translationFilePath);\n\n        for (const file of files) {\n            const content = await readFileContent(file);\n            const keys = extractTranslationKeys(content);\n            keys.forEach(key => translationKeys.add(key));\n        }\n\n        const { updatedTranslations, deletedCount, newCount } = updateTranslations(Array.from(translationKeys), translations);\n\n        await saveUpdatedTranslationFile(outputFilePath, updatedTranslations);\n        console.log(`Translation file has been updated. New tokens: ${newCount}, Deleted tokens: ${deletedCount}`);\n    } catch (error) {\n        console.error('Error processing translations:', error);\n    }\n}\n\n// Execute the main function\nprocessTranslations();\n"]}