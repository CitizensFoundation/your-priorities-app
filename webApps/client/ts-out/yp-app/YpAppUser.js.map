{"version":3,"file":"YpAppUser.js","sourceRoot":"","sources":["../../src/yp-app/YpAppUser.ts"],"names":[],"mappings":"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","sourcesContent":["import { YpServerApi } from \"../common/YpServerApi.js\";\nimport { YpCodeBase } from \"../common/YpCodeBaseclass.js\";\nimport { YpAccessHelpers } from \"../common/YpAccessHelpers.js\";\nimport { YpLogin } from \"../yp-user/yp-login.js\";\nimport { YpRegistrationQuestionsDialog } from \"../yp-user/yp-registration-questions-dialog.js\";\n\nimport FingerprintJS from \"@fingerprintjs/fingerprintjs\";\nimport { YpSnackbar } from \"./yp-snackbar.js\";\nimport { YpPostActions } from \"../yp-post/yp-post-actions.js\";\nimport { YpPostRatingsInfo } from \"../yp-rating/yp-post-ratings-info.js\";\nimport { YpPointActions } from \"../yp-point/yp-point-actions.js\";\n\nexport class YpAppUser extends YpCodeBase {\n  serverApi: YpServerApi;\n\n  loginForAcceptInviteParams: {\n    token: string;\n    editDialog: HTMLElement;\n  } | null = null;\n\n  loginForEditParams: {\n    editDialog: HTMLElement;\n    newOrUpdate: boolean;\n    params: object;\n    refreshFunction: Function;\n  } | null = null;\n\n  loginForNewPointParams: {\n    postPointsElement: HTMLElement;\n    params: { value: number; content: string };\n  } | null = null;\n\n  loginForEndorseParams: {\n    postActionElement: HTMLElement;\n    params: { value: number };\n  } | null = null;\n\n  loginForRatingsParams: {\n    postActionElement: HTMLElement;\n  } | null = null;\n\n  loginForPointQualityParams: {\n    pointActionElement: HTMLElement;\n    params: { value: number };\n  } | null = null;\n\n  loginForMembershipParams: {\n    membershipActionElement: HTMLElement;\n    params: { value: string; content: string };\n  } | null = null;\n\n  loginFor401refreshFunction: Function | undefined;\n\n  loginForNotificationSettingsParams = false;\n\n  toastLoginTextCombined: string | undefined;\n\n  toastLogoutTextCombined: string | undefined;\n\n  user: YpUserData | null | undefined;\n\n  endorsementPostsIndex: Record<number, YpEndorsement> = {};\n\n  groupCurrentVoteCountIndex: Record<number, number> = {};\n\n  ratingPostsIndex: Record<number, Record<number, YpRatingData>> = {};\n\n  membershipsIndex: Record<string, Record<number, boolean>> = {};\n\n  pointQualitiesIndex: Record<number, YpPointQuality> = {};\n\n  adminRights: YpAdminRights | undefined;\n\n  promoterRights: YpPromoterRights | undefined;\n\n  memberships: YpMemberships | undefined;\n\n  completeExternalLoginText: string | undefined;\n\n  isPollingForLogin = false;\n\n  lastLoginMethod: string | undefined;\n\n  facebookPopupWindow: Window | null = null;\n\n  samlPopupWindow: Window | null = null;\n\n  pollingStartedAt: number | undefined;\n\n  hasIssuedLogout = false;\n\n  sessionPrefix = \"session_\";\n\n  sessionStorage = window.localStorage;\n\n  browserFingerprint: string | undefined;\n  browserFingerprintConfidence: number | undefined;\n\n  constructor(serverApi: YpServerApi, skipRegularInit = false) {\n    super();\n    this.serverApi = serverApi;\n    this._setupBrowserFingerprint();\n    if (!skipRegularInit) {\n      if (!window.location.pathname.startsWith(\"/survey/\")) {\n        this.checkLogin();\n      } else {\n        console.log(\"Not checking login in survey mode\");\n      }\n      this.addGlobalListener(\n        \"yp-forgot-password\",\n        this._forgotPassword.bind(this)\n      );\n      this.addGlobalListener(\n        \"yp-reset-password\",\n        this._resetPassword.bind(this)\n      );\n      this.addGlobalListener(\"yp-logged-in\", this._onUserChanged.bind(this));\n    }\n  }\n\n  getBrowserId() {\n    var currentId = localStorage.getItem(\"aoi-brid\");\n\n    if (!currentId) {\n      currentId = this._generateRandomString(32);\n      if (currentId) localStorage.setItem(\"yp-brid\", currentId);\n      else console.error(\"Could not generate browser id\");\n    }\n\n    return currentId;\n  }\n\n  _setupBrowserFingerprint() {\n    try {\n      var fpPromise = FingerprintJS.load({\n        monitoring: false,\n      });\n\n      fpPromise\n        .then((fp) => fp.get())\n        .then((result) => {\n          this.browserFingerprint = result.visitorId;\n          this.browserFingerprintConfidence = result.confidence.score;\n        });\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  _generateRandomString(length: number) {\n    if (!length) length = 36;\n    if (window.crypto) {\n      var a = window.crypto.getRandomValues(new Uint32Array(3)),\n        token = \"\";\n      for (var i = 0, l = a.length; i < l; i++) token += a[i].toString(36);\n      return token;\n    } else {\n      console.log(\"Not checking login in survey mode\");\n      return null;\n    }\n  }\n\n  sessionHas(key: string) {\n    const prefixed_key = this.sessionPrefix + key;\n    const value = this.sessionStorage.getItem(prefixed_key);\n    return value !== null;\n  }\n\n  sessionGet(key: string) {\n    const prefixed_key = this.sessionPrefix + key;\n    const value = this.sessionStorage.getItem(prefixed_key);\n    let parsed;\n    if (value) {\n      try {\n        parsed = JSON.parse(value);\n      } catch (e) {\n        parsed = null;\n      }\n    }\n    return parsed;\n  }\n\n  sessionSet(key: string, value: string | object) {\n    const prefixed_key = this.sessionPrefix + key;\n    const stringfied = JSON.stringify(value);\n    this.sessionStorage.setItem(prefixed_key, stringfied);\n  }\n\n  sessionUnset(key: string) {\n    const prefixed_key = this.sessionPrefix + key;\n    this.sessionStorage.removeItem(prefixed_key);\n  }\n\n  sessionClear() {\n    this.sessionStorage.clear();\n  }\n\n  loginForAcceptInvite(\n    editDialog: HTMLElement,\n    token: string,\n    email: string,\n    collectionConfiguration: object | undefined\n  ) {\n    this.loginForAcceptInviteParams = { editDialog: editDialog, token: token };\n    this.openUserlogin(email, collectionConfiguration);\n  }\n\n  loginForEdit(\n    editDialog: HTMLElement,\n    newOrUpdate: boolean,\n    params: object,\n    refreshFunction: Function\n  ) {\n    this.loginForEditParams = {\n      editDialog: editDialog,\n      newOrUpdate: newOrUpdate,\n      params: params,\n      refreshFunction: refreshFunction,\n    };\n    this.openUserlogin();\n  }\n\n  loginForNewPoint(\n    postPointsElement: HTMLElement,\n    params: { value: number; content: string }\n  ) {\n    this.loginForNewPointParams = {\n      postPointsElement: postPointsElement,\n      params: params,\n    };\n    this.openUserlogin();\n  }\n\n  loginForEndorse(postActionElement: HTMLElement, params: { value: number }) {\n    this.loginForEndorseParams = {\n      postActionElement: postActionElement,\n      params: params,\n    };\n    this.openUserlogin();\n  }\n\n  loginForRatings(postActionElement: HTMLElement) {\n    this.loginForRatingsParams = { postActionElement: postActionElement };\n    this.openUserlogin();\n  }\n\n  loginForPointQuality(\n    pointActionElement: HTMLElement,\n    params: { value: number }\n  ) {\n    this.loginForPointQualityParams = {\n      pointActionElement: pointActionElement,\n      params: params,\n    };\n    this.openUserlogin();\n  }\n\n  loginForMembership(\n    membershipActionElement: HTMLElement,\n    params: { value: string; content: string }\n  ) {\n    this.loginForMembershipParams = {\n      membershipActionElement: membershipActionElement,\n      params: params,\n    };\n    this.openUserlogin();\n  }\n\n  loginFor401(refreshFunction: Function | undefined) {\n    this.loginFor401refreshFunction = refreshFunction;\n    this.openUserlogin();\n  }\n\n  loginForNotificationSettings() {\n    this.loginForNotificationSettingsParams = true;\n    this.openUserlogin();\n  }\n\n  openUserlogin(\n    email: string | undefined = undefined,\n    collectionConfiguration: object | undefined = undefined\n  ) {\n    if (!window.appDialogs) {\n      this.addGlobalListener(\n        \"yp-app-dialogs-ready\",\n        this.openUserlogin.bind(this)\n      );\n    } else {\n      window.appDialogs.getDialogAsync(\"userLogin\", (dialog: YpLogin) => {\n        dialog.setup(this._handleLogin.bind(this), window.appGlobals.domain!);\n        dialog.openDialog(undefined, email, collectionConfiguration);\n      });\n    }\n  }\n\n  autoAnonymousLogin() {\n    setTimeout(() => {\n      if (this.user == null) {\n        window.appDialogs.getDialogAsync(\"userLogin\", (dialog: YpLogin) => {\n          dialog.setup(this._handleLogin.bind(this), window.appGlobals.domain!);\n          dialog.anonymousLogin();\n        });\n      } else {\n        console.log(\"Not doing auto anon login as user already exists\");\n      }\n    }, 1);\n  }\n\n  _closeUserLogin() {\n    window.appDialogs.closeDialog(\"userLogin\");\n  }\n\n  _setUserLoginSpinner() {\n    window.appDialogs.getDialogAsync(\"userLogin\", (dialog: YpLogin) => {\n      dialog.userSpinner = false;\n    });\n  }\n\n  _handleLogin(user: YpUserData) {\n    this._closeUserLogin();\n    this.setLoggedInUser(user);\n    if (user.profile_data && user.profile_data.isAnonymousUser) {\n      console.debug(\"Do not fetch admin or memberships for anonymous users\");\n    } else {\n      this.getAdminRights();\n      this.getPromoterRights();\n      this.getMemberShips();\n      this.toastLoginTextCombined =\n        this.t(\"user.loginCompleteFor\") + \" \" + this.user?.name;\n      //this.fireGlobal(\"yp-open-toast\", { text: this.toastLoginTextCombined });\n    }\n    this._checkLoginForParameters();\n\n    // Redirect to another local service after login, for example the analytics app\n    setTimeout(() => {\n      if (\n        window.appGlobals.originalQueryParameters &&\n        window.appGlobals.originalQueryParameters[\"raLogin\"]\n      ) {\n        window.location.href = window.appGlobals.originalQueryParameters[\n          \"raLogin\"\n        ] as string;\n      }\n    });\n\n    setTimeout(() => {\n      this._checkRegistrationAnswers(user);\n    }, 450);\n  }\n\n  _checkLoginForParameters() {\n    //TODO: Get working again\n    if (this.loginForEditParams) {\n      const loginParams = this.loginForEditParams;\n      // TODO: Remove any\n      window.appDialogs.getDialogAsync(\n        loginParams.editDialog as any,\n        (dialog: any) => {\n          dialog.setup(null, true, loginParams.refreshFunction);\n          dialog.open(\"new\", loginParams.params);\n          this.loginForEditParams = null;\n        }\n      );\n    } else if (this.loginForNewPointParams) {\n      const newPointParams = this.loginForNewPointParams;\n      //newPointParams.postPointsElement.addPoint(newPointParams.params.content, newPointParams.params.value);\n      this.loginForNewPointParams = null;\n    } else if (this.loginForEndorseParams) {\n      const endorseParams = this.loginForEndorseParams;\n      (\n        endorseParams.postActionElement as YpPostActions\n      ).generateEndorsementFromLogin(endorseParams.params.value);\n      this.loginForEndorseParams = null;\n    } else if (this.loginForRatingsParams) {\n      const ratingsParams = this.loginForRatingsParams;\n      (\n        ratingsParams.postActionElement as YpPostRatingsInfo\n      ).openRatingsDialog();\n      this.loginForRatingsParams = null;\n    } else if (this.loginForPointQualityParams) {\n      const pointQualityParams = this.loginForPointQualityParams;\n      (\n        pointQualityParams.pointActionElement as YpPointActions\n      ).generatePointQualityFromLogin(pointQualityParams.params.value);\n      this.loginForPointQualityParams = null;\n    } else if (this.loginForMembershipParams) {\n      const membershipParams = this.loginForMembershipParams;\n      //(membershipParams.membershipActionElement as YpMemberships).generateMembershipFromLogin(membershipParams.params.value);\n      this.loginForMembershipParams = null;\n    } else if (this.loginForAcceptInviteParams) {\n      const acceptInviteParams = this.loginForAcceptInviteParams;\n      // TODO: Remove any\n      window.appDialogs.getDialogAsync(\"acceptInvite\", (dialog: any) => {\n        dialog.reOpen(acceptInviteParams.token);\n        dialog.afterLogin(acceptInviteParams.token);\n        this.loginForAcceptInviteParams = null;\n      });\n    } else if (this.loginFor401refreshFunction) {\n      this.loginFor401refreshFunction();\n    } else if (this.loginForNotificationSettingsParams) {\n      this.openNotificationSettings();\n    }\n  }\n\n  openNotificationSettings() {\n    // TODO: Remove any\n    window.appDialogs.getDialogAsync(\"userEdit\", (dialog: any) => {\n      dialog.setup(window.appUser.user, false, null, true);\n      dialog.open(\"edit\", { userId: window.appUser.user?.id });\n    });\n  }\n\n  _forgotPassword(event: CustomEvent) {\n    // TODO: Remove any\n    window.appDialogs.getDialogAsync(\"forgotPassword\", (dialog: any) => {\n      dialog.open(event.detail);\n    });\n  }\n\n  _resetPassword(event: CustomEvent) {\n    // TODO: Remove any\n    window.appDialogs.getDialogAsync(\"resetPassword\", (dialog: any) => {\n      dialog.open(event.detail);\n    });\n  }\n\n  setLoggedInUser(user: YpUserData) {\n    this.user = user;\n    this.fireGlobal(\"yp-logged-in\", this.user);\n\n    // TODO: Look at this. Fire another signal a bit later in case some components had not set up their listeners\n    //setTimeout(() => {\n    //  this.fireGlobal('yp-logged-in', this.user);\n    //}, 1000);\n\n    window.appGlobals.analytics.sendLoginAndSignup(\n      user.id,\n      \"Login Success\",\n      this.lastLoginMethod ? this.lastLoginMethod : \"Email\"\n    );\n    this.lastLoginMethod = undefined;\n    if (user && user.profile_data && user.profile_data.isAnonymousUser) {\n      window.appGlobals.setAnonymousUser(user);\n    } else {\n      window.appGlobals.setAnonymousUser(undefined);\n    }\n\n    window.appGlobals.offline.checkContentToSendForLoggedInUser();\n  }\n\n  removeAnonymousUser() {\n    console.log(\"Remove anon user\");\n    this.removeUserSession();\n  }\n\n  removeUserSession() {\n    this.sessionUnset(\"user\");\n    this.user = null;\n    window.appGlobals.setAnonymousUser(undefined);\n    this.fireGlobal(\"yp-logged-in\", null);\n  }\n\n  loggedIn() {\n    let isCorrectLoginProviderAndAgency = true;\n    if (window.appGlobals.currentForceSaml && window.appGlobals.currentGroup) {\n      if (!YpAccessHelpers.checkGroupAccess(window.appGlobals.currentGroup)) {\n        if (this.user) {\n          if (this.user.loginProvider !== \"saml\")\n            isCorrectLoginProviderAndAgency = false;\n\n          if (\n            window.appGlobals.currentGroup &&\n            window.appGlobals.currentGroup.configuration &&\n            window.appGlobals.currentGroup.configuration\n              .forceSecureSamlEmployeeLogin\n          ) {\n            if (!this.user.isSamlEmployee) {\n              isCorrectLoginProviderAndAgency = false;\n            }\n          }\n        } else {\n          isCorrectLoginProviderAndAgency = false;\n        }\n      }\n    }\n    return this.user != null && isCorrectLoginProviderAndAgency;\n  }\n\n  async setLocale(locale: string) {\n    await this.serverApi.setLocale({ locale: locale });\n  }\n\n  cancelLoginPolling() {\n    this.pollingStartedAt = undefined;\n  }\n\n  _closeAllPopups() {\n    if (this.facebookPopupWindow) {\n      try {\n        this.facebookPopupWindow.close();\n      } catch (error) {\n        console.error(error);\n      }\n      this.facebookPopupWindow = null;\n    }\n    if (this.samlPopupWindow) {\n      try {\n        this.samlPopupWindow.close();\n      } catch (error) {\n        console.error(error);\n      }\n      this.samlPopupWindow = null;\n    }\n  }\n\n  async pollForLogin() {\n    if (this.pollingStartedAt) {\n      const user = (await this.serverApi.isloggedin()) as YpUserData | void;\n      if (user && user.notLoggedIn === true && this.pollingStartedAt) {\n        const timeSpent = Date.now() - this.pollingStartedAt;\n        if (timeSpent < 5 * 60 * 1000) {\n          setTimeout(() => {\n            this.pollForLogin();\n          }, 1200);\n        } else {\n          this.pollingStartedAt = undefined;\n        }\n      } else if (user && user.name) {\n        this.fireGlobal(\"yp-logged-in-via-polling\", user);\n        this.cancelLoginPolling();\n        if (this.facebookPopupWindow) {\n          this.loginFromFacebook();\n        } else if (this.samlPopupWindow) {\n          this.loginFromSaml();\n        }\n        this._closeAllPopups();\n      }\n    } else {\n      console.error(\"Unkown state in polling...\");\n      this._closeAllPopups();\n      this.cancelLoginPolling();\n    }\n  }\n\n  startPollingForLogin() {\n    this.pollingStartedAt = Date.now();\n    setTimeout(() => {\n      this.pollForLogin();\n    }, 1000);\n  }\n\n  loginFromFacebook() {\n    this.cancelLoginPolling();\n    this.lastLoginMethod = \"Facebook\";\n    this._completeExternalLogin(this.t(\"user.loggedInWithFacebook\"));\n  }\n\n  loginFromSaml() {\n    this.cancelLoginPolling();\n    this.lastLoginMethod = \"Saml2\";\n    this._completeExternalLogin(this.t(\"user.loggedInWithSaml\"));\n  }\n\n  _completeExternalLogin(fromString: string) {\n    this.checkLogin();\n    this._setUserLoginSpinner();\n    this.completeExternalLoginText = fromString;\n  }\n\n  checkLogin() {\n    this.isloggedin();\n    this.getMemberShips();\n    this.getAdminRights();\n    this.getPromoterRights();\n  }\n\n  recheckAdminRights() {\n    this.getAdminRights();\n    this.getPromoterRights();\n  }\n\n  async getPromoterRights() {\n    const response = (await this.serverApi.getPromoterRights()) as\n      | YpPromoterRights\n      | void\n      | boolean;\n\n    if (response) {\n      this.promoterRights = response as YpPromoterRights;\n      this.fireGlobal(\"yp-got-promoter-rights\", true);\n    } else {\n      this.promoterRights = undefined;\n      this.fireGlobal(\"yp-got-promoter-rights\", false);\n    }\n  }\n  updateEndorsementForPost(\n    postId: number,\n    newEndorsement: YpEndorsement,\n    group: YpGroupData | undefined = undefined\n  ) {\n    if (this.user) {\n      if (!this.user.Endorsements) {\n        this.user.Endorsements = [];\n      }\n      let hasChanged = false;\n      for (let i = 0; i < this.user.Endorsements.length; i++) {\n        if (this.user.Endorsements[i].post_id === postId) {\n          if (newEndorsement) {\n            this.user.Endorsements[i] = newEndorsement;\n          } else {\n            this.user.Endorsements.splice(i, 1);\n          }\n          hasChanged = true;\n          break;\n        }\n      }\n      if (!hasChanged && newEndorsement)\n        this.user.Endorsements.push(newEndorsement);\n      this._updateEndorsementPostsIndex(this.user);\n    } else {\n      console.error(\"Can't find user for updateEndorsementForPost\");\n    }\n    if (\n      group &&\n      group.configuration &&\n      group.configuration.maxNumberOfGroupVotes\n    ) {\n      this.calculateVotesLeftForGroup(group);\n    } else {\n      this.fireGlobal(\"got-endorsements-and-qualities\", null);\n    }\n  }\n\n  calculateVotesLeftForGroup(group: YpGroupData) {\n    setTimeout(() => {\n      if (this.user && this.user.Endorsements) {\n        const lastVoteCount = this.groupCurrentVoteCountIndex[group.id];\n        this.groupCurrentVoteCountIndex[group.id] =\n          this.user.Endorsements.filter(function (endorsement) {\n            return (\n              endorsement.Post &&\n              endorsement.Post.group_id === group.id &&\n              endorsement.value !== -1 &&\n              endorsement.value !== 0\n            );\n          }).length;\n\n        if (lastVoteCount != this.groupCurrentVoteCountIndex[group.id]) {\n          const text = `${this.t(\"youHaveUsed\")} ${\n            this.groupCurrentVoteCountIndex[group.id]\n          } ${this.t(\"ofNumber\")} ${\n            group.configuration.maxNumberOfGroupVotes\n          } ${this.t(\"votesForGroup\")}`;\n          window.appDialogs.getDialogAsync(\n            \"masterToast\",\n            (toast: YpSnackbar) => {\n              toast.labelText = text;\n              toast.open = true;\n              toast.timeoutMs = 4000;\n            }\n          );\n        }\n\n        this.fireGlobal(\"got-endorsements-and-qualities\", {\n          maxGroupId: group.id,\n          groupCurrentVoteCount: this.groupCurrentVoteCountIndex[group.id],\n        });\n      } else {\n        console.warn(\"No user or endorsements for calculateVotesLeftForGroup\");\n      }\n    });\n  }\n\n  _updateEndorsementPostsIndex(user: YpUserData) {\n    if (user && user.Endorsements && user.Endorsements.length > 0) {\n      this.endorsementPostsIndex = {};\n      for (let i = 0; i < user.Endorsements.length; i++) {\n        this.endorsementPostsIndex[user.Endorsements[i].post_id] =\n          user.Endorsements[i];\n      }\n    } else {\n      this.endorsementPostsIndex = {};\n    }\n  }\n\n  _updateRatingPostsIndex(user: YpUserData) {\n    if (user && user.Ratings && user.Ratings.length > 0) {\n      this.ratingPostsIndex = {};\n      for (let i = 0; i < user.Ratings.length; i++) {\n        if (!this.ratingPostsIndex[user.Ratings[i].post_id])\n          this.ratingPostsIndex[user.Ratings[i].post_id] = {};\n        this.ratingPostsIndex[user.Ratings[i].post_id][\n          user.Ratings[i].type_index\n        ] = user.Ratings[i];\n      }\n    } else {\n      this.ratingPostsIndex = {};\n    }\n  }\n\n  updateRatingForPost(\n    postId: number,\n    typeIndex: number,\n    newRating: YpRatingData | undefined\n  ) {\n    if (this.user) {\n      if (!this.user.Ratings) {\n        this.user.Ratings = [];\n      }\n\n      let hasChanged = false;\n      for (let i = 0; i < this.user.Ratings.length; i++) {\n        if (\n          this.user.Ratings[i].post_id === postId &&\n          this.user.Ratings[i].type_index === typeIndex\n        ) {\n          if (newRating) {\n            this.user.Ratings[i] = newRating;\n          } else {\n            this.user.Ratings.splice(i, 1);\n          }\n          hasChanged = true;\n          break;\n        }\n      }\n      if (!hasChanged && newRating) this.user.Ratings.push(newRating);\n      this._updateRatingPostsIndex(this.user);\n    } else {\n      console.error(\"Can't find user for updateRatingForPost\");\n    }\n  }\n\n  updatePointQualityForPost(pointId: number, newPointQuality: YpPointQuality) {\n    if (this.user) {\n      if (this.user.PointQualities) {\n        let hasChanged = false;\n        for (let i = 0; i < this.user.PointQualities.length; i++) {\n          if (this.user.PointQualities[i].point_id === pointId) {\n            if (newPointQuality) {\n              this.user.PointQualities[i] = newPointQuality;\n            } else {\n              this.user.PointQualities.splice(i, 1);\n            }\n            hasChanged = true;\n            break;\n          }\n        }\n\n        if (!hasChanged && newPointQuality) {\n          this.user.PointQualities.push(newPointQuality);\n          hasChanged = true;\n        }\n\n        if (hasChanged) this._updatePointQualitiesIndex(this.user);\n      }\n    } else {\n      console.error(\"Can't find user for updatePointQualityForPost\");\n    }\n  }\n\n  _updatePointQualitiesIndex(user: YpUserData) {\n    if (user && user.PointQualities && user.PointQualities.length > 0) {\n      this.pointQualitiesIndex = {};\n      for (let i = 0; i < user.PointQualities.length; i++) {\n        this.pointQualitiesIndex[user.PointQualities[i].point_id] =\n          user.PointQualities[i];\n      }\n    } else {\n      this.pointQualitiesIndex = {};\n    }\n  }\n\n  _onUserChanged(event: CustomEvent) {\n    const user = event.detail;\n    if (user) {\n      this._updateEndorsementPostsIndex(user);\n      this._updatePointQualitiesIndex(user);\n      this._updateRatingPostsIndex(user);\n      this.fireGlobal(\"got-endorsements-and-qualities\", null);\n    }\n  }\n\n  async logout() {\n    this.hasIssuedLogout = true;\n    (await this.serverApi.logout()) as void;\n    this.removeUserSession();\n    const isInAgentBundlePage = window.location.pathname.includes(\"/agent-bundle/\");\n    const moveUserToHomePageLocation = true;\n    if (moveUserToHomePageLocation) {\n      window.location.reload();\n    } else {\n      this.toastLogoutTextCombined =\n        this.t(\"user.logoutCompleteFor\") + \" \" + this.user?.name;\n      this.fireGlobal(\"yp-open-toast\", { text: this.toastLogoutTextCombined });\n      this.fireGlobal(\"yp-close-right-drawer\", true);\n      this.recheckAdminRights();\n    }\n  }\n\n  checkRegistrationAnswersCurrent() {\n    if (this.user) {\n      this._checkRegistrationAnswers(this.user);\n    }\n  }\n\n  setHasRegistrationAnswers() {\n    if (this.user) {\n      this.user.hasRegistrationAnswers = true;\n    }\n  }\n\n  _checkRegistrationAnswers(user: YpUserData) {\n    if (\n      user &&\n      !user.notLoggedIn &&\n      window.appGlobals.registrationQuestionsGroup &&\n      !user.hasRegistrationAnswers &&\n      (!window.appGlobals.currentAnonymousUser ||\n        (window.appGlobals.currentAnonymousUser &&\n          window.appGlobals.registrationQuestionsGroup.configuration\n            .anonymousAskRegistrationQuestions))\n    ) {\n      window.appDialogs.getDialogAsync(\n        \"registrationQuestions\",\n        (dialog: any /*YpRegistrationQuestionsDialog*/) => {\n          dialog.open(window.appGlobals.registrationQuestionsGroup!);\n        }\n      );\n    } else {\n      this.fireGlobal(\"yp-registration-questions-done\");\n    }\n  }\n\n  async isloggedin() {\n    const user = (await this.serverApi.isloggedin()) as YpUserData | void;\n\n    if (user && user.notLoggedIn === true) {\n      this.removeUserSession();\n    } else if (\n      user &&\n      user.name &&\n      user.profile_data &&\n      user.profile_data.isAnonymousUser\n    ) {\n      setTimeout(() => {\n        if (window.appGlobals.currentAnonymousGroup) {\n          this.setLoggedInUser(user);\n        } else {\n          window.appGlobals.setAnonymousUser(user);\n        }\n      }, 500);\n    } else if (user && user.name) {\n      this.setLoggedInUser(user);\n    }\n\n    if (user && user.missingEmail) {\n      // TODO: Remove any\n      window.appDialogs.getDialogAsync(\"missingEmail\", (dialog: any) => {\n        dialog.open(user.loginProvider);\n      });\n    } else if (\n      user &&\n      user.profile_data &&\n      user.profile_data.saml_show_confirm_email_completed === false\n    ) {\n      // TODO: Remove any\n      window.appDialogs.getDialogAsync(\"missingEmail\", (dialog: any) => {\n        dialog.open(user.loginProvider, true, user.email);\n      });\n    }\n\n    setTimeout(() => {\n      if (\n        this.lastLoginMethod === \"Saml2\" ||\n        this.lastLoginMethod === \"Facebook\"\n      ) {\n        this._checkRegistrationAnswers((user as YpUserData)!);\n      }\n    }, 250);\n\n    if (user) {\n      if (user.customSamlDeniedMessage) {\n        window.appGlobals.currentSamlDeniedMessage =\n          user.customSamlDeniedMessage;\n      } else {\n        window.appGlobals.currentSamlDeniedMessage = undefined;\n      }\n\n      if (user.customSamlLoginMessage) {\n        window.appGlobals.currentSamlLoginMessage = user.customSamlLoginMessage;\n      } else {\n        window.appGlobals.currentSamlLoginMessage = undefined;\n      }\n\n      if (user.forceSecureSamlLogin) {\n        window.appGlobals.currentForceSaml = true;\n      } else {\n        window.appGlobals.currentForceSaml = false;\n      }\n    }\n\n    if (this.completeExternalLoginText) {\n      window.appGlobals.notifyUserViaToast(this.completeExternalLoginText);\n      this._closeUserLogin();\n      this.completeExternalLoginText = undefined;\n      this._checkLoginForParameters();\n    }\n  }\n\n  async getAdminRights() {\n    const response = (await this.serverApi.getAdminRights()) as\n      | YpAdminRights\n      | void\n      | boolean;\n\n    if (response) {\n      this.adminRights = response as YpAdminRights;\n      this.fireGlobal(\"yp-got-admin-rights\", true);\n\n      //TODO: Check this outFire another signal a bit later in case some components had not set up their listeners TODO: Find a better way\n      /*setTimeout(() => {\n        this.fireGlobal('yp-got-admin-rights', true);\n      }, 1000);*/\n    } else {\n      if (this.adminRights) {\n        this.adminRights = undefined;\n        this.fireGlobal(\"yp-got-admin-rights\", false);\n      }\n    }\n    this.fireGlobal(\"yp-have-checked-admin-rights\");\n  }\n\n  _updateMembershipsIndex(memberships: YpMemberships) {\n    if (memberships) {\n      let i;\n      this.membershipsIndex = { groups: {}, communities: {}, domains: {} };\n      for (i = 0; i < memberships.GroupUsers.length; i++) {\n        this.membershipsIndex.groups[memberships.GroupUsers[i].id] = true;\n      }\n      for (i = 0; i < memberships.CommunityUsers.length; i++) {\n        this.membershipsIndex.communities[memberships.CommunityUsers[i].id] =\n          true;\n      }\n      for (i = 0; i < memberships.DomainUsers.length; i++) {\n        this.membershipsIndex.domains[memberships.DomainUsers[i].id] = true;\n      }\n    } else {\n      this.membershipsIndex = { groups: {}, communities: {}, domains: {} };\n    }\n  }\n\n  async getMemberShips() {\n    const response = (await this.serverApi.getMemberships()) as\n      | YpMemberships\n      | void\n      | boolean;\n    if (response) {\n      this.memberships = response as YpMemberships;\n      this._updateMembershipsIndex(this.memberships);\n      this.fireGlobal(\"yp-got-memberships\", true);\n    } else if (this.memberships) {\n      this.memberships = undefined;\n      this.fireGlobal(\"yp-got-memberships\", false);\n    }\n  }\n}\n"]}