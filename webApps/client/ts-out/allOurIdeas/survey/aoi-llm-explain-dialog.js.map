{"version":3,"file":"aoi-llm-explain-dialog.js","sourceRoot":"","sources":["../../../src/allOurIdeas/survey/aoi-llm-explain-dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html } from \"lit\";\nimport { property, customElement, query, queryAll } from \"lit/decorators.js\";\nimport { YpBaseElement } from \"../../common/yp-base-element.js\";\n\nimport \"@material/web/dialog/dialog.js\";\nimport { MdDialog } from \"@material/web/dialog/dialog.js\";\n\nimport \"@material/web/button/elevated-button.js\";\nimport \"@material/web/button/outlined-button.js\";\nimport \"@material/web/button/text-button.js\";\nimport \"@material/web/progress/circular-progress.js\";\n\nimport \"@material/web/textfield/filled-text-field.js\";\nimport { SharedStyles } from \"./SharedStyles.js\";\nimport { YpChatbotBase } from \"../../yp-llms/yp-chatbot-base.js\";\nimport { AoiServerApi } from \"./AoiServerApi.js\";\nimport { YpLanguages } from \"../../common/languages/ypLanguages.js\";\n\n@customElement(\"aoi-llm-explain-dialog\")\nexport class AoiLlmExplainDialog extends YpChatbotBase {\n  @property({ type: Object })\n  earl!: AoiEarlData;\n\n  @property({ type: Number })\n  groupId!: number;\n\n  @property({ type: Object })\n  question!: AoiQuestionData;\n\n  @property({ type: String })\n  questionText!: string;\n\n  @property({ type: String })\n  leftAnswerText!: string;\n\n  @property({ type: String })\n  rightAnswerText!: string;\n\n  @property({ type: Object })\n  leftAnswer!: AoiAnswerToVoteOnData;\n\n  @property({ type: Object })\n  rightAnswer!: AoiAnswerToVoteOnData;\n\n  @property({ type: String })\n  currentError: string | undefined;\n\n  @property({ type: Boolean })\n  override showCloseButton = true;\n\n  @property({ type: String })\n  override defaultInfoMessage: string | undefined = undefined;\n\n  serverApi!: AoiServerApi;\n\n  haveSentFirstQuestion = false;\n\n  override setupServerApi(): void {\n    this.serverApi = new AoiServerApi();\n  }\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    this.addEventListener(\"yp-ws-opened\", this.sendFirstQuestion);\n    this.addEventListener(\"chatbot-close\", this.cancel);\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    this.removeEventListener(\"yp-ws-opened\", this.sendFirstQuestion);\n    this.addEventListener(\"chatbot-close\", this.cancel);\n  }\n\n  async sendFirstQuestion() {\n    const firstMessage = `**${this.t(\"hereIsTheQuestion\")}:**\n${this.questionText}\n\n**${this.t(\"firstAnswer\")}:**\n${this.leftAnswerText}\n\n**${this.t(\"secondAnswer\")}**\n${this.rightAnswerText}\n`;\n\n    this.addChatBotElement({\n      sender: \"you\",\n      type: \"start\",\n      message: firstMessage,\n    });\n\n    this.addThinkingChatBotMessage();\n\n    await this.serverApi.llmAnswerConverstation(\n      this.groupId,\n      this.wsClientId,\n      this.simplifiedChatLog,\n      YpLanguages.getEnglishName(this.language)\n    );\n  }\n\n  @query(\"#dialog\")\n  dialog!: MdDialog;\n\n  override async sendChatMessage() {\n    const message = this.chatInputField!.value;\n\n    if (message.length === 0) return;\n\n    //this.ws.send(message);\n    this.chatInputField!.value = \"\";\n    this.sendButton!.disabled = false;\n    //this.sendButton!.innerHTML = this.t('Thinking...');\n    setTimeout(() => {\n      this.chatInputField!.blur();\n    });\n\n    this.addChatBotElement({\n      sender: \"you\",\n      type: \"start\",\n      message: message,\n    });\n\n    this.addThinkingChatBotMessage();\n\n    await this.serverApi.llmAnswerConverstation(\n      this.groupId,\n      this.wsClientId,\n      this.simplifiedChatLog,\n      YpLanguages.getEnglishName(this.language)\n    );\n  }\n\n  open() {\n    this.dialog.show();\n    this.currentError = undefined;\n    window.appGlobals.activity(`Llm explain - open`);\n  }\n\n  cancel() {\n    this.dialog.close();\n    window.appGlobals.activity(`Llm explain - cancel`);\n    this.fire(\"closed\");\n  }\n\n  textAreaKeyDown(e: KeyboardEvent) {\n    if (e.keyCode === 13 && !e.shiftKey) {\n      e.preventDefault();\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  static override get styles() {\n    return [\n      ...super.styles,\n      SharedStyles,\n      css`\n        :host {\n          --md-dialog-container-color: var(--md-sys-color-surface);\n        }\n        md-dialog[showing-fullscreen] {\n          /* hack: private! */\n          --_container-max-block-size: 100dvh;\n          --md-dialog-container-inset-block-start: 0px;\n        }\n\n        md-circular-progress {\n          margin-right: 16px;\n          --md-circular-progress-size: 40px;\n        }\n\n        #dialog {\n          width: 100%;\n          max-width: 800px;\n          max-height: 100vh;\n        }\n\n        #ideaText {\n          margin-top: 8px;\n          width: 500px;\n        }\n\n\n        @media (max-width: 960px) {\n          #dialog {\n            --_fullscreen-header-block-size: 74px;\n          }\n\n          #dialog {\n            border-radius: 0;\n          }\n\n          #content, slot[name=\"content\"]::slotted(*) {\n            padding: 8px;\n          }\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return html`<md-dialog\n      @closed=\"${() => this.cancel()}\"\n      ?fullscreen=\"${!this.wide}\"\n      class=\"dialog\"\n      id=\"dialog\"\n    >\n      <div slot=\"headline\">${this.t(\"explainBothAnswers\")}</div>\n      <div slot=\"content\" id=\"content\">${super.render()}</div>\n    </md-dialog> `;\n  }\n}\n"]}