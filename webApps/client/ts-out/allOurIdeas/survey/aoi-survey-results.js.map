{"version":3,"file":"aoi-survey-results.js","sourceRoot":"","sources":["../../../src/allOurIdeas/survey/aoi-survey-results.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from \"lit\";\nimport { property, customElement } from \"lit/decorators.js\";\n\nimport \"../../common/yp-image.js\";\nimport { YpFormattingHelpers } from \"../../common/YpFormattingHelpers.js\";\nimport { YpBaseElement } from \"../../common/yp-base-element.js\";\nimport { SharedStyles } from \"./SharedStyles.js\";\n\nimport \"@material/web/checkbox/checkbox.js\";\nimport { Checkbox } from \"@material/web/checkbox/internal/checkbox.js\";\nimport \"@material/web/button/outlined-button.js\";\nimport \"@material/web/progress/circular-progress.js\";\n\n@customElement(\"aoi-survey-results\")\nexport class AoiSurveyResuls extends YpBaseElement {\n  @property({ type: Array })\n  results!: AoiChoiceData[];\n\n  @property({ type: Object })\n  question!: AoiQuestionData;\n\n  @property({ type: Object })\n  earl!: AoiEarlData;\n\n  @property({ type: Object })\n  group!: YpGroupData;\n\n  @property({ type: Number })\n  groupId!: number;\n\n  @property({ type: Boolean })\n  showScores = false;\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    window.appGlobals.activity(`Results - open`);\n  }\n\n  async fetchResults() {\n    this.results = await window.aoiServerApi.getResults(\n      this.groupId,\n      this.question.id,\n      !this.earl?.configuration?.minimum_ten_votes_to_show_results\n    );\n  }\n\n  override updated(\n    changedProperties: Map<string | number | symbol, unknown>\n  ): void {\n    super.updated(changedProperties);\n\n    if (changedProperties.has(\"earl\") && this.earl) {\n      this.fetchResults();\n    }\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    window.appGlobals.activity(`Results - close`);\n  }\n\n  toggleScores() {\n    const checkbox = this.$$(\"#showScores\") as Checkbox;\n    this.showScores = checkbox.checked;\n    window.appGlobals.activity(\n      `Results - toggle scores ${this.showScores ? \"on\" : \"off\"}`\n    );\n  }\n\n  exportToCSV(): void {\n    const replacer = (key: string, value: any) => (value === null ? \"\" : value);\n\n    const initialHeader = Object.keys(this.results[0]);\n    let header = initialHeader.flatMap((fieldName) =>\n      fieldName === \"data\" ? [\"content\", \"imageUrl\"] : [fieldName]\n    );\n\n    let csv = this.results.map((row) => {\n      return header\n        .map((fieldName) => {\n          if (fieldName === \"content\" || fieldName === \"imageUrl\") {\n            const dataObject = row[\"data\"];\n            const fieldValue = dataObject[fieldName];\n            return JSON.stringify(fieldValue, replacer);\n          } else {\n            return JSON.stringify((row as any)[fieldName], replacer);\n          }\n        })\n        .join(\",\");\n    });\n\n    csv.unshift(header.join(\",\"));\n    const csvString = csv.join(\"\\r\\n\");\n\n    const blob = new Blob([csvString], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement(\"a\");\n    link.href = url;\n    link.download = \"survey_results.csv\";\n    link.click();\n\n    URL.revokeObjectURL(url);\n    setTimeout(() => link.remove(), 0);\n    window.appGlobals.activity(`Results - export to csv`);\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      SharedStyles,\n      css`\n        .title {\n          font-size: 22px;\n          letter-spacing: 0.22em;\n          line-height: 1.7;\n          color: var(--md-sys-color-on-surface);\n          background-color: var(--md-sys-color-surface-container-high);\n          padding: 16px;\n          margin-top: 32px;\n          border-radius: 16px;\n          margin-bottom: 8px;\n        }\n\n        .rankOrderInfo {\n          font-size: 20px;\n          margin: 8px;\n          margin-bottom: 16px;\n          margin-top: 16px;\n          text-align: center;\n        }\n\n        .minimumTenVotesInfo {\n          padding: 16px;\n        }\n\n        .answerImage {\n          width: 75px;\n          height: 75px;\n          border-radius: 45px;\n        }\n\n        .subTitle {\n        }\n\n        .profileImage {\n          width: 50px;\n          height: 50px;\n          min-height: 50px;\n          min-width: 50px;\n          margin-right: 8px;\n        }\n\n        .row {\n          padding: 8px;\n          margin: 8px;\n          border-radius: 16px;\n          background-color: var(--md-sys-color-surface-container-lowest);\n          color: var(--md-sys-color-on-surface);\n\n          min-width: 350px;\n          width: 550px;\n\n          font-size: 16px;\n          vertical-align: center;\n\n          padding-bottom: 16px;\n          margin-bottom: 16px;\n        }\n\n        .row[current-user] {\n          background-color: var(--md-sys-color-teriary);\n          color: var(--md-sys-color-on-primary);\n        }\n\n        .column {\n          padding: 8px;\n        }\n\n        .index {\n          font-size: 20px;\n        }\n\n        .ideaName {\n          padding-bottom: 0;\n          font-size: 20px;\n          width: 100%;\n        }\n\n        .nameAndScore {\n          width: 100%;\n        }\n\n        .scores {\n          margin-top: 16px;\n          padding: 16px;\n          padding-top: 12px;\n          padding-bottom: 12px;\n          margin-bottom: 0px;\n          text-align: center;\n          background-color: var(--md-sys-color-surface-container);\n          color: var(--md-sys-color-on-surface);\n          border-radius: 24px;\n          font-size: 14px;\n          line-height: 1.3;\n        }\n\n        label {\n          margin-top: 16px;\n          margin-bottom: 8px;\n        }\n\n        .checkboxText {\n          margin-left: 8px;\n          margin-bottom: 2px;\n        }\n\n        md-checkbox {\n          padding-bottom: 8px;\n        }\n\n        .loading {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          width: 100%;\n          height: 100vh;\n        }\n\n        .scores[hidden] {\n          display: none;\n        }\n\n        .winLosses {\n          margin-top: 4px;\n        }\n\n        .scoreAndNameContainer {\n          width: 100%;\n        }\n\n        .exportButton {\n          margin-bottom: 128px;\n          margin-top: 32px;\n        }\n\n        @media (min-width: 960px) {\n          .questionTitle {\n            margin-bottom: 16px;\n          }\n        }\n\n        @media (max-width: 960px) {\n          .loading {\n            width: 100vw;\n            height: 100vh;\n          }\n\n          .title {\n            font-size: 18px;\n            letter-spacing: 0.15em;\n            line-height: 1.5;\n            margin-top: 16px;\n          }\n\n          .index {\n            font-size: 16px;\n          }\n\n          .ideaName {\n            font-size: 16px;\n          }\n\n          .row {\n            min-width: 300px;\n            width: 300px;\n          }\n        }\n      `,\n    ];\n  }\n\n  renderRow(index: number, result: AoiChoiceData) {\n    return html`\n      <div class=\"row layout horizontal\">\n        <div class=\"column index\">${index + 1}.</div>\n        <div class=\"layout horizontal nameAndScore\">\n          <div class=\"layout vertical scoreAndNameContainer\">\n            <div class=\"layout horizontal\">\n              <div class=\"column ideaName\">\n                <yp-magic-text\n                  id=\"answerText\"\n                  .contentId=\"${this.groupId}\"\n                  .extraId=\"${result.data.choiceId}\"\n                  .additionalId=\"${this.question.id}\"\n                  textOnly\n                  truncate=\"140\"\n                  .content=\"${result.data.content}\"\n                  .contentLanguage=\"${this.group.language}\"\n                  textType=\"aoiChoiceContent\"\n                ></yp-magic-text>\n              </div>\n              <div class=\"flex\"></div>\n              <img\n                class=\"answerImage\"\n                ?hidden=\"${result.data.imageUrl == undefined}\"\n                src=\"${result.data.imageUrl!}\"\n              />\n            </div>\n            <div\n              class=\"column layout vertical center-center scores\"\n              ?hidden=\"${!this.showScores}\"\n            >\n              <div>\n                <b\n                  >${this.t(\"How likely to win\")}:\n                  ${Math.round(result.score)}%</b\n                >\n              </div>\n              <div class=\"winLosses\">\n                ${this.t(\"Wins\")}: ${YpFormattingHelpers.number(result.wins)}\n                ${this.t(\"Losses\")}:\n                ${YpFormattingHelpers.number(result.losses)}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  override render() {\n    return this.results\n      ? html`\n          <div class=\"topContainer layout vertical wrap center-center\">\n            <div class=\"rankOrderInfo\">${this.t(\"rankedOrderInfo\")}</div>\n            <div class=\"questionTitle\">\n              <yp-magic-text\n                id=\"answerText\"\n                .contentId=\"${this.group.id}\"\n                .extraId=\"${this.question.id}\"\n                textOnly\n                truncate=\"300\"\n                .content=\"${this.question.name}\"\n                .contentLanguage=\"${this.group.language}\"\n                textType=\"aoiQuestionName\"\n              ></yp-magic-text>\n            </div>\n\n            <div class=\"layout horizontal\">\n              <label>\n                <md-checkbox\n                  id=\"showScores\"\n                  @change=\"${this.toggleScores}\"\n                ></md-checkbox>\n                <span class=\"checkboxText\">${this.t(\"Show scores\")}</span>\n              </label>\n            </div>\n            ${this.results.map((result, index) =>\n              this.renderRow(index, result)\n            )}\n            ${this.earl.configuration?.minimum_ten_votes_to_show_results ? html`\n              <div class=\"minimumTenVotesInfo\">${this.t('minimumTenVotesInfo')}</div>\n            `:nothing}\n            <div class=\"title subTitle\">\n              ${YpFormattingHelpers.number(this.question.votes_count)}\n              ${this.t(\"total votes\")}\n            </div>\n            <md-outlined-button @click=${this.exportToCSV} class=\"exportButton\">\n              ${this.t(\"Download Results as CSV\")}\n            </md-outlined-button>\n          </div>\n        `\n      : html`<div class=\"loading\">\n          <md-circular-progress indeterminate></md-circular-progress>\n        </div>`;\n  }\n}\n"]}