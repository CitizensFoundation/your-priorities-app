{"version":3,"file":"aoi-survey-results.js","sourceRoot":"","sources":["../../../src/allOurIdeas/survey/aoi-survey-results.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\n\nimport '../../common/yp-image.js';\nimport { YpFormattingHelpers } from '../../common/YpFormattingHelpers.js';\nimport { YpBaseElement } from '../../common/yp-base-element.js';\nimport { SharedStyles } from './SharedStyles.js';\n\nimport '@material/web/checkbox/checkbox.js';\nimport { Checkbox } from '@material/web/checkbox/internal/checkbox.js';\nimport '@material/web/button/outlined-button.js';\nimport '@material/web/circularprogress/circular-progress.js';\n\n@customElement('aoi-survey-results')\nexport class AoiSurveyResuls extends YpBaseElement {\n  @property({ type: Array })\n  results!: AoiResultData[];\n\n  @property({ type: Object })\n  question!: AoiQuestionData;\n\n  @property({ type: Object })\n  earl!: AoiEarlData;\n\n  @property({ type: Number })\n  groupId!: number;\n\n  @property({ type: Boolean })\n  showScores = false;\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    window.appGlobals.activity(`Results - open`);\n  }\n\n  async fetchResults() {\n    this.results = await window.aoiServerApi.getSurveyResults(this.groupId);\n  }\n\n  override updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    super.updated(changedProperties);\n\n    if (changedProperties.has('earl') && this.earl) {\n      this.fetchResults();\n    }\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    window.appGlobals.activity(`Results - close`);\n  }\n\n  toggleScores() {\n    const checkbox = this.$$('#showScores') as Checkbox;\n    this.showScores = checkbox.checked;\n    window.appGlobals.activity(`Results - toggle scores ${this.showScores ? 'on' : 'off'}`);\n  }\n\n  exportToCSV(): void {\n    const replacer = (key: string, value: any) => (value === null ? '' : value); // specify types for key and value\n    const header = Object.keys(this.results[0]);\n    let csv = this.results.map(row =>\n      header\n        .map(fieldName => JSON.stringify((row as any)[fieldName], replacer))\n        .join(',')\n    ); // specify type for row\n    csv.unshift(header.join(','));\n    const csvString = csv.join('\\r\\n');\n\n    // Create a downloadable link\n    const blob = new Blob([csvString], { type: 'text/csv' });\n    const url = URL.createObjectURL(blob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = 'survey_results.csv';\n    link.click();\n\n    // Clean up\n    URL.revokeObjectURL(url);\n    setTimeout(() => link.remove(), 0);\n    window.appGlobals.activity(`Results - export to csv`);\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      SharedStyles,\n      css`\n        .title {\n          font-size: 22px;\n          letter-spacing: 0.22em;\n          line-height: 1.7;\n          color: var(--md-sys-color-primary);\n          background-color: var(--md-sys-color-on-primary);\n          padding: 16px;\n          margin-top: 32px;\n          border-radius: 16px;\n          margin-bottom: 8px;\n        }\n\n        .subTitle {\n\n        }\n\n        .profileImage {\n          width: 50px;\n          height: 50px;\n          min-height: 50px;\n          min-width: 50px;\n          margin-right: 8px;\n        }\n\n        .row {\n          padding: 8px;\n          margin: 8px;\n          border-radius: 16px;\n          background-color: var(--md-sys-color-on-primary);\n          color: var(--md-sys-color-primary);\n\n          min-width: 350px;\n          width: 550px;\n\n          font-size: 16px;\n          vertical-align: center;\n\n          padding-bottom: 16px;\n        }\n\n        .row[current-user] {\n          background-color: var(--md-sys-color-teriary);\n          color: var(--md-sys-color-on-primary);\n        }\n\n        .column {\n          padding: 8px;\n        }\n\n        .index {\n          font-size: 16px;\n        }\n\n        .ideaName {\n          padding-bottom: 0;\n          width: 100%;\n        }\n\n        .nameAndScore {\n          width: 100%;\n        }\n\n        .scores {\n          margin-top: 16px;\n          padding: 16px;\n          padding-top: 12px;\n          padding-bottom: 12px;\n          margin-bottom: 0px;\n          text-align: center;\n          background-color: var(--md-sys-color-surface-variant);\n          color: var(--md-sys-color-on-surface-variant);\n          border-radius: 24px;\n          font-size: 14px;\n          line-height: 1.2;\n        }\n\n        .checkboxText {\n          color: var(--md-sys-color-primary);\n          margin-top: 14px;\n        }\n\n        md-checkbox {\n          padding-bottom: 8px;\n        }\n\n        .loading {\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          width: 100%;\n          height: 100vh;\n        }\n\n        .scores[hidden] {\n          display: none;\n        }\n\n        .winLosses {\n          margin-top: 4px;\n        }\n\n        .scoreAndNameContainer {\n          width: 100%;\n        }\n\n        .exportButton {\n          margin-bottom: 128px;\n          margin-top: 32px;\n        }\n\n        @media (min-width: 960px) {\n          .questionTitle {\n            margin-bottom: 16px;\n          }\n        }\n\n        @media (max-width: 960px) {\n          .loading {\n            width: 100vw;\n            height: 100vh;\n          }\n\n          .title {\n            font-size: 18px;\n            letter-spacing: 0.15em;\n            line-height: 1.5;\n            margin-top: 16px;\n          }\n\n          .row {\n            min-width: 300px;\n            width: 300px;\n          }\n        }\n      `,\n    ];\n  }\n\n  renderRow(index: number, result: AoiResultData) {\n    return html`\n      <div class=\"row layout horizontal\">\n        <div class=\"column index\">${index + 1}.</div>\n        <div class=\"layout horizontal nameAndScore\">\n          <div class=\"layout vertical scoreAndNameContainer\">\n            <div class=\"column ideaName \">${result.data}</div>\n            <div\n              class=\"column layout vertical center-center scores\"\n              ?hidden=\"${!this.showScores}\"\n            >\n              <div>\n                <b\n                  >${this.t('How likely to win')}:\n                  ${Math.round(result.score)}%</b\n                >\n              </div>\n              <div class=\"winLosses\">\n                ${this.t('Wins')}: ${YpFormattingHelpers.number(result.wins)}\n                ${this.t('Losses')}:\n                ${YpFormattingHelpers.number(result.losses)}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  override render() {\n    return this.results\n      ? html`\n          <div class=\"topContainer layout vertical wrap center-center\">\n            <div class=\"title\">${this.t('Voting Results')}</div>\n            <div class=\"questionTitle\">${this.question.name}</div>\n            <div class=\"layout horizontal\">\n              <md-checkbox\n                id=\"showScores\"\n                @change=\"${this.toggleScores}\"\n              ></md-checkbox>\n              <div class=\"checkboxText\">${this.t('Show scores')}</div>\n            </div>\n            ${this.results.map((result, index) =>\n              this.renderRow(index, result)\n            )}\n            <div class=\"title subTitle\">${YpFormattingHelpers.number(this.question.votes_count)} ${this.t('total votes')}</div>\n            <md-outlined-button @click=${this.exportToCSV} class=\"exportButton\">\n              ${this.t('Download Results as CSV')}\n            </md-outlined-button>\n          </div>\n        `\n      : html`<div class=\"loading\">\n          <md-circular-progress indeterminate></md-circular-progress>\n        </div>`;\n  }\n}\n"]}