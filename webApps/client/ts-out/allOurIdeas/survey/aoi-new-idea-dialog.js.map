{"version":3,"file":"aoi-new-idea-dialog.js","sourceRoot":"","sources":["../../../src/allOurIdeas/survey/aoi-new-idea-dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html } from 'lit';\nimport { property, customElement, query, queryAll } from 'lit/decorators.js';\nimport { YpBaseElement } from '../../common/yp-base-element.js';\n\nimport '@material/web/dialog/dialog.js';\nimport { MdDialog } from '@material/web/dialog/dialog.js';\n\nimport '@material/web/button/elevated-button.js';\nimport '@material/web/button/outlined-button.js';\nimport '@material/web/button/text-button.js';\nimport '@material/web/progress/circular-progress.js';\n\nimport '@material/web/textfield/filled-text-field.js';\nimport { SharedStyles } from './SharedStyles';\n\n@customElement('aoi-new-idea-dialog')\nexport class AoiNewIdeaDialog extends YpBaseElement {\n  @property({ type: Object })\n  earl!: AoiEarlData;\n\n  @property({ type: Number })\n  groupId!: number;\n\n  @property({ type: Object })\n  question!: AoiQuestionData;\n\n  @property({ type: Boolean })\n  submitting = false;\n\n  @property({ type: String })\n  currentError: string | undefined;\n\n  @query('#ideaText')\n  ideaText!: HTMLInputElement;\n\n  override async connectedCallback() {\n    super.connectedCallback();\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n  }\n\n  async submit() {\n    window.appGlobals.activity(`New Idea - submit`);\n    this.currentError = undefined;\n    this.submitting = true;\n    let addIdeaResponse;\n    try {\n      addIdeaResponse = await window.aoiServerApi.submitIdea(\n        this.groupId,\n        this.question.id,\n        this.ideaText.value\n      );\n    } catch (error: any) {\n      console.error(error);\n    }\n    this.submitting = false;\n    if (!addIdeaResponse || addIdeaResponse.error) {\n      this.currentError = this.t('An error occurred. Please try again.');\n      window.appGlobals.activity(`New Idea - general error`);\n    } else if (addIdeaResponse.flagged) {\n      this.currentError = this.t(\n        'Your idea has been flagged as inappropriate. Please try again.'\n      );\n      window.appGlobals.activity(`New Idea - moderation flag`);\n    } else {\n      this.ideaText.value = '';\n      if (addIdeaResponse.active) {\n        this.fire(\n          'display-snackbar',\n          this.t('Your idea has been added, you can continue voting.')\n        );\n      } else {\n        this.fire(\n          'display-snackbar',\n          this.t('Your idea is in a moderation queue.')\n        );\n      }\n      window.appGlobals.activity(`New Idea - added`);\n      this.dialog.close();\n    }\n  }\n\n  @query('#dialog')\n  dialog!: MdDialog;\n\n  scrollUp() {\n    //await this.updateComplete;\n    setTimeout(() => {\n      //@ts-ignore\n      (this.$$('#dialog') as MdDialog).contentElement.scrollTop = 0;\n    }, 100);\n  }\n\n  open() {\n    this.dialog.show();\n    this.currentError = undefined;\n    window.appGlobals.activity(`New Idea - open`);\n  }\n\n  cancel() {\n    this.dialog.close();\n    window.appGlobals.activity(`New Idea - cancel`);\n  }\n\n  textAreaKeyDown(e: KeyboardEvent) {\n    if (e.keyCode === 13 && !e.shiftKey) {\n      e.preventDefault();\n      return false;\n    } else {\n      return true;\n    }\n  }\n\n  static override get styles() {\n    return [\n      ...super.styles,\n      SharedStyles,\n      css`\n        :host {\n          --md-dialog-container-color: var(--md-sys-color-surface);\n        }\n        md-dialog[showing-fullscreen] {\n          /* hack: private! */\n          --_container-max-block-size: 100dvh;\n          --md-dialog-container-inset-block-start: 0px;\n        }\n\n        md-circular-progress {\n          margin-right: 16px;\n          --md-circular-progress-size: 40px;\n        }\n\n        .indexNumber {\n          margin-top: 12px;\n          font-size: 20px;\n          margin-left: 8px;\n          margin-right: 8px;\n          color: var(--md-sys-color-on-surface);\n        }\n\n        .cancelButton {\n        }\n\n        .header {\n          text-align: center;\n        }\n\n        #dialog {\n          width: 100%;\n        }\n\n        #ideaText {\n          margin-top: 8px;\n          width: 500px;\n        }\n\n        .questionTitle {\n          margin-top: 0;\n          margin-bottom: 16px;\n          line-height: normal;\n        }\n\n        md-filled-field {\n          padding: 8px;\n          margin-bottom: 8px;\n          border-radius: 12px;\n        }\n\n        .submitButton {\n          margin-left: 8px;\n        }\n\n        .error {\n          color: var(--md-sys-color-error);\n          font-size: 16px;\n          margin: 8px;\n        }\n\n        @media (max-width: 960px) {\n          #dialog {\n            --_fullscreen-header-block-size: 74px;\n          }\n\n          .footer {\n            margin-bottom: 8px;\n          }\n\n          .questionTitle {\n            margin-top: 16px;\n            margin-bottom: 12dkqwpo dkqwpo kqwpx;\n          }\n\n          .cancelButton {\n            margin-right: 32px;\n          }\n\n          .header {\n            padding: 8px;\n            font-size: 22px;\n          }\n\n          #ideaText {\n            width: 95%;\n          }\n        }\n      `,\n    ];\n  }\n\n  renderContent() {\n    return html`\n      <div class=\"questionTitle\">${this.question.name}</div>\n      <div class=\"layout vertical center-center\">\n        <md-filled-text-field\n          id=\"ideaText\"\n          type=\"textarea\"\n          @keydown=\"${this.textAreaKeyDown}\"\n          maxLength=\"140\"\n          .rows=\"${this.wide ? 3 : 5}\"\n          label=\"${this.t('Your idea')}\"\n        >\n        </md-filled-text-field>\n        <div class=\"error\" ?hidden=\"${!this.currentError}\">\n          ${this.currentError}\n        </div>\n      </div>\n    `;\n  }\n\n  renderFooter() {\n    return html` <div class=\"layout horizontal footer\">\n      <md-circular-progress\n        ?hidden=\"${!this.submitting}\"\n        indeterminate\n      ></md-circular-progress>\n      <md-text-button\n        class=\"cancelButton\"\n        @click=\"${this.cancel}\"\n        ?disabled=\"${this.submitting}\"\n      >\n        ${this.t('Cancel')}\n      </md-text-button>\n      <md-outlined-button\n        class=\"submitButton\"\n        @click=\"${this.submit}\"\n        ?disabled=\"${this.submitting}\"\n      >\n        ${this.t('Submit Idea')}\n      </md-outlined-button>\n    </div>`;\n  }\n\n  override render() {\n    return html`<md-dialog\n      ?fullscreen=\"${!this.wide}\"\n      id=\"dialog\"\n    >\n      <div slot=\"content\">${this.renderContent()}</div>\n      <div slot=\"actions\">${this.renderFooter()}</div>\n    </md-dialog> `;\n  }\n}\n"]}