{"version":3,"file":"aoi-survey-analysis.js","sourceRoot":"","sources":["../../../src/allOurIdeas/survey/aoi-survey-analysis.ts"],"names":[],"mappings":"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","sourcesContent":["import { css, html, nothing } from \"lit\";\nimport { property, customElement } from \"lit/decorators.js\";\nimport { resolveMarkdown } from \"../../common/litMarkdown/litMarkdown.js\";\n\nimport \"../../common/yp-image.js\";\nimport { YpFormattingHelpers } from \"../../common/YpFormattingHelpers.js\";\nimport { YpBaseElement } from \"../../common/yp-base-element.js\";\nimport { SharedStyles } from \"./SharedStyles.js\";\n\nimport \"@material/web/progress/circular-progress.js\";\n\n@customElement(\"aoi-survey-analysis\")\nexport class AoiSurveyAnalysis extends YpBaseElement {\n  @property({ type: Number })\n  groupId!: number;\n\n  @property({ type: Array })\n  results!: AoiResultData[];\n\n  @property({ type: Object })\n  question!: AoiQuestionData;\n\n  @property({ type: Object })\n  earl!: AoiEarlData;\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    window.appGlobals.activity(`Analysis - open`);\n  }\n\n  override disconnectedCallback(): void {\n    super.disconnectedCallback();\n    window.appGlobals.activity(`Analysis - close`);\n  }\n\n  async fetchResults() {\n    try {\n      const analysis_config = JSON.parse(this.earl.configuration!.analysis_config as any) as any;\n\n      debugger;\n\n      for (\n        let analysisIndex = 0;\n        analysisIndex < analysis_config.analyses.length;\n        analysisIndex++\n      ) {\n        const analysis = analysis_config.analyses[analysisIndex];\n        for (\n          let typeIndex = 0;\n          typeIndex < analysis.analysisTypes.length;\n          typeIndex++\n        ) {\n          const analysisData = await window.aoiServerApi.getSurveyAnalysis(\n            this.groupId,\n            analysisIndex,\n            typeIndex\n          );\n\n          if (!analysisData) {\n            analysis.analysisTypes[typeIndex].analysis = \"error\";\n            analysis.ideaRows = [];\n          } else {\n            analysis.analysisTypes[typeIndex].analysis = analysisData.analysis;\n            analysis.ideaRows = analysisData.ideaRowsFromServer;\n          }\n          this.requestUpdate();\n        }\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  override updated(\n    changedProperties: Map<string | number | symbol, unknown>\n  ): void {\n    super.updated(changedProperties);\n\n    if (changedProperties.has(\"earl\") && this.earl) {\n      this.fetchResults();\n    }\n  }\n\n  static override get styles() {\n    return [\n      ...super.styles,\n      SharedStyles,\n      css`\n        .title {\n          font-size: 22px;\n          letter-spacing: 0.22em;\n          line-height: 1.7;\n          color: var(--md-sys-color-primary);\n          background-color: var(--md-sys-color-on-primary);\n          padding: 16px;\n          margin-top: 32px;\n          border-radius: 16px;\n          margin-bottom: 8px;\n        }\n\n        .analysisTitle {\n          font-size: 16px;\n          margin: 16px;\n          padding: 8px;\n          margin-top: 8px;\n          border-radius: 16px;\n          text-align: center;\n          color: var(--md-sys-color-on-secondary);\n          background-color: var(--md-sys-color-secondary);\n        }\n\n        .ideasLabel {\n          font-size: 16px;\n          margin: 16px;\n          padding: 8px;\n          margin-bottom: 8px;\n          width: 80%;\n          border-radius: 16px;\n          text-align: center;\n          color: var(--md-sys-color-on-primary);\n          background-color: var(--md-sys-color-primary);\n        }\n\n        .generatingInfo {\n          font-size: 16px;\n          margin-top: 8px;\n          margin-bottom: 16px;\n          font-style: italic;\n        }\n\n        .analysisResults {\n          padding: 16px;\n          padding-top: 0;\n        }\n\n        .rowsContainer {\n          padding: 0;\n          padding-top: 16px;\n          padding-bottom: 16px;\n          margin: 16px;\n          width: 100%;\n          margin-top: 8px;\n          border-radius: 24px;\n          margin-bottom: 16px;\n          color: var(--md-sys-color-primary);\n          background-color: var(--md-sys-color-on-primary);\n        }\n\n        .analysisContainer {\n          padding: 8px;\n          margin: 8px;\n          color: var(--md-sys-color-primary);\n\n          min-width: 350px;\n          width: 550px;\n\n          font-size: 16px;\n          vertical-align: center;\n\n          padding-bottom: 16px;\n        }\n\n        .analysisRow {\n          margin-bottom: 16px;\n          width: 100%;\n        }\n\n        .analysisRow {\n          padding: 0px;\n          margin: 0px;\n          border-radius: 16px;\n        }\n\n        .column {\n          padding: 8px;\n        }\n\n        .index {\n          font-size: 16px;\n        }\n\n        .nickname {\n          padding-bottom: 0;\n        }\n\n        .nameAndScore {\n          width: 100%;\n        }\n\n        .analysisRow {\n        }\n\n        .answers {\n          text-align: left;\n          align-items: left;\n          width: 100%;\n        }\n\n        .questionTitle {\n        }\n\n        @media (min-width: 960px) {\n          .questionTitle {\n            margin-bottom: 16px;\n          }\n        }\n\n        @media (max-width: 960px) {\n          .title {\n            font-size: 18px;\n            letter-spacing: 0.15em;\n            line-height: 1.5;\n            margin-top: 16px;\n          }\n\n          .row {\n            min-width: 300px;\n            width: 300px;\n          }\n\n          .analysisContainer {\n            min-width: 100%;\n            width: 100%;\n            padding-left: 0;\n            padding-right: 0;\n            margin: 0;\n          }\n\n          .analysisResults {\n            border-radius: 16px;\n          }\n\n          .analysisRow {\n            width: 100%;\n          }\n\n          .ideaDescription {\n            padding-right: 24px;\n          }\n\n          .ideaIndex {\n            padding-left: 24px;\n          }\n        }\n      `,\n    ];\n  }\n\n  renderIdeas(index: number, result: AoiResultData) {\n    return html`\n      <div class=\"answers layout horizontal\">\n        <div class=\"column index ideaIndex\">${index + 1}.</div>\n        <div class=\"column layout vertical ideaDescription\">\n          <div class=\"\">${result.data}</div>\n        </div>\n      </div>\n    `;\n  }\n\n  analysisRow(analysisItem: AnalysisTypeData) {\n    let analysisHtml;\n\n    if (analysisItem.analysis && analysisItem.analysis != \"error\") {\n      analysisHtml = html`\n        <div class=\"analysisResults\">\n          ${resolveMarkdown(analysisItem.analysis, {\n            includeImages: true,\n            includeCodeBlockClassNames: true,\n          })}\n          <div class=\"generatingInfo\">\n            ${this.t(\"Written by GPT-4\")}\n          </div>\n        </div>\n      </div>`;\n    } else if (analysisItem.analysis && analysisItem.analysis == \"error\") {\n      analysisHtml = html`<div class=\" layout horizontal center-center\">\n        ${this.t(\"Error fetching analysis\")}\n      </div>`;\n    } else {\n      analysisHtml = html`<div class=\" layout vertical center-center\">\n        <md-circular-progress indeterminate></md-circular-progress>\n        <div class=\"generatingInfo\">\n          ${this.t(\"Generating analysis with GPT-4\")}\n        </div>\n      </div>`;\n    }\n\n    return html`<div class=\"analysisRow\">\n      <div class=\"analysisTitle\">${analysisItem.label}</div>\n      ${analysisHtml}\n    </div>`;\n  }\n\n  renderAnalysis() {\n    let outHtml = html``;\n\n    if (\n      this.earl.configuration &&\n      this.earl.configuration.analysis_config?.analyses?.length > 0\n    ) {\n      for (\n        let i = 0;\n        i < this.earl.configuration!.analysis_config.analyses.length;\n        i++\n      ) {\n        const analysis = this.earl.configuration!.analysis_config.analyses[i];\n        outHtml = html`${outHtml}\n          <div class=\"ideasLabel\">${analysis.ideasLabel}</div>\n\n          ${analysis.ideaRows?.map((result, index) =>\n            this.renderIdeas(index, result)\n          )} `;\n        let innerHtml = html``;\n        for (let a = 0; a < analysis.analysisTypes.length; a++) {\n          innerHtml = html`${innerHtml}\n          ${this.analysisRow(analysis.analysisTypes[a])} `;\n        }\n        outHtml = html`${outHtml}\n          <div class=\"rowsContainer\">${innerHtml}</div>`;\n      }\n    }\n\n    return outHtml;\n  }\n\n  override render() {\n    return html`\n      <div class=\"topContainer layout vertical wrap center-center\">\n        <div class=\"title\">${this.t(\"Vote Analysis\")}</div>\n        <div class=\"layout vertical self-start\">\n          <div class=\"questionTitle\">${this.question.name}</div>\n        </div>\n        <div class=\"layout vertical center-center analysisContainer\">\n          ${this.renderAnalysis()}\n        </div>\n      </div>\n    `;\n  }\n}\n"]}