{"version":3,"file":"yp-forgot-password.js","sourceRoot":"","sources":["../../src/yp-user/yp-forgot-password.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, css } from \"lit\";\nimport { customElement, property } from \"lit/decorators.js\";\n\nimport \"@material/web/dialog/dialog.js\";\nimport \"@material/web/textfield/outlined-text-field.js\";\nimport \"@material/web/button/text-button.js\";\nimport { Dialog } from \"@material/web/dialog/internal/dialog.js\";\nimport { TextField } from \"@material/web/textfield/internal/text-field.js\";\n\nimport { YpBaseElement } from \"../common/yp-base-element.js\";\n\n@customElement(\"yp-forgot-password\")\nexport class YpForgotPassword extends YpBaseElement {\n  @property({ type: String })\n  emailErrorMessage: string | undefined;\n\n  @property({ type: String })\n  email = \"\";\n\n  @property({ type: Boolean })\n  emailHasBeenSent = false;\n\n  @property({ type: Boolean })\n  isSending = false;\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        md-dialog {\n         // height: 100%;\n        }\n\n        md-dialog[open][is-safari] {\n          //height: 100%;\n        }\n\n        :host {\n          --md-dialog-container-color: var(--md-sys-color-surface);\n          --md-filled-field-container-color: var(\n            --md-sys-color-surface\n          ) !important;\n        }\n\n        md-filled-text-field {\n          --md-filled-field-container-color: var(\n            --md-sys-color-surface\n          ) !important;\n        }\n        md-outlined-text-field {\n          text-align: left;\n        }\n      `,\n    ];\n  }\n\n  closed() {\n    this.fireGlobal(\"yp-dialog-closed\");\n  }\n\n  override render() {\n    return html`\n      <md-dialog\n        id=\"dialog\"\n        ?is-safari=\"${this.isSafari}\"\n        @closed=\"${this.closed}\"\n        @cancel=\"${this.scrimDisableAction}\"\n        class=\"layout vertical center-center\"\n      >\n        <div slot=\"headline\">${this.t(\"user.forgotPassword\")}</div>\n\n        <div slot=\"content\">\n          <p ?hidden=\"${this.emailHasBeenSent}\">\n            ${this.t(\"user.forgotPasswordInstructions\")}\n          </p>\n\n          <p ?hidden=\"${!this.emailHasBeenSent}\">\n            ${this.t(\"user.forgotPasswordEmailHasBeenSent\")}\n          </p>\n\n          <md-outlined-text-field\n            id=\"email\"\n            type=\"email\"\n            @keydown=\"${this._onEnter}\"\n            .label=\"${this.t(\"email\")}\"\n            .value=\"${this.email}\"\n            pattern=\".+@.+\"\n            minLength=\"3\"\n            ?hidden=\"${this.emailHasBeenSent}\"\n          >\n          </md-outlined-text-field>\n        </div>\n\n        <div slot=\"actions\">\n          <md-text-button\n            dialogAction=\"cancel\"\n            @click=\"${this.close}\"\n            ?hidden=\"${this.emailHasBeenSent}\"\n            >${this.t(\"cancel\")}</md-text-button\n          >\n          <md-text-button\n            autofocus\n            ?hidden=\"${this.emailHasBeenSent}\"\n            @click=\"${this._validateAndSend}\"\n            >${this.t(\"user.forgotPassword\")}</md-text-button\n          >\n\n          <md-text-button dialogAction=\"ok\"\n            ?hidden=\"${!this.emailHasBeenSent}\"\n            @click=\"${this.close}\"\n            >${this.t(\"ok\")}</md-text-button\n          >\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  _onEnter(event: KeyboardEvent) {\n    if (event.keyCode == 13) {\n      event.stopPropagation();\n      this._validateAndSend();\n    }\n  }\n\n  async _validateAndSend() {\n    const email = this.$$(\"#email\") as TextField;\n    if (email && email.checkValidity() && email.value) {\n      if (!this.isSending) {\n        this.isSending = true;\n\n        const response = await window.serverApi.forgotPassword({\n          email: email.value,\n        });\n\n        this.isSending = false;\n\n        if (response) {\n          window.appGlobals.notifyUserViaToast(\n            this.t(\"user.forgotPasswordEmailHasBeenSent\")\n          );\n          this.emailHasBeenSent = true;\n        }\n      }\n      return true;\n    } else {\n      this.fire(\"yp-error\", this.t(\"user.completeForm\"));\n      return false;\n    }\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.addGlobalListener(\n      \"yp-network-error\",\n      this._forgotPasswordError.bind(this)\n    );\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeGlobalListener(\n      \"yp-network-error\",\n      this._forgotPasswordError.bind(this)\n    );\n  }\n\n  _forgotPasswordError(event: CustomEvent) {\n    if (event.detail.errorId && event.detail.errorId == \"forgotPassword\") {\n      this.isSending = false;\n    }\n  }\n\n  open(detail: { email: string }) {\n    if (detail && detail.email) {\n      this.email = detail.email;\n    }\n\n    this.fireGlobal(\"yp-dialog-opened\");\n\n    (this.$$(\"#dialog\") as Dialog).show();\n  }\n\n  close() {\n    (this.$$(\"#dialog\") as Dialog).close();\n  }\n}\n"]}