{"version":3,"file":"pl-dashboard.js","sourceRoot":"","sources":["../../../src/analytics-and-promotion/pl-components/pl-dashboard.ts"],"names":[],"mappings":"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","sourcesContent":["//import { withRouter } from 'react-router-dom';\nimport { LitElement, css, html, nothing } from 'lit';\nimport { property, customElement } from 'lit/decorators.js';\n\nimport './pl-realtime.js';\nimport './pl-historical.js';\n\nimport { parseQuery } from './query';\nimport * as api from './api';\n\n//import { withComparisonProvider } from './comparison-provider-hoc';\n\nimport { BrowserHistory, createBrowserHistory } from './util/history.js';\nimport { PlausibleBaseElementWithState } from './pl-base-element-with-state.js';\n\nconst THIRTY_SECONDS = 30000;\n\nclass Timer {\n  listeners: Array<any> = [];\n  //@ts-ignore\n  intervalId: NodeJS.Timeout | undefined;\n\n  constructor() {\n    this.intervalId = setInterval(this.dispatchTick.bind(this), THIRTY_SECONDS);\n  }\n\n  onTick(listener: any) {\n    this.listeners.push(listener);\n  }\n\n  dispatchTick() {\n    for (const listener of this.listeners) {\n      listener();\n    }\n  }\n}\n\n@customElement('pl-dashboard')\nexport class PlausibleDashboard extends PlausibleBaseElementWithState {\n  @property({ type: Object })\n  history!: BrowserHistory;\n\n  @property({ type: String })\n  metric = 'visitors'\n\n  /*private routes = new Routes(this, [\n    { path: '/', render: () => html`<h1>Home</h1>` },\n    { path: '/communities', render: () => html`<h1>Communities</h1>` },\n    { path: '/about', render: () => html`<h1>About</h1>` },\n  ]);*/\n\n  constructor() {\n    super();\n  }\n\n  resetState() {\n    //this.timer = new Timer();\n  }\n\n override connectedCallback(): void {\n    super.connectedCallback();\n    this.timer = new Timer();\n    this.history = createBrowserHistory();\n    this.query = parseQuery(location.search, this.site);\n    window.addEventListener('popstate',  () => {\n      this.query = parseQuery(location.search, this.site);\n    });\n  }\n\n  static override get styles() {\n    return [\n      ...super.styles,\n    ];\n  }\n\n  override updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    super.updated(changedProperties);\n    if (changedProperties.has('query')) {\n      api.cancelAll();\n      this.resetState();\n    }\n  }\n\n  override render() {\n    if (this.site && this.query) {\n      if (this.query!.period === 'realtime') {\n        return html`\n          <pl-realtime\n            .timer=\"${this.timer}\"\n            .site=\"${this.site}\"\n            .currentRole=\"${this.currentUserRole}\"\n            .query=\"${this.query}\"\n            .history=\"${this.history}\"\n            .proxyUrl=\"${this.proxyUrl}\"\n            .proxyFaviconBaseUrl=\"${this.proxyFaviconBaseUrl}\"\n          ></pl-realtime>\n        `;\n      } else {\n        return html`\n          <pl-historical\n            .timer=\"${this.timer}\"\n            .site=\"${this.site}\"\n            .history=\"${this.history}\"\n            .currentRole=\"${this.currentUserRole}\"\n            .query=\"${this.query}\"\n            .proxyUrl=\"${this.proxyUrl}\"\n            .proxyFaviconBaseUrl=\"${this.proxyFaviconBaseUrl}\"\n          ></pl-historical>\n        `;\n      }\n    } else {\n      return nothing;\n    }\n  }\n}\n"]}