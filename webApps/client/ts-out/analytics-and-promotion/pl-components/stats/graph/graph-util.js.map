{"version":3,"file":"graph-util.js","sourceRoot":"","sources":["../../../../../src/analytics-and-promotion/pl-components/stats/graph/graph-util.ts"],"names":[],"mappings":"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","sourcesContent":["import { METRIC_LABELS, METRIC_FORMATTER } from './pl-visitors-graph.js';\nimport { parseUTCDate, formatMonthYYYY, formatDay } from '../../util/date.js';\n\ninterface GraphData {\n  interval: string;\n  labels: string[];\n  // Additional properties can be added as required\n}\n\ninterface TooltipModel {\n  opacity: number;\n  body?: { lines: string[] }[];\n  dataPoints: { dataIndex: number; raw: number }[];\n  // Additional properties can be added as required\n}\n\ninterface CanvasElement extends HTMLElement {\n  getBoundingClientRect: () => DOMRect;\n}\n\nexport const dateFormatter = (interval: string, longForm: boolean = false) => {\n  return function (isoDate: string, _index?: number, _ticks?: any): string | undefined {\n    let date = parseUTCDate(isoDate);\n\n    if (interval === 'month') {\n      return formatMonthYYYY(date);\n    } else if (interval === 'date') {\n      return formatDay(date);\n    } else if (interval === 'hour') {\n      const parts = isoDate.split(/[^0-9]/);\n      //@ts-ignore\n      date = new Date(parts[0], parts[1] - 1, parts[2], parts[3], parts[4], parts[5]);\n      var hours = date.getHours(); // Not sure why getUTCHours doesn't work here\n      var ampm = hours >= 12 ? 'pm' : 'am';\n      hours = hours % 12;\n      hours = hours ? hours : 12; // the hour '0' should be '12'\n      return hours + ampm;\n    } else if (interval === 'minute') {\n      if (longForm) {\n        const minutesAgo = Math.abs(parseInt(isoDate));\n        return minutesAgo === 1 ? '1 minute ago' : minutesAgo + ' minutes ago';\n      } else {\n        return isoDate + 'm';\n      }\n    } else {\n      return isoDate;\n    }\n  };\n};\n\nexport const GraphTooltip = (\n  graphData: GraphData,\n  metric: string,\n  mainCanvasElement: CanvasElement,\n  tooltipElement: HTMLElement\n) => {\n  return (context: any) => {\n    const tooltipModel: TooltipModel = context.tooltip;\n    const offset: DOMRect = mainCanvasElement.getBoundingClientRect();\n\n    // Tooltip Element\n    let tooltipEl = tooltipElement;\n\n    // Create element on first render\n    if (!tooltipEl) {\n      tooltipEl = document.createElement('div');\n      tooltipEl.id = 'chartjs-tooltip';\n      tooltipEl.style.display = 'none';\n      tooltipEl.style.opacity = \"0\";\n      document.body.appendChild(tooltipEl);\n    }\n\n    // Positioning for smaller screens\n    if (tooltipEl && offset && window.innerWidth < 768) {\n      tooltipEl.style.top = offset.y + offset.height + window.scrollY + 15 + 'px';\n      tooltipEl.style.left = offset.x + 'px';\n      tooltipEl.style.right = \"\";\n      tooltipEl.style.opacity = \"1\";\n    }\n\n    // Stop if no tooltip showing\n    if (tooltipModel.opacity === 0) {\n      tooltipEl.style.display = 'none';\n      return;\n    }\n\n    // Function to get the body content\n    function getBody(bodyItem: { lines: string[] }) {\n      return bodyItem.lines;\n    }\n\n    // Function to render the label\n    function renderLabel(label: string, prev_label?: string) {\n      const formattedLabel = dateFormatter(graphData.interval, true)(label);\n      const prev_formattedLabel = prev_label ? dateFormatter(graphData.interval, true)(prev_label) : null;\n\n      if (graphData.interval === 'month' || graphData.interval === 'date') {\n        return prev_label ? prev_formattedLabel : formattedLabel;\n      }\n\n      if (graphData.interval === 'hour') {\n        return prev_label\n          ? `${dateFormatter(\"date\", true)(prev_label)}, ${dateFormatter(graphData.interval, true)(prev_label)}`\n          : `${dateFormatter(\"date\", true)(label)}, ${formattedLabel}`;\n      }\n\n      return prev_label ? prev_formattedLabel : formattedLabel;\n    }\n\n    // Set Tooltip Body\n    if (tooltipModel.body) {\n      var bodyLines = tooltipModel.body.map(getBody);\n\n      // Remove duplicated line on overlap between dashed and normal\n      if (bodyLines.length === 3) {\n        bodyLines[1] = [];\n      }\n\n      const data = tooltipModel.dataPoints[0];\n      const label = graphData.labels[data.dataIndex];\n      const point = data.raw || 0;\n\n      let innerHtml = `\n        <div class='text-gray-100 flex flex-col'>\n          <div class='flex justify-between items-center'>\n            <span class='font-bold mr-4 text-lg'>${METRIC_LABELS[metric]}</span>\n          </div>\n          <div class='flex flex-col'>\n            <div class='flex flex-row justify-between items-center'>\n              <span class='flex items-center mr-4'>\n                <div class='w-3 h-3 mr-1 rounded-full' style='background-color: rgba(101,116,205)'></div>\n                <span>${renderLabel(label)}</span>\n              </span>\n              <span>${METRIC_FORMATTER[metric](point)}</span>\n            </div>\n          </div>\n          <span class='font-bold text-'>${graphData.interval === 'month' ? 'Click to view month' : graphData.interval === 'date' ? 'Click to view day' : ''}</span>\n        </div>\n      `;\n\n      tooltipEl.innerHTML = innerHtml;\n    }\n\n    tooltipEl.style.display = \"\";\n  };\n};\n\nexport const buildDataSet = (\n  plot: Array<number | undefined>,\n  present_index: number | null,\n  ctx: CanvasRenderingContext2D,\n  label: string,\n  isPrevious: boolean\n) => {\n  var gradient = ctx.createLinearGradient(0, 0, 0, 300);\n  var prev_gradient = ctx.createLinearGradient(0, 0, 0, 300);\n  gradient.addColorStop(0, 'rgba(101,116,205, 0.2)');\n  gradient.addColorStop(1, 'rgba(101,116,205, 0)');\n  prev_gradient.addColorStop(0, 'rgba(101,116,205, 0.075)');\n  prev_gradient.addColorStop(1, 'rgba(101,116,205, 0)');\n\n  if (!isPrevious) {\n    if (present_index !== null) {\n      var dashedPart = plot.slice(present_index - 1, present_index + 1);\n      var dashedPlot = (new Array(present_index - 1)).fill(undefined).concat(dashedPart);\n      const _plot = [...plot];\n      for (var i = present_index; i < _plot.length; i++) {\n        _plot[i] = undefined;\n      }\n\n      return [{\n        label,\n        data: _plot,\n        borderWidth: 3,\n        borderColor: 'rgba(101,116,205)',\n        pointBackgroundColor: 'rgba(101,116,205)',\n        pointHoverBackgroundColor: 'rgba(71, 87, 193)',\n        pointBorderColor: 'transparent',\n        pointHoverRadius: 4,\n        backgroundColor: gradient,\n        fill: true,\n      },\n      {\n        label,\n        data: dashedPlot,\n        borderWidth: 3,\n        borderDash: [3, 3],\n        borderColor: 'rgba(101,116,205)',\n        pointHoverBackgroundColor: 'rgba(71, 87, 193)',\n        pointBorderColor: 'transparent',\n        pointHoverRadius: 4,\n        backgroundColor: gradient,\n        fill: true,\n      }];\n    } else {\n      return [{\n        label,\n        data: plot,\n        borderWidth: 3,\n        borderColor: 'rgba(101,116,205)',\n        pointHoverBackgroundColor: 'rgba(71, 87, 193)',\n        pointBorderColor: 'transparent',\n        pointHoverRadius: 4,\n        backgroundColor: gradient,\n        fill: true,\n      }];\n    }\n  } else {\n    return [{\n      label,\n      data: plot,\n      borderWidth: 2,\n      borderColor: 'rgba(166,187,210,0.5)',\n      pointHoverBackgroundColor: 'rgba(166,187,210,0.8)',\n      pointBorderColor: 'transparent',\n      pointHoverBorderColor: 'transparent',\n      pointHoverRadius: 4,\n      backgroundColor: prev_gradient,\n      fill: true,\n    }];\n  }\n};\n"]}