{"version":3,"file":"yp-point-news-story-edit.js","sourceRoot":"","sources":["../../src/yp-point/yp-point-news-story-edit.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAE,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,KAAK,CAAC;AACzC,OAAO,EAAE,QAAQ,EAAE,aAAa,EAAE,MAAM,mBAAmB,CAAC;AAI5D,OAAO,gDAAgD,CAAC;AAExD,OAAO,qCAAqC,CAAC;AAE7C,OAAO,6BAA6B,CAAC;AAErC,OAAO,gCAAgC,CAAC;AAExC,OAAO,EAAE,sBAAsB,EAAE,MAAM,yCAAyC,CAAC;AAK1E,IAAM,oBAAoB,GAA1B,MAAM,oBAAqB,SAAQ,sBAAsB;IAAzD;;QAEL,sBAAiB,GAAG,IAAI,CAAC;QAGzB,qBAAgB,GAAG,IAAI,CAAC;IA2Q1B,CAAC;IAjPC,MAAM,KAAc,MAAM;QACxB,OAAO;YACL,KAAK,CAAC,MAAM;YACZ,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;OAwEF;SACF,CAAC;IACJ,CAAC;IAEQ,MAAM;QACb,OAAO,IAAI,CAAC,KAAK;YACf,CAAC,CAAC,IAAI,CAAA;;;;;yBAKa,IAAI,CAAC,YAAY;wBAClB,IAAI,CAAC,GAAG;;;;;;;;4BAQJ,IAAI,CAAC,KAAK,CAAC,OAAO;4BAClB,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,CAAC,CAAC,oBAAoB,CAAC;;;;8BAIxC,IAAI,CAAC,QAAQ;;;;;;;8BAOb,IAAI,CAAC,UAAU;uBACtB,IAAI,CAAC,QAAQ;gBAChB,IAAI,CAAC,CAAC,CAAC,qBAAqB,CAAC;;;;;;;gBAOjC,IAAI,CAAC,KAAK,CAAC,UAAU;gBACrB,CAAC,CAAC,IAAI,CAAA;;;sCAGgB,IAAI,CAAC,KAAK,CAAC,UAAU;;;kCAGzB,IAAI,CAAC,CAAC,CAAC,mBAAmB,CAAC;;kCAE3B,IAAI,CAAC,WAAW;;;mBAG/B;gBACH,CAAC,CAAC,IAAI,CAAA,EAAE;;;SAGf;YACH,CAAC,CAAC,OAAO,CAAC;IACd,CAAC;IAED,gBAAgB;QACb,IAAI,CAAC,EAAE,CAAC,oBAAoB,CAAY,CAAC,QAAQ,GAAG,KAAK,CAAC;IAC7D,CAAC;IAEQ,iBAAiB;QACxB,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAC1B,IAAI,CAAC,MAAM,EAAE,CAAC;IAChB,CAAC;IAEQ,YAAY,CAAC,KAA6C;QACjE,KAAK,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;QACzB,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAe,CAAC,gBAAgB,CACxD,OAAO,EACP,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAC7B,CAAC;IACJ,CAAC;IAED,IAAI,eAAe;QACjB,OAAQ,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAe,CAAC,KAAK,CAAC;IACzD,CAAC;IAEQ,oBAAoB;QAC3B,KAAK,CAAC,oBAAoB,EAAE,CAAC;QAC5B,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAe,CAAC,mBAAmB,CAC3D,OAAO,EACP,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAC7B,CAAC;IACJ,CAAC;IAED,MAAM;QACJ,IAAI,CAAC,KAAK,GAAG,EAAE,OAAO,EAAE,EAAE,EAAiB,CAAC;QAC5C,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,SAAS,CAAC;QAClC,IAAI,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAC;YAC3B,IAAI,CAAC,EAAE,CAAC,iBAAiB,CAAe,CAAC,KAAK,GAAG,EAAE,CAAC;QACvD,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC3B,CAAC;IAED,KAAK,CAAC,UAAU;QACb,IAAI,CAAC,EAAE,CAAC,oBAAoB,CAAY,CAAC,QAAQ,GAAG,IAAI,CAAC;QAC1D,IAAI,CAAC,KAAM,CAAC,OAAO,GAAG,IAAI,CAAC,eAAe,CAAC;QAC3C,IAAI,IAAI,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,KAAK,EAAE,CAAC;QACjC,IAAI,GAAG,CAAC;QACR,IAAI,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,IAAI,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YACtE,IAAI,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;gBACpC,IAAI,GAAG,EAAE,GAAG,IAAI,EAAE,GAAG,EAAE,OAAO,EAAE,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC;gBAChD,GAAG,GAAG,cAAc,GAAG,IAAI,CAAC,WAAW,GAAG,kBAAkB,CAAC;YAC/D,CAAC;iBAAM,IAAI,IAAI,CAAC,OAAO,EAAE,CAAC;gBACxB,IAAI,GAAG,EAAE,GAAG,IAAI,EAAE,GAAG,EAAE,QAAQ,EAAE,IAAI,CAAC,OAAO,EAAE,EAAE,CAAC;gBAClD,GAAG,GAAG,cAAc,GAAG,IAAI,CAAC,OAAO,GAAG,aAAa,CAAC;YACtD,CAAC;iBAAM,IAAI,IAAI,CAAC,WAAW,EAAE,CAAC;gBAC5B,IAAI,GAAG,EAAE,GAAG,IAAI,EAAE,GAAG,EAAE,YAAY,EAAE,IAAI,CAAC,WAAW,EAAE,EAAE,CAAC;gBAC1D,GAAG,GAAG,mBAAmB,GAAG,IAAI,CAAC,WAAW,GAAG,aAAa,CAAC;YAC/D,CAAC;iBAAM,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;gBACzB,GAAG,GAAG,eAAe,GAAG,IAAI,CAAC,QAAQ,GAAG,aAAa,CAAC;gBACtD,IAAI,GAAG,EAAE,GAAG,IAAI,EAAE,GAAG,EAAE,SAAS,EAAE,IAAI,CAAC,QAAQ,EAAE,EAAE,CAAC;YACtD,CAAC;iBAAM,CAAC;gBACN,OAAO,CAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC;YACvC,CAAC;YACD,IAAI,GAAG,EAAE,CAAC;gBACR,MAAM,MAAM,CAAC,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;gBAChD,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBACrB,IAAI,CAAC,MAAM,EAAE,CAAC;YAChB,CAAC;QACH,CAAC;aAAM,CAAC;YACN,IAAI,CAAC,iBAAiB,EAAE,CAAC;YACzB,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC,CAAC,sBAAsB,CAAC,CAAC,CAAC;QACxD,CAAC;IACH,CAAC;IAED,iBAAiB;QACf,IAAI,IAAI,CAAC,EAAE,CAAC,oBAAoB,CAAC;YAC9B,IAAI,CAAC,EAAE,CAAC,oBAAoB,CAAY,CAAC,QAAQ,GAAG,KAAK,CAAC;IAC/D,CAAC;IAED,QAAQ,CAAC,KAAoB;QAC3B,IAAI,KAAK,CAAC,IAAI,IAAI,OAAO,IAAI,KAAK,CAAC,IAAI,IAAI,OAAO,EAAE,CAAC;YACnD,IAAI,CAAC,YAAY,EAAE,CAAC;QACtB,CAAC;IACH,CAAC;IAED,WAAW;QACT,IAAI,CAAC,KAAM,CAAC,UAAU,GAAG,SAAS,CAAC;QACnC,IAAI,CAAC,aAAa,EAAE,CAAC;IACvB,CAAC;IAED,KAAK,CAAC,YAAY;QAChB,IAAI,IAAI,CAAC,KAAK,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,CAAC;YACzC,MAAM,QAAQ,GACZ,6EAA6E,CAAC;YAChF,MAAM,SAAS,GACb,sjCAAsjC,CAAC;YACzjC,wDAAwD;YACxD,MAAM,KAAK,GAAG,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;YACnD,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;gBAC9B,8CAA8C;gBAC9C,MAAM,eAAe,GAAG,CAAC,MAAM,MAAM,CAAC,SAAS,CAAC,eAAe,CAC7D,OAAO,KAAK,CAAC,CAAC,CAAC,EAAE,CAClB,CAAuB,CAAC;gBACzB,IAAI,eAAe,IAAI,eAAe,CAAC,MAAM,GAAG,CAAC,IAAI,eAAe,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,eAAe,CAAC,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC;oBACxG,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,eAAe,CAAC,CAAC,CAAC,CAAC;oBAC3C,IAAI,CAAC,aAAa,EAAE,CAAC;gBACvB,CAAC;YACH,CAAC;QACH,CAAC;IACH,CAAC;CACF,CAAA;AA9QC;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;+DACH;AAGzB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;8DACJ;AAGxB;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;mDACD;AAG1B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;sDACE;AAG7B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;mDACI;AAG/B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;oDACA;AAG3B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;yDACK;AAGhC;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;qDACC;AAG5B;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;yDACK;AAGhC;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;sDACE;AA7BlB,oBAAoB;IADhC,aAAa,CAAC,0BAA0B,CAAC;GAC7B,oBAAoB,CAgRhC","sourcesContent":["import { html, css, nothing } from \"lit\";\nimport { property, customElement } from \"lit/decorators.js\";\n\nimport { YpBaseElement } from \"../common/yp-base-element.js\";\n\nimport \"@material/web/textfield/outlined-text-field.js\";\n\nimport \"@material/web/button/text-button.js\";\n\nimport \"../yp-user/yp-user-image.js\";\n\nimport \"./yp-point-news-story-embed.js\";\n\nimport { YpBaseElementWithLogin } from \"../common/yp-base-element-with-login.js\";\nimport { TextField } from \"@material/web/textfield/internal/text-field.js\";\nimport { Button } from \"@material/web/button/internal/button.js\";\n\n@customElement(\"yp-point-news-story-edit\")\nexport class YpPointNewsStoryEdit extends YpBaseElementWithLogin {\n  @property({ type: Boolean })\n  loadingUrlPreview = true;\n\n  @property({ type: Boolean })\n  loadingPostStory = true;\n\n  @property({ type: String })\n  label: string | undefined;\n\n  @property({ type: String })\n  addLabel: string | undefined;\n\n  @property({ type: Object })\n  point: YpPointData | undefined;\n\n  @property({ type: Number })\n  postId: number | undefined;\n\n  @property({ type: Number })\n  postGroupId: number | undefined;\n\n  @property({ type: Number })\n  groupId: number | undefined;\n\n  @property({ type: Number })\n  communityId: number | undefined;\n\n  @property({ type: Number })\n  domainId: number | undefined;\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          padding-top: 16px;\n        }\n\n\n\n        md-outlined-text-field {\n          width: 460px;\n          margin-top: -8px;\n        }\n\n        md-text-button {\n          margin-top: 16px;\n        }\n\n        .embedData {\n          padding-top: 24px;\n        }\n\n        #storySubmitButton {\n          margin-top: 16px;\n        }\n\n        .userImage {\n          padding-bottom: 16px;\n          padding-right: 16px;\n        }\n\n        .userImage[rtl] {\n          padding-left: 16px;\n          padding-right: 4px;\n        }\n\n        md-icon-button {\n          margin-top: 16px;\n          padding-bottom: 0;\n        }\n\n        md-icon-button::shadow #icon {\n          width: 36px;\n          height: 36px;\n        }\n\n        .container {\n          margin-bottom: 32px;\n        }\n\n        @media (max-width: 420px) {\n          md-outlined-text-field {\n            width: 270px;\n          }\n\n          .embedData {\n            max-width: 270px;\n            margin-left: 24px;\n          }\n\n          :host {\n            margin-top: 16px;\n          }\n        }\n\n        @media (max-width: 320px) {\n          md-outlined-text-field {\n            width: 220px;\n          }\n\n          .embedData {\n            max-width: 220px;\n          }\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return this.point\n      ? html`\n          <div class=\"layout vertical container\">\n            <div class=\"layout horizontal\">\n              <yp-user-image\n                class=\"userImage\"\n                .user=\"${this.loggedInUser}\"\n                ?rtl=\"${this.rtl}\"\n              ></yp-user-image>\n              <div class=\"layout vertical\">\n                <md-outlined-text-field\n                  type=\"textarea\"\n                  id=\"pointNewsStory\"\n                  minlength=\"15\"\n                  name=\"pointNewsStory\"\n                  .value=\"${this.point.content}\"\n                  .label=\"${this.label || this.t(\"point.addNewsStory\")}\"\n                  charCounter\n                  rows=\"4\"\n                  maxrows=\"7\"\n                  @keydown=\"${this._keyDown}\"\n                  maxlength=\"500\"\n                >\n                </md-outlined-text-field>\n                <div class=\"layout horizontal center-center\">\n                  <md-filled-button\n                    id=\"storySubmitButton\"\n                    @click=\"${this._sendStory}\"\n                    >${this.addLabel ||\n                    this.t(\"point.postNewsStory\")}</md-filled-button\n                  >\n                </div>\n              </div>\n            </div>\n\n            <div class=\"layout horizontal center-center\">\n              ${this.point.embed_data\n                ? html`\n                    <div class=\"embedData layout vertical center-center\">\n                      <yp-point-news-story-embed\n                        .embedData=\"${this.point.embed_data}\"\n                      ></yp-point-news-story-embed>\n                      <md-icon-button\n                        .label=\"${this.t(\"clearEmbededMedia\")}\"\n                        icon=\"clear\"\n                        @click=\"${this._clearEmbed}\"\n                      ></md-icon-button>\n                    </div>\n                  `\n                : html``}\n            </div>\n          </div>\n        `\n      : nothing;\n  }\n\n  _clearButtonStat() {\n    (this.$$(\"#storySubmitButton\") as Button).disabled = false;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._reset();\n  }\n\n  override firstUpdated(props: Map<string | number | symbol, unknown>) {\n    super.firstUpdated(props);\n    (this.$$(\"#pointNewsStory\") as TextField).addEventListener(\n      \"paste\",\n      this._checkForUrl.bind(this)\n    );\n  }\n\n  get newPointContent() {\n    return (this.$$(\"#pointNewsStory\") as TextField).value;\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    (this.$$(\"#pointNewsStory\") as TextField).removeEventListener(\n      \"paste\",\n      this._checkForUrl.bind(this)\n    );\n  }\n\n  _reset() {\n    this.point = { content: \"\" } as YpPointData;\n    this.point.embed_data = undefined;\n    if (this.$$(\"#pointNewsStory\"))\n      (this.$$(\"#pointNewsStory\") as TextField).value = \"\";\n    this._clearButtonState();\n  }\n\n  async _sendStory() {\n    (this.$$(\"#storySubmitButton\") as Button).disabled = true;\n    this.point!.content = this.newPointContent;\n    let body = { point: this.point };\n    let url;\n    if (this.point && this.point.content && this.point.content.length > 2) {\n      if (this.postId && this.postGroupId) {\n        body = { ...body, ...{ post_id: this.postId } };\n        url = \"/api/groups/\" + this.postGroupId + \"/post/news_story\";\n      } else if (this.groupId) {\n        body = { ...body, ...{ group_id: this.groupId } };\n        url = \"/api/groups/\" + this.groupId + \"/news_story\";\n      } else if (this.communityId) {\n        body = { ...body, ...{ community_id: this.communityId } };\n        url = \"/api/communities/\" + this.communityId + \"/news_story\";\n      } else if (this.domainId) {\n        url = \"/api/domains/\" + this.domainId + \"/news_story\";\n        body = { ...body, ...{ domain_id: this.domainId } };\n      } else {\n        console.error(\"Can't find send ids\");\n      }\n      if (url) {\n        await window.serverApi.postNewsStory(url, body);\n        this.fire(\"refresh\");\n        this._reset();\n      }\n    } else {\n      this._clearButtonState();\n      this.fire(\"yp-error\", this.t(\"point.commentToShort\"));\n    }\n  }\n\n  _clearButtonState() {\n    if (this.$$(\"#storySubmitButton\"))\n      (this.$$(\"#storySubmitButton\") as Button).disabled = false;\n  }\n\n  _keyDown(event: KeyboardEvent) {\n    if (event.code == \"Space\" || event.code == \"enter\") {\n      this._checkForUrl();\n    }\n  }\n\n  _clearEmbed() {\n    this.point!.embed_data = undefined;\n    this.requestUpdate();\n  }\n\n  async _checkForUrl() {\n    if (this.point && !this.point.embed_data) {\n      const urlRegex =\n        /(\\b(https?|ftp|file):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gi;\n      const urlRegex2 =\n        /((?:(http|https|Http|Https|rtsp|Rtsp):\\/\\/(?:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,64}(?:\\:(?:[a-zA-Z0-9\\$\\-\\_\\.\\+\\!\\*\\'\\(\\)\\,\\;\\?\\&\\=]|(?:\\%[a-fA-F0-9]{2})){1,25})?\\@)?)?((?:(?:[a-zA-Z0-9][a-zA-Z0-9\\-]{0,64}\\.)+(?:(?:aero|arpa|asia|a[cdefgilmnoqrstuwxz])|(?:biz|b[abdefghijmnorstvwyz])|(?:cat|com|coop|c[acdfghiklmnoruvxyz])|d[ejkmoz]|(?:edu|e[cegrstu])|f[ijkmor]|(?:gov|g[abdefghilmnpqrstuwy])|h[kmnrtu]|(?:info|int|i[delmnoqrst])|(?:jobs|j[emop])|k[eghimnrwyz]|l[abcikrstuvy]|(?:mil|mobi|museum|m[acdghklmnopqrstuvwxyz])|(?:name|net|n[acefgilopruz])|(?:org|om)|(?:pro|p[aefghklmnrstwy])|qa|r[eouw]|s[abcdeghijklmnortuvyz]|(?:tel|travel|t[cdfghjklmnoprtvwz])|u[agkmsyz]|v[aceginu]|w[fs]|y[etu]|z[amw]))|(?:(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9])\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[1-9]|0)\\.(?:25[0-5]|2[0-4][0-9]|[0-1][0-9]{2}|[1-9][0-9]|[0-9])))(?:\\:\\d{1,5})?)(\\/(?:(?:[a-zA-Z0-9\\;\\/\\?\\:\\@\\&\\=\\#\\~\\-\\.\\+\\!\\*\\'\\(\\)\\,\\_])|(?:\\%[a-fA-F0-9]{2}))*)?(?:\\b|$)/gi;\n      //      const urls1 = urlRegex.exec(this.point.content);\n      const urls2 = urlRegex2.exec(this.newPointContent);\n      if (urls2 && urls2.length > 0) {\n        //TODO: Error should do this._clearButtonState\n        const previewResponse = (await window.serverApi.pointUrlPreview(\n          `url=${urls2[0]}`\n        )) as Array<YpEmbedData>;\n        if (previewResponse && previewResponse.length > 0 && previewResponse[0].url && previewResponse[0].title) {\n          this.point.embed_data = previewResponse[0];\n          this.requestUpdate();\n        }\n      }\n    }\n  }\n}\n"]}