{"version":3,"file":"yp-point-comment.js","sourceRoot":"","sources":["../../src/yp-point/yp-point-comment.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, css, nothing } from \"lit\";\nimport { property, customElement } from \"lit/decorators.js\";\n\nimport \"@material/web/iconbutton/icon-button.js\";\nimport \"@material/web/iconbutton/icon-button.js\";\n\nimport \"../yp-user/yp-user-image.js\";\nimport \"../yp-user/yp-user-with-organization.js\";\nimport \"./yp-point-actions.js\";\n\nimport { YpAccessHelpers } from \"../common/YpAccessHelpers.js\";\nimport { YpBaseElementWithLogin } from \"../common/yp-base-element-with-login.js\";\nimport { YpConfirmationDialog } from \"../yp-dialog-container/yp-confirmation-dialog.js\";\nimport { YpApiActionDialog } from \"../yp-api-action-dialog/yp-api-action-dialog.js\";\n\n@customElement(\"yp-point-comment\")\nexport class YpPointComment extends YpBaseElementWithLogin {\n  @property({ type: Object })\n  point: YpPointData | undefined;\n\n  @property({ type: Object })\n  user: YpUserData | undefined;\n\n  @property({ type: Boolean })\n  hideUser = false;\n\n  override updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    super.updated(changedProperties);\n\n    if (changedProperties.has(\"point\")) {\n      this._pointChanged();\n    }\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        .userName {\n        }\n\n        .extraActions {\n          margin-top: 16px;\n        }\n\n        yp-user-image {\n          padding-top: 16px;\n          padding-right: 8px;\n        }\n\n        yp-user-with-organization {\n          margin-left: 8px;\n        }\n\n        .userName {\n          padding-bottom: 4px;\n        }\n\n        .comment {\n          margin-left: 8px;\n          margin-right: 8px;\n          padding-bottom: 4px;\n          margin-bottom: 16px;\n          padding-top: 16px;\n          max-width: 80%;\n        }\n\n        .commentDash {\n          border-bottom: dashed;\n          border-bottom-width: 1px;\n        }\n\n        yp-point-actions {\n          padding-top: 8px;\n        }\n\n        #reportPointIconButton {\n          width: 36px;\n          height: 36px;\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n\n        #deleteButton {\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return this.point\n      ? html`\n          <div class=\"layout ${this.wide ? \"vertical\" : \"vertical\"}\">\n             <yp-user-with-organization\n                .user=\"${this.user}\"\n              ></yp-user-with-organization>\n            <div class=\"layout vertical\">\n              <div class=\"comment\">\n                ${this.point.content}\n                <div class=\"layout horizontal\">\n                  <yp-point-actions\n                    .point=\"${this.point}\"\n                    hideSharing\n                  ></yp-point-actions>\n                  <div class=\"extraActions layout horizontal\">\n                    <md-icon-button\n                      ?hisdden=\"\"\n                      ?hidsddden=\"${!this.loggedInUser}\"\n                      hidden\n                      .label=\"${this.t(\"point.report\")}\"\n                      id=\"reportPointIconButton\"\n                      @click=\"${this._reportPoint}\"\n                      ><md-icon>warning</md-icon></md-icon-button\n                    >\n\n                    ${this.hasPointAccess\n                      ? html`\n                          <div class=\"layout horizontal self-end\">\n                            <md-icon-button\n                              id=\"deleteButton\"\n                              .label=\"${this.t(\"delete\")}\"\n                              @click=\"${this._deletePoint}\"\n                              ><md-icon>clear</md-icon></md-icon-button\n                            >\n                          </div>\n                        `\n                      : html``}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        `\n      : nothing;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this.addGlobalListener(\"yp-logged-in\", this.requestUpdate.bind(this));\n    this.addGlobalListener(\n      \"yp-got-admin-rights\",\n      this.requestUpdate.bind(this)\n    );\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    this.removeGlobalListener(\"yp-logged-in\", this.requestUpdate.bind(this));\n    this.removeGlobalListener(\n      \"yp-got-admin-rights\",\n      this.requestUpdate.bind(this)\n    );\n  }\n\n  _deletePoint() {\n    window.appDialogs.getDialogAsync(\n      \"confirmationDialog\",\n      (dialog: YpConfirmationDialog) => {\n        dialog.open(\n          this.t(\"point.confirmDelete\"),\n          this._reallyDeletePoint.bind(this)\n        );\n      }\n    );\n  }\n\n  async _reallyDeletePoint() {\n    if (this.point) {\n      await window.serverApi.deletePoint(this.point.id);\n      this.fire(\"yp-point-deleted\", { pointId: this.point!.id });\n      this.fire(\"iron-resize\");\n      this.point = undefined;\n    }\n  }\n\n  _reportPoint() {\n    window.appGlobals.activity(\"open\", \"point.report\");\n    window.appDialogs.getDialogAsync(\n      \"apiActionDialog\",\n      (dialog: YpApiActionDialog) => {\n        dialog.setup(\n          \"/api/points/\" + this.point!.id + \"/report\",\n          this.t(\"reportConfirmation\"),\n          this._onReport.bind(this),\n          this.t(\"point.report\"),\n          \"PUT\"\n        );\n        dialog.open();\n      }\n    );\n  }\n\n  _onReport() {\n    window.appGlobals.notifyUserViaToast(\n      this.t(\"point.report\") + \": \" + this.point!.content\n    );\n  }\n\n  _pointChanged() {\n    if (this.point) {\n      this.user = this.point.PointRevisions![0].User;\n    } else {\n      this.user = undefined;\n    }\n  }\n\n  get hasPointAccess() {\n    return this.point && YpAccessHelpers.checkPointAccess(this.point);\n  }\n\n  loginName() {\n    return this.point && this.point.PointRevisions![0].User.name;\n  }\n}\n"]}