{"version":3,"file":"yp-point-comment-edit.js","sourceRoot":"","sources":["../../src/yp-point/yp-point-comment-edit.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, css, nothing } from \"lit\";\nimport { property, customElement } from \"lit/decorators.js\";\n\nimport \"@material/web/textfield/outlined-text-field.js\";\nimport \"@material/web/button/filled-button.js\";\n\nimport \"../common/yp-image.js\";\nimport \"../yp-user/yp-user-info.js\";\n\nimport { YpBaseElementWithLogin } from \"../common/yp-base-element-with-login.js\";\nimport { Button } from \"@material/web/button/internal/button.js\";\nimport { TextField } from \"@material/web/textfield/internal/text-field.js\";\n\n@customElement(\"yp-point-comment-edit\")\nexport class YpPointCommentEdit extends YpBaseElementWithLogin {\n  @property({ type: Object })\n  comment: YpPointData | undefined;\n\n  @property({ type: Object })\n  point: YpPointData | undefined;\n\n  @property({ type: Object })\n  image: YpImageData | undefined;\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          width: 100%;\n          margin-top: 6px;\n          margin-bottom: 64px;\n        }\n\n        md-outlined-text-field {\n          width: 100%;\n        }\n\n        md-filled-button {\n          margin-top: 16px;\n          margin-bottom: 16px;\n        }\n\n        .userImage {\n          padding-left: 16px;\n          padding-right: 16px;\n          margin-bottom: 8px;\n        }\n\n        @media (max-width: 840px) {\n          :host {\n            width: 100%;\n          }\n\n          md-outlined-text-field {\n            width: 90%;\n          }\n\n          .userImage {\n            padding-top: 8px;\n            padding-right: 16px;\n            padding-left: 0;\n          }\n        }\n\n        [hidden] {\n          display: none !important;\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return this.comment\n      ? html`\n          <div\n            class=\"layout vertical center-center\"\n            ?hidden=\"${!this.loggedInUser}\"\n          >\n            <yp-user-image\n              hidden\n              class=\"userImage\"\n              .user=\"${this.loggedInUser}\"\n            ></yp-user-image>\n            <md-outlined-text-field\n                type=\"textarea\"\n                id=\"pointComment\"\n                minlength=\"15\"\n                name=\"pointComment\"\n                .value=\"${this.comment.content}\"\n                always-float-label=\"${this.comment.content}\"\n                .label=\"${this.t(\"point.addComment\")}\"\n                charCounter\n                rows=\"4\"\n                maxrows=\"7\"\n                @keydown=\"${this._keyDown}\"\n                maxlength=\"500\"\n                aria-label=\"${this.t(\"point.addComment\")}\"\n              >\n              </md-outlined-text-field>\n              <div class=\"layout horizontal\">\n                <md-filled-button\n                  id=\"submitButton\"\n                  raised\n                  @click=\"${this._sendComment}\"\n                  .label=\"${this.t(\"point.postComment\")}\"\n                  >${this.t(\"point.postComment\")}</md-filled-button\n                >\n              </div>\n          </div>\n        `\n      : nothing;\n  }\n\n  override updated(\n    changedProperties: Map<string | number | symbol, unknown>\n  ): void {\n    super.updated(changedProperties);\n\n    //TODO: See what this is about and fix the iron-resize if needed\n    if (changedProperties.has(\"comment\") && this.comment) {\n      if (this.comment.value && this.comment.value % 7 === 2) {\n        this.fire(\"iron-resize\");\n      }\n    }\n  }\n\n  get newPointComment() {\n    return (this.$$(\"#pointComment\") as TextField).value;\n  }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._reset();\n  }\n\n  _responseError() {\n    (this.$$(\"#submitButton\") as Button).disabled = false;\n  }\n\n  _reset() {\n    this.comment = { content: \"\" } as YpPointData;\n    if (this.$$(\"#submitButton\"))\n      (this.$$(\"#submitButton\") as Button).disabled = false;\n    if (this.$$(\"#pointComment\"))\n      (this.$$(\"#pointComment\") as TextField).value = \"\";\n  }\n\n  async _sendComment() {\n    this.comment!.content = this.newPointComment;\n    if (\n      this.comment &&\n      this.comment.content &&\n      this.comment.content.length > 0\n    ) {\n      if (this.point) {\n        await window.serverApi.postComment(\"points\", this.point.id, {\n          point_id: this.point.id,\n          comment: this.comment,\n        });\n        (this.$$(\"#submitButton\") as Button).disabled = false;\n      } else if (this.image) {\n        await window.serverApi.postComment(\"images\", this.image.id, {\n          image_id: this.image.id,\n          comment: this.comment,\n        });\n        (this.$$(\"#submitButton\") as Button).disabled = false;\n      } else {\n        console.error(\"Can't find send ids\");\n      }\n    } else {\n      //TODO: Make sure this works\n      this.fire(\"yp-error\", this.t(\"point.commentToShort\"));\n    }\n    this.fire(\"refresh\");\n    this._reset();\n  }\n\n  _keyDown(event: KeyboardEvent) {\n    if (event.code == \"enter\") {\n      this._sendComment();\n    }\n  }\n}\n"]}