{"version":3,"file":"yp-community.js","sourceRoot":"","sources":["../../src/yp-collection/yp-community.ts"],"names":[],"mappings":"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","sourcesContent":["import { YpAccessHelpers } from \"../common/YpAccessHelpers.js\";\nimport { YpMediaHelpers } from \"../common/YpMediaHelpers.js\";\n\nimport { YpCollection, CollectionTabTypes } from \"./yp-collection.js\";\nimport { YpCollectionItemsGrid } from \"./yp-collection-items-grid.js\";\nimport { customElement } from \"lit/decorators.js\";\nimport { AcActivities } from \"../ac-activities/ac-activities.js\";\nimport { YpNavHelpers } from \"../common/YpNavHelpers.js\";\n\n@customElement(\"yp-community\")\nexport class YpCommunity extends YpCollection {\n  constructor() {\n    super(\"community\", \"group\", \"edit\", \"group.new\");\n  }\n\n  override refresh() {\n    if (!this.collection) return;\n\n    super.refresh();\n    const isAdmin = YpAccessHelpers.checkCommunityAccess(\n      this.collection as YpCommunityData\n    );\n    const community = this.collection as YpCommunityData;\n    if (\n      this.collection &&\n      this.collection.configuration &&\n      (this.collection.configuration as YpCommunityConfiguration)\n        .redirectToGroupId &&\n      !isAdmin\n    ) {\n      YpNavHelpers.redirectTo(\n        \"/group/\" +\n          (this.collection.configuration as YpCommunityConfiguration)\n            .redirectToGroupId\n      );\n    } else if (community) {\n      this.collectionItems = community.Groups;\n      this.setFabIconIfAccess(\n        community.only_admins_can_create_groups,\n        YpAccessHelpers.checkCommunityAccess(community)\n      );\n      if (\n        community.CommunityHeaderImages &&\n        community.CommunityHeaderImages.length > 0\n      ) {\n        this.headerImageUrl = YpMediaHelpers.getImageFormatUrl(\n          community.CommunityHeaderImages as Array<YpImageData>,\n          0);\n      }\n\n      if (\n        !community.configuration.theme &&\n        community.Domain?.configuration.theme\n      ) {\n        window.appGlobals.theme.setTheme(community.Domain.theme_id, community.Domain.configuration);\n      } else if (community.configuration.theme) {\n        window.appGlobals.theme.setTheme(community.theme_id, community.configuration);\n      }\n\n      window.appGlobals.analytics.setCommunityAnalyticsTracker(\n        community.google_analytics_code\n      );\n      window.appGlobals.analytics.setCommunityPixelTracker(\n        community.configuration.facebookPixelId\n      );\n\n      if (this.collectionItems && this.collectionItems.length > 0) {\n        window.appGlobals.setAnonymousGroupStatus(\n          this.collectionItems[0] as YpGroupData\n        );\n        window.appGlobals.setRegistrationQuestionGroup(\n          this.collectionItems[0] as YpGroupData\n        );\n      }\n\n      this._hideMapIfNotUsedByGroups();\n      this._openHelpPageIfNeededOnce();\n\n      this._setupCommunityBackPath(community);\n      this._setupCommunitySaml(community);\n\n      if (\n        community.configuration.signupTermsPageId &&\n        community.configuration.signupTermsPageId != -1\n      ) {\n        window.appGlobals.signupTermsPageId =\n          community.configuration.signupTermsPageId;\n      } else {\n        window.appGlobals.signupTermsPageId = undefined;\n      }\n\n      if (\n        community.configuration &&\n        community.configuration.highlightedLanguages\n      ) {\n        window.appGlobals.setHighlightedLanguages(\n          community.configuration.highlightedLanguages\n        );\n      } else {\n        window.appGlobals.setHighlightedLanguages(undefined);\n      }\n    }\n\n    window.appGlobals.disableFacebookLoginForGroup = false;\n    window.appGlobals.externalGoalTriggerGroupId = undefined;\n    window.appGlobals.currentGroup = undefined;\n  }\n\n  _setupCommunitySaml(community: YpCommunityData) {\n    if (\n      community.configuration &&\n      community.configuration.forceSecureSamlLogin &&\n      !YpAccessHelpers.checkCommunityAccess(community)\n    ) {\n      window.appGlobals.currentForceSaml = true;\n    } else {\n      window.appGlobals.currentForceSaml = false;\n    }\n\n    if (\n      community.configuration &&\n      community.configuration.customSamlDeniedMessage\n    ) {\n      window.appGlobals.currentSamlDeniedMessage =\n        community.configuration.customSamlDeniedMessage;\n    } else {\n      window.appGlobals.currentSamlDeniedMessage = undefined;\n    }\n\n    if (\n      community.configuration &&\n      community.configuration.customSamlLoginMessage\n    ) {\n      window.appGlobals.currentSamlLoginMessage =\n        community.configuration.customSamlLoginMessage;\n    } else {\n      window.appGlobals.currentSamlLoginMessage = undefined;\n    }\n  }\n\n  scrollToGroupItem() {\n    if (\n      this.selectedTab === CollectionTabTypes.News &&\n      window.appGlobals.cache.cachedActivityItem\n    ) {\n      const list = this.$$(\"#collectionActivities\") as AcActivities;\n      if (list) {\n        list.scrollToItem(window.appGlobals.cache.cachedActivityItem);\n        window.appGlobals.cache.cachedActivityItem = undefined;\n      } else {\n        console.warn(\"No community activities for scroll to item\");\n      }\n    } else if (\n      this.selectedTab === CollectionTabTypes.Collection &&\n      this.collection\n    ) {\n      if (\n        window.appGlobals.cache.backToCommunityGroupItems &&\n        window.appGlobals.cache.backToCommunityGroupItems[this.collection.id]\n      ) {\n        (this.$$(\"#collectionItems\") as YpCollectionItemsGrid).scrollToItem(\n          window.appGlobals.cache.backToCommunityGroupItems[this.collection.id]\n        );\n        window.appGlobals.cache.backToCommunityGroupItems[this.collection.id] =\n          undefined;\n      }\n    }\n  }\n\n  _setupCommunityBackPath(community: YpCommunityData) {\n    if (community && window.location.href.indexOf(\"/community\") > -1) {\n      let backPath, headerTitle, headerDescription;\n      if (community.CommunityFolder) {\n        backPath = \"/community_folder/\" + community.CommunityFolder.id;\n        headerTitle = community.CommunityFolder.name;\n        headerDescription = community.CommunityFolder.description;\n      } else {\n        backPath = \"/domain/\" + community.domain_id;\n        if (community.Domain) {\n          headerTitle = community.Domain.name;\n          headerDescription = community.Domain.description;\n        }\n      }\n      this.fire(\"yp-change-header\", {\n        headerTitle:\n          community.configuration && community.configuration.customBackName\n            ? community.configuration.customBackName\n            : headerTitle,\n        headerDescription: headerDescription,\n        headerIcon: \"group-work\",\n        useHardBack: this._useHardBack(community.configuration),\n        disableCollectionUpLink:\n          community.configuration &&\n          community.configuration.disableCollectionUpLink === true,\n        documentTitle: community.name,\n        backPath:\n          community.configuration && community.configuration.customBackURL\n            ? community.configuration.customBackURL\n            : backPath,\n      });\n    }\n  }\n\n  scrollToCollectionItemSubClass() {\n    if (\n      this.collection &&\n      window.appGlobals.cache.backToCommunityGroupItems &&\n      window.appGlobals.cache.backToCommunityGroupItems[this.collection.id]\n    ) {\n      (this.$$(\"#collectionItems\") as YpCollectionItemsGrid).scrollToItem(\n        window.appGlobals.cache.backToCommunityGroupItems[this.collection.id]\n      );\n      window.appGlobals.cache.backToCommunityGroupItems[this.collection.id] =\n        undefined;\n    }\n  }\n\n  _openHelpPageIfNeededOnce() {\n    if (\n      this.collection &&\n      !sessionStorage.getItem(\"yp-welcome-for-community-\" + this.collection.id)\n    ) {\n      setTimeout(() => {\n        if (\n          this.collection &&\n          this.collection.configuration &&\n          this.collection.configuration.welcomePageId\n        ) {\n          this.fire(\"yp-open-page\", {\n            pageId: this.collection.configuration.welcomePageId,\n          });\n          sessionStorage.setItem(\n            \"yp-welcome-for-community-\" + this.collection.id,\n            \"true\"\n          );\n        }\n      }, 1200);\n    }\n  }\n\n  _hideMapIfNotUsedByGroups() {\n    let locationHidden = true;\n    this.collectionItems?.forEach((group) => {\n      if (group.configuration && group.configuration.locationHidden) {\n        if (group.configuration.locationHidden != true) {\n          locationHidden = false;\n        }\n      } else {\n        locationHidden = false;\n      }\n    });\n    this.locationHidden = locationHidden;\n  }\n}\n"]}