{"version":3,"file":"yp-domain.js","sourceRoot":"","sources":["../../src/yp-collection/yp-domain.ts"],"names":[],"mappings":"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","sourcesContent":["import { YpAccessHelpers } from \"../common/YpAccessHelpers.js\";\nimport { YpMediaHelpers } from \"../common/YpMediaHelpers.js\";\n\nimport { YpCollection, CollectionTabTypes } from \"./yp-collection.js\";\nimport { YpCollectionItemsList } from \"./yp-collection-items-list.js\";\nimport { customElement, property } from \"lit/decorators.js\";\nimport { AcActivities } from \"../ac-activities/ac-activities.js\";\nimport { unsafeHTML } from \"lit/directives/unsafe-html.js\";\nimport { css, html, nothing } from \"lit\";\nimport { YpNavHelpers } from \"../common/YpNavHelpers.js\";\nimport { YpFormattingHelpers } from \"../common/YpFormattingHelpers.js\";\n\nimport \"./yp-domain-header.js\";\nimport { Dialog } from \"@material/web/dialog/internal/dialog.js\";\n\n@customElement(\"yp-domain\")\nexport class YpDomain extends YpCollection {\n  @property({ type: String })\n  customWelcomeHtml: string | undefined = undefined;\n\n  @property({ type: Boolean })\n  override useEvenOddItemLayout = true;\n\n  constructor() {\n    super(\"domain\", \"community\", \"edit\", \"community.add\");\n  }\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        yp-domain-header {\n          width: 100%;\n        }\n\n        .outerContainer {\n          width: 1080px;\n          max-width: 1080px;\n          background-color: var(--md-sys-color-surface);\n        }\n\n        .loginSurface {\n          max-width: 410px;\n          background-color: var(--md-sys-color-surface);\n          padding: 32px;\n          border-radius: 4px;\n          padding-bottom: 640px;\n        }\n\n        @media (max-width: 420px) {\n          .outerContainer {\n            width: 100%;\n            max-width: 100%;\n          }\n\n          .loginSurface {\n            width: 100%;\n            max-width: 100%;\n          }\n\n          .loginSurface {\n            padding: 16px;\n          }\n        }\n      `,\n    ];\n  }\n\n  override async refresh() {\n    super.refresh();\n\n    const domain = this.collection as YpDomainData;\n\n    if (domain) {\n      window.appGlobals.domain = domain;\n      window.appGlobals.analytics.setupGoogleAnalytics(domain);\n      this.collectionItems = domain.Communities;\n      this.setFabIconIfAccess(\n        domain.only_admins_can_create_communities,\n        YpAccessHelpers.checkDomainAccess(domain)\n      );\n\n      if (domain.DomainHeaderImages && domain.DomainHeaderImages.length > 0) {\n        this.headerImageUrl = YpMediaHelpers.getImageFormatUrl(\n          domain.DomainHeaderImages as Array<YpImageData>,\n          0\n        );\n      }\n\n      window.appGlobals.theme.setTheme(domain.theme_id, domain.configuration);\n\n      window.appGlobals.setCurrentDomain(domain);\n    }\n\n    if (domain && domain.configuration && domain.configuration.hideAllTabs) {\n      this.tabsHidden = true;\n    }\n\n    window.appGlobals.setAnonymousGroupStatus(undefined);\n    window.appGlobals.setRegistrationQuestionGroup(undefined);\n    window.appGlobals.disableFacebookLoginForGroup = false;\n    window.appGlobals.externalGoalTriggerGroupId = undefined;\n    window.appGlobals.currentForceSaml = false;\n    window.appGlobals.currentSamlDeniedMessage = undefined;\n    window.appGlobals.currentSamlLoginMessage = undefined;\n    window.appGlobals.currentGroup = undefined;\n    window.appGlobals.signupTermsPageId = undefined;\n    window.appGlobals.setHighlightedLanguages(undefined);\n\n    setTimeout(async () => {\n      if (domain && domain.configuration) {\n        if (domain.configuration.welcomeHtmlInsteadOfCommunitiesList) {\n          let finalHtml =\n            domain.configuration.welcomeHtmlInsteadOfCommunitiesList;\n          const aoiStatsHtmlTag = \"<AOI_SITE_STATS>\";\n          if (\n            domain.configuration.welcomeHtmlInsteadOfCommunitiesList.includes(\n              aoiStatsHtmlTag\n            )\n          ) {\n            const stats = (await window.serverApi.getAoiTotalStats(\n              domain.id\n            )) as AoiSiteStats;\n            if (stats) {\n              const statsString = `<div class=\"layout horizontal center-center aoiSiteStats wrap\">\n              <span class=\"aoiSiteStatItem\">${YpFormattingHelpers.number(\n                stats.total_questions\n              )}</span> <span class=\"aoiSiteStatType\">wiki surveys</span> created with <span class=\"aoiSiteStatItem\">${YpFormattingHelpers.number(\n                stats.choices_count\n              )} </span> <span class=\"aoiSiteStatType\">answers</span> and <span class=\"aoiSiteStatItem\">${YpFormattingHelpers.number(\n                stats.votes_count\n              )} </span>  <span class=\"aoiSiteStatType\">votes</span> since 2010\n              </div>`;\n\n              finalHtml = finalHtml.replace(aoiStatsHtmlTag, statsString);\n            }\n          }\n          this.customWelcomeHtml = finalHtml;\n        }\n      }\n    });\n    this.requestUpdate();\n  }\n\n  scrollToCommunityItem() {\n    if (\n      this.selectedTab === CollectionTabTypes.Newsfeed &&\n      window.appGlobals.cache.cachedActivityItem\n    ) {\n      const list = this.$$(\"#collectionActivities\") as AcActivities;\n      if (list) {\n        list.scrollToItem(window.appGlobals.cache.cachedActivityItem);\n        window.appGlobals.cache.cachedActivityItem = undefined;\n      } else {\n        console.warn(\"No domain activities for scroll to item\");\n      }\n    } else if (\n      this.selectedTab === CollectionTabTypes.Collection &&\n      this.collection\n    ) {\n      if (\n        window.appGlobals.cache.backToDomainCommunityItems &&\n        window.appGlobals.cache.backToDomainCommunityItems[this.collection.id]\n      ) {\n        (this.$$(\"#collectionItems\") as YpCollectionItemsList).scrollToItem(\n          window.appGlobals.cache.backToDomainCommunityItems[this.collection.id]\n        );\n        window.appGlobals.cache.backToDomainCommunityItems[this.collection.id] =\n          undefined;\n      }\n    }\n  }\n\n  scrollToCollectionItemSubClass() {\n    if (\n      this.collection &&\n      window.appGlobals.cache.backToDomainCommunityItems &&\n      window.appGlobals.cache.backToDomainCommunityItems[this.collection.id]\n    ) {\n      (this.$$(\"#collectionItems\") as YpCollectionItemsList).scrollToItem(\n        window.appGlobals.cache.backToDomainCommunityItems[this.collection.id]\n      );\n      window.appGlobals.cache.backToDomainCommunityItems[this.collection.id] =\n        undefined;\n    }\n  }\n\n  _forgotPassword() {\n    window.appDialogs.getDialogAsync(\"forgotPassword\", (dialog: Dialog) => {\n      dialog.open = true;\n    });\n  }\n\n  override renderHeader() {\n    return this.collection && !this.noHeader\n      ? html`\n          <div class=\"layout vertical center-center header\">\n            <yp-domain-header\n              .collection=\"${this.collection}\"\n              .collectionType=\"${this.collectionType}\"\n              aria-label=\"${this.collectionType}\"\n              role=\"banner\"\n            ></yp-domain-header>\n          </div>\n        `\n      : nothing;\n  }\n\n  renderDomainLogin() {\n    return html`\n      <div class=\"layout vertical center-center\">\n        <div class=\"layout vertical center-center outerContainer\">\n          <yp-login\n            id=\"userLogin\"\n            class=\"loginSurface\"\n            fullWithLoginButton\n            @yp-forgot-password=\"${this._forgotPassword}\"\n          ></yp-login>\n        </div>\n      </div>\n    `;\n  }\n\n  override render() {\n    if (\n      this.collection &&\n      !this.loggedInUser &&\n      (this.collection.configuration as YpDomainConfiguration)\n        .useLoginOnDomainIfNotLoggedIn\n    ) {\n      return this.renderDomainLogin();\n    } else if (\n      this.collection &&\n      !this.loggedInUser &&\n      (this.collection.configuration as YpDomainConfiguration)\n        .welcomeHtmlInsteadOfCommunitiesList\n    ) {\n      if (this.customWelcomeHtml) {\n        return html`\n          <yp-magic-text\n            id=\"domainWelcomeHtml\"\n            .contentId=\"${this.collection.id}\"\n            unsafeHtml\n            .content=\"${this.customWelcomeHtml}\"\n            .contentLanguage=\"${this.collection.language}\"\n            textType=\"domainWelcomeHtml\"\n          ></yp-magic-text>\n\n          <div\n            class=\"layout vertical center-center\"\n            ?hidden=\"${!YpAccessHelpers.checkDomainAccess(\n              this.collection as YpDomainData\n            )}\"\n          >\n            <md-icon-button\n              id=\"menuButton\"\n              @click=\"${this._openAdmin}\"\n              title=\"${this.t(\"domain.edit\")}\"\n              ><md-icon>settings</md-icon>\n            </md-icon-button>\n          </div>\n        `;\n      } else {\n        return html``;\n      }\n    } else {\n      return super.render();\n    }\n  }\n}\n"]}