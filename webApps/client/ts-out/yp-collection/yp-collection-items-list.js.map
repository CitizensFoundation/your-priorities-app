{"version":3,"file":"yp-collection-items-list.js","sourceRoot":"","sources":["../../src/yp-collection/yp-collection-items-list.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, css, nothing, TemplateResult } from \"lit\";\n\nimport { property, customElement } from \"lit/decorators.js\";\n\nimport { YpBaseElement } from \"../common/yp-base-element.js\";\nimport { ShadowStyles } from \"../common/ShadowStyles.js\";\nimport { YpIronListHelpers } from \"../common/YpIronListHelpers.js\";\nimport { YpCollectionHelpers } from \"../common/YpCollectionHelpers.js\";\nimport { LitVirtualizer } from \"@lit-labs/virtualizer\";\nimport { FlowLayout } from \"@lit-labs/virtualizer/layouts/flow.js\";\nimport { GridLayout } from \"@lit-labs/virtualizer/layouts/grid.js\";\n\nimport { YpCollectionItemCard } from \"./yp-collection-item-card.js\";\nimport { YpServerApi } from \"../common/YpServerApi.js\";\nimport { ifDefined } from \"lit/directives/if-defined.js\";\n\nimport \"./yp-collection-item-card.js\";\n\n@customElement(\"yp-collection-items-list\")\nexport class YpCollectionItemsList extends YpBaseElement {\n  @property({ type: Object })\n  collection: YpCollectionData | undefined;\n\n  @property({ type: Array })\n  collectionItems: Array<YpCollectionData> | undefined;\n\n  @property({ type: String })\n  collectionItemType!: string;\n\n  @property({ type: Array })\n  sortedCollectionItems: Array<YpCollectionData> | undefined;\n\n  @property({ type: Boolean, reflect: true })\n  grid = false;\n\n  @property({ type: Boolean })\n  useEvenOddItemLayout = false;\n\n  resetListSize: Function | undefined;\n  skipIronListWidth = false;\n\n  static override get styles() {\n    return [\n      super.styles,\n      ShadowStyles,\n      css`\n        .card {\n          padding: 0;\n          width: 100%;\n        }\n\n        .topLevelListItem {\n        }\n\n        lit-virtualizer {\n          margin-top: 80px;\n          margin-left: 32px;\n          margin-right: 32px;\n          padding-left: 32px;\n          padding-right: 32px;\n          //TODO: Check this !important usage\n          max-width: 888px !important;\n          min-width: 888px !important;\n        }\n\n        a {\n          text-decoration: none;\n          width: 100%;\n        }\n\n        @media (max-width: 600px) {\n          lit-virtualizer {\n            margin-top: 80px;\n            margin-left: 0;\n            margin-right: 0;\n            padding-left: 0;\n            padding-right: 0;\n            width: 100% !important;\n            min-width: 100% !important;\n          }\n          .card {\n            margin-bottom: 16px;\n          }\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return this.sortedCollectionItems\n      ? html`\n          <lit-virtualizer\n            id=\"list\"\n            role=\"main\"\n            .layout=\"${this.grid ? GridLayout : FlowLayout}\"\n            aria-label=\"${this.t(this.pluralItemType)}\"\n            .items=\"${this.sortedCollectionItems}\"\n            .scrollTarget=\"${window}\"\n            .keyFunction=\"${(item: YpCollectionData) => item.id}\"\n            .renderItem=\"${this.renderItem.bind(this)}\"\n          ></lit-virtualizer>\n        `\n      : nothing;\n  }\n\n  renderItem(item: YpCollectionData, index: number): TemplateResult {\n    return html`\n      <div class=\"layout vertical center-center topLevelListItem\">\n        <yp-collection-item-card\n          class=\"card\"\n          .index=\"${index}\"\n          ?useEvenOddItemLayout=\"${this.useEvenOddItemLayout && this.wide}\"\n          aria-label=\"${item.name}\"\n          ariarole=\"listitem\"\n          .item=\"${item}\"\n          @keypress=\"${this._keypress.bind(this)}\"\n          @click=\"${this._selectedItemChanged.bind(this)}\"\n        ></yp-collection-item-card>\n      </div>\n    `;\n  }\n\n  get pluralItemType() {\n    if (this.collectionItemType == \"community\") {\n      return \"communities\";\n    } else if (this.collectionItemType == \"group\") {\n      return \"groups\";\n    } else if (this.collectionItemType == \"post\") {\n      return \"posts\";\n    } else {\n      return \"unknownItemType\";\n    }\n  }\n\n  _keypress(event: KeyboardEvent) {\n    if (event.keyCode == 13) {\n      this._selectedItemChanged(event as unknown as CustomEvent);\n    }\n  }\n\n  async refresh() {}\n\n  override firstUpdated(\n    changedProperties: Map<string | number | symbol, unknown>\n  ) {\n    super.firstUpdated(changedProperties);\n    YpIronListHelpers.attachListeners(this as YpElementWithIronList);\n  }\n\n  override async connectedCallback() {\n    super.connectedCallback();\n    if (this.collection && this.collectionItems) {\n      const splitCommunities = YpCollectionHelpers.splitByStatus(\n        this.collectionItems,\n        this.collection.configuration\n      );\n\n      this.sortedCollectionItems = splitCommunities.featured.concat(\n        splitCommunities.active.concat(splitCommunities.archived)\n      );\n    }\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    YpIronListHelpers.detachListeners(this as YpElementWithIronList);\n  }\n\n  // TODO: Make sure this fires each time on keyboard, mouse & phone - make sure back key on browser works also just with the A\n  _selectedItemChanged(event: CustomEvent) {\n    const item = (event.target as YpCollectionItemCard).item;\n\n    if (this.collectionItemType && item) {\n      window.appGlobals.activity(\n        \"open\",\n        this.collectionItemType,\n        `/${this.collectionItemType}/${item.id}`,\n        { id: item.id }\n      );\n\n      if (this.collectionItemType === \"community\") {\n        const community = item as YpCommunityData;\n        if (community != undefined) {\n          window.appGlobals.cache.backToDomainCommunityItems[\n            community.domain_id!\n          ] = community;\n        }\n      } else if (this.collectionItemType === \"group\" && item) {\n        const group = item as YpGroupData;\n        window.appGlobals.cache.backToCommunityGroupItems[group.community_id] =\n          group;\n        window.appGlobals.cache.groupItemsCache[group.id] = group;\n      }\n    }\n  }\n\n  scrollToItem(item: YpDatabaseItem | undefined) {\n    if (item && this.sortedCollectionItems) {\n      for (let i = 0; i < this.sortedCollectionItems.length; i++) {\n        if (this.sortedCollectionItems[i] == item) {\n          (this.$$(\"#list\") as LitVirtualizer).scrollToIndex(i);\n          break;\n        }\n      }\n      this.fireGlobal(\"yp-refresh-activities-scroll-threshold\");\n    } else {\n      console.error(\"No item to scroll too\");\n    }\n  }\n}\n"]}