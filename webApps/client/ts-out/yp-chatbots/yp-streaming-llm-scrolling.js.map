{"version":3,"file":"yp-streaming-llm-scrolling.js","sourceRoot":"","sources":["../../src/yp-chatbots/yp-streaming-llm-scrolling.ts"],"names":[],"mappings":"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","sourcesContent":["import { property, customElement } from \"lit/decorators.js\";\n\nimport \"@material/web/fab/fab.js\";\n\nimport \"@material/web/radio/radio.js\";\nimport \"@material/web/button/elevated-button.js\";\nimport \"@material/web/button/text-button.js\";\nimport \"@material/web/button/outlined-button.js\";\nimport \"@material/web/button/filled-button.js\";\nimport \"@material/web/textfield/outlined-text-field.js\";\nimport \"@material/web/icon/icon.js\";\n\nimport \"@material/web/iconbutton/outlined-icon-button.js\";\n\nimport \"../common/yp-image.js\";\n\nimport { YpStreamingLlmBase } from \"./yp-streaming-llm-base.js\";\n\nimport \"./yp-chatbot-item-base.js\";\n\n@customElement(\"yp-streaming-llm-scrolling\")\nexport abstract class YpStreamingLlmScrolling extends YpStreamingLlmBase {\n  @property({ type: String })\n  scrollElementSelector = \"#chat-messages\";\n\n  @property({ type: Boolean })\n  useMainWindowScroll = false;\n\n  @property({ type: Boolean })\n  userScrolled = false;\n\n  override scrollDown() {\n    if (this.disableAutoScroll) {\n      return;\n    }\n\n    if (\n      !this.userScrolled &&\n      (this.$$(this.scrollElementSelector) || this.useMainWindowScroll)\n    ) {\n      this.programmaticScroll = true;\n      let element;\n      if (this.useMainWindowScroll) {\n        element = window.document.documentElement;\n      } else if (this.$$(this.scrollElementSelector)) {\n        element = this.$$(this.scrollElementSelector)!;\n      }\n\n      if (\n        element?.tagName === \"INPUT\" ||\n        element?.tagName === \"TEXTAREA\" ||\n        element?.tagName === \"MD-OUTLINED-TEXT-FIELD\"\n      ) {\n        // Move the cursor to the end of the text\n        (element as HTMLInputElement).selectionStart = (\n          element as HTMLInputElement\n        ).selectionEnd = (element as HTMLInputElement).value.length;\n        element.scrollTop = element.scrollHeight - 100;\n      } else {\n        // For non-text field elements, use scrollTop and scrollHeight to scroll\n        element!.scrollTop = element!.scrollHeight;\n      }\n\n      setTimeout(() => {\n        this.programmaticScroll = false;\n      }, 100);\n    } else {\n      console.error(\"User scrolled, not scrolling down\");\n    }\n  }\n\n  handleScroll() {\n    if (this.disableAutoScroll) {\n      return;\n    }\n\n    if (\n      this.programmaticScroll ||\n      (!this.$$(this.scrollElementSelector) && !this.useMainWindowScroll)\n    ) {\n      return;\n    }\n\n    let currentScrollTop = 0;\n    if (this.$$(this.scrollElementSelector)) {\n      currentScrollTop = this.$$(this.scrollElementSelector)!.scrollTop;\n    } else if (this.useMainWindowScroll) {\n      currentScrollTop = window.scrollY;\n    }\n\n    if (this.scrollStart === 0) {\n      // Initial scroll\n      this.scrollStart = currentScrollTop;\n    }\n\n    const threshold = 10;\n\n    let atBottom;\n\n    if (this.useMainWindowScroll) {\n      atBottom =\n        this.$$(this.scrollElementSelector)!.scrollHeight -\n          currentScrollTop -\n          this.$$(this.scrollElementSelector)!.clientHeight <=\n        threshold;\n    } else if (this.$$(this.scrollElementSelector)) {\n      atBottom =\n        document.documentElement.scrollHeight -\n          currentScrollTop -\n          window.innerHeight <=\n        threshold;\n    }\n\n    if (atBottom) {\n      this.userScrolled = false;\n      this.scrollStart = 0; // Reset scroll start\n    } else if (Math.abs(this.scrollStart - currentScrollTop) > threshold) {\n      this.userScrolled = true;\n      // Optionally reset scrollStart here if you want to continuously check for threshold scroll\n      // this.scrollStart = currentScrollTop;\n    }\n  }\n}\n"]}