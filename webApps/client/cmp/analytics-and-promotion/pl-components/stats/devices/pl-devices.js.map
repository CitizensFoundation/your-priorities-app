{"version":3,"file":"pl-devices.js","sourceRoot":"","sources":["../../../../../src/analytics-and-promotion/pl-components/stats/devices/pl-devices.ts"],"names":[],"mappings":"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","sourcesContent":["import { customElement, property } from 'lit/decorators.js';\nimport { html, nothing } from 'lit';\n\nimport * as storage from '../../util/storage.js';\nimport * as url from '../../util/url.js';\nimport * as api from '../../api.js';\nimport '../reports/pl-list-report.js';\n\nimport { PlausibleBaseElementWithState } from '../../pl-base-element-with-state.js';\n\nconst EXPLANATION = {\n  Mobile: 'up to 576px',\n  Tablet: '576px to 992px',\n  Laptop: '992px to 1440px',\n  Desktop: 'above 1440px',\n} as Record<string, string>;\n\n@customElement('pl-devices')\nexport class PlausableDevices extends PlausibleBaseElementWithState {\n  @property({ type: String })\n  tabKey!: string;\n\n  @property({ type: String })\n  storedTab: string | undefined;\n\n  @property({ type: String })\n  mode: string | undefined;\n\n override connectedCallback() {\n    super.connectedCallback();\n    this.tabKey = `pageTab__${this.site.domain}`;\n    this.mode = this.storedTab || 'browser';\n  }\n\n  setMode(mode: string) {\n    storage.setItem(this.tabKey, mode);\n    this.mode = mode;\n  }\n\n  renderBrowsers() {\n    const fetchData = () => {\n      return api.get(\n        this.proxyUrl,\n        url.apiPath(this.site, '/browsers'),\n        this.query\n      );\n    };\n\n    return html`\n      <pl-list-report\n        .fetchDataFunction=${fetchData}\n        .filter=${{ browser: 'name' }}\n        .timer=\"${this.timer}\"\n        .keyLabel=\"${this.t(\"Browser\")}\"\n        .query=${this.query}\n      ></pl-list-report>\n    `;\n  }\n\n  renderBrowserVersions() {\n    const fetchData = () => {\n      return api.get(\n        this.proxyUrl,\n        url.apiPath(this.site, '/browser-versions'),\n        this.query\n      );\n    };\n\n    return html`\n      <pl-list-report\n        .fetchDataFunction=${fetchData}\n        .timer=\"${this.timer}\"\n        .filter=${{ browser_version: 'name' }}\n        .keyLabel=${this.query.filters.browser + ` ${this.t(\"version\")}`}\n        .query=${this.query}\n      ></pl-list-report>\n    `;\n  }\n\n  renderOperatingSystems() {\n    const fetchData = () => {\n      return api.get(\n        this.proxyUrl,\n        url.apiPath(this.site, '/operating-systems'),\n        this.query\n      );\n    };\n\n    return html`\n      <pl-list-report\n        .fetchDataFunction=${fetchData}\n        .timer=\"${this.timer}\"\n        .filter=${{ os: 'name' }}\n        .keyLabel=${this.t(\"Operating system\")}\n        .query=${this.query}\n      ></pl-list-report>\n    `;\n  }\n\n  renderOperatingSystemVersions() {\n    const fetchData = () => {\n      return api.get(\n        this.proxyUrl,\n        url.apiPath(this.site, '/operating-system-versions'),\n        this.query\n      );\n    };\n\n    return html`\n      <pl-list-report\n        .fetchDataFunction=${fetchData}\n        .timer=\"${this.timer}\"\n        .filter=${{ os_version: 'name' }}\n        .keyLabel=${this.query.filters.os + ` ${this.t(\"version\")}`}\n        .query=${this.query}\n      ></pl-list-report>\n    `;\n  }\n\n  renderScreenSizes() {\n    const fetchData = () => {\n      return api.get(\n        this.proxyUrl,\n        url.apiPath(this.site, '/screen-sizes'),\n        this.query\n      );\n    };\n\n    const renderIcon = (screenSize: PlausibleListItemData) => {\n      return this.iconFor(screenSize.name);\n    };\n\n    const renderTooltipText = (screenSize: PlausibleListItemData) => {\n      return EXPLANATION[screenSize.name!];\n    };\n\n    return html`\n      <pl-list-report\n        .fetchDataFunction=${fetchData}\n        .filter=${{ screen: 'name' }}\n        .keyLabel=${this.t(\"Screen size\")}\n        .timer=\"${this.timer}\"\n        .query=${this.query}\n        .renderIcon=${renderIcon}\n        .tooltipText=${renderTooltipText}\n      ></pl-list-report>\n    `;\n  }\n\n  iconFor(screenSize: string) {\n    if (screenSize === 'Mobile') {\n      return html`\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"24\"\n          height=\"24\"\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          class=\"-mt-px feather\"\n        >\n          <rect x=\"5\" y=\"2\" width=\"14\" height=\"20\" rx=\"2\" ry=\"2\" />\n          <line x1=\"12\" y1=\"18\" x2=\"12\" y2=\"18\" />\n        </svg>\n      `;\n    } else if (screenSize === 'Tablet') {\n      return html`\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"24\"\n          height=\"24\"\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          class=\"-mt-px feather\"\n        >\n          <rect\n            x=\"4\"\n            y=\"2\"\n            width=\"16\"\n            height=\"20\"\n            rx=\"2\"\n            ry=\"2\"\n            transform=\"rotate(180 12 12)\"\n          />\n          <line x1=\"12\" y1=\"18\" x2=\"12\" y2=\"18\" />\n        </svg>\n      `;\n    } else if (screenSize === 'Laptop') {\n      return html`\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"24\"\n          height=\"24\"\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          class=\"-mt-px feather\"\n        >\n          <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\" />\n          <line x1=\"2\" y1=\"20\" x2=\"22\" y2=\"20\" />\n        </svg>\n      `;\n    } else if (screenSize === 'Desktop') {\n      return html`\n        <svg\n          xmlns=\"http://www.w3.org/2000/svg\"\n          width=\"24\"\n          height=\"24\"\n          viewBox=\"0 0 24 24\"\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth=\"2\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          class=\"-mt-px feather\"\n        >\n          <rect x=\"2\" y=\"3\" width=\"20\" height=\"14\" rx=\"2\" ry=\"2\" />\n          <line x1=\"8\" y1=\"21\" x2=\"16\" y2=\"21\" />\n          <line x1=\"12\" y1=\"17\" x2=\"12\" y2=\"21\" />\n        </svg>\n      `;\n    } else {\n      return nothing;\n    }\n  }\n\n  renderContent() {\n    switch (this.mode) {\n      case 'browser':\n        if (this.query.filters.browser) {\n          return this.renderBrowserVersions();\n        } else {\n          return this.renderBrowsers();\n        }\n      case 'os':\n        if (this.query.filters.os) {\n          return this.renderOperatingSystemVersions();\n        } else {\n          return this.renderOperatingSystems();\n        }\n      case 'size':\n      default:\n        return this.renderScreenSizes();\n    }\n  }\n\n  renderPill(name: string, mode: string) {\n    const isActive = this.mode === mode;\n\n    if (isActive) {\n      return html`\n        <li\n          class=\"inline-block h-5 font-bold text-indigo-700 active-prop-heading dark:text-indigo-500\"\n        >\n          ${this.t(name)}\n        </li>\n      `;\n    } else {\n      return html`\n        <li\n          class=\"cursor-pointer hover:text-indigo-600\"\n          @click=${() => this.setMode(mode)}\n        >\n          ${this.t(name)}\n        </li>\n      `;\n    }\n  }\n\n  override render() {\n    return html`\n      <div class=\"stats-item flex flex-col mt-6 stats-item--has-header w-full\">\n        <div\n          class=\"stats-item-header flex flex-col flex-grow relative p-4 bg-white rounded shadow-xl dark:bg-gray-825\"\n        >\n          <div class=\"flex justify-between w-full\">\n            <h3 class=\"font-bold dark:text-gray-100\">${this.t(\"Devices\")}</h3>\n            <ul\n              class=\"flex text-xs font-medium text-gray-500 dark:text-gray-400 space-x-2\"\n            >\n              ${this.renderPill('Size', 'size')}\n              ${this.renderPill('Browser', 'browser')}\n              ${this.renderPill('OS', 'os')}\n            </ul>\n          </div>\n          ${this.renderContent()}\n        </div>\n      </div>\n    `;\n  }\n}\n"]}