{"version":3,"file":"yp-rating.js","sourceRoot":"","sources":["../../src/yp-rating/yp-rating.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-ignore */\nimport { html, css } from 'lit';\nimport { customElement, property } from 'lit/decorators.js';\nimport { YpBaseElement } from '../common/yp-base-element.js';\nimport { dom } from '@polymer/polymer/lib/legacy/polymer.dom.js';\n\n@customElement('yp-ratings')\nexport class YpRating extends YpBaseElement {\n  @property({ type: String })\n  emoji: string | undefined;\n\n  @property({ type: Boolean })\n  votingDisabled = false;\n\n  @property({ type: Boolean })\n  readOnly = false;\n\n  @property({ type: Number })\n  postId: number | undefined;\n\n  @property({ type: Number })\n  ratingIndex: number | undefined;\n\n  @property({ type: Number })\n  numberOf: number | undefined;\n\n  @property({ type: Number })\n  rate = 0;\n\n  @property({ type: Array })\n  currentRatings: Array<number> | undefined;\n\n  static override get styles() {\n    return [\n      super.styles,\n      css`\n        :host {\n          display: block;\n        }\n\n        .rating-wrapper {\n          unicode-bidi: bidi-override;\n          direction: rtl;\n          text-align: center;\n        }\n\n        .rating-wrapper > span {\n          display: inline-block;\n          position: relative;\n          width: 1.35em;\n          font-size: 1.6em;\n          cursor: pointer;\n          opacity: 0.4;\n          -webkit-filter: grayscale(50%);\n          filter: grayscale(50%);\n        }\n\n        .rating-wrapper[voting-disabled] > span {\n          cursor: initial;\n        }\n\n        .rating-wrapper > span.active,\n        .rating-wrapper > span.active ~ span {\n          opacity: 1;\n          -webkit-filter: grayscale(0%);\n          filter: grayscale(0%);\n        }\n\n        @media (pointer: fine) {\n          .rating-wrapper:not([read-only]):hover > span.active,\n          .rating-wrapper:not([read-only]):hover > span.active ~ span {\n            opacity: 0.4;\n          }\n          .rating-wrapper:not([read-only]) > span:hover,\n          .rating-wrapper:not([read-only]) > span:hover ~ span,\n          .rating-wrapper:not([read-only]) > span.active:hover ~ span {\n            opacity: 0.8 !important;\n            -webkit-filter: grayscale(0%);\n            filter: grayscale(0%);\n          }\n          .rating-wrapper:not([read-only]) > span:hover {\n            opacity: 0.9 !important;\n            -webkit-filter: grayscale(0%);\n            filter: grayscale(0%);\n          }\n        }\n\n        .rating-wrapper > span.totals {\n          opacity: 1 !important;\n          margin-left: 50px;\n        }\n\n        .rating-wrapper:not([read-only]) > span.totals:hover {\n          opacity: 1 !important;\n        }\n\n        .rating-wrapper[read-only] > span {\n        }\n\n        .rating-wrapper[read-only] > span {\n          font-size: 0.8em !important;\n          width: 1.248em;\n        }\n\n        :host[read-only] {\n        }\n      `,\n    ];\n  }\n\n  override render() {\n    return html`\n      <div\n        class=\"rating-wrapper\"\n        voting-disabled$=\"[[votingDisabled]]\"\n        read-only$=\"[[readOnly]]\">\n        ${this.currentRatings?.map((item, index) => {\n          return html`\n            <span\n              class=\"${this.isActive(index, this.rate)}\"\n              @click=\"${this._setRate}\"\n              data-index=\"${index}\"\n              >${this.emoji}</span\n            >\n          `;\n        })}\n      </div>\n    `;\n  }\n\n  // Caller in polymer was {{isActive(numberOf, index, rate)}}\n  isActive(index: number, rate: number) {\n    if (index <= rate) {\n      return 'active';\n    } else {\n      return '';\n    }\n  }\n\n  _postIdChanged() {\n    this._resetRatings();\n  }\n\n  _resetRatings() {\n    if (typeof this.rate === 'string') this.rate = parseFloat(this.rate);\n    this.rate = Math.round(this.rate);\n    this.currentRatings = [];\n\n    const deep = dom(this.shadowRoot);\n\n    setTimeout(() => {\n      if (typeof this.numberOf === 'string')\n        this.numberOf = parseInt(this.numberOf);\n      if (this.numberOf) {\n        if (this.numberOf > 5) this.numberOf = 5;\n        for (let i = this.numberOf - 1; i >= 0; i--) {\n          this.currentRatings?.push(i + 1);\n        }\n        if (this.rate && this.rate > 0) {\n          setTimeout(() => {\n            if (this.numberOf) {\n              const inverted = this.rate * -1 + this.numberOf;\n              for (let i = this.numberOf - 1; i >= inverted; i--) {\n                //@ts-ignore\n                let selector = deep.querySelectorAll(\n                  '[data-index=\"' + i + '\"]'\n                );\n                selector = selector[0];\n                if (selector) {\n                  selector.classList.add('active');\n                } else {\n                  console.warn('No selector found for rating');\n                }\n              }\n            }\n          });\n        }\n      }\n    });\n  }\n\n  _setRate(e: CustomEvent) {\n    const deep = dom(this.shadowRoot);\n    if (!this.readOnly && this.numberOf) {\n      //@ts-ignore\n      const index = e.model.index;\n      const indexOld = this.rate * -1 + this.numberOf;\n      const oldRate = this.rate;\n      this.rate = (index - this.numberOf) * -1;\n      if (oldRate !== this.rate) {\n        this.fire('yp-rating-add', {\n          postId: this.postId,\n          ratingIndex: this.ratingIndex,\n          rate: this.rate,\n        });\n      } else {\n        this.fire('yp-rating-delete', {\n          postId: this.postId,\n          ratingIndex: this.ratingIndex,\n        });\n        this.rate = 0;\n        this._resetRatings();\n      }\n      if (indexOld < this.numberOf) {\n        deep\n          //@ts-ignore\n          .querySelectorAll('[data-index=\"' + indexOld + '\"]')[0]\n          .classList.remove('active');\n      }\n      deep\n        //@ts-ignore\n        .querySelectorAll('[data-index=\"' + index + '\"]')[0]\n        .classList.add('active');\n    }\n  }\n}\n"]}