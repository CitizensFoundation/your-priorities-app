import{n as t,r as e,t as i,Y as n,i as o,x as r,T as s}from"./LLn8G3bW.js";
/**
 * {@link https://github.com/muaz-khan/RecordRTC|RecordRTC} is a WebRTC JavaScript library for audio/video as well as screen activity recording. It supports Chrome, Firefox, Opera, Android, and Microsoft Edge. Platforms: Linux, Mac and Windows. 
 * @summary Record audio, video or screen inside the browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTC
 * @class
 * @example
 * var recorder = RecordRTC(mediaStream or [arrayOfMediaStream], {
 *     type: 'video', // audio or video or gif or canvas
 *     recorderType: MediaStreamRecorder || CanvasRecorder || StereoAudioRecorder || Etc
 * });
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, desiredSampRate: 16000, video: HTMLVideoElement, etc.}
 */
function u(t,e){if(!t)throw"First parameter is required.";e=new a(t,e=e||{type:"video"});var i=this;function n(i){i&&(e.initCallback=function(){i(),i=e.initCallback=null});var n=new c(t,e);(l=new n(t,e)).record(),f("recording"),e.disableLogs||console.log("Initialized recorderType:",l.constructor.name,"for output-type:",e.type)}function o(t){if(t=t||function(){},l){if("paused"===i.state)return i.resumeRecording(),void setTimeout((function(){o(t)}),1);"recording"===i.state||e.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',i.state),e.disableLogs||console.log("Stopped recording "+e.type+" stream."),"gif"!==e.type?l.stop(n):(l.stop(),n()),f("stopped")}else v();function n(n){if(l){Object.keys(l).forEach((function(t){"function"!=typeof l[t]&&(i[t]=l[t])}));var o=l.blob;if(!o){if(!n)throw"Recording failed.";l.blob=o=n}if(o&&!e.disableLogs&&console.log(o.type,"->",j(o.size)),t){var r;try{r=y.createObjectURL(o)}catch(t){}"function"==typeof t.call?t.call(i,r):t(r)}e.autoWriteToDisk&&s((function(t){var i={};i[e.type+"Blob"]=t,D.Store(i)}))}else"function"==typeof t.call?t.call(i,""):t("")}}function r(t){postMessage((new FileReaderSync).readAsDataURL(t))}function s(t,i){if(!t)throw"Pass a callback function over getDataURL.";var n=i?i.blob:(l||{}).blob;if(!n)return e.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout((function(){s(t,i)}),1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var o=new FileReader;o.readAsDataURL(n),o.onload=function(e){t(e.target.result)}}else{var u=function(t){try{var e=y.createObjectURL(new Blob([t.toString(),"this.onmessage =  function (eee) {"+t.name+"(eee.data);}"],{type:"application/javascript"})),i=new Worker(e);return y.revokeObjectURL(e),i}catch(t){}}(r);u.onmessage=function(e){t(e.data)},u.postMessage(n)}}function h(t){t=t||0,"paused"!==i.state?"stopped"!==i.state&&(t>=i.recordingDuration?o(i.onRecordingStopped):(t+=1e3,setTimeout((function(){h(t)}),1e3))):setTimeout((function(){h(t)}),1e3)}function f(t){i&&(i.state=t,"function"==typeof i.onStateChanged.call?i.onStateChanged.call(i,t):i.onStateChanged(t))}var l,d='It seems that recorder is destroyed or "startRecording" is not invoked for '+e.type+" recorder.";function v(){!0!==e.disableLogs&&console.warn(d)}var m={startRecording:function(o){return e.disableLogs||console.log("RecordRTC version: ",i.version),o&&(e=new a(t,o)),e.disableLogs||console.log("started recording "+e.type+" stream."),l?(l.clearRecordedData(),l.record(),f("recording"),i.recordingDuration&&h(),i):(n((function(){i.recordingDuration&&h()})),i)},stopRecording:o,pauseRecording:function(){l?"recording"===i.state?(f("paused"),l.pause(),e.disableLogs||console.log("Paused recording.")):e.disableLogs||console.warn("Unable to pause the recording. Recording state: ",i.state):v()},resumeRecording:function(){l?"paused"===i.state?(f("recording"),l.resume(),e.disableLogs||console.log("Resumed recording.")):e.disableLogs||console.warn("Unable to resume the recording. Recording state: ",i.state):v()},initRecorder:n,setRecordingDuration:function(t,e){if(void 0===t)throw"recordingDuration is required.";if("number"!=typeof t)throw"recordingDuration must be a number.";return i.recordingDuration=t,i.onRecordingStopped=e||function(){},{onRecordingStopped:function(t){i.onRecordingStopped=t}}},clearRecordedData:function(){l?(l.clearRecordedData(),e.disableLogs||console.log("Cleared old recorded data.")):v()},getBlob:function(){if(l)return l.blob;v()},getDataURL:s,toURL:function(){if(l)return y.createObjectURL(l.blob);v()},getInternalRecorder:function(){return l},save:function(t){l?M(l.blob,t):v()},getFromDisk:function(t){l?u.getFromDisk(e.type,t):v()},setAdvertisementArray:function(t){e.advertisement=[];for(var i=t.length,n=0;n<i;n++)e.advertisement.push({duration:n,image:t[n]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"!==i.state||e.disableLogs||console.warn("Stop an active recorder."),l&&"function"==typeof l.clearRecordedData&&l.clearRecordedData(),l=null,f("inactive"),i.blob=null},onStateChanged:function(t){e.disableLogs||console.log("Recorder state changed:",t)},state:"inactive",getState:function(){return i.state},destroy:function(){var t=e.disableLogs;e={disableLogs:!0},i.reset(),f("destroyed"),m=i=null,x.AudioContextConstructor&&(x.AudioContextConstructor.close(),x.AudioContextConstructor=null),e.disableLogs=t,e.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.2"};if(!this)return i=m,m;for(var p in m)this[p]=m[p];return i=this,m}
/**
 * {@link RecordRTCConfiguration} is an inner/private helper for {@link RecordRTC}.
 * @summary It configures the 2nd parameter passed over {@link RecordRTC} and returns a valid "config" object.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCConfiguration
 * @class
 * @example
 * var options = RecordRTCConfiguration(mediaStream, options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, getNativeBlob:true, etc.}
 */
function a(t,e){return e.recorderType||e.type||(e.audio&&e.video?e.type="video":e.audio&&!e.video&&(e.type="audio")),e.recorderType&&!e.type&&(e.recorderType===B||e.recorderType===P||void 0!==W&&e.recorderType===W?e.type="video":e.recorderType===I?e.type="gif":e.recorderType===E?e.type="audio":e.recorderType===T&&(S(t,"audio").length&&S(t,"video").length||!S(t,"audio").length&&S(t,"video").length?e.type="video":S(t,"audio").length&&!S(t,"video").length&&(e.type="audio"))),void 0!==T&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(e.mimeType||(e.mimeType="video/webm"),e.type||(e.type=e.mimeType.split("/")[0]),e.bitsPerSecond),e.type||(e.mimeType&&(e.type=e.mimeType.split("/")[0]),e.type||(e.type="audio")),e}
/**
 * {@link GetRecorderType} is an inner/private helper for {@link RecordRTC}.
 * @summary It returns best recorder-type available for your browser.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GetRecorderType
 * @class
 * @example
 * var RecorderType = GetRecorderType(options);
 * var recorder = new RecorderType(options);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {type:"video", disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 */function c(t,e){var i;return(g||p||b)&&(i=E),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!g&&(i=T),"video"===e.type&&(g||b)&&(i=B,void 0!==W&&"undefined"!=typeof ReadableStream&&(i=W)),"gif"===e.type&&(i=I),"canvas"===e.type&&(i=P),C()&&i!==P&&i!==I&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(S(t,"video").length||S(t,"audio").length)&&("audio"===e.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(i=T):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(i=T)),t instanceof Array&&t.length&&(i=F),e.recorderType&&(i=e.recorderType),!e.disableLogs&&i&&i.name&&console.log("Using recorderType:",i.name||i.constructor.name),!i&&A&&(i=T),i}
/**
 * MRecordRTC runs on top of {@link RecordRTC} to bring multiple recordings in a single place, by providing simple API.
 * @summary MRecordRTC stands for "Multiple-RecordRTC".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MRecordRTC
 * @class
 * @example
 * var recorder = new MRecordRTC();
 * recorder.addStream(MediaStream);
 * recorder.mediaType = {
 *     audio: true, // or StereoAudioRecorder or MediaStreamRecorder
 *     video: true, // or WhammyRecorder or MediaStreamRecorder or WebAssemblyRecorder or CanvasRecorder
 *     gif: true    // or GifRecorder
 * };
 * // mimeType is optional and should be set only in advance cases.
 * recorder.mimeType = {
 *     audio: 'audio/wav',
 *     video: 'video/webm',
 *     gif:   'image/gif'
 * };
 * recorder.startRecording();
 * @see For further information:
 * @see {@link https://github.com/muaz-khan/RecordRTC/tree/master/MRecordRTC|MRecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @requires {@link RecordRTC}
 */function h(t){this.addStream=function(e){e&&(t=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e,i=this.mediaType,n=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof i.audio&&C()&&!S(t,"audio").length&&(i.audio=!1),"function"!=typeof i.video&&C()&&!S(t,"video").length&&(i.video=!1),"function"!=typeof i.gif&&C()&&!S(t,"video").length&&(i.gif=!1),!i.audio&&!i.video&&!i.gif)throw"MediaStream must have either audio or video tracks.";if(i.audio&&(e=null,"function"==typeof i.audio&&(e=i.audio),this.audioRecorder=new u(t,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:e,mimeType:n.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),i.video||this.audioRecorder.startRecording()),i.video){e=null,"function"==typeof i.video&&(e=i.video);var o=t;if(C()&&i.audio&&"function"==typeof i.audio){var r=S(t,"video")[0];w?((o=new k).addTrack(r),e&&e===B&&(e=T)):(o=new k).addTrack(r)}this.videoRecorder=new u(o,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:e,mimeType:n.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),i.audio||this.videoRecorder.startRecording()}if(i.audio&&i.video){var s=this,a=!0===C();(i.audio instanceof E&&i.video||!0!==i.audio&&!0!==i.video&&i.audio!==i.video)&&(a=!1),!0===a?(s.audioRecorder=null,s.videoRecorder.startRecording()):s.videoRecorder.initRecorder((function(){s.audioRecorder.initRecorder((function(){s.videoRecorder.startRecording(),s.audioRecorder.startRecording()}))}))}i.gif&&(e=null,"function"==typeof i.gif&&(e=i.gif),this.gifRecorder=new u(t,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:e,mimeType:n.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(t){t=t||function(){},this.audioRecorder&&this.audioRecorder.stopRecording((function(e){t(e,"audio")})),this.videoRecorder&&this.videoRecorder.stopRecording((function(e){t(e,"video")})),this.gifRecorder&&this.gifRecorder.stopRecording((function(e){t(e,"gif")}))},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(t){var e={};return this.audioRecorder&&(e.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(e.video=this.videoRecorder.getBlob()),this.gifRecorder&&(e.gif=this.gifRecorder.getBlob()),t&&t(e),e},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(t){function e(t,e){if("undefined"!=typeof Worker){var i=function(t){var e,i=y.createObjectURL(new Blob([t.toString(),"this.onmessage =  function (eee) {"+t.name+"(eee.data);}"],{type:"application/javascript"})),n=new Worker(i);if(void 0!==y)e=y;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";e=webkitURL}return e.revokeObjectURL(i),n}((function(t){postMessage((new FileReaderSync).readAsDataURL(t))}));i.onmessage=function(t){e(t.data)},i.postMessage(t)}else{var n=new FileReader;n.readAsDataURL(t),n.onload=function(t){e(t.target.result)}}}this.getBlob((function(i){i.audio&&i.video?e(i.audio,(function(n){e(i.video,(function(e){t({audio:n,video:e})}))})):i.audio?e(i.audio,(function(e){t({audio:e})})):i.video&&e(i.video,(function(e){t({video:e})}))}))},this.writeToDisk=function(){u.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(t){(t=t||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof t.audio?t.audio:""),t.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof t.video?t.video:""),t.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof t.gif?t.gif:"")}}u.version="5.6.2","undefined"!=typeof module&&(module.exports=u),"function"==typeof define&&define.amd&&define("RecordRTC",[],(function(){return u})),u.getFromDisk=function(t,e){if(!e)throw"callback is mandatory.";console.log("Getting recorded "+("all"===t?"blobs":t+" blob ")+" from disk!"),D.Fetch((function(i,n){"all"!==t&&n===t+"Blob"&&e&&e(i),"all"===t&&e&&e(i,n.replace("Blob",""))}))},u.writeToDisk=function(t){console.log("Writing recorded blob(s) to disk!"),(t=t||{}).audio&&t.video&&t.gif?t.audio.getDataURL((function(e){t.video.getDataURL((function(i){t.gif.getDataURL((function(t){D.Store({audioBlob:e,videoBlob:i,gifBlob:t})}))}))})):t.audio&&t.video?t.audio.getDataURL((function(e){t.video.getDataURL((function(t){D.Store({audioBlob:e,videoBlob:t})}))})):t.audio&&t.gif?t.audio.getDataURL((function(e){t.gif.getDataURL((function(t){D.Store({audioBlob:e,gifBlob:t})}))})):t.video&&t.gif?t.video.getDataURL((function(e){t.gif.getDataURL((function(t){D.Store({videoBlob:e,gifBlob:t})}))})):t.audio?t.audio.getDataURL((function(t){D.Store({audioBlob:t})})):t.video?t.video.getDataURL((function(t){D.Store({videoBlob:t})})):t.gif&&t.gif.getDataURL((function(t){D.Store({gifBlob:t})}))},h.getFromDisk=u.getFromDisk,h.writeToDisk=u.writeToDisk,void 0!==u&&(u.MRecordRTC=h);var f;(f="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0!==global.console.log&&void 0!==global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(f.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var t={getContext:function(){return t},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return t},f.HTMLVideoElement=function(){}),"undefined"==typeof location&&(f.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(f.screen={width:0,height:0}),void 0===y&&(f.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),f.window=global);var l=window.requestAnimationFrame;if(void 0===l)if("undefined"!=typeof webkitRequestAnimationFrame)l=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)l=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)l=msRequestAnimationFrame;else if(void 0===l){var d=0;l=function(t,e){var i=(new Date).getTime(),n=Math.max(0,16-(i-d)),o=setTimeout((function(){t(i+n)}),n);return d=i+n,o}}var v=window.cancelAnimationFrame;void 0===v&&("undefined"!=typeof webkitCancelAnimationFrame?v=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?v=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?v=msCancelAnimationFrame:void 0===v&&(v=function(t){clearTimeout(t)}));var m=window.AudioContext;void 0===m&&("undefined"!=typeof webkitAudioContext&&(m=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(m=mozAudioContext));var y=window.URL;void 0===y&&"undefined"!=typeof webkitURL&&(y=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var p=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),b=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),w=navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&"netscape"in window&&/ rv:/.test(navigator.userAgent),g=!b&&!p&&!!navigator.webkitGetUserMedia||R()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),A=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);A&&!g&&-1!==navigator.userAgent.indexOf("CriOS")&&(A=!1,g=!0);var k=window.MediaStream;function j(t){if(0===t)return"0 Bytes";var e=parseInt(Math.floor(Math.log(t)/Math.log(1e3)),10);return(t/Math.pow(1e3,e)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][e]}function M(t,e){if(!t)throw"Blob object is required.";if(!t.type)try{t.type="video/webm"}catch(t){}var i=(t.type||"video/webm").split("/")[1];if(-1!==i.indexOf(";")&&(i=i.split(";")[0]),e&&-1!==e.indexOf(".")){var n=e.split(".");e=n[0],i=n[1]}var o=(e||Math.round(9999999999*Math.random())+888888888)+"."+i;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(t,o);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(t,o);var r=document.createElement("a");r.href=y.createObjectURL(t),r.download=o,r.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(r),"function"==typeof r.click?r.click():(r.target="_blank",r.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),y.revokeObjectURL(r.href)}function R(){return"undefined"!=typeof window&&"object"==typeof window.process&&"renderer"===window.process.type||(!("undefined"==typeof process||"object"!=typeof process.versions||!process.versions.electron)||"object"==typeof navigator&&"string"==typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}function S(t,e){return t&&t.getTracks?t.getTracks().filter((function(t){return t.kind===(e||"audio")})):[]}function O(t,e){"srcObject"in e?e.srcObject=t:"mozSrcObject"in e?e.mozSrcObject=t:e.srcObject=t}void 0===k&&"undefined"!=typeof webkitMediaStream&&(k=webkitMediaStream),void 0!==k&&void 0===k.prototype.stop&&(k.prototype.stop=function(){this.getTracks().forEach((function(t){t.stop()}))}),void 0!==u&&(u.invokeSaveAsDialog=M,u.getTracks=S,u.getSeekableBlob=function(t,e){if("undefined"==typeof EBML)throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var i=new EBML.Reader,n=new EBML.Decoder,o=EBML.tools,r=new FileReader;r.onload=function(t){n.decode(this.result).forEach((function(t){i.read(t)})),i.stop();var r=o.makeMetadataSeekable(i.metadatas,i.duration,i.cues),s=this.result.slice(i.metadataSize),u=new Blob([r,s],{type:"video/webm"});e(u)},r.readAsArrayBuffer(t)},u.bytesToSize=j,u.isElectron=R);
/**
 * Storage is a standalone object used by {@link RecordRTC} to store reusable objects e.g. "new AudioContext".
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * Storage.AudioContext === webkitAudioContext
 * @property {webkitAudioContext} AudioContext - Keeps a reference to AudioContext object.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */
var x={};function C(){if(w||A||p)return!0;var t,e,i=navigator.userAgent,n=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10);return(g||b)&&(t=i.indexOf("Chrome"),n=i.substring(t+7)),-1!==(e=n.indexOf(";"))&&(n=n.substring(0,e)),-1!==(e=n.indexOf(" "))&&(n=n.substring(0,e)),o=parseInt(""+n,10),isNaN(o)&&(n=""+parseFloat(navigator.appVersion),o=parseInt(navigator.appVersion,10)),o>=49}
/**
 * MediaStreamRecorder is an abstraction layer for {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}. It is used by {@link RecordRTC} to record MediaStream(s) in both Chrome and Firefox.
 * @summary Runs top over {@link https://w3c.github.io/mediacapture-record/MediaRecorder.html|MediaRecorder API}.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://github.com/muaz-khan|Muaz Khan}
 * @typedef MediaStreamRecorder
 * @class
 * @example
 * var config = {
 *     mimeType: 'video/webm', // vp8, vp9, h264, mkv, opus/vorbis
 *     audioBitsPerSecond : 256 * 8 * 1024,
 *     videoBitsPerSecond : 256 * 8 * 1024,
 *     bitsPerSecond: 256 * 8 * 1024,  // if this is provided, skip above two
 *     checkForInactiveTracks: true,
 *     timeSlice: 1000, // concatenate intervals based blobs
 *     ondataavailable: function() {} // get intervals based blobs
 * }
 * var recorder = new MediaStreamRecorder(mediaStream, config);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs:true, initCallback: function, mimeType: "video/webm", timeSlice: 1000}
 * @throws Will throw an error if first argument "MediaStream" is missing. Also throws error if "MediaRecorder API" are not supported by the browser.
 */function T(t,e){var i=this;if(void 0===t)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if("audio"===(e=e||{mimeType:"video/webm"}).type){var n;if(S(t,"video").length&&S(t,"audio").length)navigator.mozGetUserMedia?(n=new k).addTrack(S(t,"audio")[0]):n=new k(S(t,"audio")),t=n;e.mimeType&&-1!==e.mimeType.toString().toLowerCase().indexOf("audio")||(e.mimeType=g?"audio/webm":"audio/ogg"),e.mimeType&&"audio/ogg"!==e.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(e.mimeType="audio/ogg")}var o,r=[];function s(){i.timestamps.push((new Date).getTime()),"function"==typeof e.onTimeStamp&&e.onTimeStamp(i.timestamps[i.timestamps.length-1],i.timestamps)}function u(t){return o&&o.mimeType?o.mimeType:t.mimeType||"video/webm"}function a(){r=[],o=null,i.timestamps=[]}this.getArrayOfBlobs=function(){return r},this.record=function(){i.blob=null,i.clearRecordedData(),i.timestamps=[],c=[],r=[];var n=e;e.disableLogs||console.log("Passing following config over MediaRecorder API.",n),o&&(o=null),g&&!C()&&(n="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&n.mimeType&&(MediaRecorder.isTypeSupported(n.mimeType)||(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",n.mimeType),n.mimeType="audio"===e.type?"audio/webm":"video/webm"));try{o=new MediaRecorder(t,n),e.mimeType=n.mimeType}catch(e){o=new MediaRecorder(t)}n.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in o&&!1===o.canRecordMimeType(n.mimeType)&&(e.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",n.mimeType)),o.ondataavailable=function(t){if(t.data&&c.push("ondataavailable: "+j(t.data.size)),"number"!=typeof e.timeSlice)!t.data||!t.data.size||t.data.size<100||i.blob?i.recordingCallback&&(i.recordingCallback(new Blob([],{type:u(n)})),i.recordingCallback=null):(i.blob=e.getNativeBlob?t.data:new Blob([t.data],{type:u(n)}),i.recordingCallback&&(i.recordingCallback(i.blob),i.recordingCallback=null));else if(t.data&&t.data.size&&(r.push(t.data),s(),"function"==typeof e.ondataavailable)){var o=e.getNativeBlob?t.data:new Blob([t.data],{type:u(n)});e.ondataavailable(o)}},o.onstart=function(){c.push("started")},o.onpause=function(){c.push("paused")},o.onresume=function(){c.push("resumed")},o.onstop=function(){c.push("stopped")},o.onerror=function(t){t&&(t.name||(t.name="UnknownError"),c.push("error: "+t),e.disableLogs||(-1!==t.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",t):-1!==t.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",n.mimeType,") is not supported.",t):-1!==t.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",t):"OutOfMemory"===t.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",t):"IllegalStreamModification"===t.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",t):"OtherRecordingError"===t.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",t):"GenericError"===t.name?console.error("The UA cannot provide the codec or recording option that has been requested.",t):console.error("MediaRecorder Error",t)),function(t){if(!i.manuallyStopped&&o&&"inactive"===o.state)return delete e.timeslice,void o.start(6e5);setTimeout(void 0,1e3)}(),"inactive"!==o.state&&"stopped"!==o.state&&o.stop())},"number"==typeof e.timeSlice?(s(),o.start(e.timeSlice)):o.start(36e5),e.initCallback&&e.initCallback()},this.timestamps=[],this.stop=function(t){t=t||function(){},i.manuallyStopped=!0,o&&(this.recordingCallback=t,"recording"===o.state&&o.stop(),"number"==typeof e.timeSlice&&setTimeout((function(){i.blob=new Blob(r,{type:u(e)}),i.recordingCallback(i.blob)}),100))},this.pause=function(){o&&"recording"===o.state&&o.pause()},this.resume=function(){o&&"paused"===o.state&&o.resume()},this.clearRecordedData=function(){o&&"recording"===o.state&&i.stop(a),a()},this.getInternalRecorder=function(){return o},this.blob=null,this.getState=function(){return o&&o.state||"inactive"};var c=[];this.getAllStates=function(){return c},void 0===e.checkForInactiveTracks&&(e.checkForInactiveTracks=!1);i=this;!function n(){if(o&&!1!==e.checkForInactiveTracks)return!1===function(){if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}()?(e.disableLogs||console.log("MediaStream seems stopped."),void i.stop()):void setTimeout(n,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}
/**
 * StereoAudioRecorder is a standalone class used by {@link RecordRTC} to bring "stereo" audio-recording in chrome.
 * @summary JavaScript standalone object for stereo audio recording.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef StereoAudioRecorder
 * @class
 * @example
 * var recorder = new StereoAudioRecorder(MediaStream, {
 *     sampleRate: 44100,
 *     bufferSize: 4096
 * });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {sampleRate: 44100, bufferSize: 4096, numberOfAudioChannels: 1, etc.}
 */
function E(t,e){if(!S(t,"audio").length)throw"Your stream has no audio tracks.";var i,n=this,o=[],r=[],s=!1,a=0,c=2,h=(e=e||{}).desiredSampRate;function f(){if(!1===e.checkForInactiveTracks)return!0;if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}function l(t,e){function i(t,e){var i,n=t.numberOfAudioChannels,o=t.leftBuffers.slice(0),r=t.rightBuffers.slice(0),s=t.sampleRate,u=t.internalInterleavedLength,a=t.desiredSampRate;function c(t,e,i){var n=Math.round(t.length*(e/i)),o=[],r=Number((t.length-1)/(n-1));o[0]=t[0];for(var s=1;s<n-1;s++){var u=s*r,a=Number(Math.floor(u)).toFixed(),c=Number(Math.ceil(u)).toFixed(),f=u-a;o[s]=h(t[a],t[c],f)}return o[n-1]=t[t.length-1],o}function h(t,e,i){return t+(e-t)*i}function f(t,e){for(var i=new Float64Array(e),n=0,o=t.length,r=0;r<o;r++){var s=t[r];i.set(s,n),n+=s.length}return i}function l(t,e,i){for(var n=i.length,o=0;o<n;o++)t.setUint8(e+o,i.charCodeAt(o))}2===n&&(o=f(o,u),r=f(r,u),a&&(o=c(o,a,s),r=c(r,a,s))),1===n&&(o=f(o,u),a&&(o=c(o,a,s))),a&&(s=a),2===n&&(i=function(t,e){for(var i=t.length+e.length,n=new Float64Array(i),o=0,r=0;r<i;)n[r++]=t[o],n[r++]=e[o],o++;return n}(o,r)),1===n&&(i=o);var d=i.length,v=new ArrayBuffer(44+2*d),m=new DataView(v);l(m,0,"RIFF"),m.setUint32(4,36+2*d,!0),l(m,8,"WAVE"),l(m,12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,n,!0),m.setUint32(24,s,!0),m.setUint32(28,s*n*2,!0),m.setUint16(32,2*n,!0),m.setUint16(34,16,!0),l(m,36,"data"),m.setUint32(40,2*d,!0);for(var y=d,p=44,b=0;b<y;b++)m.setInt16(p,32767*i[b],!0),p+=2;if(e)return e({buffer:v,view:m});postMessage({buffer:v,view:m})}if(t.noWorker)i(t,(function(t){e(t.buffer,t.view)}));else{var n,o,r,s=(n=i,o=y.createObjectURL(new Blob([n.toString(),";this.onmessage =  function (eee) {"+n.name+"(eee.data);}"],{type:"application/javascript"})),(r=new Worker(o)).workerURL=o,r);s.onmessage=function(t){e(t.data.buffer,t.data.view),y.revokeObjectURL(s.workerURL),s.terminate()},s.postMessage(t)}}!0===e.leftChannel&&(c=1),1===e.numberOfAudioChannels&&(c=1),(!c||c<1)&&(c=2),e.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+c),void 0===e.checkForInactiveTracks&&(e.checkForInactiveTracks=!0),this.record=function(){if(!1===f())throw"Please make sure MediaStream is active.";g(),k=w=!1,s=!0,void 0!==e.timeSlice&&M()},this.stop=function(t){t=t||function(){},s=!1,l({desiredSampRate:h,sampleRate:b,numberOfAudioChannels:c,internalInterleavedLength:a,leftBuffers:o,rightBuffers:1===c?[]:r,noWorker:e.noWorker},(function(e,i){n.blob=new Blob([i],{type:"audio/wav"}),n.buffer=new ArrayBuffer(i.buffer.byteLength),n.view=i,n.sampleRate=h||b,n.bufferSize=p,n.length=a,k=!1,t&&t(n.blob)}))},void 0===u.Storage&&(u.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),u.Storage.AudioContextConstructor&&"closed"!==u.Storage.AudioContextConstructor.state||(u.Storage.AudioContextConstructor=new u.Storage.AudioContext);var d=u.Storage.AudioContextConstructor,v=d.createMediaStreamSource(t),m=[0,256,512,1024,2048,4096,8192,16384],p=void 0===e.bufferSize?4096:e.bufferSize;if(-1===m.indexOf(p)&&(e.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(m,null,"\t"))),d.createJavaScriptNode)i=d.createJavaScriptNode(p,c,c);else{if(!d.createScriptProcessor)throw"WebAudio API has no support on this browser.";i=d.createScriptProcessor(p,c,c)}v.connect(i),e.bufferSize||(p=i.bufferSize);var b=void 0!==e.sampleRate?e.sampleRate:d.sampleRate||44100;(b<22050||b>96e3)&&(e.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),e.disableLogs||e.desiredSampRate&&console.log("Desired sample-rate: "+e.desiredSampRate);var w=!1;function g(){o=[],r=[],a=0,k=!1,s=!1,w=!1,d=null,n.leftchannel=o,n.rightchannel=r,n.numberOfAudioChannels=c,n.desiredSampRate=h,n.sampleRate=b,n.recordingLength=a,j={left:[],right:[],recordingLength:0}}function A(){i&&(i.onaudioprocess=null,i.disconnect(),i=null),v&&(v.disconnect(),v=null),g()}this.pause=function(){w=!0},this.resume=function(){if(!1===f())throw"Please make sure MediaStream is active.";if(!s)return e.disableLogs||console.log("Seems recording has been restarted."),void this.record();w=!1},this.clearRecordedData=function(){e.checkForInactiveTracks=!1,s&&this.stop(A),A()},this.name="StereoAudioRecorder",this.toString=function(){return this.name};var k=!1;i.onaudioprocess=function(t){if(!w)if(!1===f()&&(e.disableLogs||console.log("MediaStream seems stopped."),i.disconnect(),s=!1),s){k||(k=!0,e.onAudioProcessStarted&&e.onAudioProcessStarted(),e.initCallback&&e.initCallback());var u=t.inputBuffer.getChannelData(0),h=new Float32Array(u);if(o.push(h),2===c){var l=t.inputBuffer.getChannelData(1),d=new Float32Array(l);r.push(d)}a+=p,n.recordingLength=a,void 0!==e.timeSlice&&(j.recordingLength+=p,j.left.push(h),2===c&&j.right.push(d))}else v&&(v.disconnect(),v=null)},d.createMediaStreamDestination?i.connect(d.createMediaStreamDestination()):i.connect(d.destination),this.leftchannel=o,this.rightchannel=r,this.numberOfAudioChannels=c,this.desiredSampRate=h,this.sampleRate=b,n.recordingLength=a;var j={left:[],right:[],recordingLength:0};function M(){s&&"function"==typeof e.ondataavailable&&void 0!==e.timeSlice&&(j.left.length?(l({desiredSampRate:h,sampleRate:b,numberOfAudioChannels:c,internalInterleavedLength:j.recordingLength,leftBuffers:j.left,rightBuffers:1===c?[]:j.right},(function(t,i){var n=new Blob([i],{type:"audio/wav"});e.ondataavailable(n),setTimeout(M,e.timeSlice)})),j={left:[],right:[],recordingLength:0}):setTimeout(M,e.timeSlice))}}
/**
 * CanvasRecorder is a standalone class used by {@link RecordRTC} to bring HTML5-Canvas recording into video WebM. It uses HTML2Canvas library and runs top over {@link Whammy}.
 * @summary HTML2Canvas recording into video WebM.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef CanvasRecorder
 * @class
 * @example
 * var recorder = new CanvasRecorder(htmlElement, { disableLogs: true, useWhammyRecorder: true });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {HTMLElement} htmlElement - querySelector/getElementById/getElementsByTagName[0]/etc.
 * @param {object} config - {disableLogs:true, initCallback: function}
 */
function P(t,e){if("undefined"==typeof html2canvas)throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(e=e||{}).frameInterval||(e.frameInterval=10);var i=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(t){t in document.createElement("canvas")&&(i=!0)}));var n,o,r,s=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),u=50,a=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(s&&a&&a[2]&&(u=parseInt(a[2],10)),s&&u<52&&(i=!1),e.useWhammyRecorder&&(i=!1),i)if(e.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),t instanceof HTMLCanvasElement)n=t;else{if(!(t instanceof CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";n=t.canvas}else navigator.mozGetUserMedia&&(e.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(r=!0,i&&!e.useWhammyRecorder){var t;"captureStream"in n?t=n.captureStream(25):"mozCaptureStream"in n?t=n.mozCaptureStream(25):"webkitCaptureStream"in n&&(t=n.webkitCaptureStream(25));try{var s=new k;s.addTrack(S(t,"video")[0]),t=s}catch(t){}if(!t)throw"captureStream API are NOT available.";(o=new T(t,{mimeType:e.mimeType||"video/webm"})).record()}else d.frames=[],l=(new Date).getTime(),f();e.initCallback&&e.initCallback()},this.getWebPImages=function(i){if("canvas"===t.nodeName.toLowerCase()){var n=d.frames.length;d.frames.forEach((function(t,i){var o=n-i;e.disableLogs||console.log(o+"/"+n+" frames remaining"),e.onEncodingCallback&&e.onEncodingCallback(o,n);var r=t.image.toDataURL("image/webp",1);d.frames[i].image=r})),e.disableLogs||console.log("Generating WebM"),i()}else i()},this.stop=function(t){r=!1;var n=this;i&&o?o.stop(t):this.getWebPImages((function(){d.compile((function(i){e.disableLogs||console.log("Recording finished!"),n.blob=i,n.blob.forEach&&(n.blob=new Blob([],{type:"video/webm"})),t&&t(n.blob),d.frames=[]}))}))};var c=!1;function h(){d.frames=[],r=!1,c=!1}function f(){if(c)return l=(new Date).getTime(),setTimeout(f,500);if("canvas"===t.nodeName.toLowerCase()){var i=(new Date).getTime()-l;return l=(new Date).getTime(),d.frames.push({image:(n=document.createElement("canvas"),o=n.getContext("2d"),n.width=t.width,n.height=t.height,o.drawImage(t,0,0),n),duration:i}),void(r&&setTimeout(f,e.frameInterval))}var n,o;html2canvas(t,{grabMouse:void 0===e.showMousePointer||e.showMousePointer,onrendered:function(t){var i=(new Date).getTime()-l;if(!i)return setTimeout(f,e.frameInterval);l=(new Date).getTime(),d.frames.push({image:t.toDataURL("image/webp",1),duration:i}),r&&setTimeout(f,e.frameInterval)}})}this.pause=function(){c=!0,o instanceof T&&o.pause()},this.resume=function(){c=!1,o instanceof T?o.resume():r||this.record()},this.clearRecordedData=function(){r&&this.stop(h),h()},this.name="CanvasRecorder",this.toString=function(){return this.name};var l=(new Date).getTime(),d=new V.Video(100)}
/**
 * WhammyRecorder is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It runs top over {@link Whammy}.
 * @summary Video recording feature in Chrome.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WhammyRecorder
 * @class
 * @example
 * var recorder = new WhammyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {disableLogs: true, initCallback: function, video: HTMLVideoElement, etc.}
 */
function B(t,e){function i(t){t=void 0!==t?t:10;var e=(new Date).getTime()-a;return e?r?(a=(new Date).getTime(),setTimeout(i,100)):(a=(new Date).getTime(),u.paused&&u.play(),f.drawImage(u,0,0,h.width,h.height),c.frames.push({duration:e,image:h.toDataURL("image/webp")}),void(o||setTimeout(i,t,t))):setTimeout(i,t,t)}function n(t,e,i,n,o){var r=document.createElement("canvas");r.width=h.width,r.height=h.height;var s=r.getContext("2d"),u=[],a=-1===e,c=e&&e>0&&e<=t.length?e:t.length,f=0,l=0,d=0,v=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),m=i&&i>=0&&i<=1?i:0,y=n&&n>=0&&n<=1?n:0,p=!1;!function(t){var e=-1,i=t.length;!function n(){++e!==i?setTimeout((function(){t.functionToLoop(n,e)}),1):t.callback()}()}({length:c,functionToLoop:function(e,i){var n,o,r,c=function(){!p&&r-n<=r*y||(a&&(p=!0),u.push(t[i])),e()};if(p)c();else{var b=new Image;b.onload=function(){s.drawImage(b,0,0,h.width,h.height);var t=s.getImageData(0,0,h.width,h.height);n=0,o=t.data.length,r=t.data.length/4;for(var e=0;e<o;e+=4){var i={r:t.data[e],g:t.data[e+1],b:t.data[e+2]};Math.sqrt(Math.pow(i.r-f,2)+Math.pow(i.g-l,2)+Math.pow(i.b-d,2))<=v*m&&n++}c()},b.src=t[i].image}},callback:function(){(u=u.concat(t.slice(c))).length<=0&&u.push(t[t.length-1]),o(u)}})}(e=e||{}).frameInterval||(e.frameInterval=10),e.disableLogs||console.log("Using frames-interval:",e.frameInterval),this.record=function(){e.width||(e.width=320),e.height||(e.height=240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),h.width=e.canvas.width||320,h.height=e.canvas.height||240,f=h.getContext("2d"),e.video&&e.video instanceof HTMLVideoElement?(u=e.video.cloneNode(),e.initCallback&&e.initCallback()):(u=document.createElement("video"),O(t,u),u.onloadedmetadata=function(){e.initCallback&&e.initCallback()},u.width=e.video.width,u.height=e.video.height),u.muted=!0,u.play(),a=(new Date).getTime(),c=new V.Video,e.disableLogs||(console.log("canvas resolutions",h.width,"*",h.height),console.log("video width/height",u.width||h.width,"*",u.height||h.height)),i(e.frameInterval)};var o=!1;this.stop=function(t){t=t||function(){},o=!0;var i=this;setTimeout((function(){n(c.frames,-1,null,null,(function(n){c.frames=n,e.advertisement&&e.advertisement.length&&(c.frames=e.advertisement.concat(c.frames)),c.compile((function(e){i.blob=e,i.blob.forEach&&(i.blob=new Blob([],{type:"video/webm"})),t&&t(i.blob)}))}))}),10)};var r=!1;function s(){c.frames=[],o=!0,r=!1}this.pause=function(){r=!0},this.resume=function(){r=!1,o&&this.record()},this.clearRecordedData=function(){o||this.stop(s),s()},this.name="WhammyRecorder",this.toString=function(){return this.name};var u,a,c,h=document.createElement("canvas"),f=h.getContext("2d")}void 0!==m?x.AudioContext=m:"undefined"!=typeof webkitAudioContext&&(x.AudioContext=webkitAudioContext),void 0!==u&&(u.Storage=x),void 0!==u&&(u.MediaStreamRecorder=T),void 0!==u&&(u.StereoAudioRecorder=E),void 0!==u&&(u.CanvasRecorder=P),void 0!==u&&(u.WhammyRecorder=B);
/**
 * Whammy is a standalone class used by {@link RecordRTC} to bring video recording in Chrome. It is written by {@link https://github.com/antimatter15|antimatter15}
 * @summary A real time javascript webm encoder based on a canvas hack.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef Whammy
 * @class
 * @example
 * var recorder = new Whammy().Video(15);
 * recorder.add(context || canvas || dataURL);
 * var output = recorder.compile();
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */
var V=function(){function t(t){this.frames=[],this.duration=t||1,this.quality=.8}function e(t){function e(t,e,i){return[{data:t,id:231}].concat(i.map((function(t){var i=function(t){var e=0;t.keyframe&&(e|=128);t.invisible&&(e|=8);t.lacing&&(e|=t.lacing<<1);t.discardable&&(e|=1);if(t.trackNum>127)throw"TrackNumber > 127 not supported";return[128|t.trackNum,t.timecode>>8,255&t.timecode,e].map((function(t){return String.fromCharCode(t)})).join("")+t.frame}({discardable:0,frame:t.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(e)});return e+=t.duration,{data:i,id:163}})))}function i(t){for(var e=[];t>0;)e.push(255&t),t>>=8;return new Uint8Array(e.reverse())}function n(t){var e=[];t=(t.length%8?new Array(9-t.length%8).join("0"):"")+t;for(var i=0;i<t.length;i+=8)e.push(parseInt(t.substr(i,8),2));return new Uint8Array(e)}function o(t){for(var e=[],r=0;r<t.length;r++){var s=t[r].data;"object"==typeof s&&(s=o(s)),"number"==typeof s&&(s=n(s.toString(2))),"string"==typeof s&&(s=new Uint8Array(s.split("").map((function(t){return t.charCodeAt(0)}))));var u=s.size||s.byteLength||s.length,a=Math.ceil(Math.ceil(Math.log(u)/Math.log(2))/8),c=u.toString(2),h=new Array(7*a+7+1-c.length).join("0")+c,f=new Array(a).join("0")+"1"+h;e.push(i(t[r].id)),e.push(n(f)),e.push(s)}return new Blob(e,{type:"video/webm"})}function r(t,e){return parseInt(t.substr(e+4,4).split("").map((function(t){var e=t.charCodeAt(0).toString(2);return new Array(8-e.length+1).join("0")+e})).join(""),2)}function s(t){for(var e=0,i={};e<t.length;){var n=t.substr(e,4),o=r(t,e),u=t.substr(e+4+4,o);e+=8+o,i[n]=i[n]||[],"RIFF"===n||"LIST"===n?i[n].push(s(u)):i[n].push(u)}return i}var u=new function(t){var i=function(t){if(!t[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var e=t[0].width,i=t[0].height,n=t[0].duration,o=1;o<t.length;o++)n+=t[o].duration;return{duration:n,width:e,height:i}}(t);if(!i)return[];for(var n,r=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(n=i.duration,[].slice.call(new Uint8Array(new Float64Array([n]).buffer),0).map((function(t){return String.fromCharCode(t)})).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:i.width,id:176},{data:i.height,id:186}]}]}]}]}],s=0,u=0;s<t.length;){var a=[],c=0;do{a.push(t[s]),c+=t[s].duration,s++}while(s<t.length&&c<3e4);var h={id:524531317,data:e(u,0,a)};r[1].data.push(h),u+=c}return o(r)}(t.map((function(t){var e=function(t){for(var e=t.RIFF[0].WEBP[0],i=e.indexOf("*"),n=0,o=[];n<4;n++)o[n]=e.charCodeAt(i+3+n);return{width:16383&(o[1]<<8|o[0]),height:16383&(o[3]<<8|o[2]),data:e,riff:t}}(s(atob(t.image.slice(23))));return e.duration=t.duration,e})));postMessage(u)}return t.prototype.add=function(t,e){if("canvas"in t&&(t=t.canvas),"toDataURL"in t&&(t=t.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(t))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:t,duration:e||this.duration})},t.prototype.compile=function(t){var i,n,o,r=(i=e,n=y.createObjectURL(new Blob([i.toString(),"this.onmessage =  function (eee) {"+i.name+"(eee.data);}"],{type:"application/javascript"})),o=new Worker(n),y.revokeObjectURL(n),o);r.onmessage=function(e){e.data.error?console.error(e.data.error):t(e.data)},r.postMessage(this.frames)},{Video:t}}();void 0!==u&&(u.Whammy=V);
/**
 * DiskStorage is a standalone object used by {@link RecordRTC} to store recorded blobs in IndexedDB storage.
 * @summary Writing blobs into IndexedDB.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @example
 * DiskStorage.Store({
 *     audioBlob: yourAudioBlob,
 *     videoBlob: yourVideoBlob,
 *     gifBlob  : yourGifBlob
 * });
 * DiskStorage.Fetch(function(dataURL, type) {
 *     if(type === 'audioBlob') { }
 *     if(type === 'videoBlob') { }
 *     if(type === 'gifBlob')   { }
 * });
 * // DiskStorage.dataStoreName = 'recordRTC';
 * // DiskStorage.onError = function(error) { };
 * @property {function} init - This method must be called once to initialize IndexedDB ObjectStore. Though, it is auto-used internally.
 * @property {function} Fetch - This method fetches stored blobs from IndexedDB.
 * @property {function} Store - This method stores blobs in IndexedDB.
 * @property {function} onError - This function is invoked for any known/unknown error.
 * @property {string} dataStoreName - Name of the ObjectStore created in IndexedDB storage.
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 */var D={init:function(){var t=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var e,i=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),n=indexedDB.open(i,1);n.onerror=t.onError,n.onsuccess=function(){((e=n.result).onerror=t.onError,e.setVersion)?1!==e.version?e.setVersion(1).onsuccess=function(){o(e),r()}:r():r()},n.onupgradeneeded=function(t){o(t.target.result)}}else console.error("IndexedDB API are not available in this browser.");function o(e){e.createObjectStore(t.dataStoreName)}function r(){var i=e.transaction([t.dataStoreName],"readwrite");function n(e){i.objectStore(t.dataStoreName).get(e).onsuccess=function(i){t.callback&&t.callback(i.target.result,e)}}t.videoBlob&&i.objectStore(t.dataStoreName).put(t.videoBlob,"videoBlob"),t.gifBlob&&i.objectStore(t.dataStoreName).put(t.gifBlob,"gifBlob"),t.audioBlob&&i.objectStore(t.dataStoreName).put(t.audioBlob,"audioBlob"),n("audioBlob"),n("videoBlob"),n("gifBlob")}},Fetch:function(t){return this.callback=t,this.init(),this},Store:function(t){return this.audioBlob=t.audioBlob,this.videoBlob=t.videoBlob,this.gifBlob=t.gifBlob,this.init(),this},onError:function(t){console.error(JSON.stringify(t,null,"\t"))},dataStoreName:"recordRTC",dbName:null};
/**
 * GifRecorder is standalone calss used by {@link RecordRTC} to record video or canvas into animated gif.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef GifRecorder
 * @class
 * @example
 * var recorder = new GifRecorder(mediaStream || canvas || context, { onGifPreview: function, onGifRecordingStarted: function, width: 1280, height: 720, frameRate: 200, quality: 10 });
 * recorder.record();
 * recorder.stop(function(blob) {
 *     img.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object or HTMLCanvasElement or CanvasRenderingContext2D.
 * @param {object} config - {disableLogs:true, initCallback: function, width: 320, height: 240, frameRate: 200, quality: 10}
 */
function I(t,e){if("undefined"==typeof GIFEncoder){var i=document.createElement("script");i.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(i)}e=e||{};var n=t instanceof CanvasRenderingContext2D||t instanceof HTMLCanvasElement;this.record=function(){"undefined"!=typeof GIFEncoder&&u?(n||(e.width||(e.width=a.offsetWidth||320),e.height||(e.height=a.offsetHeight||240),e.video||(e.video={width:e.width,height:e.height}),e.canvas||(e.canvas={width:e.width,height:e.height}),r.width=e.canvas.width||320,r.height=e.canvas.height||240,a.width=e.video.width||320,a.height=e.video.height||240),(h=new GIFEncoder).setRepeat(0),h.setDelay(e.frameRate||200),h.setQuality(e.quality||10),h.start(),"function"==typeof e.onGifRecordingStarted&&e.onGifRecordingStarted(),f=l((function t(i){if(!0!==d.clearedRecordedData){if(o)return setTimeout((function(){t(i)}),100);f=l(t),void 0===typeof c&&(c=i),i-c<90||(!n&&a.paused&&a.play(),n||s.drawImage(a,0,0,r.width,r.height),e.onGifPreview&&e.onGifPreview(r.toDataURL("image/png")),h.addFrame(s),c=i)}})),e.initCallback&&e.initCallback()):setTimeout(d.record,1e3)},this.stop=function(t){t=t||function(){},f&&v(f),this.blob=new Blob([new Uint8Array(h.stream().bin)],{type:"image/gif"}),t(this.blob),h.stream().bin=[]};var o=!1;this.pause=function(){o=!0},this.resume=function(){o=!1},this.clearRecordedData=function(){d.clearedRecordedData=!0,h&&(h.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var r=document.createElement("canvas"),s=r.getContext("2d");n&&(t instanceof CanvasRenderingContext2D?r=(s=t).canvas:t instanceof HTMLCanvasElement&&(s=t.getContext("2d"),r=t));var u=!0;if(!n){var a=document.createElement("video");a.muted=!0,a.autoplay=!0,a.playsInline=!0,u=!1,a.onloadedmetadata=function(){u=!0},O(t,a),a.play()}var c,h,f=null,d=this}function _(t,e){!function(t){void 0===u&&t&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0!==global.console.log&&void 0!==global.console.error||(global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(t.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var t={getContext:function(){return t},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return t},t.HTMLVideoElement=function(){}),"undefined"==typeof location&&(t.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(t.screen={width:0,height:0}),void 0===c&&(t.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),t.window=global)}("undefined"!=typeof global?global:null),e=e||"multi-streams-mixer";var i=[],n=!1,o=document.createElement("canvas"),r=o.getContext("2d");o.style.opacity=0,o.style.position="absolute",o.style.zIndex=-1,o.style.top="-1000em",o.style.left="-1000em",o.className=e,(document.body||document.documentElement).appendChild(o),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var s=this,a=window.AudioContext;void 0===a&&("undefined"!=typeof webkitAudioContext&&(a=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(a=mozAudioContext));var c=window.URL;void 0===c&&"undefined"!=typeof webkitURL&&(c=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var h=window.MediaStream;void 0===h&&"undefined"!=typeof webkitMediaStream&&(h=webkitMediaStream),void 0!==h&&void 0===h.prototype.stop&&(h.prototype.stop=function(){this.getTracks().forEach((function(t){t.stop()}))});var f={};function l(){if(!n){var t=i.length,e=!1,r=[];if(i.forEach((function(t){t.stream||(t.stream={}),t.stream.fullcanvas?e=t:r.push(t)})),e)o.width=e.stream.width,o.height=e.stream.height;else if(r.length){o.width=t>1?2*r[0].width:r[0].width;var u=1;3!==t&&4!==t||(u=2),5!==t&&6!==t||(u=3),7!==t&&8!==t||(u=4),9!==t&&10!==t||(u=5),o.height=r[0].height*u}else o.width=s.width||360,o.height=s.height||240;e&&e instanceof HTMLVideoElement&&d(e),r.forEach((function(t,e){d(t,e)})),setTimeout(l,s.frameInterval)}}function d(t,e){if(!n){var i=0,o=0,s=t.width,u=t.height;1===e&&(i=t.width),2===e&&(o=t.height),3===e&&(i=t.width,o=t.height),4===e&&(o=2*t.height),5===e&&(i=t.width,o=2*t.height),6===e&&(o=3*t.height),7===e&&(i=t.width,o=3*t.height),void 0!==t.stream.left&&(i=t.stream.left),void 0!==t.stream.top&&(o=t.stream.top),void 0!==t.stream.width&&(s=t.stream.width),void 0!==t.stream.height&&(u=t.stream.height),r.drawImage(t,i,o,s,u),"function"==typeof t.stream.onRender&&t.stream.onRender(r,i,o,s,u,e)}}function v(t){var i=document.createElement("video");return function(t,e){"srcObject"in e?e.srcObject=t:"mozSrcObject"in e?e.mozSrcObject=t:e.srcObject=t}(t,i),i.className=e,i.muted=!0,i.volume=0,i.width=t.width||s.width||360,i.height=t.height||s.height||240,i.play(),i}function m(e){i=[],(e=e||t).forEach((function(t){if(t.getTracks().filter((function(t){return"video"===t.kind})).length){var e=v(t);e.stream=t,i.push(e)}}))}void 0!==a?f.AudioContext=a:"undefined"!=typeof webkitAudioContext&&(f.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){l()},this.appendStreams=function(e){if(!e)throw"First parameter is required.";e instanceof Array||(e=[e]),e.forEach((function(e){var n=new h;if(e.getTracks().filter((function(t){return"video"===t.kind})).length){var o=v(e);o.stream=e,i.push(o),n.addTrack(e.getTracks().filter((function(t){return"video"===t.kind}))[0])}if(e.getTracks().filter((function(t){return"audio"===t.kind})).length){var r=s.audioContext.createMediaStreamSource(e);s.audioDestination=s.audioContext.createMediaStreamDestination(),r.connect(s.audioDestination),n.addTrack(s.audioDestination.stream.getTracks().filter((function(t){return"audio"===t.kind}))[0])}t.push(n)}))},this.releaseStreams=function(){i=[],n=!0,s.gainNode&&(s.gainNode.disconnect(),s.gainNode=null),s.audioSources.length&&(s.audioSources.forEach((function(t){t.disconnect()})),s.audioSources=[]),s.audioDestination&&(s.audioDestination.disconnect(),s.audioDestination=null),s.audioContext&&s.audioContext.close(),s.audioContext=null,r.clearRect(0,0,o.width,o.height),o.stream&&(o.stream.stop(),o.stream=null)},this.resetVideoStreams=function(t){!t||t instanceof Array||(t=[t]),m(t)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){n=!1;var e=function(){var t;m(),"captureStream"in o?t=o.captureStream():"mozCaptureStream"in o?t=o.mozCaptureStream():s.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var e=new h;return t.getTracks().filter((function(t){return"video"===t.kind})).forEach((function(t){e.addTrack(t)})),o.stream=e,e}(),i=function(){f.AudioContextConstructor||(f.AudioContextConstructor=new f.AudioContext);s.audioContext=f.AudioContextConstructor,s.audioSources=[],!0===s.useGainNode&&(s.gainNode=s.audioContext.createGain(),s.gainNode.connect(s.audioContext.destination),s.gainNode.gain.value=0);var e=0;if(t.forEach((function(t){if(t.getTracks().filter((function(t){return"audio"===t.kind})).length){e++;var i=s.audioContext.createMediaStreamSource(t);!0===s.useGainNode&&i.connect(s.gainNode),s.audioSources.push(i)}})),!e)return;return s.audioDestination=s.audioContext.createMediaStreamDestination(),s.audioSources.forEach((function(t){t.connect(s.audioDestination)})),s.audioDestination.stream}();return i&&i.getTracks().filter((function(t){return"audio"===t.kind})).forEach((function(t){e.addTrack(t)})),t.forEach((function(t){t.fullcanvas})),e}}
/**
 * MultiStreamRecorder can record multiple videos in single container.
 * @summary Multi-videos recorder.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef MultiStreamRecorder
 * @class
 * @example
 * var options = {
 *     mimeType: 'video/webm'
 * }
 * var recorder = new MultiStreamRecorder(ArrayOfMediaStreams, options);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 *
 *     // or
 *     var blob = recorder.blob;
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStreams} mediaStreams - Array of MediaStreams.
 * @param {object} config - {disableLogs:true, frameInterval: 1, mimeType: "video/webm"}
 */
function F(t,e){t=t||[];var i,n,o=this;(e=e||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(e.frameInterval=10),e.video||(e.video={}),e.video.width||(e.video.width=360),e.video.height||(e.video.height=240),this.record=function(){var o;i=new _(t,e.elementClass||"multi-streams-mixer"),(o=[],t.forEach((function(t){S(t,"video").forEach((function(t){o.push(t)}))})),o).length&&(i.frameInterval=e.frameInterval||10,i.width=e.video.width||360,i.height=e.video.height||240,i.startDrawingFrames()),e.previewStream&&"function"==typeof e.previewStream&&e.previewStream(i.getMixedStream()),(n=new T(i.getMixedStream(),e)).record()},this.stop=function(t){n&&n.stop((function(e){o.blob=e,t(e),o.clearRecordedData()}))},this.pause=function(){n&&n.pause()},this.resume=function(){n&&n.resume()},this.clearRecordedData=function(){n&&(n.clearRecordedData(),n=null),i&&(i.releaseStreams(),i=null)},this.addStreams=function(o){if(!o)throw"First parameter is required.";o instanceof Array||(o=[o]),t.concat(o),n&&i&&(i.appendStreams(o),e.previewStream&&"function"==typeof e.previewStream&&e.previewStream(i.getMixedStream()))},this.resetVideoStreams=function(t){i&&(!t||t instanceof Array||(t=[t]),i.resetVideoStreams(t))},this.getMixer=function(){return i},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}
/**
 * WebAssemblyRecorder lets you create webm videos in JavaScript via WebAssembly. The library consumes raw RGBA32 buffers (4 bytes per pixel) and turns them into a webm video with the given framerate and quality. This makes it compatible out-of-the-box with ImageData from a CANVAS. With realtime mode you can also use webm-wasm for streaming webm videos.
 * @summary Video recording feature in Chrome, Firefox and maybe Edge.
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef WebAssemblyRecorder
 * @class
 * @example
 * var recorder = new WebAssemblyRecorder(mediaStream);
 * recorder.record();
 * recorder.stop(function(blob) {
 *     video.src = URL.createObjectURL(blob);
 * });
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - MediaStream object fetched using getUserMedia API or generated using captureStreamUntilEnded or WebAudio API.
 * @param {object} config - {webAssemblyPath:'webm-wasm.wasm',workerPath: 'webm-worker.js', frameRate: 30, width: 1920, height: 1080, bitrate: 1024, realtime: true}
 */
function W(t,e){var i,n,o;function r(){return new ReadableStream({start:function(n){var o=document.createElement("canvas"),r=document.createElement("video"),s=!0;r.srcObject=t,r.muted=!0,r.height=e.height,r.width=e.width,r.volume=0,r.onplaying=function(){o.width=e.width,o.height=e.height;var t=o.getContext("2d"),u=1e3/e.frameRate,a=setInterval((function(){if(i&&(clearInterval(a),n.close()),s&&(s=!1,e.onVideoProcessStarted&&e.onVideoProcessStarted()),t.drawImage(r,0,0),"closed"!==n._controlledReadableStream.state)try{n.enqueue(t.getImageData(0,0,e.width,e.height))}catch(t){}}),u)},r.play()}})}function s(t,a){if(!e.workerPath&&!a)return i=!1,void fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then((function(e){e.arrayBuffer().then((function(e){s(t,e)}))}));if(!e.workerPath&&a instanceof ArrayBuffer){var c=new Blob([a],{type:"text/javascript"});e.workerPath=y.createObjectURL(c)}e.workerPath||console.error("workerPath parameter is missing."),(n=new Worker(e.workerPath)).postMessage(e.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),n.addEventListener("message",(function(t){"READY"===t.data?(n.postMessage({width:e.width,height:e.height,bitrate:e.bitrate||1200,timebaseDen:e.frameRate||30,realtime:e.realtime}),r().pipeTo(new WritableStream({write:function(t){i?console.error("Got image, but recorder is finished!"):n.postMessage(t.data.buffer,[t.data.buffer])}}))):t.data&&(o||u.push(t.data))}))}"undefined"!=typeof ReadableStream&&"undefined"!=typeof WritableStream||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(e=e||{}).width=e.width||640,e.height=e.height||480,e.frameRate=e.frameRate||30,e.bitrate=e.bitrate||1200,e.realtime=e.realtime||!0,this.record=function(){u=[],o=!1,this.blob=null,s(t),"function"==typeof e.initCallback&&e.initCallback()},this.pause=function(){o=!0},this.resume=function(){o=!1};var u=[];this.stop=function(t){i=!0;var e=this;!function(t){n?(n.addEventListener("message",(function(e){null===e.data&&(n.terminate(),n=null,t&&t())})),n.postMessage(null)):t&&t()}((function(){e.blob=new Blob(u,{type:"video/webm"}),t(e.blob)}))},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){u=[],o=!1,this.blob=null},this.blob=null}void 0!==u&&(u.DiskStorage=D),void 0!==u&&(u.GifRecorder=I),void 0===u&&("undefined"!=typeof module&&(module.exports=_),"function"==typeof define&&define.amd&&define("MultiStreamsMixer",[],(function(){return _}))),void 0!==u&&(u.MultiStreamRecorder=F),void 0!==u&&(u.RecordRTCPromisesHandler=
/**
 * RecordRTCPromisesHandler adds promises support in {@link RecordRTC}. Try a {@link https://github.com/muaz-khan/RecordRTC/blob/master/simple-demos/RecordRTCPromisesHandler.html|demo here}
 * @summary Promises for {@link RecordRTC}
 * @license {@link https://github.com/muaz-khan/RecordRTC/blob/master/LICENSE|MIT}
 * @author {@link https://MuazKhan.com|Muaz Khan}
 * @typedef RecordRTCPromisesHandler
 * @class
 * @example
 * var recorder = new RecordRTCPromisesHandler(mediaStream, options);
 * recorder.startRecording()
 *         .then(successCB)
 *         .catch(errorCB);
 * // Note: You can access all RecordRTC API using "recorder.recordRTC" e.g. 
 * recorder.recordRTC.onStateChanged = function(state) {};
 * recorder.recordRTC.setRecordingDuration(5000);
 * @see {@link https://github.com/muaz-khan/RecordRTC|RecordRTC Source Code}
 * @param {MediaStream} mediaStream - Single media-stream object, array of media-streams, html-canvas-element, etc.
 * @param {object} config - {type:"video", recorderType: MediaStreamRecorder, disableLogs: true, numberOfAudioChannels: 1, bufferSize: 0, sampleRate: 0, video: HTMLVideoElement, etc.}
 * @throws Will throw an error if "new" keyword is not used to initiate "RecordRTCPromisesHandler". Also throws error if first argument "MediaStream" is missing.
 * @requires {@link RecordRTC}
 */
function(t,e){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===t)throw'First argument "MediaStream" is required.';var i=this;i.recordRTC=new u(t,e),this.startRecording=function(){return new Promise((function(t,e){try{i.recordRTC.startRecording(),t()}catch(t){e(t)}}))},this.stopRecording=function(){return new Promise((function(t,e){try{i.recordRTC.stopRecording((function(n){i.blob=i.recordRTC.getBlob(),i.blob&&i.blob.size?t(n):e("Empty blob.",i.blob)}))}catch(t){e(t)}}))},this.pauseRecording=function(){return new Promise((function(t,e){try{i.recordRTC.pauseRecording(),t()}catch(t){e(t)}}))},this.resumeRecording=function(){return new Promise((function(t,e){try{i.recordRTC.resumeRecording(),t()}catch(t){e(t)}}))},this.getDataURL=function(t){return new Promise((function(t,e){try{i.recordRTC.getDataURL((function(e){t(e)}))}catch(t){e(t)}}))},this.getBlob=function(){return new Promise((function(t,e){try{t(i.recordRTC.getBlob())}catch(t){e(t)}}))},this.getInternalRecorder=function(){return new Promise((function(t,e){try{t(i.recordRTC.getInternalRecorder())}catch(t){e(t)}}))},this.reset=function(){return new Promise((function(t,e){try{t(i.recordRTC.reset())}catch(t){e(t)}}))},this.destroy=function(){return new Promise((function(t,e){try{t(i.recordRTC.destroy())}catch(t){e(t)}}))},this.getState=function(){return new Promise((function(t,e){try{t(i.recordRTC.getState())}catch(t){e(t)}}))},this.blob=null,this.version="5.6.2"}),void 0!==u&&(u.WebAssemblyRecorder=W);var L,U,$=Object.freeze({__proto__:null});
/*!
 * wavesurfer.js 6.6.4 (2023-06-10)
 * https://wavesurfer-js.org
 * @license BSD-3-Clause
 */L=self,U=()=>{return t={"./src/drawer.canvasentry.js":
/*!***********************************!*\
  !*** ./src/drawer.canvasentry.js ***!
  \***********************************/(t,e,i)=>{Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var n=r(i(/*! ./util/style */"./src/util/style.js")),o=r(i(/*! ./util/get-id */"./src/util/get-id.js"));function r(t){return t&&t.i?t:{default:t}}function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,r=void 0,r=function(t,e){if("object"!==s(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===s(r)?r:String(r)),n)}var o,r}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.wave=null,this.waveCtx=null,this.progress=null,this.progressCtx=null,this.start=0,this.end=1,this.id=(0,o.default)(void 0!==this.constructor.name?this.constructor.name.toLowerCase()+"_":"canvasentry_"),this.canvasContextAttributes={}}var e,i,r;return e=t,i=[{key:"initWave",value:function(t){this.wave=t,this.waveCtx=this.wave.getContext("2d",this.canvasContextAttributes)}},{key:"initProgress",value:function(t){this.progress=t,this.progressCtx=this.progress.getContext("2d",this.canvasContextAttributes)}},{key:"updateDimensions",value:function(t,e,i,o){this.start=this.wave.offsetLeft/e||0,this.end=this.start+t/e,this.wave.width=i,this.wave.height=o;var r={width:t+"px"};(0,n.default)(this.wave,r),this.hasProgressCanvas&&(this.progress.width=i,this.progress.height=o,(0,n.default)(this.progress,r))}},{key:"clearWave",value:function(){this.waveCtx.clearRect(0,0,this.waveCtx.canvas.width,this.waveCtx.canvas.height),this.hasProgressCanvas&&this.progressCtx.clearRect(0,0,this.progressCtx.canvas.width,this.progressCtx.canvas.height)}},{key:"setFillStyles",value:function(t,e){this.waveCtx.fillStyle=this.getFillStyle(this.waveCtx,t),this.hasProgressCanvas&&(this.progressCtx.fillStyle=this.getFillStyle(this.progressCtx,e))}},{key:"getFillStyle",value:function(t,e){if("string"==typeof e||e instanceof CanvasGradient)return e;var i=t.createLinearGradient(0,0,0,t.canvas.height);return e.forEach((function(t,n){return i.addColorStop(n/e.length,t)})),i}},{key:"applyCanvasTransforms",value:function(t){t&&(this.waveCtx.setTransform(0,1,1,0,0,0),this.hasProgressCanvas&&this.progressCtx.setTransform(0,1,1,0,0,0))}},{key:"fillRects",value:function(t,e,i,n,o){this.fillRectToContext(this.waveCtx,t,e,i,n,o),this.hasProgressCanvas&&this.fillRectToContext(this.progressCtx,t,e,i,n,o)}},{key:"fillRectToContext",value:function(t,e,i,n,o,r){t&&(r?this.drawRoundedRect(t,e,i,n,o,r):t.fillRect(e,i,n,o))}},{key:"drawRoundedRect",value:function(t,e,i,n,o,r){0!==o&&(o<0&&(i-=o*=-1),t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+n-r,i),t.quadraticCurveTo(e+n,i,e+n,i+r),t.lineTo(e+n,i+o-r),t.quadraticCurveTo(e+n,i+o,e+n-r,i+o),t.lineTo(e+r,i+o),t.quadraticCurveTo(e,i+o,e,i+o-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath(),t.fill())}},{key:"drawLines",value:function(t,e,i,n,o,r){this.drawLineToContext(this.waveCtx,t,e,i,n,o,r),this.hasProgressCanvas&&this.drawLineToContext(this.progressCtx,t,e,i,n,o,r)}},{key:"drawLineToContext",value:function(t,e,i,n,o,r,s){if(t){var u,a,c,h=e.length/2,f=Math.round(h*this.start),l=f,d=Math.round(h*this.end)+1,v=this.wave.width/(d-l-1),m=n+o,y=i/n;for(t.beginPath(),t.moveTo((l-f)*v,m),t.lineTo((l-f)*v,m-Math.round((e[2*l]||0)/y)),u=l;u<d;u++)a=e[2*u]||0,c=Math.round(a/y),t.lineTo((u-f)*v+this.halfPixel,m-c);for(var p=d-1;p>=l;p--)a=e[2*p+1]||0,c=Math.round(a/y),t.lineTo((p-f)*v+this.halfPixel,m-c);t.lineTo((l-f)*v,m-Math.round((e[2*l+1]||0)/y)),t.closePath(),t.fill()}}},{key:"destroy",value:function(){this.waveCtx=null,this.wave=null,this.progressCtx=null,this.progress=null}},{key:"getImage",value:function(t,e,i){var n=this;return"blob"===i?new Promise((function(i){n.wave.toBlob(i,t,e)})):"dataURL"===i?this.wave.toDataURL(t,e):void 0}}],i&&u(e.prototype,i),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.default=a,t.exports=e.default},"./src/drawer.js":
/*!***********************!*\
  !*** ./src/drawer.js ***!
  \***********************/(t,e,i)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var o=function(t,e){if(!e&&t&&t.i)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var i=r(e);if(i&&i.has(t))return i.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var a=s?Object.getOwnPropertyDescriptor(t,u):null;a&&(a.get||a.set)?Object.defineProperty(o,u,a):o[u]=t[u]}return o.default=t,i&&i.set(t,o),o}(i(/*! ./util */"./src/util/index.js"));function r(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(r=function(t){return t?i:e})(t)}function s(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(r=o.key,s=void 0,s=function(t,e){if("object"!==n(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===n(s)?s:String(s)),o)}var r,s}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,o=c(t);if(e){var r=c(this).constructor;i=Reflect.construct(o,arguments,r)}else i=o.apply(this,arguments);return function(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}var h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(c,t);var e,i,n,r=a(c);function c(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,c),(i=r.call(this)).container=o.withOrientation(t,e.vertical),i.params=e,i.width=0,i.height=e.height*i.params.pixelRatio,i.lastPos=0,i.wrapper=null,i}return e=c,i=[{key:"style",value:function(t,e){return o.style(t,e)}},{key:"createWrapper",value:function(){this.wrapper=o.withOrientation(this.container.appendChild(document.createElement("wave")),this.params.vertical),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",cursor:this.params.hideCursor?"none":"auto",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()}},{key:"handleEvent",value:function(t,e){!e&&t.preventDefault();var i,n=o.withOrientation(t.targetTouches?t.targetTouches[0]:t,this.params.vertical).clientX,r=this.wrapper.getBoundingClientRect(),s=this.width,u=this.getWidth(),a=this.getProgressPixels(r,n);return i=!this.params.fillParent&&s<u?a*(this.params.pixelRatio/s)||0:(a+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,o.clamp(i,0,1)}},{key:"getProgressPixels",value:function(t,e){return this.params.rtl?t.right-e:e-t.left}},{key:"setupWrapperEvents",value:function(){var t=this;this.wrapper.addEventListener("click",(function(e){var i=o.withOrientation(e,t.params.vertical),n=t.wrapper.offsetHeight-t.wrapper.clientHeight;if(0!==n){var r=t.wrapper.getBoundingClientRect();if(i.clientY>=r.bottom-n)return}t.params.interact&&t.fireEvent("click",e,t.handleEvent(e))})),this.wrapper.addEventListener("dblclick",(function(e){t.params.interact&&t.fireEvent("dblclick",e,t.handleEvent(e))})),this.wrapper.addEventListener("scroll",(function(e){return t.fireEvent("scroll",e)}))}},{key:"drawPeaks",value:function(t,e,i,n){this.setWidth(e)||this.clearWave(),this.params.barWidth?this.drawBars(t,0,i,n):this.drawWave(t,0,i,n)}},{key:"resetScroll",value:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)}},{key:"recenter",value:function(t){var e=this.wrapper.scrollWidth*t;this.recenterOnPosition(e,!0)}},{key:"recenterOnPosition",value:function(t,e){var i=this.wrapper.scrollLeft,n=~~(this.wrapper.clientWidth/2),o=this.wrapper.scrollWidth-this.wrapper.clientWidth,r=t-n,s=r-i;if(0!=o){if(!e&&-n<=s&&s<n){var u=this.params.autoCenterRate;u/=n,u*=o,r=i+(s=Math.max(-u,Math.min(u,s)))}(r=Math.max(0,Math.min(o,r)))!=i&&(this.wrapper.scrollLeft=r)}}},{key:"getScrollX",value:function(){var t=0;if(this.wrapper){var e=this.params.pixelRatio;if(t=Math.round(this.wrapper.scrollLeft*e),this.params.scrollParent){var i=~~(this.wrapper.scrollWidth*e-this.getWidth());t=Math.min(i,Math.max(0,t))}}return t}},{key:"getWidth",value:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function(t){if(this.width==t)return!1;if(this.width=t,this.params.fillParent||this.params.scrollParent)this.style(this.wrapper,{width:""});else{var e=~~(this.width/this.params.pixelRatio)+"px";this.style(this.wrapper,{width:e})}return this.updateSize(),!0}},{key:"setHeight",value:function(t){return t!=this.height&&(this.height=t,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"progress",value:function(t){var e=1/this.params.pixelRatio,i=Math.round(t*this.width)*e;if(i<this.lastPos||i-this.lastPos>=e){if(this.lastPos=i,this.params.scrollParent&&this.params.autoCenter){var n=~~(this.wrapper.scrollWidth*t);this.recenterOnPosition(n,this.params.autoCenterImmediately)}this.updateProgress(i)}}},{key:"destroy",value:function(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container.domElement&&this.container.removeChild(this.wrapper.domElement),this.wrapper=null)}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(t,e,i,n){}},{key:"drawWave",value:function(t,e,i,n){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(t){}}],i&&s(e.prototype,i),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),c}(o.Observer);e.default=h,t.exports=e.default},"./src/drawer.multicanvas.js":
/*!***********************************!*\
  !*** ./src/drawer.multicanvas.js ***!
  \***********************************/(t,e,i)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var o=a(i(/*! ./drawer */"./src/drawer.js")),r=function(t,e){if(!e&&t&&t.i)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var i=u(e);if(i&&i.has(t))return i.get(t);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=r?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=t[s]}return o.default=t,i&&i.set(t,o),o}(i(/*! ./util */"./src/util/index.js")),s=a(i(/*! ./drawer.canvasentry */"./src/drawer.canvasentry.js"));function u(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(u=function(t){return t?i:e})(t)}function a(t){return t&&t.i?t:{default:t}}function c(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(r=o.key,s=void 0,s=function(t,e){if("object"!==n(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===n(s)?s:String(s)),o)}var r,s}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,o=l(t);if(e){var r=l(this).constructor;i=Reflect.construct(o,arguments,r)}else i=o.apply(this,arguments);return function(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(u,t);var e,i,n,o=f(u);function u(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,u),(i=o.call(this,t,e)).maxCanvasWidth=e.maxCanvasWidth,i.maxCanvasElementWidth=Math.round(e.maxCanvasWidth/e.pixelRatio),i.hasProgressCanvas=e.waveColor!=e.progressColor,i.halfPixel=.5/e.pixelRatio,i.canvases=[],i.progressWave=null,i.EntryClass=s.default,i.canvasContextAttributes=e.drawingContextAttributes,i.overlap=2*Math.ceil(e.pixelRatio/2),i.barRadius=e.barRadius||0,i.vertical=e.vertical,i}return e=u,i=[{key:"init",value:function(){this.createWrapper(),this.createElements()}},{key:"createElements",value:function(){this.progressWave=r.withOrientation(this.wrapper.appendChild(document.createElement("wave")),this.params.vertical),this.style(this.progressWave,{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"}),this.addCanvas(),this.updateCursor()}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function(){for(var t=this,e=Math.round(this.width/this.params.pixelRatio),i=Math.ceil(e/(this.maxCanvasElementWidth+this.overlap));this.canvases.length<i;)this.addCanvas();for(;this.canvases.length>i;)this.removeCanvas();var n=this.maxCanvasWidth+this.overlap,o=this.canvases.length-1;this.canvases.forEach((function(e,i){i==o&&(n=t.width-t.maxCanvasWidth*o),t.updateDimensions(e,n,t.height),e.clearWave()}))}},{key:"addCanvas",value:function(){var t=new this.EntryClass;t.canvasContextAttributes=this.canvasContextAttributes,t.hasProgressCanvas=this.hasProgressCanvas,t.halfPixel=this.halfPixel;var e=this.maxCanvasElementWidth*this.canvases.length,i=r.withOrientation(this.wrapper.appendChild(document.createElement("canvas")),this.params.vertical);if(this.style(i,{position:"absolute",zIndex:2,left:e+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"}),t.initWave(i),this.hasProgressCanvas){var n=r.withOrientation(this.progressWave.appendChild(document.createElement("canvas")),this.params.vertical);this.style(n,{position:"absolute",left:e+"px",top:0,bottom:0,height:"100%"}),t.initProgress(n)}this.canvases.push(t)}},{key:"removeCanvas",value:function(){var t=this.canvases[this.canvases.length-1];t.wave.parentElement.removeChild(t.wave.domElement),this.hasProgressCanvas&&t.progress.parentElement.removeChild(t.progress.domElement),t&&(t.destroy(),t=null),this.canvases.pop()}},{key:"updateDimensions",value:function(t,e,i){var n=Math.round(e/this.params.pixelRatio),o=Math.round(this.width/this.params.pixelRatio);t.updateDimensions(n,o,e,i),this.style(this.progressWave,{display:"block"})}},{key:"clearWave",value:function(){var t=this;r.frame((function(){t.canvases.forEach((function(t){return t.clearWave()}))}))()}},{key:"drawBars",value:function(t,e,i,n){var o=this;return this.prepareDraw(t,e,i,n,(function(t){var e=t.absmax,r=t.hasMinVals;t.height;var s=t.offsetY,u=t.halfH,a=t.peaks,c=t.channelIndex;if(void 0!==i)for(var h=r?2:1,f=a.length/h,l=o.params.barWidth*o.params.pixelRatio,d=l+(null===o.params.barGap?Math.max(o.params.pixelRatio,~~(l/2)):Math.max(o.params.pixelRatio,o.params.barGap*o.params.pixelRatio)),v=f/o.width,m=n,y=i;y<m;y+=d){var p=0,b=Math.floor(y*v)*h,w=Math.floor((y+d)*v)*h;do{var g=Math.abs(a[b]);g>p&&(p=g),b+=h}while(b<w);var A=Math.round(p/e*u);o.params.barMinHeight&&(A=Math.max(A,o.params.barMinHeight)),o.fillRect(y+o.halfPixel,u-A+s,l+o.halfPixel,2*A,o.barRadius,c)}}))}},{key:"drawWave",value:function(t,e,i,n){var o=this;return this.prepareDraw(t,e,i,n,(function(t){var e=t.absmax,r=t.hasMinVals;t.height;var s=t.offsetY,u=t.halfH,a=t.peaks,c=t.channelIndex;if(!r){for(var h=[],f=a.length,l=0;l<f;l++)h[2*l]=a[l],h[2*l+1]=-a[l];a=h}void 0!==i&&o.drawLine(a,e,u,s,i,n,c),o.fillRect(0,u+s-o.halfPixel,o.width,o.halfPixel,o.barRadius,c)}))}},{key:"drawLine",value:function(t,e,i,n,o,r,s){var u=this,a=this.params.splitChannelsOptions.channelColors[s]||{},c=a.waveColor,h=a.progressColor;this.canvases.forEach((function(s,a){u.setFillStyles(s,c,h),u.applyCanvasTransforms(s,u.params.vertical),s.drawLines(t,e,i,n,o,r)}))}},{key:"fillRect",value:function(t,e,i,n,o,r){for(var s=Math.floor(t/this.maxCanvasWidth),u=Math.min(Math.ceil((t+i)/this.maxCanvasWidth)+1,this.canvases.length),a=s;a<u;a++){var c=this.canvases[a],h=a*this.maxCanvasWidth,f={x1:Math.max(t,a*this.maxCanvasWidth),y1:e,x2:Math.min(t+i,a*this.maxCanvasWidth+c.wave.width),y2:e+n};if(f.x1<f.x2){var l=this.params.splitChannelsOptions.channelColors[r]||{},d=l.waveColor,v=l.progressColor;this.setFillStyles(c,d,v),this.applyCanvasTransforms(c,this.params.vertical),c.fillRects(f.x1-h,f.y1,f.x2-f.x1,f.y2-f.y1,o)}}}},{key:"hideChannel",value:function(t){return this.params.splitChannels&&this.params.splitChannelsOptions.filterChannels.includes(t)}},{key:"prepareDraw",value:function(t,e,i,n,o,s,u){var a=this;return r.frame((function(){if(t[0]instanceof Array){var c=t;if(a.params.splitChannels){var h,f=c.filter((function(t,e){return!a.hideChannel(e)}));return a.params.splitChannelsOptions.overlay||a.setHeight(Math.max(f.length,1)*a.params.height*a.params.pixelRatio),a.params.splitChannelsOptions&&a.params.splitChannelsOptions.relativeNormalization&&(h=r.max(c.map((function(t){return r.absMax(t)})))),c.forEach((function(t,e){return a.prepareDraw(t,e,i,n,o,f.indexOf(t),h)}))}t=c[0]}if(!a.hideChannel(e)){var l=1/a.params.barHeight;a.params.normalize&&(l=void 0===u?r.absMax(t):u);var d=[].some.call(t,(function(t){return t<0})),v=a.params.height*a.params.pixelRatio,m=v/2,y=v*s||0;return a.params.splitChannelsOptions&&a.params.splitChannelsOptions.overlay&&(y=0),o({absmax:l,hasMinVals:d,height:v,offsetY:y,halfH:m,peaks:t,channelIndex:e})}}))()}},{key:"setFillStyles",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.params.waveColor,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.params.progressColor;t.setFillStyles(e,i)}},{key:"applyCanvasTransforms",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.applyCanvasTransforms(e)}},{key:"getImage",value:function(t,e,i){if("blob"===i)return Promise.all(this.canvases.map((function(n){return n.getImage(t,e,i)})));if("dataURL"===i){var n=this.canvases.map((function(n){return n.getImage(t,e,i)}));return n.length>1?n:n[0]}}},{key:"updateProgress",value:function(t){this.style(this.progressWave,{width:t+"px"})}}],i&&c(e.prototype,i),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),u}(o.default);e.default=d,t.exports=e.default},"./src/mediaelement-webaudio.js":
/*!**************************************!*\
  !*** ./src/mediaelement-webaudio.js ***!
  \**************************************/(t,e,i)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}var o;function r(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(r=o.key,s=void 0,s=function(t,e){if("object"!==n(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===n(s)?s:String(s)),o)}var r,s}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},s.apply(this,arguments)}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,o=c(t);if(e){var r=c(this).constructor;i=Reflect.construct(o,arguments,r)}else i=o.apply(this,arguments);return function(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var h=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(h,t);var e,i,n,o=a(h);function h(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),(e=o.call(this,t)).params=t,e.sourceMediaElement=null,e}return e=h,(i=[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer(),this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode()}},{key:"_load",value:function(t,e,i){s(c(h.prototype),"_load",this).call(this,t,e,i),this.createMediaElementSource(t)}},{key:"createMediaElementSource",value:function(t){this.sourceMediaElement=this.ac.createMediaElementSource(t),this.sourceMediaElement.connect(this.analyser)}},{key:"play",value:function(t,e){return this.resumeAudioContext(),s(c(h.prototype),"play",this).call(this,t,e)}},{key:"destroy",value:function(){s(c(h.prototype),"destroy",this).call(this),this.destroyWebAudio()}}])&&r(e.prototype,i),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),h}(((o=i(/*! ./mediaelement */"./src/mediaelement.js"))&&o.i?o:{default:o}).default);e.default=h,t.exports=e.default},"./src/mediaelement.js":
/*!*****************************!*\
  !*** ./src/mediaelement.js ***!
  \*****************************/(t,e,i)=>{function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var o,r=(o=i(/*! ./webaudio */"./src/webaudio.js"))&&o.i?o:{default:o},s=function(t,e){if(!e&&t&&t.i)return t;if(null===t||"object"!==n(t)&&"function"!=typeof t)return{default:t};var i=u(e);if(i&&i.has(t))return i.get(t);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if("default"!==s&&Object.prototype.hasOwnProperty.call(t,s)){var a=r?Object.getOwnPropertyDescriptor(t,s):null;a&&(a.get||a.set)?Object.defineProperty(o,s,a):o[s]=t[s]}return o.default=t,i&&i.set(t,o),o}(i(/*! ./util */"./src/util/index.js"));function u(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(u=function(t){return t?i:e})(t)}function a(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(r=o.key,s=void 0,s=function(t,e){if("object"!==n(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var o=i.call(t,e||"default");if("object"!==n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===n(s)?s:String(s)),o)}var r,s}function c(){return c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:i):o.value}},c.apply(this,arguments)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function f(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,o=l(t);if(e){var r=l(this).constructor;i=Reflect.construct(o,arguments,r)}else i=o.apply(this,arguments);return function(t,e){if(e&&("object"===n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,i)}}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(r,t);var e,i,n,o=f(r);function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=o.call(this,t)).params=t,e.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0},e.mediaType=t.mediaType.toLowerCase(),e.elementPosition=t.elementPosition,e.peaks=null,e.playbackRate=1,e.volume=1,e.isMuted=!1,e.buffer=null,e.onPlayEnd=null,e.mediaListeners={},e}return e=r,(i=[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer()}},{key:"_setupMediaListeners",value:function(){var t=this;this.mediaListeners.error=function(){t.fireEvent("error","Error loading media element")},this.mediaListeners.waiting=function(){t.fireEvent("waiting")},this.mediaListeners.canplay=function(){t.fireEvent("canplay")},this.mediaListeners.ended=function(){t.fireEvent("finish")},this.mediaListeners.play=function(){t.fireEvent("play")},this.mediaListeners.pause=function(){t.fireEvent("pause")},this.mediaListeners.seeked=function(e){t.fireEvent("seek")},this.mediaListeners.volumechange=function(e){t.isMuted=t.media.muted,t.isMuted?t.volume=0:t.volume=t.media.volume,t.fireEvent("volume")},Object.keys(this.mediaListeners).forEach((function(e){t.media.removeEventListener(e,t.mediaListeners[e]),t.media.addEventListener(e,t.mediaListeners[e])}))}},{key:"createTimer",value:function(){var t=this;this.on("play",(function e(){t.isPaused()||(t.fireEvent("audioprocess",t.getCurrentTime()),s.frame(e)())})),this.on("pause",(function(){t.fireEvent("audioprocess",t.getCurrentTime())}))}},{key:"load",value:function(t,e,i,n){var o=document.createElement(this.mediaType);o.controls=this.params.mediaControls,o.autoplay=this.params.autoplay||!1,o.preload=n??"auto",o.src=t,o.style.width="100%";var r=e.querySelector(this.mediaType);r&&e.removeChild(r),e.appendChild(o),this._load(o,i,n)}},{key:"loadElt",value:function(t,e){t.controls=this.params.mediaControls,t.autoplay=this.params.autoplay||!1,this._load(t,e,t.preload)}},{key:"_load",value:function(t,e,i){if(!(t instanceof HTMLMediaElement)||void 0===t.addEventListener)throw new Error("media parameter is not a valid media element");"function"!=typeof t.load||e&&"none"==i||t.load(),this.media=t,this._setupMediaListeners(),this.peaks=e,this.onPlayEnd=null,this.buffer=null,this.isMuted=t.muted,this.setPlaybackRate(this.playbackRate),this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration)return this.explicitDuration;var t=(this.buffer||this.media).duration;return t>=1/0&&(t=this.media.seekable.end(0)),t}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(t){this.playbackRate=t||1,this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(t){null==t||isNaN(t)||(this.media.currentTime=t),this.clearPlayEnd()}},{key:"play",value:function(t,e){this.seekTo(t);var i=this.media.play();return e&&this.setPlayEnd(e),i}},{key:"pause",value:function(){var t;return this.media&&(t=this.media.pause()),this.clearPlayEnd(),t}},{key:"setPlayEnd",value:function(t){var e=this;this.clearPlayEnd(),this._onPlayEnd=function(i){i>=t&&(e.pause(),e.seekTo(t))},this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}},{key:"getPeaks",value:function(t,e,i){return this.buffer?c(l(r.prototype),"getPeaks",this).call(this,t,e,i):this.peaks||[]}},{key:"setSinkId",value:function(t){return t?this.media.setSinkId?this.media.setSinkId(t):Promise.reject(new Error("setSinkId is not supported in your browser")):Promise.reject(new Error("Invalid deviceId: "+t))}},{key:"getVolume",value:function(){return this.volume}},{key:"setVolume",value:function(t){this.volume=t,this.media.volume!==this.volume&&(this.media.volume=this.volume)}},{key:"setMute",value:function(t){this.isMuted=this.media.muted=t}},{key:"destroy",value:function(){var t=this;this.pause(),this.unAll(),this.destroyed=!0,Object.keys(this.mediaListeners).forEach((function(e){t.media&&t.media.removeEventListener(e,t.mediaListeners[e])})),this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}])&&a(e.prototype,i),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),r}(r.default);e.default=d,t.exports=e.default},"./src/peakcache.js":
/*!**************************!*\
  !*** ./src/peakcache.js ***!
  \**************************/(t,e)=>{function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(r=o.key,s=void 0,s=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!==i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===i(s)?s:String(s)),o)}var r,s}Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.clearPeakCache()}var e,i,o;return e=t,i=[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[],this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(t,e,i){t!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=t);for(var n=[],o=0;o<this.peakCacheRanges.length&&this.peakCacheRanges[o]<e;)o++;for(o%2==0&&n.push(e);o<this.peakCacheRanges.length&&this.peakCacheRanges[o]<=i;)n.push(this.peakCacheRanges[o]),o++;o%2==0&&n.push(i),n=n.filter((function(t,e,i){return 0==e?t!=i[e+1]:e==i.length-1?t!=i[e-1]:t!=i[e-1]&&t!=i[e+1]})),this.peakCacheRanges=this.peakCacheRanges.concat(n),this.peakCacheRanges=this.peakCacheRanges.sort((function(t,e){return t-e})).filter((function(t,e,i){return 0==e?t!=i[e+1]:e==i.length-1?t!=i[e-1]:t!=i[e-1]&&t!=i[e+1]}));var r=[];for(o=0;o<n.length;o+=2)r.push([n[o],n[o+1]]);return r}},{key:"getCacheRanges",value:function(){var t,e=[];for(t=0;t<this.peakCacheRanges.length;t+=2)e.push([this.peakCacheRanges[t],this.peakCacheRanges[t+1]]);return e}}],i&&n(e.prototype,i),o&&n(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.default=o,t.exports=e.default},"./src/util/absMax.js":
/*!****************************!*\
  !*** ./src/util/absMax.js ***!
  \****************************/(t,e,i)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(t){var e=(0,n.default)(t),i=(0,o.default)(t);return-i>e?-i:e};var n=r(i(/*! ./max */"./src/util/max.js")),o=r(i(/*! ./min */"./src/util/min.js"));function r(t){return t&&t.i?t:{default:t}}t.exports=e.default},"./src/util/clamp.js":
/*!***************************!*\
  !*** ./src/util/clamp.js ***!
  \***************************/(t,e)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(t,e,i){return Math.min(Math.max(e,t),i)},t.exports=e.default},"./src/util/fetch.js":
/*!***************************!*\
  !*** ./src/util/fetch.js ***!
  \***************************/(t,e,i)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(t){if(!t)throw new Error("fetch options missing");if(!t.url)throw new Error("fetch url missing");var e=new o.default,i=new Headers,n=new Request(t.url);e.controller=new AbortController,t&&t.requestHeaders&&t.requestHeaders.forEach((function(t){i.append(t.key,t.value)}));var r=t.responseType||"json",s={method:t.method||"GET",headers:i,mode:t.mode||"cors",credentials:t.credentials||"same-origin",cache:t.cache||"default",redirect:t.redirect||"follow",referrer:t.referrer||"client",signal:e.controller.signal};return fetch(n,s).then((function(t){e.response=t;var i=!0;t.body||(i=!1);var n=t.headers.get("content-length");return null===n&&(i=!1),i?(e.onProgress=function(t){e.fireEvent("progress",t)},new Response(new ReadableStream(new u(e,n,t)),s)):t})).then((function(t){var e;if(t.ok)switch(r){case"arraybuffer":return t.arrayBuffer();case"json":return t.json();case"blob":return t.blob();case"text":return t.text();default:e="Unknown responseType: "+r}throw e||(e="HTTP error status: "+t.status),new Error(e)})).then((function(t){e.fireEvent("success",t)})).catch((function(t){e.fireEvent("error",t)})),e.fetchRequest=n,e};var n,o=(n=i(/*! ./observer */"./src/util/observer.js"))&&n.i?n:{default:n};function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(o=n.key,s=void 0,s=function(t,e){if("object"!==r(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"),"symbol"===r(s)?s:String(s)),n)}var o,s}var u=function(){function t(e,i,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.instance=e,this.instance._reader=n.body.getReader(),this.total=parseInt(i,10),this.loaded=0}var e,i,n;return e=t,(i=[{key:"start",value:function(t){var e=this;!function i(){e.instance._reader.read().then((function(n){var o=n.done,r=n.value;if(o)return 0===e.total&&e.instance.onProgress.call(e.instance,{loaded:e.loaded,total:e.total,lengthComputable:!1}),void t.close();e.loaded+=r.byteLength,e.instance.onProgress.call(e.instance,{loaded:e.loaded,total:e.total,lengthComputable:!(0===e.total)}),t.enqueue(r),i()})).catch((function(e){t.error(e)}))}()}}])&&s(e.prototype,i),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports=e.default},"./src/util/frame.js":
/*!***************************!*\
  !*** ./src/util/frame.js ***!
  \***************************/(t,e,i)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(t){return function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return(0,o.default)((function(){return t.apply(void 0,i)}))}};var n,o=(n=i(/*! ./request-animation-frame */"./src/util/request-animation-frame.js"))&&n.i?n:{default:n};t.exports=e.default},"./src/util/get-id.js":
/*!****************************!*\
  !*** ./src/util/get-id.js ***!
  \****************************/(t,e)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(t){return void 0===t&&(t="wavesurfer_"),t+Math.random().toString(32).substring(2)},t.exports=e.default},"./src/util/index.js":
/*!***************************!*\
  !*** ./src/util/index.js ***!
  \***************************/(t,e,i)=>{Object.defineProperty(e,"i",{value:!0}),Object.defineProperty(e,"Observer",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(e,"absMax",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(e,"clamp",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(e,"debounce",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(e,"fetchFile",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(e,"frame",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(e,"getId",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(e,"ignoreSilenceMode",{enumerable:!0,get:function(){return y.default}}),Object.defineProperty(e,"max",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(e,"min",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(e,"preventClick",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(e,"requestAnimationFrame",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(e,"style",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(e,"withOrientation",{enumerable:!0,get:function(){return m.default}});var n=p(i(/*! ./get-id */"./src/util/get-id.js")),o=p(i(/*! ./max */"./src/util/max.js")),r=p(i(/*! ./min */"./src/util/min.js")),s=p(i(/*! ./absMax */"./src/util/absMax.js")),u=p(i(/*! ./observer */"./src/util/observer.js")),a=p(i(/*! ./style */"./src/util/style.js")),c=p(i(/*! ./request-animation-frame */"./src/util/request-animation-frame.js")),h=p(i(/*! ./frame */"./src/util/frame.js")),f=p(i(/*! debounce */"./node_modules/debounce/index.js")),l=p(i(/*! ./prevent-click */"./src/util/prevent-click.js")),d=p(i(/*! ./fetch */"./src/util/fetch.js")),v=p(i(/*! ./clamp */"./src/util/clamp.js")),m=p(i(/*! ./orientation */"./src/util/orientation.js")),y=p(i(/*! ./silence-mode */"./src/util/silence-mode.js"));function p(t){return t&&t.i?t:{default:t}}},"./src/util/max.js":
/*!*************************!*\
  !*** ./src/util/max.js ***!
  \*************************/(t,e)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(t){var e=-1/0;return Object.keys(t).forEach((function(i){t[i]>e&&(e=t[i])})),e},t.exports=e.default},"./src/util/min.js":
/*!*************************!*\
  !*** ./src/util/min.js ***!
  \*************************/(t,e)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(t){var e=Number(1/0);return Object.keys(t).forEach((function(i){t[i]<e&&(e=t[i])})),e},t.exports=e.default},"./src/util/observer.js":
/*!******************************!*\
  !*** ./src/util/observer.js ***!
  \******************************/(t,e)=>{function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(r=o.key,s=void 0,s=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,e||"default");if("object"!==i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(r,"string"),"symbol"===i(s)?s:String(s)),o)}var r,s}Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._disabledEventEmissions=[],this.handlers=null}var e,i,o;return e=t,i=[{key:"on",value:function(t,e){var i=this;this.handlers||(this.handlers={});var n=this.handlers[t];return n||(n=this.handlers[t]=[]),n.push(e),{name:t,callback:e,un:function(t,e){return i.un(t,e)}}}},{key:"un",value:function(t,e){if(this.handlers){var i,n=this.handlers[t];if(n)if(e)for(i=n.length-1;i>=0;i--)n[i]==e&&n.splice(i,1);else n.length=0}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(t,e){var i=this;return this.on(t,(function n(){for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];e.apply(i,r),setTimeout((function(){i.un(t,n)}),0)}))}},{key:"setDisabledEventEmissions",value:function(t){this._disabledEventEmissions=t}},{key:"_isDisabledEventEmission",value:function(t){return this._disabledEventEmissions&&this._disabledEventEmissions.includes(t)}},{key:"fireEvent",value:function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];if(this.handlers&&!this._isDisabledEventEmission(t)){var o=this.handlers[t];o&&o.forEach((function(t){t.apply(void 0,i)}))}}}],i&&n(e.prototype,i),o&&n(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.default=o,t.exports=e.default},"./src/util/orientation.js":
/*!*********************************!*\
  !*** ./src/util/orientation.js ***!
  \*********************************/(t,e)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function t(e,i){return e[o]?e:new Proxy(e,{get:function(e,r,s){if(r===o)return!0;if("domElement"===r)return e;if("style"===r)return t(e.style,i);if("canvas"===r)return t(e.canvas,i);if("getBoundingClientRect"===r)return function(){return t(e.getBoundingClientRect.apply(e,arguments),i)};if("getContext"===r)return function(){return t(e.getContext.apply(e,arguments),i)};var u=e[n(r,i)];return"function"==typeof u?u.bind(e):u},set:function(t,e,o){return t[n(e,i)]=o,!0}})};var i={width:"height",height:"width",overflowX:"overflowY",overflowY:"overflowX",clientWidth:"clientHeight",clientHeight:"clientWidth",clientX:"clientY",clientY:"clientX",scrollWidth:"scrollHeight",scrollLeft:"scrollTop",offsetLeft:"offsetTop",offsetTop:"offsetLeft",offsetHeight:"offsetWidth",offsetWidth:"offsetHeight",left:"top",right:"bottom",top:"left",bottom:"right",borderRightStyle:"borderBottomStyle",borderRightWidth:"borderBottomWidth",borderRightColor:"borderBottomColor"};function n(t,e){return Object.prototype.hasOwnProperty.call(i,t)&&e?i[t]:t}var o=Symbol("isProxy");t.exports=e.default},"./src/util/prevent-click.js":
/*!***********************************!*\
  !*** ./src/util/prevent-click.js ***!
  \***********************************/(t,e)=>{function i(t){t.stopPropagation(),document.body.removeEventListener("click",i,!0)}Object.defineProperty(e,"i",{value:!0}),e.default=function(t){document.body.addEventListener("click",i,!0)},t.exports=e.default},"./src/util/request-animation-frame.js":
/*!*********************************************!*\
  !*** ./src/util/request-animation-frame.js ***!
  \*********************************************/(t,e)=>{Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var i=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){return setTimeout(t,1e3/60)}).bind(window);e.default=i,t.exports=e.default},"./src/util/silence-mode.js":
/*!**********************************!*\
  !*** ./src/util/silence-mode.js ***!
  \**********************************/(t,e)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(){var t=new AudioContext,e=t.createBufferSource();e.buffer=t.createBuffer(1,1,44100),e.connect(t.destination),e.start();var i=document.createElement("div");i.innerHTML='<audio x-webkit-airplay="deny"></audio>';var n=i.children.item(0);n.src="data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAACcQCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA//////////////////////////////////////////////////////////////////8AAABhTEFNRTMuMTAwA8MAAAAAAAAAABQgJAUHQQAB9AAAAnGMHkkIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADgnABGiAAQBCqgCRMAAgEAH///////////////7+n/9FTuQsQH//////2NG0jWUGlio5gLQTOtIoeR2WX////X4s9Atb/JRVCbBUpeRUq//////////////////9RUi0f2jn/+xDECgPCjAEQAABN4AAANIAAAAQVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==",n.preload="auto",n.type="audio/mpeg",n.disableRemotePlayback=!0,n.play(),n.remove(),i.remove()},t.exports=e.default},"./src/util/style.js":
/*!***************************!*\
  !*** ./src/util/style.js ***!
  \***************************/(t,e)=>{Object.defineProperty(e,"i",{value:!0}),e.default=function(t,e){return Object.keys(e).forEach((function(i){t.style[i]!==e[i]&&(t.style[i]=e[i])})),t},t.exports=e.default},"./src/wavesurfer.js":
/*!***************************!*\
  !*** ./src/wavesurfer.js ***!
  \***************************/(t,e,i)=>{Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var n=function(t,e){if(!e&&t&&t.i)return t;if(null===t||"object"!==p(t)&&"function"!=typeof t)return{default:t};var i=h(e);if(i&&i.has(t))return i.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if("default"!==r&&Object.prototype.hasOwnProperty.call(t,r)){var s=o?Object.getOwnPropertyDescriptor(t,r):null;s&&(s.get||s.set)?Object.defineProperty(n,r,s):n[r]=t[r]}return n.default=t,i&&i.set(t,n),n}(i(/*! ./util */"./src/util/index.js")),o=c(i(/*! ./drawer.multicanvas */"./src/drawer.multicanvas.js")),r=c(i(/*! ./webaudio */"./src/webaudio.js")),s=c(i(/*! ./mediaelement */"./src/mediaelement.js")),u=c(i(/*! ./peakcache */"./src/peakcache.js")),a=c(i(/*! ./mediaelement-webaudio */"./src/mediaelement-webaudio.js"));function c(t){return t&&t.i?t:{default:t}}function h(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(h=function(t){return t?i:e})(t)}function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=m(t);if(e){var o=m(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return d(this,i)}}function d(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return v(t)}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(t){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},m(t)}function y(t,e,i){return(e=w(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function b(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,w(n.key),n)}}function w(t){var e=function(t,e){if("object"!==p(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===p(e)?e:String(e)}var g=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}(m,t);var e,i,c,h=l(m);function m(t){var e;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,m),y(v(e=h.call(this)),"defaultParams",{audioContext:null,audioScriptProcessor:null,audioRate:1,autoCenter:!0,autoCenterRate:5,autoCenterImmediately:!1,backend:"WebAudio",backgroundColor:null,barHeight:1,barRadius:0,barGap:null,barMinHeight:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,drawingContextAttributes:{desynchronized:!1},duration:null,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,hideCursor:!1,ignoreSilenceMode:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:o.default,responsive:!1,rtl:!1,scrollParent:!1,skipLength:2,splitChannels:!1,splitChannelsOptions:{overlay:!1,channelColors:{},filterChannels:[],relativeNormalization:!1,splitDragSelection:!1},vertical:!1,waveColor:"#999",xhr:{}}),y(v(e),"backends",{MediaElement:s.default,WebAudio:r.default,MediaElementWebAudio:a.default}),y(v(e),"util",n),e.params=Object.assign({},e.defaultParams,t),e.params.splitChannelsOptions=Object.assign({},e.defaultParams.splitChannelsOptions,t.splitChannelsOptions),e.container="string"==typeof t.container?document.querySelector(e.params.container):e.params.container,!e.container)throw new Error("Container element not found");if(null==e.params.mediaContainer?e.mediaContainer=e.container:"string"==typeof e.params.mediaContainer?e.mediaContainer=document.querySelector(e.params.mediaContainer):e.mediaContainer=e.params.mediaContainer,!e.mediaContainer)throw new Error("Media Container element not found");if(e.params.maxCanvasWidth<=1)throw new Error("maxCanvasWidth must be greater than 1");if(e.params.maxCanvasWidth%2==1)throw new Error("maxCanvasWidth must be an even number");if(!0===e.params.rtl&&(!0===e.params.vertical?n.style(e.container,{transform:"rotateX(180deg)"}):n.style(e.container,{transform:"rotateY(180deg)"})),e.params.backgroundColor&&e.setBackgroundColor(e.params.backgroundColor),e.savedVolume=0,e.isMuted=!1,e.tmpEvents=[],e.currentRequest=null,e.arraybuffer=null,e.drawer=null,e.backend=null,e.peakCache=null,"function"!=typeof e.params.renderer)throw new Error("Renderer parameter is invalid");e.Drawer=e.params.renderer,"AudioElement"==e.params.backend&&(e.params.backend="MediaElement"),"WebAudio"!=e.params.backend&&"MediaElementWebAudio"!==e.params.backend||r.default.prototype.supportsWebAudio.call(null)||(e.params.backend="MediaElement"),e.Backend=e.backends[e.params.backend],e.initialisedPluginList={},e.isDestroyed=!1,e.isReady=!1;var i=0;return e._onResize=n.debounce((function(){e.drawer.wrapper&&i!=e.drawer.wrapper.clientWidth&&!e.params.scrollParent&&(i=e.drawer.wrapper.clientWidth)&&e.drawer.fireEvent("redraw")}),"number"==typeof e.params.responsive?e.params.responsive:100),d(e,v(e))}return e=m,i=[{key:"init",value:function(){return this.registerPlugins(this.params.plugins),this.createDrawer(),this.createBackend(),this.createPeakCache(),this}},{key:"registerPlugins",value:function(t){var e=this;return t.forEach((function(t){return e.addPlugin(t)})),t.forEach((function(t){t.deferInit||e.initPlugin(t.name)})),this.fireEvent("plugins-registered",t),this}},{key:"getActivePlugins",value:function(){return this.initialisedPluginList}},{key:"addPlugin",value:function(t){var e=this;if(!t.name)throw new Error("Plugin does not have a name!");if(!t.instance)throw new Error("Plugin ".concat(t.name," does not have an instance property!"));t.staticProps&&Object.keys(t.staticProps).forEach((function(i){e[i]=t.staticProps[i]}));var i=t.instance;return Object.getOwnPropertyNames(n.Observer.prototype).forEach((function(t){i.prototype[t]=n.Observer.prototype[t]})),this[t.name]=new i(t.params||{},this),this.fireEvent("plugin-added",t.name),this}},{key:"initPlugin",value:function(t){if(!this[t])throw new Error("Plugin ".concat(t," has not been added yet!"));return this.initialisedPluginList[t]&&this.destroyPlugin(t),this[t].init(),this.initialisedPluginList[t]=!0,this.fireEvent("plugin-initialised",t),this}},{key:"destroyPlugin",value:function(t){if(!this[t])throw new Error("Plugin ".concat(t," has not been added yet and cannot be destroyed!"));if(!this.initialisedPluginList[t])throw new Error("Plugin ".concat(t," is not active and cannot be destroyed!"));if("function"!=typeof this[t].destroy)throw new Error("Plugin ".concat(t," does not have a destroy function!"));return this[t].destroy(),delete this.initialisedPluginList[t],this.fireEvent("plugin-destroyed",t),this}},{key:"destroyAllPlugins",value:function(){var t=this;Object.keys(this.initialisedPluginList).forEach((function(e){return t.destroyPlugin(e)}))}},{key:"createDrawer",value:function(){var t=this;this.drawer=new this.Drawer(this.container,this.params),this.drawer.init(),this.fireEvent("drawer-created",this.drawer),!1!==this.params.responsive&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0)),this.drawer.on("redraw",(function(){t.drawBuffer(),t.drawer.progress(t.backend.getPlayedPercents())})),this.drawer.on("click",(function(e,i){setTimeout((function(){return t.seekTo(i)}),0)})),this.drawer.on("scroll",(function(e){t.params.partialRender&&t.drawBuffer(),t.fireEvent("scroll",e)})),this.drawer.on("dblclick",(function(e,i){t.fireEvent("dblclick",e,i)}))}},{key:"createBackend",value:function(){var t=this;this.backend&&this.backend.destroy(),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",(function(){t.drawer.progress(t.backend.getPlayedPercents()),t.fireEvent("finish")})),this.backend.on("play",(function(){return t.fireEvent("play")})),this.backend.on("pause",(function(){return t.fireEvent("pause")})),this.backend.on("audioprocess",(function(e){t.drawer.progress(t.backend.getPlayedPercents()),t.fireEvent("audioprocess",e)})),"MediaElement"!==this.params.backend&&"MediaElementWebAudio"!==this.params.backend||(this.backend.on("seek",(function(){t.drawer.progress(t.backend.getPlayedPercents())})),this.backend.on("volume",(function(){var e=t.getVolume();t.fireEvent("volume",e),t.backend.isMuted!==t.isMuted&&(t.isMuted=t.backend.isMuted,t.fireEvent("mute",t.isMuted))})))}},{key:"createPeakCache",value:function(){this.params.partialRender&&(this.peakCache=new u.default)}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(t){t>=this.getDuration()?this.seekTo(1):this.seekTo(t/this.getDuration())}},{key:"play",value:function(t,e){var i=this;return this.params.ignoreSilenceMode&&n.ignoreSilenceMode(),this.fireEvent("interaction",(function(){return i.play(t,e)})),this.backend.play(t,e)}},{key:"setPlayEnd",value:function(t){this.backend.setPlayEnd(t)}},{key:"pause",value:function(){if(!this.backend.isPaused())return this.backend.pause()}},{key:"playPause",value:function(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(t){this.skip(-t||-this.params.skipLength)}},{key:"skipForward",value:function(t){this.skip(t||this.params.skipLength)}},{key:"skip",value:function(t){var e=this.getDuration()||1,i=this.getCurrentTime()||0;i=Math.max(0,Math.min(e,i+(t||0))),this.seekAndCenter(i/e)}},{key:"seekAndCenter",value:function(t){this.seekTo(t),this.drawer.recenter(t)}},{key:"seekTo",value:function(t){var e=this;if("number"!=typeof t||!isFinite(t)||t<0||t>1)throw new Error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.fireEvent("interaction",(function(){return e.seekTo(t)}));var i="WebAudio"===this.params.backend,n=this.backend.isPaused();i&&!n&&this.backend.pause();var o=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(t*this.getDuration()),this.drawer.progress(t),i&&!n&&this.backend.play(),this.params.scrollParent=o,this.fireEvent("seek",t)}},{key:"stop",value:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)}},{key:"setSinkId",value:function(t){return this.backend.setSinkId(t)}},{key:"setVolume",value:function(t){!0!==this.isMuted?(this.backend.setVolume(t),this.fireEvent("volume",t)):this.savedVolume=t}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(t){this.backend.setPlaybackRate(t)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(t){t!==this.isMuted?(this.backend.setMute?(this.backend.setMute(t),this.isMuted=t):t?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume)),this.fireEvent("mute",this.isMuted)):this.fireEvent("mute",this.isMuted)}},{key:"getMute",value:function(){return this.isMuted}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.params.splitChannelsOptions.channelColors[t]?this.params.splitChannelsOptions.channelColors[t].waveColor:this.params.waveColor}},{key:"setWaveColor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.params.splitChannelsOptions.channelColors[e]?this.params.splitChannelsOptions.channelColors[e].waveColor=t:this.params.waveColor=t,this.drawBuffer()}},{key:"getProgressColor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this.params.splitChannelsOptions.channelColors[t]?this.params.splitChannelsOptions.channelColors[t].progressColor:this.params.progressColor}},{key:"setProgressColor",value:function(t,e){this.params.splitChannelsOptions.channelColors[e]?this.params.splitChannelsOptions.channelColors[e].progressColor=t:this.params.progressColor=t,this.drawBuffer()}},{key:"getBackgroundColor",value:function(){return this.params.backgroundColor}},{key:"setBackgroundColor",value:function(t){this.params.backgroundColor=t,n.style(this.container,{background:this.params.backgroundColor})}},{key:"getCursorColor",value:function(){return this.params.cursorColor}},{key:"setCursorColor",value:function(t){this.params.cursorColor=t,this.drawer.updateCursor()}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(t){this.params.height=t,this.drawer.setHeight(t*this.params.pixelRatio),this.drawBuffer()}},{key:"setFilteredChannels",value:function(t){this.params.splitChannelsOptions.filterChannels=t,this.drawBuffer()}},{key:"drawBuffer",value:function(){var t,e=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),i=this.drawer.getWidth(),n=e,o=0,r=Math.max(o+i,n);if(this.params.fillParent&&(!this.params.scrollParent||e<i)&&(o=0,r=n=i),this.params.partialRender){var s,u=this.peakCache.addRangeToPeakCache(n,o,r);for(s=0;s<u.length;s++)t=this.backend.getPeaks(n,u[s][0],u[s][1]),this.drawer.drawPeaks(t,n,u[s][0],u[s][1])}else t=this.backend.getPeaks(n,o,r),this.drawer.drawPeaks(t,n,o,r);this.fireEvent("redraw",t,n)}},{key:"zoom",value:function(t){t?(this.params.minPxPerSec=t,this.params.scrollParent=!0):(this.params.minPxPerSec=this.defaultParams.minPxPerSec,this.params.scrollParent=!1),this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",t)}},{key:"loadArrayBuffer",value:function(t){var e=this;this.decodeArrayBuffer(t,(function(t){e.isDestroyed||e.loadDecodedBuffer(t)}))}},{key:"loadDecodedBuffer",value:function(t){this.backend.load(t),this.drawBuffer(),this.isReady=!0,this.fireEvent("ready")}},{key:"loadBlob",value:function(t){var e=this,i=new FileReader;i.addEventListener("progress",(function(t){return e.onProgress(t)})),i.addEventListener("load",(function(t){return e.loadArrayBuffer(t.target.result)})),i.addEventListener("error",(function(){return e.fireEvent("error","Error reading file")})),i.readAsArrayBuffer(t),this.empty()}},{key:"load",value:function(t,e,i,n){if(!t)throw new Error("url parameter cannot be empty");if(this.empty(),i){var o={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(i),"Peaks are not provided":!e,"Backend is not of type 'MediaElement' or 'MediaElementWebAudio'":-1===["MediaElement","MediaElementWebAudio"].indexOf(this.params.backend),"Url is not of type string":"string"!=typeof t},r=Object.keys(o).filter((function(t){return o[t]}));r.length&&(console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+r.join("\n\t- ")),i=null)}switch("WebAudio"===this.params.backend&&t instanceof HTMLMediaElement&&(t=t.src),this.params.backend){case"WebAudio":return this.loadBuffer(t,e,n);case"MediaElement":case"MediaElementWebAudio":return this.loadMediaElement(t,e,i,n)}}},{key:"loadBuffer",value:function(t,e,i){var n=this,o=function(e){return e&&n.tmpEvents.push(n.once("ready",e)),n.getArrayBuffer(t,(function(t){return n.loadArrayBuffer(t)}))};if(!e)return o();this.backend.setPeaks(e,i),this.drawBuffer(),this.fireEvent("waveform-ready"),this.tmpEvents.push(this.once("interaction",o))}},{key:"loadMediaElement",value:function(t,e,i,n){var o=this,r=t;if("string"==typeof t)this.backend.load(r,this.mediaContainer,e,i);else{var s=t;this.backend.loadElt(s,e),r=s.src}this.tmpEvents.push(this.backend.once("canplay",(function(){o.backend.destroyed||(o.drawBuffer(),o.isReady=!0,o.fireEvent("ready"))})),this.backend.once("error",(function(t){return o.fireEvent("error",t)}))),e&&(this.backend.setPeaks(e,n),this.drawBuffer(),this.fireEvent("waveform-ready")),e&&!this.params.forceDecode||!this.backend.supportsWebAudio()||this.getArrayBuffer(r,(function(t){o.decodeArrayBuffer(t,(function(t){o.backend.buffer=t,o.backend.setPeaks(null),o.drawBuffer(),o.fireEvent("waveform-ready")}))}))}},{key:"decodeArrayBuffer",value:function(t,e){var i=this;this.isDestroyed||(this.arraybuffer=t,this.backend.decodeArrayBuffer(t,(function(n){i.isDestroyed||i.arraybuffer!=t||(e(n),i.arraybuffer=null)}),(function(){return i.fireEvent("error","Error decoding audiobuffer")})))}},{key:"getArrayBuffer",value:function(t,e){var i=this,o=Object.assign({url:t,responseType:"arraybuffer"},this.params.xhr),r=n.fetchFile(o);return this.currentRequest=r,this.tmpEvents.push(r.on("progress",(function(t){i.onProgress(t)})),r.on("success",(function(t){e(t),i.currentRequest=null})),r.on("error",(function(t){i.fireEvent("error",t),i.currentRequest=null}))),r}},{key:"onProgress",value:function(t){var e;e=t.lengthComputable?t.loaded/t.total:t.loaded/(t.loaded+1e6),this.fireEvent("loading",Math.round(100*e),t.target)}},{key:"exportPCM",value:function(t,e,i,n,o){t=t||1024,n=n||0,e=e||1e4,i=i||!1;var r=this.backend.getPeaks(t,n,o),s=[].map.call(r,(function(t){return Math.round(t*e)/e}));return new Promise((function(t,e){if(!i){var n=new Blob([JSON.stringify(s)],{type:"application/json;charset=utf-8"}),o=URL.createObjectURL(n);window.open(o),URL.revokeObjectURL(o)}t(s)}))}},{key:"exportImage",value:function(t,e,i){return t||(t="image/png"),e||(e=1),i||(i="dataURL"),this.drawer.getImage(t,e,i)}},{key:"cancelAjax",value:function(){this.currentRequest&&this.currentRequest.controller&&(this.currentRequest._reader&&this.currentRequest._reader.cancel().catch((function(t){})),this.currentRequest.controller.abort(),this.currentRequest=null)}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach((function(t){return t.un()}))}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.isReady=!1,this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function(){this.destroyAllPlugins(),this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),!1!==this.params.responsive&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0)),this.backend&&(this.backend.destroy(),this.backend=null),this.drawer&&this.drawer.destroy(),this.isDestroyed=!0,this.isReady=!1,this.arraybuffer=null}}],c=[{key:"create",value:function(t){return new m(t).init()}}],i&&b(e.prototype,i),c&&b(e,c),Object.defineProperty(e,"prototype",{writable:!1}),m}(n.Observer);e.default=g,y(g,"VERSION","6.6.4"),y(g,"util",n),t.exports=e.default},"./src/webaudio.js":
/*!*************************!*\
  !*** ./src/webaudio.js ***!
  \*************************/(t,e,i)=>{Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var n=function(t,e){if(!e&&t&&t.i)return t;if(null===t||"object"!==r(t)&&"function"!=typeof t)return{default:t};var i=o(e);if(i&&i.has(t))return i.get(t);var n={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if("default"!==u&&Object.prototype.hasOwnProperty.call(t,u)){var a=s?Object.getOwnPropertyDescriptor(t,u):null;a&&(a.get||a.set)?Object.defineProperty(n,u,a):n[u]=t[u]}return n.default=t,i&&i.set(t,n),n}(i(/*! ./util */"./src/util/index.js"));function o(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(o=function(t){return t?i:e})(t)}function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,n=h(t);if(e){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return function(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return c(t)}(this,i)}}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function f(t,e,i){return(e=l(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function l(t){var e=function(t,e){if("object"!==r(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===r(e)?e:String(e)}var d="playing",v="paused",m="finished",y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&u(t,e)}(h,t);var e,i,o,r=a(h);function h(t){var e,i,n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,h),f(c(n=r.call(this)),"audioContext",null),f(c(n),"stateBehaviors",(f(e={},d,{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),f(e,v,{init:function(){},getPlayedPercents:function(){var t=this.getDuration();return this.getCurrentTime()/t||0},getCurrentTime:function(){return this.startPosition}}),f(e,m,{init:function(){this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),e)),n.params=t,n.ac=t.audioContext||(n.supportsWebAudio()?n.getAudioContext():{}),n.lastPlay=n.ac.currentTime,n.startPosition=0,n.scheduledPause=null,n.states=(f(i={},d,Object.create(n.stateBehaviors[d])),f(i,v,Object.create(n.stateBehaviors[v])),f(i,m,Object.create(n.stateBehaviors[m])),i),n.buffer=null,n.filters=[],n.gainNode=null,n.mergedPeaks=null,n.offlineAc=null,n.peaks=null,n.playbackRate=1,n.analyser=null,n.scriptNode=null,n.source=null,n.splitPeaks=[],n.state=null,n.explicitDuration=t.duration,n.sinkStreamDestination=null,n.sinkAudioElement=null,n.destroyed=!1,n}return e=h,i=[{key:"supportsWebAudio",value:function(){return!(!window.AudioContext&&!window.webkitAudioContext)}},{key:"getAudioContext",value:function(){return window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(t){return window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,t)),window.WaveSurferOfflineAudioContext}},{key:"init",value:function(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(v),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach((function(t){t&&t.disconnect()})),this.filters=null,this.analyser.connect(this.gainNode))}},{key:"setState",value:function(t){this.state!==this.states[t]&&(this.state=this.states[t],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];this.setFilters(e)}},{key:"setFilters",value:function(t){this.disconnectFilters(),t&&t.length&&(this.filters=t,this.analyser.disconnect(),t.reduce((function(t,e){return t.connect(e),e}),this.analyser).connect(this.gainNode))}},{key:"createScriptNode",value:function(){this.params.audioScriptProcessor&&(this.scriptNode=this.params.audioScriptProcessor,this.scriptNode.connect(this.ac.destination))}},{key:"addOnAudioProcess",value:function(){var t=this;!function e(){var i=t.getCurrentTime();i>=t.getDuration()&&t.state!==t.states[m]?(t.setState(m),t.fireEvent("pause")):i>=t.scheduledPause&&t.state!==t.states[v]?t.pause():t.state===t.states[d]&&(t.fireEvent("audioprocess",i),n.frame(e)())}()}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(t){return t?(this.sinkAudioElement||(this.sinkAudioElement=new window.Audio,this.sinkAudioElement.autoplay=!0),this.sinkAudioElement.setSinkId?(this.sinkStreamDestination||(this.sinkStreamDestination=this.ac.createMediaStreamDestination()),this.gainNode.disconnect(),this.gainNode.connect(this.sinkStreamDestination),this.sinkAudioElement.srcObject=this.sinkStreamDestination.stream,this.sinkAudioElement.setSinkId(t)):Promise.reject(new Error("setSinkId is not supported in your browser"))):Promise.reject(new Error("Invalid deviceId: "+t))}},{key:"setVolume",value:function(t){this.gainNode.gain.setValueAtTime(t,this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(t,e,i){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)),"webkitAudioContext"in window?this.offlineAc.decodeAudioData(t,(function(t){return e(t)}),i):this.offlineAc.decodeAudioData(t).then((function(t){return e(t)})).catch((function(t){return i(t)}))}},{key:"setPeaks",value:function(t,e){null!=e&&(this.explicitDuration=e),this.peaks=t}},{key:"setLength",value:function(t){if(!this.mergedPeaks||t!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[],this.mergedPeaks=[];var e,i=this.buffer?this.buffer.numberOfChannels:1;for(e=0;e<i;e++)this.splitPeaks[e]=[],this.splitPeaks[e][2*(t-1)]=0,this.splitPeaks[e][2*(t-1)+1]=0;this.mergedPeaks[2*(t-1)]=0,this.mergedPeaks[2*(t-1)+1]=0}}},{key:"getPeaks",value:function(t,e,i){if(this.peaks)return this.peaks;if(!this.buffer)return[];if(e=e||0,i=i||t-1,this.setLength(t),!this.buffer)return this.params.splitChannels?this.splitPeaks:this.mergedPeaks;if(!this.buffer.length){var n=this.createBuffer(1,4096,this.sampleRate);this.buffer=n.buffer}var o,r=this.buffer.length/t,s=~~(r/10)||1,u=this.buffer.numberOfChannels;for(o=0;o<u;o++){var a=this.splitPeaks[o],c=this.buffer.getChannelData(o),h=void 0;for(h=e;h<=i;h++){var f=~~(h*r),l=~~(f+r),d=c[f],v=d,m=void 0;for(m=f;m<l;m+=s){var y=c[m];y>v&&(v=y),y<d&&(d=y)}a[2*h]=v,a[2*h+1]=d,(0==o||v>this.mergedPeaks[2*h])&&(this.mergedPeaks[2*h]=v),(0==o||d<this.mergedPeaks[2*h+1])&&(this.mergedPeaks[2*h+1]=d)}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroyWebAudio",value:function(){this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode&&this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"==typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null),this.sinkStreamDestination&&(this.sinkAudioElement.pause(),this.sinkAudioElement.srcObject=null,this.sinkStreamDestination.disconnect(),this.sinkStreamDestination=null)}},{key:"destroy",value:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.destroyed=!0,this.destroyWebAudio()}},{key:"load",value:function(t){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=t,this.createSource()}},{key:"createSource",value:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.setPlaybackRate(this.playbackRate),this.source.buffer=this.buffer,this.source.connect(this.analyser)}},{key:"resumeAudioContext",value:function(){"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume()}},{key:"isPaused",value:function(){return this.state!==this.states[d]}},{key:"getDuration",value:function(){return this.explicitDuration?this.explicitDuration:this.buffer?this.buffer.duration:0}},{key:"seekTo",value:function(t,e){if(this.buffer)return this.scheduledPause=null,null==t&&(t=this.getCurrentTime())>=this.getDuration()&&(t=0),null==e&&(e=this.getDuration()),this.startPosition=t,this.lastPlay=this.ac.currentTime,this.state===this.states[m]&&this.setState(v),{start:t,end:e}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(t,e){if(this.buffer){this.createSource();var i=this.seekTo(t,e);t=i.start,e=i.end,this.scheduledPause=e,this.source.start(0,t),this.resumeAudioContext(),this.setState(d),this.fireEvent("play")}}},{key:"pause",value:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime();try{this.source&&this.source.stop(0)}catch(t){}this.setState(v),this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(t){this.playbackRate=t||1,this.source&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime)}},{key:"setPlayEnd",value:function(t){this.scheduledPause=t}}],i&&s(e.prototype,i),o&&s(e,o),Object.defineProperty(e,"prototype",{writable:!1}),h}(n.Observer);e.default=y,t.exports=e.default},"./node_modules/debounce/index.js":
/*!****************************************!*\
  !*** ./node_modules/debounce/index.js ***!
  \****************************************/t=>{function e(t,e,i){var n,o,r,s,u;function a(){var c=Date.now()-s;c<e&&c>=0?n=setTimeout(a,e-c):(n=null,i||(u=t.apply(r,o),r=o=null))}null==e&&(e=100);var c=function(){r=this,o=arguments,s=Date.now();var c=i&&!n;return n||(n=setTimeout(a,e)),c&&(u=t.apply(r,o),r=o=null),u};return c.clear=function(){n&&(clearTimeout(n),n=null)},c.flush=function(){n&&(u=t.apply(r,o),r=o=null,clearTimeout(n),n=null)},c}e.debounce=e,t.exports=e}},e={},function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}("./src/wavesurfer.js");var t,e},"object"==typeof exports&&"object"==typeof module?module.exports=U():"function"==typeof define&&define.amd?define("WaveSurfer",[],U):"object"==typeof exports?exports.WaveSurfer=U():L.WaveSurfer=U(),function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("WaveSurfer",[],e):"object"==typeof exports?exports.WaveSurfer=e():(t.WaveSurfer=t.WaveSurfer||{},t.WaveSurfer.microphone=e())}(self,(()=>(()=>{var t={872:(t,e)=>{function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,(void 0,r=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!==i(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(o.key),"symbol"===i(r)?r:String(r)),o)}var r}Object.defineProperty(e,"i",{value:!0}),e.default=void 0;var o=function(){function t(e,i){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.params=e,this.wavesurfer=i,this.active=!1,this.paused=!1,this.browser=this.detectBrowser(),this.reloadBufferFunction=function(t){return n.reloadBuffer(t)},void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(t,e,i){var n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return n?new Promise((function(e,i){n.call(navigator,t,e,i)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),this.constraints=this.params.constraints||{video:!1,audio:!0},this.bufferSize=this.params.bufferSize||4096,this.numberOfInputChannels=this.params.numberOfInputChannels||1,this.numberOfOutputChannels=this.params.numberOfOutputChannels||1,this._onBackendCreated=function(){n.micContext=n.wavesurfer.backend.getAudioContext()}}var e,i,o;return e=t,o=[{key:"create",value:function(e){return{name:"microphone",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,instance:t}}}],(i=[{key:"init",value:function(){this.wavesurfer.on("backend-created",this._onBackendCreated),this.wavesurfer.backend&&this._onBackendCreated()}},{key:"destroy",value:function(){this.paused=!0,this.wavesurfer.un("backend-created",this._onBackendCreated),this.stop()}},{key:"start",value:function(){var t=this;navigator.mediaDevices.getUserMedia(this.constraints).then((function(e){return t.gotStream(e)})).catch((function(e){return t.deviceError(e)}))}},{key:"togglePlay",value:function(){this.active?(this.paused=!this.paused,this.paused?this.pause():this.play()):this.start()}},{key:"play",value:function(){this.paused=!1,this.connect()}},{key:"pause",value:function(){this.paused=!0,this.disconnect()}},{key:"stop",value:function(){this.active&&(this.stopDevice(),this.wavesurfer.empty())}},{key:"stopDevice",value:function(){this.active=!1,this.disconnect(),this.stream&&this.stream.getTracks&&this.stream.getTracks().forEach((function(t){return t.stop()}))}},{key:"connect",value:function(){void 0!==this.stream&&("edge"===this.browser.browser&&(this.localAudioBuffer=this.micContext.createBuffer(this.numberOfInputChannels,this.bufferSize,this.micContext.sampleRate)),this.mediaStreamSource=this.micContext.createMediaStreamSource(this.stream),this.levelChecker=this.micContext.createScriptProcessor(this.bufferSize,this.numberOfInputChannels,this.numberOfOutputChannels),this.mediaStreamSource.connect(this.levelChecker),this.levelChecker.connect(this.micContext.destination),this.levelChecker.onaudioprocess=this.reloadBufferFunction)}},{key:"disconnect",value:function(){void 0!==this.mediaStreamSource&&this.mediaStreamSource.disconnect(),void 0!==this.levelChecker&&(this.levelChecker.disconnect(),this.levelChecker.onaudioprocess=void 0),void 0!==this.localAudioBuffer&&(this.localAudioBuffer=void 0)}},{key:"reloadBuffer",value:function(t){if(!this.paused)if(this.wavesurfer.empty(),"edge"===this.browser.browser){var e,i;for(e=0,i=Math.min(this.localAudioBuffer.numberOfChannels,t.inputBuffer.numberOfChannels);e<i;e++)this.localAudioBuffer.getChannelData(e).set(t.inputBuffer.getChannelData(e));this.wavesurfer.loadDecodedBuffer(this.localAudioBuffer)}else this.wavesurfer.loadDecodedBuffer(t.inputBuffer)}},{key:"gotStream",value:function(t){this.stream=t,this.active=!0,this.play(),this.fireEvent("deviceReady",t)}},{key:"deviceError",value:function(t){this.fireEvent("deviceError",t)}},{key:"extractVersion",value:function(t,e,i){var n=t.match(e);return n&&n.length>=i&&parseInt(n[i],10)}},{key:"detectBrowser",value:function(){var t={browser:null,version:null,minVersion:null};return"undefined"!=typeof window&&window.navigator?navigator.mozGetUserMedia?(t.browser="firefox",t.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1),t.minVersion=31,t):navigator.webkitGetUserMedia?(t.browser="chrome",t.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2),t.minVersion=38,t):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(t.browser="edge",t.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),t.minVersion=10547,t):window.RTCPeerConnection&&navigator.userAgent.match(/AppleWebKit\/(\d+)\./)?(t.browser="safari",t.minVersion=11,t.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1),t):(t.browser="Not a supported browser.",t):(t.browser="Not a supported browser.",t)}}])&&n(e.prototype,i),o&&n(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();e.default=o,t.exports=e.default}},e={},i=function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,i),r.exports}(872);return i})()));var N=function(t,e,i,n){for(var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n,u=t.length-1;u>=0;u--)(o=t[u])&&(s=(r<3?o(s):r>3?o(e,i,s):o(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s};let z=class extends n{constructor(){super(...arguments),this.audioRecording=!1,this.videoRecording=!1,this.maxLength=5,this.recordingFinished=!1,this.isRecording=!1,this.rememberDevice=!1,this.previewActive=!1,this.recordSecondsLeft=0,this.videoAspect="portrait",this.selectedCamera="user",this.hasFacingMode=!1,this.isMobile=!1,this.selectedAudioDeviceId=null,this.selectedVideoDeviceId=null}static get styles(){return[super.styles,o`
        #dialog[audio-recording] {
          width: 430px;
        }

        .mainbuttons {
          width: 100%;
          margin-top: 8px;
          margin-bottom: 8px;
        }

        .recording {
          color: #f00;
          animation-name: pulse;
          animation-duration: 1.3s;
          animation-iteration-count: infinite;
          animation-timing-function: linear;
        }

        .recordingTime {
          color: #f00;
          animation-name: pulse;
          animation-duration: 1s;
          animation-iteration-count: infinite;
          animation-timing-function: linear;
        }

        @keyframes pulse {
          from {
            opacity: 1;
          }
          to {
            opacity: 0.5;
          }
        }

        .buttonText {
          margin-left: 6px;
        }

        .actionButton {
        }

        .iconButtons {
          margin-top: 2px;
        }

        #secondsLeft {
          margin-top: 12px;
          margin-left: 4px;
          margin-right: 4px;
        }

        .mainContainer {
          padding: 0 24px;
        }

        @media (max-width: 640px) {
          #dialog {
            padding: 0;
            margin: 0;
          }
          .mainContainer {
            padding: 0 0;
          }

          .mainbuttons {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
          }

          #dialog {
            min-height: 242px;
            min-width: 320px;
            width: 100%;
          }
        }

        @media (max-width: 360px) {
          .uploadFileText {
            display: none;
          }
        }

        .rememberBox {
          margin-top: 8px;
        }

        #checkBox {
          margin-left: 6px;
        }

        .header {
          font-weight: bold;
          font-size: 18px;
          margin-bottom: 10px;
        }

        #waveform {
          height: 128px;
        }

        [hidden] {
          display: none !important;
        }
      `]}_closeMediaStream(){this.mediaStream&&(this.mediaStream.getTracks().forEach((t=>{t.stop()})),this.mediaStream=void 0),this.surfer&&(this.surfer.getActivePlugins()[0].stop(),this.surfer.destroy(),this.surfer=void 0),this.previewActive=!1}_uploadFileThroughPhoneCamera(){this._close(),this.uploadFileFunction?this.uploadFileFunction(this.videoAspect,!0):console.error("Upload file function is not defined")}async _openRecorderDialog(){if(this.videoRecording&&this.isMobile)this._uploadFileThroughPhoneCamera();else if(this.videoRecording){const t=this.shadowRoot.querySelector("#videoRecorder"),e=this.shadowRoot.querySelector("#videoPreviewer");let i,n;if(window.innerHeight>window.innerWidth)this.videoSettings={width:720,height:1280},n=Math.min(1280,Math.abs(window.innerHeight)),i=Math.min(720,Math.abs(.5625*n)),console.info(`Portrait - width: ${i} height: ${n} video width: 720 height: 1280`);else{this.videoSettings={width:1280,height:720};let t=.8;window.innerHeight<700&&(t=.7),window.innerHeight<500&&(t=.6),n=Math.min(720,Math.abs(window.innerHeight*t)),i=Math.min(1280,Math.abs(1.77777777778*n)),console.info(`Landscape - width: ${i} height: ${n}`)}t.style.height=`${n}px`,t.style.width=`${i}px`,e.style.height=.8*n+"px",e.style.width=.8*i+"px"}!this.audioRecording&&this.isMobile||(await this.updateComplete,this.shadowRoot.querySelector("#dialog").open=!0,this.setupRecorders())}render(){return r`
      <md-dialog id="optionsDialog" modal>
        <div class="layout vertical center-center" slot="content">
          <div class="layout vertical center-center optionsButtons">
            <div class="layout horizontal center-center">
              <md-filled-button
                raised
                dialogAction="confirm"
                class="uploadFileButton"
                @click="${this._openRecorderDialog}"
              >
                <md-icon>fiber_manual_record</md-icon>
                <div class="buttonText">${this.t("record")}</div>
              </md-filled-button>
            </div>
            <div class="layout horizontal center-center">
              <md-filled-button
                raised
                dialogAction="confirm"
                class="uploadFileButton"
                @click="${this._uploadFile}"
              >
                <md-icon>file_upload</md-icon>
                <div class="buttonText">${this.t("upload")}</div>
              </md-filled-button>
            </div>
          </div>
          <div class="videoAspectDescription">${this.t("videoFormat")}</div>
          <div ?hidden="${this.audioRecording}">
            <label
              name="aspect"
              class="aspect layout horizontal wrap"
              @selected="${this._setVideoAspect}"
              selected="${this.videoAspect}"
            >
              <md-radio value="landscape">landscape</md-radio>
              <md-radio value="portrait">portrait</md-radio>
            </label>
          </div>
          <div class="layout horizontal center-center" slot="actions">
            <md-text-button dialogAction="close"
              >${this.t("cancel")}</md-text-button
            >
          </div>
        </div>
      </md-dialog>
      <md-dialog id="dialog" modal ?audioRecording="${this.audioRecording}">
        <div class="layout vertical no-padding mainContainer">
          ${this.videoRecording?r`
                <video
                  id="videoRecorder"
                  class="videoRecorder"
                  ?hidden="${this.previewActive}"
                ></video>
                <video
                  id="videoPreviewer"
                  preload="auto"
                  class="videoRecorder"
                  ?hidden="${!this.previewActive}"
                ></video>
              `:s}
          ${this.audioRecording?r`
                <div class="layout vertical center-center">
                  <div class="layout horizontal center-center header">
                    ${this.t("voiceRecorder")}
                  </div>
                  <div
                    id="waveform"
                    ?hidden="${null!=this.recordedData}"
                  ></div>
                  <audio
                    id="audioRecorder"
                    class="audioRecorder"
                    ?hidden
                  ></audio>
                  <audio
                    id="audioPreviewer"
                    controls
                    preload="auto"
                    class="audioRecorder"
                    ?hidden="${!this.previewActive}"
                  ></audio>
                </div>
              `:s}

          <div class="layout horizontal mainbuttons">
            <md-icon-button @click="${this._close}">
              <md-icon>clear</md-icon>
            </md-icon-button>
            <div class="layout horizontal" ?hidden="${!this.recorder}">
              <md-icon-button
                @click="${this._deleteRecording}"
                ?hidden="${!this.recordedData}"
              >
                <md-icon>delete</md-icon>
              </md-icon-button>
              <md-text-button
                @click="${this._startRecording}"
                ?hidden="${null!=this.recordedData}"
              >
                <md-icon>fiber_manual_record</md-icon>
                ${this.t("record")}
              </md-text-button>
              <div id="secondsLeft" ?hidden="${null!=this.recordedData}">
                ${this.recordSecondsLeft} ${this.t("seconds")}
              </div>
              <md-text-button
                @click="${this._stopRecording}"
                ?hidden="${!this.isRecording}"
              >
                <md-icon>stop</md-icon>
                ${this.t("stop")}
              </md-text-button>
            </div>
            <span ?hidden="${this.isRecording||this.audioRecording}">
              <div class="layout horizontal">
                <md-text-button
                  id="uploadFileButton"
                  @click="${this._uploadFile}"
                  ?hidden="${null!=this.recordedData}"
                >
                  <md-icon>file_upload</md-icon>
                  ${this.t("uploadFile")}
                </md-text-button>
                <label>
                  <md-radio
                    name="videoAspect"
                    @change="${this._setVideoAspect}"
                    value="landscape"
                  >
                  </md-radio>
                  landscape
                </label>
                <label>
                  <md-radio
                    name="videoAspect"
                    @change="${this._setVideoAspect}"
                    value="portrait"
                  >
                  </md-radio>
                  portrait
                </label>
              </div>
            </span>
            <md-text-button
              @click="${this._sendBack}"
              ?hidden="${!this.recordedData}"
            >
              <md-icon>send</md-icon>
              ${this.t("send")}
            </md-text-button>
          </div>
        </div>
        <div ?hidden="${!this.error}">${this.error}</div>
      </md-dialog>
      ${this.allDevices?r`
            <md-dialog id="selectDevices" modal>
              <div slot="headline">${this.selectDeviceTitle}</div>
              <md-select id="deviceListBox">
                ${this.allDevices.map((t=>r`
                    <md-select-option
                      @click="${this.selectDeviceFunction}"
                      value="${t.deviceId}"
                    >
                      ${t.label}
                    </md-select-option>
                  `))}
              </md-select>
              <div class="layout horizontal rememberBox">
                <div>${this.t("rememberDevice")}</div>
                <md-checkbox id="checkBox"></md-checkbox>
              </div>
            </md-dialog>
          `:s}
      <md-dialog id="noDevices">
        <div slot="headline">${this.t("noDevicesFound")}</div>
        <div class="button layout horizontal center-center">
          <md-text-button
            slot="actions"
            raised
            @click="${()=>this.$$("#noDevices").close()}"
          >
            ${this.t("ok")}
          </md-text-button>
        </div>
      </md-dialog>
    `}_setVideoAspect(t){this.videoAspect=t.target.value}_selectAudioDevice(t){const e=t.target;e.id&&(this.selectedAudioDeviceId=e.id),this.$$("#checkBox").checked&&localStorage.setItem("selectedAudioDeviceId",this.selectedAudioDeviceId),this.$$("#selectDevices").open=!1,this._openMediaSession(this.captureCallback)}_selectVideoDevice(t){t.target.id&&(this.selectedVideoDeviceId=t.target.id),this.$$("#checkBox").checked&&localStorage.setItem("selectedVideoDeviceId",this.selectedVideoDeviceId),this.$$("#selectDevices").open=!1,this._checkAudioDevices()}async _checkAudioDevices(){this.audioDevices&&this.audioDevices.length>1?localStorage.getItem("selectedAudioDeviceId")?(this.selectedAudioDeviceId=localStorage.getItem("selectedAudioDeviceId"),this._openMediaSession(this.captureCallback)):(this.selectDeviceTitle=this.t("selectAudioDevice"),this.selectDeviceFunction=this._selectAudioDevice.bind(this),this.allDevices=this.audioDevices,await this.updateComplete,this.$$("#checkBox").checked=!1,this.$$("#selectDevices").open=!0):this._openMediaSession(this.captureCallback)}async _checkVideoDevices(){this.videoRecording&&this.videoDevices&&this.videoDevices.length>1?localStorage.getItem("selectedVideoDeviceId")?(this.selectedVideoDeviceId=localStorage.getItem("selectedVideoDeviceId"),await this._checkAudioDevices()):(this.selectDeviceTitle=this.t("selectVideoDevice"),this.rememberDevice=!1,this.selectDeviceFunction=this._selectVideoDevice.bind(this),this.allDevices=this.videoDevices,await this.updateComplete,this.$$("#checkBox").checked=!1,this.$$("#selectDevices").open=!0):await this._checkAudioDevices()}_close(){this.mediaStream&&this.mediaStream.getTracks().forEach((function(t){t.stop()})),this.surfer&&(this.surfer.getActivePlugins()[0].stop(),this.surfer.destroy()),this.previewActive=!1,this.$$("#dialog").open=!1}_uploadFile(){this._close(),this.uploadFileFunction(this.videoAspect)}_sendBack(){this.callbackFunction&&this.recorder?(this.callbackFunction(this.recordedData),this.recordedData=void 0,this.recorder.clearRecordedData(),this.recorder.reset(),this.recorder=void 0,this._close()):console.error("No callback function for media player")}checkDevices(){navigator.mediaDevices.enumerateDevices().then((t=>{this.audioDevices=t.filter((t=>"audioinput"===t.kind)),this.videoDevices=t.filter((t=>"videoinput"===t.kind));let e=!1;this.videoDevices.forEach((function(t){t.label&&""!=t.label&&(e=!0)})),e||(this.videoDevices=void 0,this.audioDevices=void 0),this._checkVideoDevices()}))}connectedCallback(){super.connectedCallback(),window.innerHeight>window.innerWidth?this.videoAspect="portrait":this.videoAspect="landscape"}captureUserMedia(t){this.captureCallback=t,this.checkDevices()}_openMediaSession(t){if(t){this.selectedVideoDeviceId&&(this.videoSettings.deviceId=this.selectedVideoDeviceId);const e={audio:!this.selectedAudioDeviceId||{deviceId:this.selectedAudioDeviceId},video:this.videoRecording?this.videoSettings:void 0};navigator.mediaDevices.getUserMedia(e).then((e=>{e.getTracks().forEach((function(t){console.info(t.getCapabilities())})),t(e)})).catch((function(e){console.error(e),t(null)}))}}async open(t){this.callbackFunction=t.callbackFunction,this.recordingFinished=!1,this.error=void 0,this.audioRecording=t.audioRecording,this.videoRecording=t.videoRecording,this.maxLength=t.maxLength,this.uploadFileFunction=t.uploadFileFunction,this.recordSecondsLeft=this.maxLength,this.isMobile=/Android|iPhone|iPad/i.test(navigator.userAgent)||window.matchMedia("only screen and (max-width: 480px)").matches,this.videoAspect=window.innerHeight>window.innerWidth?"portrait":"landscape",await this.requestUpdate(),this.videoRecording?this.$$("#optionsDialog").open=!0:(this.$$("#dialog").open=!0,this.setupRecorders())}_generateRandomString(){if(window.crypto){const t=window.crypto.getRandomValues(new Uint32Array(3));let e="";for(let i=0,n=t.length;i<n;i++)e+=t[i].toString(36);return e}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}_startRecording(){this.isRecording?this._stopRecording():(this.recorder.startRecording(),this.recordSecondsLeft=this.maxLength,this.isRecording=!0,this.$$("#recordingIcon").className="recording",this._recordingTimer())}_stopRecording(){this.$$("#recordingIcon").className="",this.isRecording=!1,this.recorder.stopRecording(this._storeRecordedData.bind(this)),this.$$("#secondsLeft").className=""}_deleteRecording(){this.recorder.reset(),this.previewActive=!1,this.recordedData=void 0,this.recordSecondsLeft=this.maxLength,this.$$("#secondsLeft").className="",this.$$("#recordingIcon").className=""}_storeRecordedData(){const t=this.recorder.getBlob();let e;if(this.videoRecording){const i=this.shadowRoot.querySelector("#videoRecorder"),n=this.shadowRoot.querySelector("#videoPreviewer");e=this._generateRandomString()+".webm",this.recordedData=new File([t],e,{type:"video/webm"}),i.controls=!0,this.recorder.reset(),n.src=window.URL.createObjectURL(this.recordedData),n.controls=!0,this.previewActive=!0}else if(this.audioRecording){const i=this.shadowRoot.querySelector("#audioRecorder"),n=this.shadowRoot.querySelector("#audioPreviewer");e=this._generateRandomString()+".mp3",this.recordedData=new File([t],e,{type:"audio/mp3"}),i.controls=!0,i.pause(),n.src=window.URL.createObjectURL(this.recordedData),n.controls=!0,this.previewActive=!0}}_recordingTimer(){this.isRecording?setTimeout((()=>{this.isRecording&&(this.recordSecondsLeft>0?this._recordingTimer():this._stopRecording(),this.recordSecondsLeft>0&&(this.recordSecondsLeft-=1),this.recordSecondsLeft<=5&&(this.$$("#secondsLeft").className="recordingTime"))}),1e3):console.error("_recordingTimer called without in recording mode")}setupRecorders(){if(this.recordSecondsLeft=this.maxLength,this.videoRecording){const t=this.shadowRoot.querySelector("#videoRecorder");this.captureUserMedia((e=>{if(e){this.mediaStream=e;try{t.srcObject=e}catch(i){console.error(i),t.src=window.URL.createObjectURL(e)}t.play(),t.muted=!0,t.controls=!1,this.recorder=$(e,{type:"video"})}else console.error("Can't find stream"),this.$$("#noDevices").open=!0,this.$$("#uploadFileButton").style.color="#F00"}))}else if(this.audioRecording){const t=this.shadowRoot.querySelector("#audioRecorder");this.captureUserMedia((e=>{if(e){this.mediaStream=e;try{t.srcObject=e}catch(i){console.error(i),t.src=window.URL.createObjectURL(e)}t.play(),t.muted=!0,t.controls=!1,this.surfer=(void 0)({container:this.$$("#waveform"),waveColor:"#ff3d00",progressColor:"#ff3d00",cursorWidth:0,plugins:[(void 0)({stream:this.mediaStream})]}),this.surfer.getActivePlugins()[0].play(),this.recorder=new $(e,{type:"audio"})}else console.error("Can't find stream"),this.$$("#noDevices").open=!0,this.$$("#uploadFileButton").style.color="#F00"}))}setTimeout((()=>{}))}};N([t({type:Object})],z.prototype,"recorder",void 0),N([t({type:Object})],z.prototype,"mediaStream",void 0),N([t({type:Object})],z.prototype,"captureStream",void 0),N([t({type:Boolean})],z.prototype,"audioRecording",void 0),N([t({type:Boolean})],z.prototype,"videoRecording",void 0),N([t({type:Number})],z.prototype,"maxLength",void 0),N([t({type:Object})],z.prototype,"recordedData",void 0),N([t({type:Boolean})],z.prototype,"recordingFinished",void 0),N([t({type:Boolean})],z.prototype,"isRecording",void 0),N([t({type:Boolean})],z.prototype,"rememberDevice",void 0),N([t({type:Boolean})],z.prototype,"previewActive",void 0),N([t({type:Object})],z.prototype,"callbackFunction",void 0),N([t({type:Object})],z.prototype,"captureCallback",void 0),N([t({type:Object})],z.prototype,"uploadFileFunction",void 0),N([t({type:Object})],z.prototype,"selectDeviceFunction",void 0),N([t({type:String})],z.prototype,"error",void 0),N([t({type:String})],z.prototype,"selectDeviceTitle",void 0),N([t({type:Number})],z.prototype,"recordSecondsLeft",void 0),N([t({type:Array})],z.prototype,"audioDevices",void 0),N([t({type:Array})],z.prototype,"videoDevices",void 0),N([t({type:Array})],z.prototype,"allDevices",void 0),N([t({type:Object})],z.prototype,"videoOptions",void 0),N([t({type:Object})],z.prototype,"surfer",void 0),N([e()],z.prototype,"videoAspect",void 0),N([t({type:String})],z.prototype,"selectedCamera",void 0),N([t({type:Boolean})],z.prototype,"hasFacingMode",void 0),N([t({type:Boolean})],z.prototype,"isMobile",void 0),z=N([i("yp-media-recorder")],z);export{z as YpMediaRecorder};
