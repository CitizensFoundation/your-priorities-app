<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <title>yp-points-actions tests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <script src="../../../../../@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
  <script src="../../../../../wct-browser-legacy/browser.js"></script>
  <script src="../../../../../@polymer/test-fixture/test-fixture-mocha.js"></script>

  <script type="module" src="../../../../../@polymer/test-fixture/test-fixture.js"></script>
  <script type="text/javascript" src="../../i18next-1.7.4.min.js"></script>

  <script type="module" src="../../yp-app-globals/yp-app-globals.js"></script>
  <script type="module" src="../yp-point-actions.js"></script>

</head>
<body>

<yp-app-globals disable-welcome></yp-app-globals>

<test-fixture id="basic">
  <template is="dom-template">
    <yp-point-actions point="{{point}}" style="width:300px;"></yp-point-actions>
  </template>
</test-fixture>

<script type="module">
import '../../../../../@polymer/test-fixture/test-fixture.js';
import '../../yp-app-globals/yp-app-globals.js';
import '../yp-point-actions.js';
suite('point quality counted correctly', function() {

  test('point quality count correct', function() {
    var pointActions = fixture('basic', {point: {PointQualities: [{value: 1},{value: -1},{value: 1},{value: -1},
                                                                 {value: -1},{value: 1},{value: 1},{value: 1}]}});
    var point = pointActions.point;


    expect(point.PointQualities).to.be.eql([{value: 1},{value: -1},{value: 1},{value: -1},
                                           {value: -1},{value: 1},{value: 1},{value: 1}]);

    expect(pointActions.voteCount(point.PointQualities,'up')).to.be.equal('5');
    expect(pointActions.voteCount(point.PointQualities,'down')).to.be.equal('3');
  });

  test('displays counters', function() {
    var pointActions = fixture('basic', {point: {PointQualities: [{value: 1},{value: -1},{value: 1},{value: -1},
      {value: -1},{value: 1},{value: 1},{value: 1}]}});

    expect(pointActions.innerHTML).to.include("5");
    expect(pointActions.innerHTML).to.include("3");
  });

  test('point up vote dialog is displayed', function(done) {
    var pointActions = fixture('basic', {point: {PointQualities: [{value: 1},{value: -1},{value: 1},{value: -1},
      {value: -1},{value: 1},{value: 1},{value: 1}]}});

    var button = pointActions.querySelector('.point-up-vote-icon');
    button.click();

    this.async(function() {
      var defaultDialog = document.querySelector('#dialog');
      expect(defaultDialog.opened).to.be.equal(true);
      done();
    });
  });

  test('point down vote dialog is displayed', function(done) {
    var pointActions = fixture('basic', {point: {PointQualities: [{value: 1},{value: -1},{value: 1},{value: -1},
      {value: -1},{value: 1},{value: 1},{value: 1}]}});

    var button = pointActions.querySelector('.point-down-vote-icon');
    button.click();

    this.async(function() {
      var defaultDialog = document.querySelector('#dialog');
      expect(defaultDialog.opened).to.be.equal(true);
      done();
    });
  });
});
</script>
</body>
</html>
