<div hidden=""by-polymer-bundler=""><dom-module id="yp-post-points"><template><style include="iron-flex iron-flex-alignment">:host{display:block;}.item{@apply --layout-horizontal;}paper-button, paper-textarea-aria{font-family:var(--app-normal-font-family, Roboto);}.main-container{@apply --layout-horizontal;background-color:var(--primary-background-color);}.point{padding-top:32px;padding-bottom:32px;padding-left:24px;padding-right:24px;@apply --layout-vertical;width:398px;}.pointInputMaterial{padding-top:24px;padding-left:16px;padding-right:16px;padding-bottom:16px;margin-bottom:16px;background-color:#FFF;}paper-toast{z-index:9999;}paper-material{background-color:#fff;}yp-point{padding-top:8px;}.pointMaterial{padding-top:8px;background-color:#FFF;padding-left:0;padding-right:0;width:430px;margin-bottom:12px;}.thumbIcon{height:64px;width:64px;padding-bottom:16px;color:var(--primary-color);}.editIcon{height:28px;width:28px;padding-bottom:16px;color:var(--primary-color);}.addPointFab{width:100%;color:#FFF;margin-bottom:18px;}paper-textarea-aria{--paper-input-container-label:{font-size:22px;height:30px;overflow:visible;color:#AAAAAA;font-family:var(--app-normal-font-family, Roboto);};font-family:var(--app-normal-font-family, Roboto);}.howToWriteInfoText{padding-top:4px;color:var(--primary-color);}.point .main-container .topContainer{background-color:var(--primary-background-color) !important;}.penContainer{margin-top:42px;}.upOrDown{margin-top:72px;}paper-radio-button{--paper-radio-button-checked-color:var(--accent-color) !important;font-size:16px;}#pointUpOrDownMaterial{margin-top:16px;width:100%;}.mobileFab{margin-top:8px;}paper-button{color:#FFF;background-color:var(--accent-color);}paper-spinner{margin-top:7px;margin-bottom:6px;}@media (max-width: 985px){paper-spinner{margin-top:4px;margin-bottom:4px;}.pointInputMaterial{width:100%;max-width:568px;font-size:14px;padding-top:4px;margin-top:0;}.pointMaterial{width:100%;max-width:600px;padding-left:0;padding-right:0;}#pointUpOrDownMaterial{margin-top:16px;}.main-container{width:100%;}iron-list{width:100vw;}.pointMaterial{}}@media (max-width: 420px){.pointInputMaterial{width:90%;max-width:90%;}}.mobilePaperTextArea{--paper-input-container-label:{font-size:19px;font-family:var(--app-normal-font-family, Roboto);};font-family:var(--app-normal-font-family, Roboto);}.pointMainHeader{font-size:26px;margin-bottom:16px;color:#555;}#pointUpMaterialNotUsed{border-top:solid 2px;border-top-color:var(--master-point-up-color);}#pointDownMaterialNotUsed{border-top:solid 2px;border-top-color:var(--master-point-down-color);}.pointElement{margin-bottom:18px;}[hidden]{display:none !important;}iron-list{height:80vh;}iron-list{--iron-list-items-container:{};}:focus{}#ironListMobile[debate-disabled]{margin-top:16px;}.mainSpinner{margin:32px;}paper-button[disabled]{background-color:#333;color:#FFF;}.uploadNotLoggedIn{min-width:100px;background-color:#FFF;color:#000;margin-bottom:24px;}.uploadNotLoggedIn > .icon{padding-right:8px;}.pointButtons{margin-bottom:4px;}.bottomDiv{margin-bottom:64px;}.uploadSection{justify-content:space-evenly;width:50%;margin-left:8px;margin-right:8px;vertical-align:top;}.videoUploadDisclamer{font-size:12px;padding:8px;margin-bottom:4px;}.pointMaterialMobile[is-last-point]{margin-bottom:107px;}div[rtl]{direction:rtl;}paper-radio-button{--paper-radio-button-label:{padding-right:6px;};}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-yp-update-points-for-post="_loadNewPointsIfNeeded"></lite-signal><lite-signal on-lite-signal-logged-in="_userLoggedIn"></lite-signal><iron-media-query query="(min-width: 985px)"query-matches="{{largeMode}}"></iron-media-query><div class="layout horizontal center-center"hidden$="[[ajaxActive]]"><yp-ajax id="ajax"large-spinner=""active$="{{ajaxActive}}"on-response="_response"></yp-ajax></div><div class="layout horizontal center-center"hidden=""><yp-ajax id="moreAjax"hidden=""on-response="_morePointsResponse"></yp-ajax></div><template is="dom-if"if="[[largeModeReady]]"restamp=""><div rtl$="[[rtl]]"class="layout vertical topContainer"><div class="main-container"><div class="point"><template is="dom-if"if="[[!post.Group.configuration.alternativePointForHeader]]"><div class="pointMainHeader layout horizontal center-center"role="heading"aria-level="2">[[t('pointsFor')]]</div></template><template is="dom-if"if="[[post.Group.configuration.alternativePointForHeader]]"><div class="pointMainHeader layout horizontal center-center"><yp-magic-text content-id="[[post.Group.id]]"text-only=""content="[[post.Group.configuration.alternativePointForHeader]]"content-language="[[post.Group.language]]"role="heading"aria-level="2"class="ratingName"text-type="alternativePointForHeader"></yp-magic-text></div></template><paper-material id="pointUpMaterial"elevation="1"class="pointInputMaterial layout vertical"animated=""hidden$="[[disableDebate]]"><paper-textarea-aria id="up_point"on-tap="focusUpPoint"on-focus="focusTextArea"on-blur="blurTextArea"value="{{textValueUp}}"label="[[labelUp]]"always-float-label="[[_floatIfValueOrIE()]]"char-counter=""rows="2"hidden$="[[hideUpText]]"max-rows="3"maxlength="[[pointMaxLength]]"></paper-textarea-aria><div class="horizontal end-justified layout"hidden$="[[post.Group.configuration.hideEmoji]]"><emoji-selector id="pointUpEmojiSelector"hidden$="[[hideUpText]]"></emoji-selector></div><div class="layout horizontal center-justified"><template is="dom-if"if="[[post.Group.configuration.allowPointVideoUploads]]"><div hidden$="[[hideUpVideo]]"class="uploadSection"><div class="layout vertical center-center self-start"hidden$="[[!loggedInUser]]"><yp-file-upload id="videoFileUploadUp"upload-limit-seconds="[[post.Group.configuration.videoPointUploadLimitSec]]"no-default-cover-image=""current-file="{{hasCurrentUpVideo}}"container-type="points"group="[[post.Group]]"raised="true"multi="false"video-upload=""method="POST"on-success="_videoUpUploaded"><iron-icon class="icon"icon="videocam"></iron-icon><span>[[t('uploadVideoPointFor')]]</span></yp-file-upload></div><div hidden$="[[!post.Group.configuration.showVideoUploadDisclaimer]]"><div class="videoUploadDisclamer"hidden$="[[!uploadedVideoUpId]]">[[t('videoUploadDisclaimer')]]</div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn"raised=""hidden$="[[loggedInUser]]"on-tap="_openLogin"><iron-icon class="icon"icon="videocam"></iron-icon>[[t('uploadVideoPointFor')]]</paper-button></div></div></template><template is="dom-if"if="[[post.Group.configuration.allowPointAudioUploads]]"><div hidden$="[[hideUpAudio]]"class="uploadSection"><div class="layout vertical center-center"hidden$="[[!loggedInUser]]"><yp-file-upload id="audioFileUploadUp"current-file="{{hasCurrentUpAudio}}"container-type="points"upload-limit-seconds="[[post.Group.configuration.audioPointUploadLimitSec]]"group="[[post.Group]]"raised="true"multi="false"audio-upload=""method="POST"on-success="_audioUpUploaded"><iron-icon class="icon"icon="keyboard-voice"></iron-icon><span>[[t('uploadAudioPointFor')]]</span></yp-file-upload></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn"raised=""hidden$="[[loggedInUser]]"on-tap="_openLogin"><iron-icon class="icon"icon="keyboard-voice"></iron-icon>[[t('uploadAudioPointFor')]]</paper-button></div></div></template></div><div hidden="[[!ifLengthUpIsRight]]"><div class="addPointFab layout horizontal center-center"><paper-button raised=""class="submitButton"hidden$="[[addPointDisabled]]"icon="add"mini=""elevation="3"on-tap="addPointUp"title="[[t('postPoint')]]">[[t('postPoint')]]</paper-button><paper-spinner hidden$="[[!addPointDisabled]]"active=""></paper-spinner></div></div></paper-material><div id="allUpPoints"><iron-scroll-threshold id="ironScrollThesholdUp"scroll-target="document"on-lower-threshold="_loadMorePoints"><iron-list id="ironListUp"lower-threshold="200"items="[[upPoints]]"role="list"as="point"scroll-target="document"scroll-offset="550"><template><div class="item"tabindex$="[[tabIndex]]"role="listitem"aria-level="3"><paper-material id="point[[point.id]]"elevation="1"animated=""class="pointMaterial"><yp-point post="[[post]]"point="[[point]]"></yp-point></paper-material></div></template></iron-list></iron-scroll-threshold></div></div><div class="point"hidden$="[[post.Group.configuration.hidePointAgainst]]"><template is="dom-if"if="[[!post.Group.configuration.alternativePointAgainstHeader]]"><div class="pointMainHeader layout horizontal center-center"role="heading"aria-level="2">[[t('pointsAgainst')]]</div></template><template is="dom-if"if="[[post.Group.configuration.alternativePointAgainstHeader]]"><div class="pointMainHeader layout horizontal center-center"><yp-magic-text content-id="[[post.Group.id]]"text-only=""content="[[post.Group.configuration.alternativePointAgainstHeader]]"content-language="[[post.Group.language]]"role="heading"aria-level="2"class="ratingName"text-type="alternativePointAgainstHeader"></yp-magic-text></div></template><template is="dom-if"if="[[post.Group.configuration.alternativePointForLabel]]"><yp-magic-text id="alternativePointForLabelId"hidden=""content-id="[[post.Group.id]]"text-only=""content="[[post.Group.configuration.alternativePointForLabel]]"content-language="[[post.Group.language]]"on-new-translation="_updatePointLabels"role="heading"aria-level="2"text-type="alternativePointForLabel"></yp-magic-text></template><template is="dom-if"if="[[post.Group.configuration.alternativePointAgainstLabel]]"><yp-magic-text id="alternativePointAgainstLabelId"hidden=""content-id="[[post.Group.id]]"text-only=""content="[[post.Group.configuration.alternativePointAgainstLabel]]"content-language="[[post.Group.language]]"on-new-translation="_updatePointLabels"role="heading"aria-level="2"text-type="alternativePointAgainstLabel"></yp-magic-text></template><paper-material id="pointDownMaterial"elevation="1"class="pointInputMaterial layout vertical"animated=""hidden$="[[disableDebate]]"><paper-textarea-aria id="down_point"on-tap="focusDownPoint"on-focus="focusTextArea"on-blur="blurTextArea"value="{{textValueDown}}"label="[[labelDown]]"char-counter=""rows="2"hidden$="[[hideDownText]]"always-float-label="[[_floatIfValueOrIE()]]"max-rows="5"maxlength="[[pointMaxLength]]"></paper-textarea-aria><div class="horizontal end-justified layout"hidden$="[[post.Group.configuration.hideEmoji]]"><emoji-selector id="pointDownEmojiSelector"hidden$="[[hideDownText]]"></emoji-selector></div><div class="layout horizontal center-justified"><template is="dom-if"if="[[post.Group.configuration.allowPointVideoUploads]]"><div hidden$="[[hideDownVideo]]"class="uploadSection"><div class="layout vertical center-center self-start"hidden$="[[!loggedInUser]]"><yp-file-upload id="videoFileUploadDown"current-file="{{hasCurrentDownVideo}}"container-type="points"upload-limit-seconds="[[post.Group.configuration.videoPointUploadLimitSec]]"no-default-cover-image=""group="[[post.Group]]"raised="true"multi="false"video-upload=""method="POST"on-success="_videoDownUploaded"><iron-icon class="icon"icon="videocam"></iron-icon><span>[[t('uploadVideoPointAgainst')]]</span></yp-file-upload></div><div hidden$="[[!post.Group.configuration.showVideoUploadDisclaimer]]"><div class="videoUploadDisclamer"hidden$="[[!uploadedVideoDownId]]">[[t('videoUploadDisclaimer')]]</div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn"raised=""hidden$="[[loggedInUser]]"on-tap="_openLogin"><iron-icon class="icon"icon="videocam"></iron-icon>[[t('uploadVideoPointAgainst')]]</paper-button></div></div></template><template is="dom-if"if="[[post.Group.configuration.allowPointAudioUploads]]"><div hidden$="[[hideDownAudio]]"class="uploadSection"><div class="layout vertical center-center"hidden$="[[!loggedInUser]]"><yp-file-upload id="audioFileUploadDown"current-file="{{hasCurrentDownAudio}}"container-type="points"upload-limit-seconds="[[post.Group.configuration.audioPointUploadLimitSec]]"group="[[post.Group]]"raised="true"multi="false"audio-upload=""method="POST"on-success="_audioDownUploaded"><iron-icon class="icon"icon="keyboard-voice"></iron-icon><span>[[t('uploadAudioPointAgainst')]]</span></yp-file-upload></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn"raised=""hidden$="[[loggedInUser]]"on-tap="_openLogin"><iron-icon class="icon"icon="keyboard-voice"></iron-icon>[[t('uploadAudioPointAgainst')]]</paper-button></div></div></template></div><div hidden="[[!ifLengthDownIsRight]]"><div class="addPointFab layout horizontal center-center"><paper-button raised=""hidden$="[[addPointDisabled]]"icon="add"elevation="3"on-tap="addPointDown"title="[[t('postPoint')]]">[[t('postPoint')]]</paper-button><paper-spinner hidden$="[[!addPointDisabled]]"active=""></paper-spinner></div></div></paper-material><div id="allDownPoints"><iron-scroll-threshold id="ironScrollThesholdDown"scroll-target="document"on-lower-threshold="_loadMorePoints"><iron-list id="ironListDown"lower-threshold="200"items="[[downPoints]]"role="list"as="point"scroll-target="document"scroll-offset="550"><template><div class="item"tabindex$="[[tabIndex]]"role="listitem"aria-level="3"><paper-material id="point[[point.id]]"elevation="1"animated=""class="pointMaterial"><yp-point post="[[post]]"point="[[point]]"></yp-point></paper-material></div></template></iron-list></iron-scroll-threshold></div></div></div></div></template><template is="dom-if"if="[[smallModeReady]]"restamp=""><div rtl$="[[rtl]]"class="layout vertical center-center"><paper-material id="pointUpOrDownMaterial"elevation="0"class="pointInputMaterial layout vertical"animated=""hidden$="[[disableDebate]]"><paper-textarea-aria id="mobileUpOrDownPoint"class="mobilePaperTextArea"on-tap="focusDownPoint"on-focus="focusTextArea"on-blur="blurTextArea"value="{{textValueMobileUpOrDown}}"label="[[labelMobileUpOrDown]]"char-counter=""rows="2"hidden$="[[hideMobileText]]"max-rows="3"maxlength="[[pointMaxLength]]"></paper-textarea-aria><div class="layout vertical end-justified"><div class="layout horizontal center-center pointButtons"><paper-radio-group hidden$="[[post.Group.configuration.hidePointAgainst]]"id="upOrDown"attribute-for-selected="name"class="layout horizontal"selected="{{pointUpOrDownSelected}}"><paper-radio-button name="pointFor">[[t('pointForShort')]]</paper-radio-button><paper-radio-button name="pointAgainst">[[t('pointAgainstShort')]]</paper-radio-button></paper-radio-group><div class="flex"></div><div hidden$="[[hideMobileText]]"><emoji-selector id="pointUpDownEmojiSelector"hidden$="[[post.Group.configuration.hideEmoji]]"></emoji-selector></div></div><div class="layout horizontal center-justified"><template is="dom-if"if="[[post.Group.configuration.allowPointVideoUploads]]"><div hidden$="[[hideMobileVideo]]"class="uploadSection"><div class="layout vertical center-center self-start"hidden$="[[!loggedInUser]]"><yp-file-upload id="videoFileUploadMobile"current-file="{{hasCurrentMobileVideo}}"container-type="points"upload-limit-seconds="[[post.Group.configuration.videoPointUploadLimitSec]]"no-default-cover-image=""group="[[post.Group]]"raised="true"multi="false"video-upload=""method="POST"on-success="_videoMobileUploaded"><iron-icon class="icon"icon="videocam"></iron-icon><span hidden$="[[!selectedPointForMobile]]">[[t('uploadVideoPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('uploadVideoPointAgainst')]]</span></yp-file-upload></div><div hidden$="[[!post.Group.configuration.showVideoUploadDisclaimer]]"><div class="videoUploadDisclamer"hidden$="[[!uploadedVideoMobileId]]">[[t('videoUploadDisclaimer')]]</div></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn"raised=""hidden$="[[loggedInUser]]"on-tap="_openLogin"><iron-icon class="icon"icon="videocam"></iron-icon><span hidden$="[[!selectedPointForMobile]]">[[t('uploadVideoPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('uploadVideoPointAgainst')]]</span></paper-button></div></div></template><template is="dom-if"if="[[post.Group.configuration.allowPointAudioUploads]]"><div hidden$="[[hideMobileAudio]]"class="uploadSection"><div class="layout vertical center-center self-start"hidden$="[[!loggedInUser]]"><yp-file-upload id="audioFileUploadMobile"current-file="{{hasCurrentMobileAudio}}"container-type="points"upload-limit-seconds="[[post.Group.configuration.audioPointUploadLimitSec]]"group="[[post.Group]]"raised="true"multi="false"audio-upload=""method="POST"on-success="_audioMobileUploaded"><iron-icon class="icon"icon="keyboard-voice"></iron-icon><span hidden$="[[!selectedPointForMobile]]">[[t('uploadAudioPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('uploadAudioPointAgainst')]]</span></yp-file-upload></div><div class="layout horizontal center-center"><paper-button class="uploadNotLoggedIn"raised=""hidden$="[[loggedInUser]]"on-tap="_openLogin"><iron-icon class="icon"icon="keyboard-voice"></iron-icon><span hidden$="[[!selectedPointForMobile]]">[[t('uploadAudioPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('uploadAudioPointAgainst')]]</span></paper-button></div></div></template></div></div><div hidden="[[!ifLengthMobileRight]]"><div class="addPointFab layout horizontal center-center mobileFab"><paper-button raised=""hidden$="[[addPointDisabled]]"icon="add"elevation="3"on-tap="addMobilePointUpOrDown"title="[[t('postPoint')]]"><span hidden$="[[!selectedPointForMobile]]">[[t('postPointFor')]]</span> <span hidden$="[[selectedPointForMobile]]">[[t('postPointAgainst')]]</span></paper-button><paper-spinner hidden$="[[!addPointDisabled]]"active=""></paper-spinner></div></div></paper-material></div><div rtl$="[[rtl]]"class="layout vertical center-center"><iron-scroll-threshold id="ironScrollThesholdMobile"scroll-target="[[scrollTarget]]"on-lower-threshold="_loadMorePoints"><iron-list id="ironListMobile"lower-threshold="150"debate-disabled$="[[disableDebate]]"role="list"items="[[points]]"as="point"scroll-target="[[scrollTarget]]"scroll-offset="[[mobileScrollOffset]]"><template><div class="item layout vertical center-center"tabindex$="[[tabIndex]]"role="listitem"aria-level="3"><paper-material id="point[[point.id]]"elevation="0"animated=""is-last-point$="[[point.isLastPointInList]]"class="pointMaterial pointMaterialMobile"><yp-point post="[[post]]"point="[[point]]"></yp-point></paper-material></div></template></iron-list></iron-scroll-threshold></div></template><div class="layout vertical center-center"><yp-ajax id="newPointsAjax"on-response="_newPointsResponse"></yp-ajax><yp-ajax id="newPointAjax"on-error="_newPointError"method="POST"url="/api/points"on-response="_newPointResponse"></yp-ajax></div><paper-toast id="newPointToast"text="[[newPointTextCombined]]"></paper-toast></template><script>Polymer({is:"yp-post-points",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypTruncateBehavior,Polymer.ypLoggedInUserBehavior],properties:{host:String,isAdmin:{type:Boolean,value:!1,observer:"_isAdminChanged"},disableDebate:{type:Boolean,value:!1},downPoints:{type:Array,value:[]},upPoints:{type:Array,value:[]},textValueUp:{type:String,notify:!0,value:""},textValueDown:{type:String,notify:!0,value:""},newPointTextCombined:{type:String},post:{type:Object,observer:"_postChanged"},points:{type:Array,value:null,observer:"_pointsChanged"},rtl:{type:Boolean,value:!1},largeMode:{type:Boolean,value:!1,observer:"_updateEmojiBindings"},largeModeReady:{type:Boolean,computed:"_largeModeReady(largeMode, post)"},smallModeReady:{type:Boolean,computed:"_smallModeReady(largeMode, post)"},textValueMobileUpOrDown:String,labelMobileUpOrDown:String,labelUp:String,labelDown:String,pointUpOrDownSelected:{type:String,observer:"_pointUpOrDownSelectedChanged",value:"pointFor"},latestPointCreatedAt:{type:Date,value:null},scrollToId:{type:String,value:null},ironListResizeScrollThreshold:{type:Number,computed:"_ironListResizeScrollThreshold(largeMode)"},ironListPaddingTop:{type:Number,computed:"_ironListPaddingTop(wide)"},ifLengthUpIsRight:{type:Boolean,value:!1,computed:'ifLengthIsRight("up",textValueUp, uploadedVideoUpId, uploadedAudioUpId)'},ifLengthDownIsRight:{type:Boolean,value:!1,computed:'ifLengthIsRight("down", textValueDown, uploadedVideoDownId, uploadedAudioDownId)'},ifLengthMobileRight:{type:Boolean,value:!1,computed:'ifLengthIsRight("mobile", textValueMobileUpOrDown, uploadedVideoMobileId, uploadedAudioMobileId)'},addPointDisabled:{type:Boolean,value:!1},mobileScrollOffset:{type:Number,computed:"_mobileScrollOffset(largeMode,post)"},ajaxActive:{type:Boolean,value:!1},uploadedVideoUpId:{type:String,value:null},uploadedVideoDownId:{type:String,value:null},uploadedVideoMobileId:{type:String,value:null},currentVideoId:{type:String,value:null},hideUpVideo:{type:Boolean,value:!1},hideDownVideo:{type:Boolean,value:!1},hideMobileVideo:{type:Boolean,value:!1},uploadedAudioUpId:{type:String,value:null},uploadedAudioDownId:{type:String,value:null},uploadedAudioMobileId:{type:String,value:null},currentAudioId:{type:String,value:null},hideUpAudio:{type:Boolean,value:!1},hideDownAudio:{type:Boolean,value:!1},hideMobileAudio:{type:Boolean,value:!1},hideUpText:{type:Boolean,value:!1},hideDownText:{type:Boolean,value:!1},hideMobileText:{type:Boolean,value:!1},selectedPointForMobile:{type:Boolean,value:!0},isAndroid:{type:Boolean,value:!1},hasCurrentUpVideo:{type:String,observer:"_hasCurrentUpVideo"},hasCurrentDownVideo:{type:String,observer:"_hasCurrentDownVideo"},hasCurrentMobileVideo:{type:String,observer:"_hasCurrentMobileVideo"},hasCurrentUpAudio:{type:String,observer:"_hasCurrentUpAudio"},hasCurrentDownAudio:{type:String,observer:"_hasCurrentDownAudio"},hasCurrentMobileAudio:{type:String,observer:"_hasCurrentMobileAudio"},storedPoints:{type:Array,value:null},pointMaxLength:{type:Number,computed:"_pointMaxLength(post, largeMode)"},isPostPage:{type:Boolean,value:!1},scrollTarget:{type:String,computed:"_scrollTarget(isPostPage)"}},_scrollTarget:function(t){return t?"document":void 0},_largeModeReady:function(t,i){return t&&i},_smallModeReady:function(t,i){return!t&&i},_pointMaxLength:function(t){return t&&t.Group&&t.Group.configuration&&t.Group.configuration.pointCharLimit?t.Group.configuration.pointCharLimit:500},_openLogin:function(){this.fire("yp-open-login")},_videoUpUploaded:function(t,i){this.set("uploadedVideoUpId",i.videoId)},_videoDownUploaded:function(t,i){this.set("uploadedVideoDownId",i.videoId)},_videoMobileUploaded:function(t,i){this.set("uploadedVideoMobileId",i.videoId)},_audioUpUploaded:function(t,i){this.set("uploadedAudioUpId",i.audioId)},_audioDownUploaded:function(t,i){this.set("uploadedAudioDownId",i.audioId)},_audioMobileUploaded:function(t,i){this.set("uploadedAudioMobileId",i.audioId)},_mobileScrollOffset:function(t,i){if(!t&&i){var e=this.$$("#ironListMobile");if(e){var o=e.getBoundingClientRect().top;return o<=0&&(o=800),o}return console.warn("Can't find mobile list element, returning 800"),800}},_newPointError:function(){this.set("addPointDisabled",!1)},_ironListResizeScrollThreshold:function(){return 300},_ironListPaddingTop:function(t){return t?600:500},ready:function(){-1<navigator.userAgent.toLowerCase().indexOf("android")&&this.set("isAndroid",!0),window.addEventListener("resize",this._processStoredPoints.bind(this))},detached:function(){window.removeEventListener("resize",this._processStoredPoints)},listeners:{"yp-point-deleted":"_pointDeleted","yp-update-point-in-list":"_updatePointInLists","yp-iron-resize":"_ypIronResize"},observers:["_setupPointTextStartState(pointUpOrDownSelected, post)"],_ypIronResize:function(){this.$$("#ironListUp")&&this.$$("#ironListUp").fire("iron-resize"),this.$$("#ironListDown")&&this.$$("#ironListDown").fire("iron-resize"),this.$$("#ironListMobile")&&this.$$("#ironListMobile").fire("iron-resize")},_setupPointTextStartState:function(t,i){i&&this._pointUpOrDownSelectedChanged(t)},_loadNewPointsIfNeeded:function(t,i){this.post&&this.post.id==i.postId&&(this.latestPointCreatedAt?(this.$.newPointsAjax.url="/api/posts/"+this.post.id+"/newPoints",this.$.newPointsAjax.params={latestPointCreatedAt:this.latestPointCreatedAt},this.$.newPointsAjax.generateRequest()):console.error("Trying to send point without latestPointCreatedAt"))},_loadMorePoints:function(){this.loadMoreInProgress||this.noMorePoints||(this.loadMoreInProgress=!0,this.post&&this.storedPoints&&0<this.storedPoints.length?(this.host?this.$.moreAjax.url=this.host+"/api/posts/"+this.post.id+"/points":this.$.moreAjax.url="/api/posts/"+this.post.id+"/points",this.$.moreAjax.params={offsetUp:this.storedUpPointsCount?this.storedUpPointsCount:0,offsetDown:this.storedDownPointsCount?this.storedDownPointsCount:0},this.$.moreAjax.generateRequest()):(console.warn("Trying to load more points early"),this.loadMoreInProgress=!1))},_interleaveMorePoints:function(t){for(var i=[],e=[],o=0;o<t.length;o++)0<t[o].value?i.push(t[o]):t[o].value<0&&e.push(t[o]);return this.interleaveArrays(i,e)},_morePointsResponse:function(t,i){this.loadMoreInProgress=!1;var e=this._preProcessPoints(i.response.points);0===e.length&&(this.noMorePoints=!0);var o=!1;(e=this._interleaveMorePoints(e)).forEach(function(t){this._addMorePoint(t)&&(o=!0)}.bind(this)),this.async(function(){this.$$("#ironListUp")&&this.$$("#ironListUp").fire("iron-resize"),this.$$("#ironListDown")&&this.$$("#ironListDown").fire("iron-resize"),this.$$("#ironListMobile")&&this.$$("#ironListMobile").fire("iron-resize")},5),o&&this._clearScrollTrigger()},_clearScrollTrigger:function(){this.$$("#ironScrollThesholdUp")&&this.$$("#ironScrollThesholdUp").clearTriggers(),this.$$("#ironScrollThesholdDown")&&this.$$("#ironScrollThesholdDown").clearTriggers(),this.$$("#ironScrollThesholdMobile")&&this.$$("#ironScrollThesholdMobile").clearTriggers()},_newPointsResponse:function(t,i){this._preProcessPoints(i.response).forEach(function(t){this._insertNewPoint(t)}.bind(this)),this._updateCounterInfo()},_pointDeleted:function(){this.$.ajax.generateRequest()},_pointsChanged:function(t){t&&this._updateEmojiBindings()},_updateEmojiBindings:function(){this.async(function(){if(this.largeMode){var t=this.$$("#up_point"),i=this.$$("#down_point"),e=this.$$("#pointUpEmojiSelector"),o=this.$$("#pointDownEmojiSelector");t&&i&&e&&o?(e.inputTarget=t,o.inputTarget=i):console.warn("Wide: Can't bind emojis :(")}else{var n=this.$$("#mobileUpOrDownPoint"),s=this.$$("#pointUpDownEmojiSelector");n&&s?s.inputTarget=n:console.warn("Small: Can't bind emojis :(")}}.bind(this),500)},_pointUpOrDownSelectedChanged:function(t){"pointFor"==t?(this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.alternativePointForLabel?this.set("labelMobileUpOrDown",this.post.Group.configuration.alternativePointForLabel):this.set("labelMobileUpOrDown",this.t("point.for")),this.set("selectedPointForMobile",!0)):"pointAgainst"==t&&(this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.alternativePointAgainstLabel?this.set("labelMobileUpOrDown",this.post.Group.configuration.alternativePointAgainstLabel):this.set("labelMobileUpOrDown",this.t("point.against")),this.set("selectedPointForMobile",!1))},_clearVideo:function(){this.set("uploadedVideoUpId",null),this.set("uploadedVideoDownId",null),this.set("uploadedVideoMobileId",null),this.set("currentVideoId",null),this.set("hideUpVideo",!1),this.set("hideDownVideo",!1),this.set("hideMobileVideo",!1),this.$$("#videoFileUploadUp")&&this.$$("#videoFileUploadUp").clear(),this.$$("#videoFileUploadDown")&&this.$$("#videoFileUploadDown").clear(),this.$$("#videoFileUploadMobile")&&this.$$("#videoFileUploadMobile").clear()},_clearAudio:function(){this.set("uploadedAudioUpId",null),this.set("uploadedAudioDownId",null),this.set("uploadedAudioMobileId",null),this.set("currentAudioId",null),this.set("hideUpAudio",!1),this.set("hideDownAudio",!1),this.set("hideMobileAudio",!1),this.$$("#audioFileUploadUp")&&this.$$("#audioFileUploadUp").clear(),this.$$("#audioFileUploadDown")&&this.$$("#audioFileUploadDown").clear(),this.$$("#audioFileUploadMobile")&&this.$$("#audioFileUploadMobile").clear()},_isAdminChanged:function(t){this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.disableDebate?t&&this.post.Group.configuration.allowAdminsToDebate?this.set("disableDebate",!1):this.set("disableDebate",!0):this.set("disableDebate",!1)},_postChanged:function(t){this.set("points",null),this.set("upPoints",null),this.set("downPoints",null),this.set("latestPointCreatedAt",null),this.set("storedPoints",null),this._clearVideo(),this._clearAudio(),this.loadedPointIds={},this.storedUpPointsCount=null,this.storedDownPointsCount=null,t&&(t.Group&&t.Group.configuration&&t.Group.configuration.disableDebate?this.set("disableDebate",!0):this.set("disableDebate",!1),this.host?this.$.ajax.url=this.host+"/api/posts/"+t.id+"/points":this.$.ajax.url="/api/posts/"+t.id+"/points",this.$.ajax.generateRequest(),this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.alternativePointForLabel?this.set("labelUp",this.post.Group.configuration.alternativePointForLabel):this.set("labelUp",this.t("point.for")),this.post&&this.post.Group&&this.post.Group.configuration&&this.post.Group.configuration.alternativePointAgainstLabel?this.set("labelDown",this.post.Group.configuration.alternativePointAgainstLabel):this.set("labelDown",this.t("point.against"))),this.async(function(){this._updatePointLabels()})},removeElementsByClass:function(t,i){for(var e=t.getElementsByClassName(i);0<e.length;)e[0].parentNode.removeChild(e[0])},_updatePointLabels:function(){this.async(function(){var t=this.$$("#alternativePointForLabelId"),i=this.$$("#alternativePointAgainstLabelId");t&&t.finalContent&&this.set("labelUp",t.finalContent),i&&i.finalContent&&this.set("labelDown",i.finalContent)})},_processStoredPoints:function(){if(console.info("_processStoredPoints"),this.storedPoints&&0<this.storedPoints.length){for(var t=[],i=[],e=0;e<this.storedPoints.length;e++)0<this.storedPoints[e].value?t.push(this.storedPoints[e]):this.storedPoints[e].value<0&&i.push(this.storedPoints[e]);this.set("upPoints",t),this.set("downPoints",i)}else this.set("upPoints",[]),this.set("downPoints",[]),this.set("points",[]);this.largeMode||this.set("points",this.interleaveArrays(this.upPoints,this.downPoints)),this._clearScrollTrigger()},_response:function(t,i){this.set("storedPoints",this._preProcessPoints(i.response.points)),this.totalCount=i.response.count,this.storedUpPointsCount=0;for(var e=this.storedDownPointsCount=0;e<this.storedPoints.length;e++)0<this.storedPoints[e].value?this.storedUpPointsCount+=1:this.storedPoints[e].value<0&&(this.storedDownPointsCount+=1),this.loadedPointIds[this.storedPoints[e].id]=!0;this._processStoredPoints(),this.removeElementsByClass(this,"inserted-outside-list"),this._updateCounterInfo(),this._scrollPointIntoView(),this._checkForMultipleLanguages()},_updatePointInLists:function(t,e){this.upPoints.forEach(function(t,i){t.id===e.id&&(this.upPoints[i]=e)}.bind(this)),this.downPoints.forEach(function(t,i){t.id===e.id&&(this.downPoints[i]=e)}.bind(this)),this.points&&0<this.points.length&&this.points.forEach(function(t,i){t.id===e.id&&(this.points[i]=e)}.bind(this))},_checkForMultipleLanguages:function(){if(!localStorage.getItem("dontPromptForAutoTranslation")&&!sessionStorage.getItem("dontPromptForAutoTranslation")){var i,e=!1;this.upPoints.forEach(function(t){t.language&&!e&&(i||"??"===t.language?i&&i!==t.language&&"??"!==t.language&&(e=!0,console.info("Multiple point languages: "+i+" and "+t.language)):i=t.language)}),e||this.downPoints.forEach(function(t){t.language&&!e&&(i||"??"===t.language?i&&i!=t.language&&"??"!==t.language&&(e=!0,console.info("Multiple point languages: "+i+" and "+t.language)):i=t.language)}),e&&Polymer.dom(document).querySelector("yp-app").getDialogAsync("autoTranslateDialog",function(t){t.openLaterIfAutoTranslationEnabled()}.bind(this))}},interleaveArrays:function(t,i){for(var e=[t,i],o=Math.max.apply(Math,e.map(function(t){return t.length})),n=[],s=0;s<o;++s)e.forEach(function(t){t.length>s&&n.push(t[s])});return 0<n.length&&(n.length===this.totalCount||this.points&&this.points.length+n.length===this.totalCount)&&(n[n.length-1].isLastPointInList=!0),n},_scrollPointIntoView:function(){this.scrollToId&&this.async(function(){var i=!1;this.largeMode?(this.upPoints.forEach(function(t){i||t.id!=this.scrollToId||(this.$$("#ironListUp").scrollToItem(t),i=!0)}.bind(this)),i||this.downPoints.forEach(function(t){i||t.id!=this.scrollToId||(this.$$("#ironListDown").scrollToItem(t),i=!0)}.bind(this))):this.points.forEach(function(t){i||t.id!=this.scrollToId||(this.$$("#ironListMobile").scrollToItem(t),i=!0)}.bind(this)),i&&this.async(function(){var t=this.$$("#point"+this.scrollToId);t?(t.elevation=5,t.elevation=1,t.elevation=5,this.async(function(){t.elevation=1}.bind(this),7e3)):console.warn("Can't find point to elevate"),this.set("scrollToId",null)},50)},20)},_floatIfValueOrIE:function(t){return/Trident.*rv[ :]*11\./.test(navigator.userAgent)||t},_preProcessPoints:function(t){for(var i=0;i<t.length;i++)this.latestPointCreatedAt&&this.latestPointCreatedAt&&!(t[i].created_at>this.latestPointCreatedAt)||this.set("latestPointCreatedAt",t[i].created_at),t[i].PointRevisions[t[i].PointRevisions.length-1]&&t[i].PointRevisions[t[i].PointRevisions.length-1].content?t[i].latestContent=t[i].PointRevisions[t[i].PointRevisions.length-1].content:this.currentVideoId||this.currentAudioId||console.warn("No content for point in _preProcessPoints");return t},_updateCounterInfo:function(){this.largeMode?this.fire("yp-debate-info",{count:this.totalCount,firstPoint:this.upPoints[0]}):this.fire("yp-debate-info",{count:this.totalCount,firstPoint:this.points[0]})},_insertNewPoint:function(t){this.loadedPointIds[t.id]||(this.loadedPointIds[t.id]=!0,this.largeMode?0<t.value?(this.unshift("upPoints",t),this.async(function(){this.$$("#ironListUp").fire("iron-resize")},700)):t.value<0&&(this.unshift("downPoints",t),this.async(function(){this.$$("#ironListDown").fire("iron-resize")},700)):(this.unshift("points",t),this.async(function(){this.$$("#ironListMobile").fire("iron-resize")},700)),this.unshift("storedPoints",t))},_addMorePoint:function(t){var i=!1;return this.loadedPointIds[t.id]||(i=this.loadedPointIds[t.id]=!0,this.largeMode?0<t.value?this.push("upPoints",t):t.value<0&&this.push("downPoints",t):this.push("points",t),this.push("storedPoints",t),0<t.value?this.storedUpPointsCount+=1:t.value<0&&(this.storedDownPointsCount+=1)),i},_newPointResponse:function(t,i){i&&i.offlineSendLater?(this.set("addPointDisabled",!1),this.set("textValueUp",""),this.set("textValueDown",""),this.set("textValueMobileUpOrDown","")):((this.currentVideoId||this.currentAudioId)&&window.appGlobals.showSpeechToTextInfoIfNeeded(),this._completeNewPointResponse(t,i))},_completeNewPointResponse:function(t,i){this.set("addPointDisabled",!1);var e=this._preProcessPoints([i.response])[0];this.currentVideoId?e.checkTranscriptFor="video":this.currentAudioId&&(e.checkTranscriptFor="audio"),0<e.value?(this.newPointTextCombined=this.t("point.forAdded")+" "+this.truncate(e.content,21),this.set("textValueUp","")):(this.newPointTextCombined=this.t("point.againstAdded")+" "+this.truncate(e.content,21),this.set("textValueDown","")),this.set("textValueMobileUpOrDown",""),this._insertNewPoint(e),this.set("post.counter_points",this.post.counter_points+1),this.$.newPointToast.show(),this._updateCounterInfo(),0<e.value?window.appGlobals.activity("completed","newPointFor",{pointId:e.id}):window.appGlobals.activity("completed","newPointAgainst",{pointId:e.id}),this._clearVideo(),this._clearAudio()},addPointUp:function(){this.addPoint(this.textValueUp,1,this.uploadedVideoUpId,this.uploadedAudioUpId),window.appGlobals.activity("add","pointUp")},addPointDown:function(){this.addPoint(this.textValueDown,-1,this.uploadedVideoDownId,this.uploadedAudioDownId),window.appGlobals.activity("add","pointDown")},addMobilePointUpOrDown:function(){"pointFor"==this.pointUpOrDownSelected?(this.addPoint(this.textValueMobileUpOrDown,1,this.uploadedVideoMobileId,this.uploadedAudioMobileId),window.appGlobals.activity("add","pointUp")):"pointAgainst"==this.pointUpOrDownSelected&&(this.addPoint(this.textValueMobileUpOrDown,-1,this.uploadedVideoMobileId,this.uploadedAudioMobileId),window.appGlobals.activity("add","pointDown"))},addPoint:function(t,i,e,o){!0===window.appUser.loggedIn()?(this.$.newPointAjax.url="/api/points/"+this.post.group_id,this.$.newPointAjax.body={postId:this.post.id,content:t,value:i,pointBaseId:window.appUser.getBrowserId(),pointValCode:window.appUser.browserFingerprint,pointConf:window.appUser.browserFingerprintConfidence,originalQueryString:window.appGlobals.getOriginalQueryString(),userLocale:window.locale,userAutoTranslate:window.autoTranslate,referrer:document.referrer,url:location.href,screen_width:window.screen.width,videoId:e,audioId:o,appLanguage:this.language,isZiggeo:window.appGlobals.useZiggeo},this.set("addPointDisabled",!0),this.$.newPointAjax.generateRequest(),e?this.set("currentVideoId",e):o&&this.set("currentAudioId",o)):window.appUser.loginForNewPoint(this,{content:t,value:i})},focusUpPoint:function(){window.appGlobals.activity("focus","pointUp")},focusDownPoint:function(){window.appGlobals.activity("focus","pointDown")},focusTextArea:function(t){500<window.innerWidth&&(t.currentTarget.parentElement.elevation=2)},blurTextArea:function(t){t.currentTarget.parentElement.elevation=1},_hasCurrentUpVideo:function(t){t?(this.set("hideUpAudio",!0),this.set("hideUpText",!0)):(this.set("hideUpAudio",!1),this.set("hideUpText",!1))},_hasCurrentDownVideo:function(t){t?(this.set("hideDownAudio",!0),this.set("hideDownText",!0)):(this.set("hideDownAudio",!1),this.set("hideDownText",!1))},_hasCurrentUpAudio:function(t){t?(this.set("hideUpVideo",!0),this.set("hideUpText",!0)):(this.set("hideUpVideo",!1),this.set("hideUpText",!1))},_hasCurrentDownAudio:function(t){t?(this.set("hideDownVideo",!0),this.set("hideDownText",!0)):(this.set("hideDownVideo",!1),this.set("hideDownText",!1))},_hasCurrentMobileVideo:function(t){t?(this.set("hideMobileAudio",!0),this.set("hideMobileText",!0)):(this.set("hideMobileAudio",!1),this.set("hideMobileText",!1))},_hasCurrentMobileAudio:function(t){t?(this.set("hideMobileVideo",!0),this.set("hideMobileText",!0)):(this.set("hideMobileVideo",!1),this.set("hideMobileText",!1))},ifLengthIsRight:function(t,i,e,o){return null!=e?("up"===t&&(this.set("hideUpVideo",!1),this.set("hideUpAudio",!0),this.set("hideUpText",!0)),"down"===t&&(this.set("hideDownVideo",!1),this.set("hideDownAudio",!0),this.set("hideDownText",!0)),"mobile"===t&&(this.set("hideMobileVideo",!1),this.set("hideMobileAudio",!0),this.set("hideMobileText",!0)),!0):null!=o?("up"===t&&(this.set("hideUpAudio",!1),this.set("hideUpVideo",!0),this.set("hideUpText",!0)),"down"===t&&(this.set("hideDownAudio",!1),this.set("hideDownVideo",!0),this.set("hideDownText",!0)),"mobile"===t&&(this.set("hideMobileAudio",!1),this.set("hideMobileVideo",!0),this.set("hideMobileText",!0)),!0):null!=i&&0===i.length?("up"===t&&(this.set("hideUpVideo",!1),this.set("hideUpAudio",!1),this.set("hideUpText",!1)),"down"===t&&(this.set("hideDownVideo",!1),this.set("hideDownAudio",!1),this.set("hideDownText",!1)),"mobile"===t&&(this.set("hideMobileVideo",!1),this.set("hideMobileAudio",!1),this.set("hideMobileText",!1)),!1):null!=i&&0<i.length&&0<i.trim().length?("up"===t&&(this.set("hideUpVideo",!0),this.set("hideUpAudio",!0),this.set("hideUpText",!1)),"down"===t&&(this.set("hideDownVideo",!0),this.set("hideDownAudio",!0),this.set("hideDownText",!1)),"mobile"===t&&(this.set("hideMobileVideo",!0),this.set("hideMobileAudio",!0),this.set("hideMobileText",!1)),!0):null!=i&&1<i.length&&1<i.trim().length}})</script></dom-module><dom-module id="yp-post-user-image-card"><template><style include="iron-flex iron-flex-alignment">.description{padding-left:16px;padding-right:16px;padding-top:16px;color:#444;}.photographer{padding-left:16px;padding-right:16px;padding-top:8px;color:#aaa;}paper-material{width:800px;height:100%;background-color:#FFF;padding:0;}iron-image{width:800px;height:600px;}@media (max-width: 800px){iron-image{width:600px;height:450px;}paper-material{width:600px;}}@media (max-width: 620px){iron-image{width:400px;height:300px;}paper-material{width:400px;}}@media (max-width: 420px){iron-image{width:320px;height:240px;}paper-material{width:320px;}.commentsList{margin-left:16px;}}.commentsList{margin-left:32px;}[hidden]{display:none !important;}</style><paper-material elevation="2"class="layout vertical"><iron-image title$="[[image.description]]"sizing="cover"src$="[[_imageUrl(image)]]"></iron-image><div class="description">[[image.description]]</div><div class="layout horizontal"style="width: 100%;"><div class="photographer">[[image.photographer_name]]</div><div class="editMenu layout horizontal flex end-justified"hidden$="[[!hasImageAccess(image, post)]]"><paper-icon-button aria-label$="[[t('edit')]]"icon="create"on-tap="_openEdit"></paper-icon-button><paper-icon-button aria-label$="[[t('delete')]]"icon="clear"on-tap="_openDelete"></paper-icon-button></div></div><yp-point-comment-list class="commentsList"image="[[image]]"></yp-point-comment-list></paper-material></template><script>Polymer({is:"yp-post-user-image-card",behaviors:[Polymer.ypLanguageBehavior,Polymer.AccessHelpers,Polymer.ypMediaFormatsBehavior],properties:{image:{type:Object},post:{type:Object}},_openEdit:function(){window.appGlobals.activity("open","userImage.edit"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("userImageEdit",function(e){e.setup(this.post,this.image,!1,this._refresh.bind(this)),e.open("edit",{postId:this.post.id,userImages:!0})}.bind(this))},_openDelete:function(){window.appGlobals.activity("open","userImage.delete"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("apiActionDialog",function(e){e.setup("/api/images/"+this.post.id+"/"+this.image.id+"/user_images",this.t("userImage.deleteConfirmation"),this._refresh.bind(this)),e.open()}.bind(this))},_refresh:function(){this.fire("refresh")},_imageUrl:function(e){return this.getImageFormatUrl([e],0)}})</script></dom-module><dom-module id="yp-post-user-images"><template><style include="iron-flex iron-flex-alignment">paper-button{margin-top:32px;margin-bottom:8px;background-color:var(--accent-color);color:#FFF;width:242px;}yp-post-user-image-card{margin-top:32px;margin-bottom:32px;}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><div class="layout vertical center-center"><template is="dom-if"if="[[post]]"><paper-button raised=""on-tap="_newImage">[[t('posts.newUserImage')]]</paper-button><template is="dom-if"if="[[images]]"><template is="dom-repeat"items="[[images]]"as="image"><yp-post-user-image-card post="[[post]]"image="[[image]]"on-refresh="_refresh"></yp-post-user-image-card></template></template></template><div class="layout horizontal center-center"><yp-ajax id="ajax"on-response="_response"></yp-ajax></div></div></template><script>Polymer({is:"yp-post-user-images",behaviors:[Polymer.ypLanguageBehavior],properties:{images:{type:Array,value:null},post:{type:Object,observer:"_postChanged"}},_refresh:function(){this.$.ajax.generateRequest()},_postChanged:function(e){e&&(this.$.ajax.url="/api/images/"+e.id+"/user_images",this.$.ajax.generateRequest())},_newImage:function(){window.appGlobals.activity("open","newUserImage"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("userImageEdit",function(e){e.setup(this.post,null,!0,this._refresh.bind(this)),e.open("new",{postId:this.post.id,userImages:!0})}.bind(this))},_response:function(e,s){this.set("images",s.response),this.images&&0<this.images.length?this.fire("yp-post-image-count",this.images.length):this.fire("yp-post-image-count",0)}})</script></dom-module></div><dom-module id="yp-post"><template><style include="iron-flex iron-flex-alignment">:host{}.container{padding-top:0;margin-top:-70px;height:100%;}.topContainer{margin-top:28px;}.flex{@apply --layout-vertical;@apply --layout-flex;}.centerContainer{@apply --layout-center-center;}.postHeader{padding:16px;background-color:#fefefe;width:940px;}.statusHeader{padding:16px;background-color:#fefefe;width:940px;margin-top:16px;height:48px;}.description{width:510px;padding-left:24px;}ac-activities{padding-top:8px;}.statusColumn{width:670px;padding-bottom:16px;}.mainPage{background-color:#FFF;}paper-tab{--paper-tabs:{font-family:var(--app-normal-font-family, Roboto);};font-family:var(--app-normal-font-family, Roboto);}yp-post-user-images{padding-top:32px;}@media (max-width: 961px){.postHeader{width:600px;}}@media (max-width: 600px){.postHeader{width:400px;}.topContainer{margin-top:16px;}}.createFab{position:fixed;bottom:24px;right:28px;background-color:var(--accent-color);color:#FFF;--paper-fab-iron-icon:{color:var(--icon-general-color, #FFF);height:40px;width:40px;};}.createFab[wide-layout]{width:72px;height:72px;--paper-fab-iron-icon:{color:var(--icon-general-color, #FFF);width:50px;height:50px;};}@media (max-width: 360px){.centerContainer{@apply --layout-vertical;}.postHeader{height:100%;width:360px;padding:0;}.tabsMaterial{width:360px;}.statusHeader{width:360px;height:120px;padding:0px;padding-left:20px;}.statusColumn{height:60px;padding:0px;}.description{width:320px;padding:8px;padding-left:20px;padding-bottom:16px;}.statusColumn{width:320px;}}yp-ajax{background-color:var(--primary-background-color);}.mapContainer{margin:24px;width:960px;height:500px;}.counterInfo{font-size:11px;}.tabs{margin-top:24px;}@media (max-width: 934px){.mapContainer{margin:16px;width:800px;height:400px;}}@media (max-width: 832px){.mapContainer{margin:8px;width:600px;height:340px;}}@media (max-width: 632px){.mapContainer{margin:8px;width:400px;height:300px;}}@media (max-width: 420px){.mapContainer{margin:8px;width:330px;height:250px;}}@media (max-width: 360px){.mapContainer{margin:8px;width:280px;height:200px;}}.tabs{width:1100px;padding-top:8px;padding-bottom:8px;}.tab{width:250px;}@media (max-width: 900px){.tabs{max-width:100%;font-size:14px !important;word-wrap:break-word !important;margin-top:8px;width:100%;margin-bottom:8px;}.tabs .tab{width:100%;word-wrap:break-word !important;margin-left:8px;margin-right:8px;}.topArea{height:300px;}.topArea[is-post]{min-height:470px;}}@media (max-width: 380px){.tabs{font-size:12px !important;}.topArea[is-post]{min-height:530px;}ac-activities{min-height:600px !important;}}@media (max-width: 360px){.tabs{font-size:10px !important;}}.minHeightSection{min-height:450px;}[hidden]{display:none !important;}</style><div class="topContainer layout vertical center-center"is-post=""create-fab-title="[[t('point.add')]]"on-yp-create-fab-tap="_newPoint"><template is="dom-if"if="[[isGalleryMode]]"><yp-post-list-gallery-item id="galleryPostItem"post="[[post]]"description-open=""></yp-post-list-gallery-item></template><template is="dom-if"if="[[!isGalleryMode]]"><yp-post-header id="postCard"class="largeCard"post="[[post]]"on-refresh="_refreshAjax"header-mode=""></yp-post-header></template><div class="layout horizontal center-center"hidden$="[[post.Group.configuration.hideAllTabs]]"><paper-tabs id="paper_tabs"class="tabs"selected="{{selectedTab}}"attr-for-selected="name"focused=""><paper-tab name="debate"><div class="layout vertical center-center tabCounterContainer"><span>[[t('post.tabs.debate')]] (<span id="tabCountDebate"></span>)</span></div></paper-tab><paper-tab name="news"hidden$="[[post.Group.configuration.hideNewsfeeds]]">[[t('post.tabs.news')]]</paper-tab><paper-tab name="location"hidden$="[[locationHidden]]">[[t('post.tabs.location')]]</paper-tab><paper-tab name="photos"><div class="layout vertical center-center tabCounterContainer"><span>[[t('post.tabs.photos')]] (<span id="tabCountPhotos"></span>)</span></div></paper-tab></paper-tabs></div><iron-pages id="pages"class="tabPages"selected="[[selectedTab]]"attr-for-selected="name"entry-animation="fade-in-animation"exit-animation="fade-out-animation"><div name="debate"class="layout horizontal center-center"role="main"aria-label$="[[t('debate')]]"><yp-post-points host="[[host]]"id="pointsSection"is-post-page="[[isPostPage]]"is-admin="[[isAdmin]]"post="[[post]]"scroll-to-id$="[[scrollToPointId]]"></yp-post-points></div><section name="news"class="minHeightSection"><template is="dom-if"if="[[newsTabSelected]]"><ac-activities hidden$="[[post.Group.configuration.hideNewsfeeds]]"id="postNews"selected-tab="[[selectedTab]]"disable-new-posts="[[disableNewPosts]]"post-group-id="[[post.group_id]]"post-id="[[post.id]]"></ac-activities></template></section><section name="location"class="minHeightSection"><div class="layout horizontal center-center"><template is="dom-if"if="[[post.location]]"restamp=""><template is="dom-if"if="[[mapActive]]"restamp=""><paper-material class="mapContainer"elevation="3"><google-map additional-map-options="{&quot;keyboardShortcuts&quot;:false}"api-key$="[[_getGoogleMapsKey()]]"id="map"libraries="places"class="map"map-type="[[post.location.mapType]]"zoom="[[post.location.map_zoom]]"fit-to-markers=""><google-map-marker slot="markers"latitude="[[post.location.latitude]]"longitude="[[post.location.longitude]]"id="marker"></google-map-marker></google-map></paper-material></template></template><template is="dom-if"if="[[post]]"><template is="dom-if"if="[[!post.location]]"><h1 style="padding-top: 16px">[[t('post.noLocation')]]</h1></template></template></div></section><section name="photos"class="minHeightSection"><div class="layout vertical flex"><div class="layout horizontal center-center"><yp-post-user-images post="[[post]]"></yp-post-user-images></div></div></section></iron-pages></div><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><app-route route="{{idRoute}}"pattern="/:id"data="{{idRouteData}}"tail="{{tabRoute}}"></app-route><app-route route="{{tabRoute}}"pattern="/:tabName"data="{{tabRouteData}}"></app-route><iron-media-query query="(min-width: 1024px)"query-matches="{{wideWidth}}"></iron-media-query><div class="create-fab-wrapper layout horizontal end-justified createFabContainer"hidden$="[[post.Group.configuration.hideNewPostOnPostPage]]"><template is="dom-if"if="[[!disableNewPosts]]"><paper-fab class="createFab"icon="[[createFabIcon]]"elevation="5"wide-layout$="{{wideWidth}}"title$="[[t('post.new')]]"on-tap="_newPost"></paper-fab></template></div><div class="layout horizontal center-center"><yp-ajax id="ajax"on-response="_handleIncomingPostResponse"></yp-ajax><yp-ajax id="pagesAjax"on-response="_pagesResponse"></yp-ajax></div></template><script>Polymer({is:"yp-post",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypThemeBehavior,Polymer.YpNewsTabSelected,Polymer.AccessHelpers,Polymer.ypGotoBehavior,Polymer.ypMediaFormatsBehavior,Polymer.ypNumberFormatBehavior,Polymer.ypTruncateBehavior],properties:{idRoute:Object,tabRoute:Object,idRouteData:Object,tabRouteData:Object,isAdmin:{type:Boolean,value:!1},postId:{type:Number,value:null,observer:"_postIdChanged"},host:String,post:{type:Object,value:null,notify:!0,observer:"_postChanged"},selectedTab:{type:String,value:"debate",observer:"_selectedTabChanged"},currentPage:{type:String},isPostPage:{type:Boolean,computed:"_isPostPage(currentPage)"},isGalleryMode:{type:Boolean,value:!1},small:{type:Boolean},method:{type:String},mapActive:{type:Boolean,value:!1},wideWidth:{type:Boolean,value:!1},createFabIcon:{type:String,value:"lightbulb-outline"},disableNewPosts:{type:Boolean,value:!1},scrollToPointId:{type:String,value:null},locationHidden:{type:Boolean,value:!1}},observers:["_routeIdChanged(idRouteData.id)","_routeTabChanged(tabRouteData.tabName)"],_routeIdChanged:function(o){o&&this.set("postId",o)},_getGoogleMapsKey:function(){return window.appGlobals.googleMapsApiKey},_routeTabChanged:function(o){o&&!this._isNumber(o)?this.set("selectedTab",o):o&&this._isNumber(o)&&(this.set("scrollToPointId",o),this.set("selectedTab","debate"))},_isNumber:function(o){return!isNaN(parseFloat(o))&&isFinite(o)},_selectedTabChanged:function(o){this.post&&this.redirectTo("/post/"+this.post.id+"/"+o),"location"==o?this.set("mapActive",!0):this.set("mapActive",!1),o&&window.appGlobals&&window.appGlobals.activity("open","post_tab_"+o,"",{id:this.postId,modelType:"post"}),this.async(function(){var o=this.$$("#postNews");o&&o.fireResize()},300)},_newPost:function(){window.appGlobals.activity("open","newPost"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("postEdit",function(o){o.setup(null,!0,null),o.open("new",{groupId:this.post.Group.id,group:this.post.Group})}.bind(this))},listeners:{"yp-debate-info":"_updateDebateInfo","yp-post-image-count":"_updatePostImageCount"},_updatePostImageCount:function(o,t){var e=this.$$("#tabCountPhotos");e&&(e.innerHTML=this.formatNumber(t))},_updateDebateInfo:function(o,t){var e=this.$$("#tabCountDebate");e&&t&&(e.innerHTML=this.formatNumber(t.count)),t&&t.firstPoint&&this.$$("#postCard")&&this.$$("#postCard").updateDescriptionIfEmpty(t.firstPoint.content)},_mainContainerClasses:function(o){return o?"layout horizontal wrap":"layout horizontal center-center"},_isPostPage:function(o){return"post"===o},_headerClasses:function(o){return o?"layout vertical postHeader wrap":"layout horizontal postHeader"},postName:function(o){return o&&o.name?this.truncate(this.trim(o.name),200):o?o.short_name:void 0},postDescription:function(o){return o&&o.description?this.truncate(this.trim(o.description),1e4,"..."):""},_refreshAjax:function(){this.$.ajax.generateRequest()},_postChanged:function(o){o?(this.set("isAdmin",this.checkPostAdminOnlyAccess(o)),o.Group&&o.Group.configuration&&!0===o.Group.configuration.galleryMode?this.set("isGalleryMode",!0):this.set("isGalleryMode",!1)):(this.set("isAdmin",!1),this.set("isGalleryMode",!1))},_postIdChanged:function(o){var t=window.appGlobals.cachedPostItem;t&&t.id==o?(this._setupAjaxUrl(),this._handleIncomingPostResponse(null,{response:t}),console.log("Got post from item cache")):window.appGlobals.getPostFromCache(o)?(this._setupAjaxUrl(),this._handleIncomingPostResponse(null,{response:window.appGlobals.getPostFromCache(o),fromCache:!0}),console.log("Got post from cache possibly from recommendations")):(console.log("Got post from server not cache"),this.set("post",null),o&&(this._getPost(),this.set("selectedTab","debate")))},_setupAjaxUrl:function(){this.host?this.$.ajax.url=this.host+"/api/posts/"+this.postId:this.$.ajax.url="/api/posts/"+this.postId},_pagesResponse:function(o,t){this.fire("yp-set-pages",t.response)},_getPost:function(){this._setupAjaxUrl(),this.$$("#ajax").retryMethodAfter401Login=this._getPost.bind(this),this.$.ajax.generateRequest()},_handleIncomingPostResponse:function(o,t){this.set("post",t.response),this.refresh(),this.post.Group.configuration&&null!=this.post.Group.configuration.canAddNewPosts?!0===this.post.Group.configuration.canAddNewPosts?this.set("disableNewPosts",!1):this.set("disableNewPosts",!0):this.set("disableNewPosts",!1),t.fromCache||window.appGlobals.addPostsToCacheLater([this.post]),window.appGlobals.getNextRecommendationForGroup(this.post.group_id,this.post.id,this._processRecommendation.bind(this))},_processRecommendation:function(o){if(o&&this.post){var t=o.name;t=this.wideWidth?this.truncate(t,60):this.truncate(t,30),this.fire("yp-set-next-post",{currentPostId:this.post.id,goForwardToPostId:o.id,goForwardPostName:t})}else this.fire("yp-set-next-post",{currentPostId:this.post.id,goForwardToPostId:null,goForwardPostName:null}),console.log("Not recommended post")},refresh:function(){this.post&&(null!=this.post.Group.theme_id||this.post.Group.configuration&&null!=this.post.Group.configuration.themeOverrideColorPrimary?this.setTheme(this.post.Group.theme_id,this.post.Group.configuration):this.post.Group.Community&&(null!=this.post.Group.Community.theme_id||this.post.Group.Community.configuration&&this.post.Group.Community.configuration.themeOverrideColorPrimary)?this.setTheme(this.post.Group.Community.theme_id,this.post.Group.Community.configuration):this.setTheme(1),this.post.Group.Community||console.error("No community!"),window.appGlobals&&(window.appGlobals.setCommunityAnalyticsTracker(this.post.Group.Community.google_analytics_code),this.post.Group.Community.configuration&&(window.appGlobals.setCommunityPixelTracker(this.post.Group.Community.configuration.facebookPixelId),this.post.Group.Community.configuration.useZiggeo?window.appGlobals.useZiggeo=!0:window.appGlobals.useZiggeo=!1),window.appGlobals.setAnonymousGroupStatus(this.post.Group),window.appGlobals.setRegistrationQuestionGroup(this.post.Group)),this.post.Group.configuration&&null!=this.post.Group.configuration.defaultLocale&&window.appGlobals.changeLocaleIfNeeded(this.post.Group.configuration.defaultLocale),this.post.Group.configuration&&null!=this.post.Group.configuration.locationHidden?this.set("locationHidden",this.post.Group.configuration.locationHidden):this.set("locationHidden",!1),this.fire("change-header",{headerTitle:this.truncate(this.post.Group.name,80),documentTitle:this.post.name,headerDescription:"",backPath:"/group/"+this.post.group_id,backListItem:this.post,hideHelpIcon:!(!this.post.Group.configuration||!this.post.Group.configuration.hideHelpIcon)||null}),this.$.pagesAjax.url="/api/groups/"+this.post.Group.id+"/pages",this.$.pagesAjax.generateRequest(),this.post.Group.configuration&&!0===this.post.Group.configuration.disableFacebookLoginForGroup?window.appGlobals.disableFacebookLoginForGroup=!0:window.appGlobals.disableFacebookLoginForGroup=!1,this.fire("yp-set-home-link",{type:"group",id:this.post.Group.id,name:this.post.Group.name}),this.post.Group&&this.post.Group.Community&&this.post.Group.Community.configuration&&this.post.Group.Community.configuration.signupTermsPageId&&-1!=this.post.Group.Community.configuration.signupTermsPageId?window.appGlobals.signupTermsPageId=this.post.Group.Community.configuration.signupTermsPageId:window.appGlobals.signupTermsPageId=null,window.appGlobals.currentGroup=this.post.Group,this.post.Group.configuration&&this.post.Group.configuration.forceSecureSamlLogin&&!this.checkGroupAccess(this.post.Group)||this.post.Group.Community&&this.post.Group.Community.configuration&&this.post.Group.Community.configuration.forceSecureSamlLogin&&!this.checkCommunityAccess(this.post.Group.Community)?window.appGlobals.currentForceSaml=!0:window.appGlobals.currentForceSaml=!1,this.post.Group.configuration&&this.post.Group.configuration.forceSecureSamlLogin||this.post.Group.Community&&this.post.Group.Community.configuration&&this.post.Group.Community.configuration.forceSecureSamlLogin?window.appGlobals.currentForceSaml=!0:window.appGlobals.currentForceSaml=!1,this.post.Group.Community&&this.post.Group.Community.configuration&&this.post.Group.Community.configuration.customSamlDeniedMessage?window.appGlobals.currentSamlDeniedMessage=this.post.Group.Community.configuration.customSamlDeniedMessage:window.appGlobals.currentSamlDeniedMessage=null,this.post.Group.Community.configuration&&this.post.Group.Community.configuration.customSamlLoginMessage?window.appGlobals.currentSamlLoginMessage=this.post.Group.Community.configuration.customSamlLoginMessage:window.appGlobals.currentSamlLoginMessage=null,this.post.Group.configuration&&this.post.Group.configuration.maxNumberOfGroupVotes&&window.appUser.calculateVotesLeftForGroup(this.post.Group))},setupTopHeaderImage:function(o){var t="url("+this.getImageFormatUrl(o,0)+")";this.updateStyles({"--top-area-background-image":t})},computeUrl:function(o){return"/api/posts/"+o}})</script></dom-module>