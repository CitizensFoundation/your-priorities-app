# Model: Organization

Represents an organization entity in the system. This Sequelize model defines the schema, associations, and several utility methods for managing organizations, including image setup and access level handling.

## Properties

| Name            | Type      | Description                                                                 |
|-----------------|-----------|-----------------------------------------------------------------------------|
| id              | number    | Primary key (auto-generated by Sequelize).                                  |
| name            | string    | Name of the organization. Required.                                         |
| description     | string    | Description of the organization.                                            |
| address         | string    | Address of the organization.                                                |
| phone_number    | string    | Phone number of the organization.                                           |
| access          | number    | Access level: 0 (public), 1 (closed), 2 (secret). Required.                 |
| status          | string    | Status of the organization. Default: `'active'`. Required.                  |
| deleted         | boolean   | Soft delete flag. Default: `false`. Required.                               |
| website         | string    | Website URL of the organization.                                            |
| ip_address      | string    | IP address associated with the organization. Required.                      |
| user_agent      | string    | User agent string. Required.                                                |
| weight          | number    | Weight for ordering or ranking. Default: `0`.                               |
| counter_users   | number    | Counter for users associated with the organization. Default: `0`.           |
| theme_id        | number    | Theme identifier. Default: `0`.                                             |
| created_at      | Date      | Timestamp when the organization was created.                                |
| updated_at      | Date      | Timestamp when the organization was last updated.                           |

## Configuration

- **Table Name:** `organizations`
- **Timestamps:** Enabled (`created_at`, `updated_at`)
- **Underscored:** Field names use snake_case.
- **Default Scope:** Only includes records where `deleted` is `false`.
- **Indexes:**
  - `organizations_idx_id_deleted` on `id`, `deleted`
  - `organizations_idx_deleted` on `deleted`

## Associations

| Association Type         | Target Model         | Foreign Key      | Alias/Through Table                |
|-------------------------|----------------------|------------------|------------------------------------|
| belongsTo               | Domain               | `domain_id`      |                                    |
| belongsTo               | Community            | `community_id`   |                                    |
| belongsTo               | User                 | `user_id`        |                                    |
| belongsToMany           | Image                | -                | as: `OrgLogoImgs`, through: `OrganizationLogoImage` |
| belongsToMany           | Image                | -                | as: `OrganizationHeaderImages`, through: `OrganizationHeaderImage` |
| belongsToMany           | User                 | -                | as: `OrganizationUsers`, through: `OrganizationUser` |
| belongsToMany           | User                 | -                | as: `OrganizationAdmins`, through: `OrganizationAdmin` |

## Exported Constants

| Name                | Value | Description                        |
|---------------------|-------|------------------------------------|
| ACCESS_PUBLIC       | 0     | Public access                      |
| ACCESS_CLOSED       | 1     | Closed access                      |
| ACCESS_SECRET       | 2     | Secret access                      |

---

## Static Methods

### Organization.convertAccessFromRadioButtons

Converts a request body containing radio button values into an access level integer.

#### Parameters

| Name | Type   | Description                                 |
|------|--------|---------------------------------------------|
| body | object | Request body with `public`, `closed`, `secret` boolean fields |

#### Returns

- `number` — Access level (`0`, `1`, or `2`).

#### Example

```javascript
const access = Organization.convertAccessFromRadioButtons({ public: true });
// access === 0
```

---

## Instance Methods

### organization.simple()

Returns a simplified representation of the organization.

#### Returns

- `object` — `{ id, name, hostname }`

#### Example

```javascript
const simpleOrg = organization.simple();
```

---

### organization.updateAllExternalCounters(req, direction, column, done)

Updates an external counter on the associated domain, incrementing or decrementing as specified.

#### Parameters

| Name      | Type     | Description                                      |
|-----------|----------|--------------------------------------------------|
| req       | Request  | Express request object, must have `ypDomain`     |
| direction | string   | `'up'` to increment, `'down'` to decrement       |
| column    | string   | Name of the column to update                     |
| done      | function | Callback function                                |

#### Example

```javascript
organization.updateAllExternalCounters(req, 'up', 'counter_users', () => {});
```

---

### organization.setupLogoImage(body, done)

Associates a logo image with the organization if `uploadedLogoImageId` is present in the body.

#### Parameters

| Name   | Type     | Description                                 |
|--------|----------|---------------------------------------------|
| body   | object   | Request body, may contain `uploadedLogoImageId` |
| done   | function | Callback function                           |

---

### organization.setupHeaderImage(body, done)

Associates a header image with the organization if `uploadedHeaderImageId` is present in the body.

#### Parameters

| Name   | Type     | Description                                 |
|--------|----------|---------------------------------------------|
| body   | object   | Request body, may contain `uploadedHeaderImageId` |
| done   | function | Callback function                           |

---

### organization.setupImages(body, done)

Sets up both logo and header images for the organization in parallel.

#### Parameters

| Name   | Type     | Description                                 |
|--------|----------|---------------------------------------------|
| body   | object   | Request body, may contain image IDs         |
| done   | function | Callback function, called with error if any |

---

## Example Usage

```javascript
const Organization = require('./models/organization')(sequelize, DataTypes);

// Creating a new organization
const org = await Organization.create({
  name: 'My Org',
  access: Organization.ACCESS_PUBLIC,
  ip_address: '127.0.0.1',
  user_agent: 'Mozilla/5.0'
});

// Setting up images
org.setupImages({ uploadedLogoImageId: 1, uploadedHeaderImageId: 2 }, (err) => {
  if (err) console.error(err);
});
```

---

## See Also

- [Sequelize Documentation](https://sequelize.org/)
- [Domain Model](./Domain.md)
- [Community Model](./Community.md)
- [User Model](./User.md)
- [Image Model](./Image.md)
