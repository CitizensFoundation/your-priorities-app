# Model: Category

Represents a category entity in the application, typically used to group posts and associate images (icons and headers). This Sequelize model includes fields for name, description, deletion status, icon file name, and language, and supports soft deletion via the `deleted` flag. It also manages relationships to posts, groups, and images.

## Properties

| Name             | Type      | Description                                                      |
|------------------|-----------|------------------------------------------------------------------|
| id               | number    | Primary key (auto-generated by Sequelize).                       |
| name             | string    | Name of the category. Required.                                  |
| description      | string    | Description of the category. Required.                           |
| deleted          | boolean   | Soft delete flag. Defaults to `false`.                           |
| icon_file_name   | string    | File name of the category's icon image. Optional.                |
| language         | string    | Language code for the category. Optional.                        |
| created_at       | Date      | Timestamp when the category was created.                         |
| updated_at       | Date      | Timestamp when the category was last updated.                    |
| group_id         | number    | Foreign key referencing the associated group.                    |

## Configuration

- **Table Name:** `categories`
- **Timestamps:** Enabled (`created_at`, `updated_at`)
- **Underscored:** Field names use snake_case.
- **Default Scope:** Only returns categories where `deleted` is `false`.
- **Indexes:**
  - On `id` and `deleted`
  - On `name` and `deleted`
  - On `deleted` and `group_id` (named `categories_idx_deleted_group_id`)
  - On `deleted` (named `categories_idx_deleted`)

## Associations

| Association Type         | Target Model | Alias                  | Through Table             | Foreign Key   | Description                                 |
|-------------------------|--------------|------------------------|---------------------------|--------------|---------------------------------------------|
| hasMany                 | Post         | -                      | -                         | -            | A category has many posts.                  |
| belongsTo               | Group        | -                      | -                         | group_id     | A category belongs to a group.              |
| belongsToMany           | Image        | CategoryIconImages     | CategoryIconImage         | -            | Many-to-many: category icon images.         |
| belongsToMany           | Image        | CategoryHeaderImages   | CategoryHeaderImage       | -            | Many-to-many: category header images.       |

## Instance Methods

### setupIconImage

Associates an uploaded icon image with the category if `uploadedIconImageId` is present in the request body.

#### Parameters

| Name   | Type   | Description                                      |
|--------|--------|--------------------------------------------------|
| body   | object | Request body, expected to contain `uploadedIconImageId`. |
| done   | function | Callback function to be called when done.      |

#### Usage

```javascript
categoryInstance.setupIconImage(body, done);
```

---

### setupHeaderImage

Associates an uploaded header image with the category if `uploadedHeaderImageId` is present in the request body.

#### Parameters

| Name   | Type   | Description                                      |
|--------|--------|--------------------------------------------------|
| body   | object | Request body, expected to contain `uploadedHeaderImageId`. |
| done   | function | Callback function to be called when done.      |

#### Usage

```javascript
categoryInstance.setupHeaderImage(body, done);
```

---

### setupImages

Convenience method to set up both icon and header images in parallel using `async.parallel`.

#### Parameters

| Name   | Type   | Description                                      |
|--------|--------|--------------------------------------------------|
| body   | object | Request body, may contain `uploadedIconImageId` and/or `uploadedHeaderImageId`. |
| done   | function | Callback function to be called when both image setups are complete. |

#### Usage

```javascript
categoryInstance.setupImages(body, done);
```

---

## Example

```javascript
const { Category } = require('./models');
const body = {
  uploadedIconImageId: 1,
  uploadedHeaderImageId: 2
};

Category.findByPk(1).then(category => {
  category.setupImages(body, (err) => {
    if (err) {
      // handle error
    } else {
      // images set up successfully
    }
  });
});
```

---

## See Also

- [Post](./Post.md)
- [Group](./Group.md)
- [Image](./Image.md)
- [Sequelize Documentation](https://sequelize.org/master/class/lib/model.js~Model.html)
- [async (npm)](https://caolan.github.io/async/v3/)

---

**Note:**  
This model is typically used as part of a larger application with associations to posts, groups, and images. The image setup methods are designed to be called after a category is created or updated, to associate uploaded images with the category.