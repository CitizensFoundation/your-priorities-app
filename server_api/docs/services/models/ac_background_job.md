# Model: AcBackgroundJob

Represents a background job in the system, used for tracking asynchronous or long-running tasks. This Sequelize model provides methods for creating, updating, and deleting background job records, as well as updating their progress, data, and error states.

## Properties

| Name           | Type      | Description                                      |
|----------------|-----------|--------------------------------------------------|
| id             | number    | Primary key (auto-generated by Sequelize).       |
| progress       | number    | Progress of the job (nullable).                  |
| error          | string    | Error message or stack trace (nullable).         |
| data           | object    | JSONB field for job-specific data (nullable).    |
| internal_data  | object    | JSONB field for internal job data (nullable).    |
| created_at     | Date      | Timestamp when the job was created.              |
| updated_at     | Date      | Timestamp when the job was last updated.         |

## Table Configuration

- **Table Name:** `ac_background_jobs`
- **Timestamps:** Enabled (`created_at`, `updated_at`)
- **Underscored:** Field names use snake_case

---

# Service Module: AcBackgroundJob (Static Methods)

Provides static methods for managing background jobs, including creation, progress updates, data/error updates, and deletion.

## Methods

| Name                    | Parameters                                                                 | Return Type         | Description                                                                                 |
|-------------------------|----------------------------------------------------------------------------|---------------------|---------------------------------------------------------------------------------------------|
| createJob               | data: object, internal_data: object, done: function                        | void                | Creates a new job and calls the callback with (error, jobId).                               |
| createJobAsync          | data: object, internal_data: object                                        | Promise<AcBackgroundJob> | Asynchronously creates a new job and resolves with the job instance.                        |
| updateProgress          | jobId: number, progress: number, done: function                            | void                | Updates the progress of a job and calls the callback when done.                             |
| updateProgressAsync     | jobId: number, progress: number                                            | Promise<[number, AcBackgroundJob[]]> | Asynchronously updates the progress of a job.                                               |
| updateDataAsync         | jobId: number, data: object                                                | Promise<[number, AcBackgroundJob[]]> | Asynchronously updates the `data` field of a job.                                           |
| updateErrorAsync        | jobId: number, error: string                                               | Promise<[number, AcBackgroundJob[]]> | Asynchronously updates the `error` field of a job.                                          |
| destroyJobAsync         | jobId: number                                                              | Promise<number>     | Asynchronously deletes a job by its ID.                                                     |

---

## Method Details

### AcBackgroundJob.createJob

Creates a new background job and invokes a callback with the result.

#### Parameters

| Name           | Type     | Description                                      |
|----------------|----------|--------------------------------------------------|
| data           | object   | Data to store in the `data` field.               |
| internal_data  | object   | Data to store in the `internal_data` field.      |
| done           | function | Callback function (error, jobId).                |

#### Example

```javascript
AcBackgroundJob.createJob({foo: 1}, {bar: 2}, (err, jobId) => {
  if (err) { /* handle error */ }
  // use jobId
});
```

---

### AcBackgroundJob.createJobAsync

Asynchronously creates a new background job.

#### Parameters

| Name           | Type     | Description                                      |
|----------------|----------|--------------------------------------------------|
| data           | object   | Data to store in the `data` field.               |
| internal_data  | object   | Data to store in the `internal_data` field.      |

#### Returns

- `Promise<AcBackgroundJob>`: Resolves with the created job instance.

#### Example

```javascript
const job = await AcBackgroundJob.createJobAsync({foo: 1}, {bar: 2});
```

---

### AcBackgroundJob.updateProgress

Updates the progress of a job and invokes a callback when done.

#### Parameters

| Name     | Type     | Description                        |
|----------|----------|------------------------------------|
| jobId    | number   | ID of the job to update.           |
| progress | number   | New progress value.                |
| done     | function | Callback function (error).         |

#### Example

```javascript
AcBackgroundJob.updateProgress(1, 50, (err) => {
  if (err) { /* handle error */ }
});
```

---

### AcBackgroundJob.updateProgressAsync

Asynchronously updates the progress of a job.

#### Parameters

| Name     | Type   | Description                        |
|----------|--------|------------------------------------|
| jobId    | number | ID of the job to update.           |
| progress | number | New progress value.                |

#### Returns

- `Promise<[number, AcBackgroundJob[]]>`: Resolves with the result of the update operation.

#### Example

```javascript
await AcBackgroundJob.updateProgressAsync(1, 75);
```

---

### AcBackgroundJob.updateDataAsync

Asynchronously updates the `data` field of a job.

#### Parameters

| Name   | Type   | Description                        |
|--------|--------|------------------------------------|
| jobId  | number | ID of the job to update.           |
| data   | object | New data to set.                   |

#### Returns

- `Promise<[number, AcBackgroundJob[]]>`: Resolves with the result of the update operation.

#### Example

```javascript
await AcBackgroundJob.updateDataAsync(1, {foo: "bar"});
```

---

### AcBackgroundJob.updateErrorAsync

Asynchronously updates the `error` field of a job.

#### Parameters

| Name   | Type   | Description                        |
|--------|--------|------------------------------------|
| jobId  | number | ID of the job to update.           |
| error  | string | Error message to set.              |

#### Returns

- `Promise<[number, AcBackgroundJob[]]>`: Resolves with the result of the update operation.

#### Example

```javascript
await AcBackgroundJob.updateErrorAsync(1, "Something went wrong");
```

---

### AcBackgroundJob.destroyJobAsync

Asynchronously deletes a job by its ID.

#### Parameters

| Name   | Type   | Description                        |
|--------|--------|------------------------------------|
| jobId  | number | ID of the job to delete.           |

#### Returns

- `Promise<number>`: Resolves with the number of deleted rows (should be 1 if successful).

#### Example

```javascript
await AcBackgroundJob.destroyJobAsync(1);
```

---

# Usage Example

```javascript
// Creating a job asynchronously
const job = await AcBackgroundJob.createJobAsync({task: "import"}, {user: 123});

// Updating progress
await AcBackgroundJob.updateProgressAsync(job.id, 50);

// Updating data
await AcBackgroundJob.updateDataAsync(job.id, {step: "processing"});

// Updating error
await AcBackgroundJob.updateErrorAsync(job.id, "Failed at step 2");

// Deleting a job
await AcBackgroundJob.destroyJobAsync(job.id);
```

---

# See Also

- [Sequelize Model Documentation](https://sequelize.org/master/manual/model-basics.html)
- [Sequelize DataTypes](https://sequelize.org/master/manual/model-basics.html#data-types)
