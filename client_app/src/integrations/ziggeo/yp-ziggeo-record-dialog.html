<link rel="import" href="../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="yp-ziggeo-record-dialog">
  <template>

  </template>

  <script>
    Polymer({

      is: 'yp-ziggeo-record-dialog',

      properties: {
        recorder: {
          type: Object,
        },

        videoHeight: {
          type: String,
          computed: '_videoHeight(postId,domainId,communityId,groupId)'
        },

        videoWidth: {
          type: String,
          computed: '_videoWidth(postId,domainId,communityId,groupId)'
        },

        callbackElement: {
          type: Object
        }
      },

      _createRecorder: function () {
        if (!this.recorder) {
          ziggeoApp.on("ready", function() {
            this.recorder = new ZiggeoApi.V2.PopupRecorder({
                element: this.$.ziggeoRecorder,
                attrs: {
                    width: this.videoWidth,
                    height: this.videoHeight,
                    theme: "modern",
                    themecolor: "red",
                    onProcessed: this._recordingFinished.bind(this)
                }
            });

            this.recorder.on("processed",  this._recordingFinished.bind(this));

            this.recorder.activate();
          }.bind(this));
        }
      },

      _videoHeight: function() {
        if (window.innerHeight > window.innerWidth) {
          return "720px";
        } else {
          return "1280px";
        }
      },

      _videoWidth: function () {
        if (window.innerHeight > window.innerWidth) {
          return "1280px";
        } else {
          return "720px";
        }
      },

      _recordingFinished: function (event, detail) {
        this.callbackElement.fire('success', {
          videoId: this.recorder.get('video')
        });
        this.async(function (){
          this.recorder = undefined;
        });
        this.recorder.destroy();
      },

      open: function (options) {
        this.set('callbackElement', options.callbackElement)
        this._createRecorder();
      },
    });
  </script>
</dom-module>
