<div hidden=""by-polymer-bundler=""><script>!function(){"use strict";Polymer({is:"google-map-search",properties:{map:{type:Object,value:null},query:{type:String,value:null},latitude:{type:Number,value:null},longitude:{type:Number,value:null},radius:{type:Number,value:null},globalSearch:{type:Boolean,value:!1},types:{type:String,value:null},results:{type:Array,value:function(){return[]},notify:!0},location:{type:Object,value:null,readOnly:!0}},observers:["search(query,map,location,radius,types,globalSearch)","_updateLocation(latitude,longitude)"],search:function(){if(this.query&&this.map){var t=new google.maps.places.PlacesService(this.map);if(this.types&&"string"==typeof this.types)var e=this.types.split(" ");if(this.radius)var i=this.radius,s=this.location?this.location:this.map.getCenter();else if(!this.globalSearch)var a=this.map.getBounds();t.textSearch({query:this.query,types:e,bounds:a,radius:i,location:s},this._gotResults.bind(this))}},getDetails:function(t){var e=new google.maps.places.PlacesService(this.map);return new Promise(function(i,s){e.getDetails({placeId:t},function(t,e){e===google.maps.places.PlacesServiceStatus.OK?(i(t),this.fire("google-map-search-place-detail",t)):s(e)}.bind(this))}.bind(this))},_gotResults:function(t){this.results=t.map(function(t){return t.latitude=t.geometry.location.lat(),t.longitude=t.geometry.location.lng(),t}),this.fire("google-map-search-results",this.results)},_updateLocation:function(){if(this.map){if("number"!=typeof this.latitude||isNaN(this.latitude))throw new TypeError("latitude must be a number");if("number"!=typeof this.longitude||isNaN(this.longitude))throw new TypeError("longitude must be a number");this._setLocation({lat:this.latitude,lng:this.longitude})}}})}()</script><dom-module id="yp-post-location"assetpath="../yp-post/"><template><style include="iron-flex iron-flex-alignment">:host{display:block;width:100%;height:100%;}.location-button{@apply --layout-horizontal;@apply --layout-flex;}#map{width:100%;height:100%;}@media screen and (-ms-high-contrast: active), (-ms-high-contrast: none){#map{min-height:220px;}}.mapSearchInput{width:100%;margin-top:8px;}paper-input{width:250px;}.searchResultText{width:100%;text-align:right;padding-top:8px;}paper-button{font-size:16px;padding-top:32px;}@media (max-width: 390px){#map{max-height:180px;}}@media (max-width: 320px){#map{max-height:160px;}}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><iron-media-query query="(max-width: 1024px)"query-matches="{{narrowPad}}"></iron-media-query><google-map-search id="mapSearch"map="[[map]]"on-google-map-search-results="_mapSearchResults"></google-map-search><google-map additional-map-options="{&quot;keyboardShortcuts&quot;:false}"id="map"zoom="[[mapZoom]]"api-key="AIzaSyDkF_kak8BVZA5zfp5R4xRnrX8HP3hjiL0"map="{{map}}"libraries="places"on-map-type-changed="_mapTypeChanged"class="map"click-events=""on-zoom-changed="_zoomChanged"on-google-map-click="_setLocation"fit-to-markers=""><google-map-marker slot="markers"latitude="[[defaultLatitude]]"longitude="[[defaultLongitude]]"id="marker"></google-map-marker></google-map><div class="mapSearchInput layout vertical center-center"><div class="layout horizontal center-center wrap"><paper-input max-length="60"label="[[t('maps.searchInput')]]"value="{{mapSearchString}}"on-keydown="_submitOnEnter"></paper-input><paper-button on-tap="_searchMap">[[t('maps.search')]]</paper-button></div><div class="searchResultText layout horizontal center-center">[[mapSearchResultAddress]]</div><paper-spinner id="spinner"></paper-spinner></div></template><script>Polymer({is:"yp-post-location",behaviors:[Polymer.ypLanguageBehavior],properties:{map:{type:Object},group:{type:Object,observer:"_groupChanged"},defaultLatitude:{type:String,value:"64.13897027178841"},defaultLongitude:{type:String,value:"-21.876912117004395"},mapSearchString:{type:String,value:""},mapSearchResultAddress:{type:String,value:""},location:{type:Object,observer:"_locationChanged",notify:!0},mapZoom:{type:Number,value:13,computed:"_computeMapZoom(location)"},encodedLocation:{type:String,notify:!0},post:{type:Object,observer:"_postChanged"},marker:{type:Object},active:{type:Boolean,value:!1},narrowPad:Boolean},_computeMapZoom:function(t){return t&&t.map_zoom?t.map_zoom:this.mapZoom},_submitOnEnter:function(t){13===t.keyCode&&this._searchMap()},_searchMap:function(){this.$.mapSearch.query=this.mapSearchString,this.$.mapSearch.search(),this.$.spinner.active=!0,this.set("mapSearchResultAddress","")},_mapSearchResults:function(t,o){this.$.spinner.active=!1,o&&0<o.length&&(this.set("location",{latitude:o[0].latitude,longitude:o[0].longitude,map_zoom:15}),this.mapSearchResultAddress=o[0].formatted_address,this.$.map.zoom=15,this.$.map.resize())},ready:function(){this.location||this.async(function(){"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(function(t){this.location||(this.location={latitude:t.coords.latitude,longitude:t.coords.longitude,map_zoom:13})}.bind(this))},50)},_zoomChanged:function(t,o){o&&o.value&&this.set("location.map_zoom",o.value),this.set("encodedLocation",JSON.stringify(this.location))},_mapTypeChanged:function(t,o){o&&o.value&&this.set("location.mapType",o.value),this.set("encodedLocation",JSON.stringify(this.location))},_locationChanged:function(t){t&&(this.$.marker.setAttribute("latitude",t.latitude),this.$.marker.setAttribute("longitude",t.longitude),t.map_zoom&&(this.$.map.zoom=t.map_zoom),t.mapType&&(this.$.map.mapType=t.mapType),this.$.map.resize(),this.set("encodedLocation",JSON.stringify(t)))},_setLocation:function(t,o){this.set("location",{latitude:o.latLng.lat(),longitude:o.latLng.lng(),mapType:this.$.map.mapType,map_zoom:this.$.map.zoom})},_groupChanged:function(t){var o;t&&(t.configuration&&t.configuration.defaultLocationLongLat&&""!=t.configuration.defaultLocationLongLat&&1<t.configuration.defaultLocationLongLat.split(",").length?(o=t.configuration.defaultLocationLongLat.trim().split(","),this.set("defaultLongitude",o[0]),this.set("defaultLatitude",o[1])):t.Community&&t.Community.configuration&&t.Community.configuration.defaultLocationLongLat&&""!=t.Community.configuration.defaultLocationLongLat&&1<t.Community.configuration.defaultLocationLongLat.split(",").length&&(o=t.Community.configuration.defaultLocationLongLat.trim().split(","),this.set("defaultLongitude",o[0]),this.set("defaultLatitude",o[1])))},_postChanged:function(t){t||this.set("location",null)}})</script></dom-module><dom-module id="yp-simple-html-editor"assetpath="../yp-survey-group/"><template><style include="iron-flex iron-flex-alignment">:host{display:inline-block;margin-top:8px;width:100%;}#htmlEditor{width:100%;height:300px;border-top:1px solid #cccccc;border-bottom:1px solid #888888;outline:none;overflow:auto;padding-top:8px;padding-bottom:8px;transition:border-bottom-color 0.1s;}#htmlEditor:focus{border-bottom:2px solid var(--accent-color);}#htmlEditor[has-error]{border-bottom:2px solid #dd2c00 !important;}.characterCounter{color:#212121;font-size:12px;text-align:right;width:100%;transition:color 0.1s;margin-top:1px;}.characterCounter[has-focus]{color:var(--accent-color);margin-top:0px;}.characterCounter[has-error]{color:#dd2c00 !important;}@media (max-width: 800px){#htmlEditor{height:220px;}}</style><div class="layout horizontal wrap"><div class="layout horizontal"><paper-icon-button aria-label$="[[t('formatBold')]]"icon="format-bold"on-mousedown="_toggleBoldM"on-tap="_toggleBold"></paper-icon-button><paper-icon-button aria-label$="[[t('formatItalic')]]"icon="format-italic"on-mousedown="_toggleItalicM"on-tap="_toggleItalic"></paper-icon-button><paper-icon-button aria-label$="[[t('formatUnderline')]]"icon="format-underlined"on-mousedown="_toggleUnderlineM"on-tap="_toggleUnderline"></paper-icon-button><paper-icon-button aria-label$="[[t('formatListBullets')]]"icon="format-list-bulleted"on-mousedown="_toggleListBulletsM"on-tap="_toggleListBullets"></paper-icon-button><paper-icon-button aria-label$="[[t('formatListNumbered')]]"icon="format-list-numbered"on-mousedown="_toggleListNumbersM"on-tap="_toggleListNumbers"></paper-icon-button></div><div class="layout horizontal"><paper-icon-button aria-label$="[[t('formatLeft')]]"icon="format-align-left"on-mousedown="_toggleAlignLeftM"on-tap="_toggleAlignLeft"></paper-icon-button><paper-icon-button aria-label$="[[t('formatCenter')]]"icon="format-align-center"on-mousedown="_toggleAlignCenterM"on-tap="_toggleAlignCenter"></paper-icon-button><paper-icon-button aria-label$="[[t('formatRight')]]"icon="format-align-right"on-mousedown="_toggleAlignRightM"on-tap="_toggleAlignRight"></paper-icon-button></div><div class="layout horizontal"><paper-icon-button aria-label$="[[t('formatH1')]]"icon="format-header-1"on-mousedown="_toggleH1M"on-tap="_toggleH1"></paper-icon-button><paper-icon-button aria-label$="[[t('formatH2')]]"icon="format-header-2"on-mousedown="_toggleH2M"on-tap="_toggleH2"></paper-icon-button><paper-icon-button aria-label$="[[t('formatH3')]]"icon="format-header-3"on-mousedown="_toggleH3M"on-tap="_toggleH3"></paper-icon-button><paper-icon-button aria-label$="[[t('formatH4')]]"icon="format-header-4"on-mousedown="_toggleH4M"on-tap="_toggleH4"></paper-icon-button><paper-icon-button aria-label$="[[t('formatH5')]]"icon="format-header-5"on-mousedown="_toggleH5M"on-tap="_toggleH5"></paper-icon-button><paper-icon-button aria-label$="[[t('formatH6')]]"icon="format-header-6"on-mousedown="_toggleH6M"on-tap="_toggleH6"></paper-icon-button><paper-icon-button aria-label$="[[t('formatP')]]"icon="format-paragraph"on-mousedown="_toggleHPM"on-tap="_toggleP"></paper-icon-button><paper-icon-button aria-label$="[[t('formatClear')]]"icon="format-clear"on-mousedown="_clearFormatM"on-tap="_clearFormat"></paper-icon-button></div></div><div id="htmlEditor"has-error$="[[showErrorLine]]"on-focus="_setFocus"on-blur="_setBlur"contenteditable="true"spellcheck="false"on-keydown="_keydown"on-paste="_paste"on-click="_changed"on-keyup="_changed"on-changed="_changed"></div><div has-focus$="[[hasFocus]]"has-error$="[[showErrorLine]]"class="layout end characterCounter">[[characterCount]]<span hidden$="[[!question.maxLength]]">/[[question.maxLength]]</span></div></template><script>var YpSimpleHtmlEditor=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"_setFocus",value:function(){this.set("hasFocus",!0),this._isFirefox()&&this.allowFirefoxFocusHack&&setTimeout(function(){this.allowFirefoxFocusHack=!1,this.shadowRoot.querySelector("#htmlEditor").blur(),this.shadowRoot.querySelector("#htmlEditor").focus(),setTimeout(function(){this.allowFirefoxFocusHack=!0}.bind(this),150)}.bind(this))}},{key:"_setBlur",value:function(){this.set("hasFocus",!1)}},{key:"setRichValue",value:function(e){this.set("value",e),this.shadowRoot.querySelector("#htmlEditor").innerHTML=this.value}},{key:"_updateCharacterCounter",value:function(){var e=this.shadowRoot.querySelector("#htmlEditor").textContent;e?this.set("characterCount",e.length):this.set("characterCount",0)}},{key:"_keydown",value:function(e){if(this._updateCharacterCounter(),this.set("showErrorLine",!1),this.question.maxLength){var t=[8,37,38,39,40].includes(e.keyCode),i=e.ctrlKey&&[65,90,86,67,88,8].includes(e.keyCode);if(t||i)return;this.characterCount>=this.question.maxLength&&e.preventDefault()}}},{key:"_paste",value:function(e){if(this.question.maxLength){var t=(e.clipboardData||window.clipboardData).getData("text/plain"),i=e.target.textContent.length,o=window.getSelection().toString(),a=this.question.maxLength-i+o.length,n=t.substring(0,a);e.preventDefault(),this._masterCommand("insertHTML",!1,n)}setTimeout(function(){this._updateCharacterCounter()}.bind(this))}},{key:"_changed",value:function(){this.set("value",this.shadowRoot.querySelector("#htmlEditor").innerHTML),this._updateCharacterCounter()}},{key:"validate",value:function(){return this.question.required?this.value&&0<this.value.length?(this.set("showErrorLine",!1),!0):(this.set("showErrorLine",!0),!1):(this.set("showErrorLine",!1),!0)}},{key:"_isSafariOrIe11",value:function(){return-1<navigator.userAgent.indexOf("Safari")&&-1===navigator.userAgent.indexOf("Chrome")&&-1===navigator.userAgent.indexOf("iPhone")&&-1===navigator.userAgent.indexOf("iPad")||/Trident.*rv[ :]*11\./.test(navigator.userAgent)}},{key:"_isFirefox",value:function(){return-1<navigator.userAgent.indexOf("Firefox")}},{key:"_clearFormat",value:function(){this._masterCommand("removeFormat"),this._masterCommand("formatBlock",!1,"p")}},{key:"_clearFormatM",value:function(){this._isSafariOrIe11()&&this._clearFormat()}},{key:"_toggleH1",value:function(){this._masterCommand("formatBlock",!1,"h1")}},{key:"_toggleH1M",value:function(){this._isSafariOrIe11()&&this._toggleH1()}},{key:"_toggleH2",value:function(){this._masterCommand("formatBlock",!1,"h2")}},{key:"_toggleH2M",value:function(){this._isSafariOrIe11()&&this._toggleH2()}},{key:"_toggleH3",value:function(){this._masterCommand("formatBlock",!1,"h3")}},{key:"_toggleH3M",value:function(){this._isSafariOrIe11()&&this._toggleH3()}},{key:"_toggleH4",value:function(){this._masterCommand("formatBlock",!1,"h4")}},{key:"_toggleH4M",value:function(){this._isSafariOrIe11()&&this._toggleH4()}},{key:"_toggleH5",value:function(){this._masterCommand("formatBlock",!1,"h5")}},{key:"_toggleH5M",value:function(){this._isSafariOrIe11()&&this._toggleH5()}},{key:"_toggleH6",value:function(){this._masterCommand("formatBlock",!1,"h6")}},{key:"_toggleH6M",value:function(){this._isSafariOrIe11()&&this._toggleH6()}},{key:"_toggleP",value:function(){this._masterCommand("formatBlock",!1,"p")}},{key:"_togglePM",value:function(){this._isSafariOrIe11()&&this._toggleP()}},{key:"_toggleAlignLeft",value:function(){this._masterCommand("JustifyLeft",!1,"")}},{key:"_toggleAlignLeftM",value:function(){this._isSafariOrIe11()&&this._toggleAlignLeft()}},{key:"_toggleAlignRight",value:function(){this._masterCommand("JustifyRight",!1,"")}},{key:"_toggleAlignRightM",value:function(){this._isSafariOrIe11()&&this._toggleAlignRight()}},{key:"_toggleAlignCenter",value:function(){this._masterCommand("JustifyCenter",!1,"")}},{key:"_toggleAlignCenterM",value:function(){this._isSafariOrIe11()&&this._toggleAlignCenter()}},{key:"_toggleAlignJustify",value:function(){this._masterCommand("JustifyFull",!1,"")}},{key:"_toggleAlignJustifyM",value:function(){this._isSafariOrIe11()&&this._toggleAlignJustify()}},{key:"_toggleBold",value:function(){this._masterCommand("bold")}},{key:"_toggleBoldM",value:function(){this._isSafariOrIe11()&&this._toggleBold()}},{key:"_toggleItalic",value:function(){this._masterCommand("italic")}},{key:"_toggleItalicM",value:function(){this._isSafariOrIe11()&&this._toggleItalic()}},{key:"_toggleUnderline",value:function(){this._masterCommand("underline")}},{key:"_toggleUnderlineM",value:function(){this._isSafariOrIe11()&&this._toggleUnderline()}},{key:"_toggleListBullets",value:function(){this._masterCommand("insertUnorderedList")}},{key:"_toggleListBulletsM",value:function(){this._isSafariOrIe11()&&this._toggleListBullets()}},{key:"_toggleListNumbers",value:function(){this._masterCommand("insertOrderedList")}},{key:"_toggleListNumbersM",value:function(){this._isSafariOrIe11()&&this._toggleListNumbers()}},{key:"_masterCommand",value:function(e,t,i){document.execCommand(e,t,i),this._changed()}},{key:"ready",value:function(){window.i18nTranslation&&this.set("language",window.locale),babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"ready",this).call(this)}}],[{key:"is",get:function(){return"yp-simple-html-editor"}},{key:"properties",get:function(){return{question:{type:Object},index:{type:Number},language:{type:String},useSmallFont:{type:Boolean,value:!1},value:{type:String,value:""},characterCount:{type:Number,value:0},hasFocus:{type:Boolean,value:!1},allowFirefoxFocusHack:{type:Boolean,value:!0},showErrorLine:{type:Boolean,value:!1}}}}]),t}(Polymer.Element);customElements.define(YpSimpleHtmlEditor.is,YpSimpleHtmlEditor)</script></dom-module><dom-module id="yp-structured-question-edit"assetpath="../yp-survey-group/"><template><style include="iron-flex iron-flex-alignment">:host{display:block;font-size:16px;}a{color:#000;}.question{margin-top:32px;margin-bottom:8px;color:#000;font-size:18px;line-height:1.5;}.question[use-small-font]{font-size:16px;}hr{border-top:2px dashed var(--accent-color);margin-top:48px;margin-bottom:32px;}.general{color:#000;}.noBottomMargin{margin-bottom:0;}.header[is-not-first]{margin-top:54px;}paper-dropdown-menu{margin-top:16px;}.numberInput{}paper-checkbox{margin-bottom:16px;}paper-input, paper-textarea-aria{--paper-input-container-label:{color:#000;font-size:18px;};}paper-input[use-small-font], paper-textarea-aria[use-small-font]{--paper-input-container-label:{font-size:16px;};}paper-input{margin-bottom:32px;}paper-radio-group{margin-top:16px;margin-bottom:16px;font-size:16px;}paper-radio-button{--paper-radio-button-label-color:#252525;font-size:16px;}.checkBoxesLabel{margin-bottom:36px;}.radiosLabel{margin-bottom:16px;margin-top:48px;}.radiosLabel[is-first-rating]{margin-top:24px;}paper-textarea-aria.textAreaLong{--paper-input-container:{margin:0;padding:0;};}paper-input.textAreaLong{--paper-input-container:{margin:0;padding:0;};}.longQuestion{font-size:18px;font-weight:400;color:#252525;padding-bottom:0;margin-bottom:0;}.longQuestion[use-small-font]{font-size:16px;color:#252525;}.longQuestion[is-from-new-post]{color:#757575;}.question[is-from-new-post]{color:#757575;}.longQuestion[has-content]{font-size:12px;}.longQuestion[has-focus]{color:var(--accent-color);}paper-checkbox{--paper-checkbox-label-color:#252525;margin-left:42px;margin-bottom:24px;}.general[less-bottom-margin]{margin-bottom:-32px;}.general[extra-top-margin]{margin-top:32px;}.lessBottomMargin{margin-bottom:-32px;}[hidden]{display:none !important;}.header{font-size:26px;font-weight:bold;line-height:1.5;}.header[is-first]{background-color:var(--accent-color);color:#FFF;font-size:32px;padding:24px;}@media (min-width: 800px){paper-input[half-width-desktop]{width:50%;}:host{padding:0;margin:0;}}paper-radio-button{margin-left:24px;}.specifyInput{max-width:220px;margin-left:24px;margin-top:-16px;margin-bottom:0;}.specifyCheckBox{margin-left:42px;margin-bottom:12px;}@media (max-width: 600px){.header{font-size:22px;}.header[is-first]{font-size:24px;}}paper-radio-group[invalid] paper-radio-button{--paper-radio-button-label-color:red;--paper-radio-button-unchecked-color:red;}paper-dropdown-menu{background-color:transparent;}</style><template is="dom-if"if="[[_isTextField(question)]]"><template is="dom-if"if="[[_isNumberSubType(question)]]"><paper-input id="structuredQuestion_[[index]]"value="{{question.value}}"always-float-label="[[_floatIfValueOrIE(question.value)]]"label="[[_getTextWithIndex(question)]]"char-counter=""use-small-font$="[[useSmallFont]]"title$="[[question.text]]"on-keypress="_keyPressed"type="text"allowed-pattern="[0-9]"half-width-desktop$="[[question.halfWidthDesktop]]"on-value-changed="_debounceChangeEvent"required$="[[question.required]]"maxlength="[[question.maxLength]]"></paper-input></template><template is="dom-if"if="[[!_isNumberSubType(question)]]"><paper-input id="structuredQuestion_[[index]]"value="{{question.value}}"always-float-label="[[_floatIfValueOrIE(question.value)]]"label="[[_getTextWithIndex(question)]]"char-counter=""use-small-font$="[[useSmallFont]]"title$="[[question.text]]"on-keypress="_keyPressed"type="[[question.subType]]"half-width-desktop$="[[question.halfWidthDesktop]]"on-value-changed="_debounceChangeEvent"required$="[[question.required]]"maxlength="[[question.maxLength]]"></paper-input></template></template><template is="dom-if"if="[[_isTextFieldLong(question)]]"><div class="question general longQuestion"has-focus$="[[longFocus]]"is-from-new-post$="[[isFromNewPost]]"use-small-font$="[[useSmallFont]]"id="structuredQuestionIntro_[[index]]"inner-h-t-m-l="[[_getTextWithIndex(question)]]"></div><template is="dom-if"if="[[_isNumberSubType(question)]]"><paper-input id="structuredQuestion_[[index]]"value="{{question.value}}"char-counter=""use-small-font$="[[useSmallFont]]"on-keypress="_keyPressed"on-focus="setLongFocus"on-blur="setLongUnFocus"allowed-pattern="[0-9]"type="text"title$="[[question.text]]"no-label-float=""half-width-desktop$="[[question.halfWidthDesktop]]"on-value-changed="_debounceChangeEvent"required$="[[question.required]]"maxlength="[[question.maxLength]]"></paper-input></template><template is="dom-if"if="[[!_isNumberSubType(question)]]"><paper-input id="structuredQuestion_[[index]]"value="{{question.value}}"char-counter=""use-small-font$="[[useSmallFont]]"on-keypress="_keyPressed"on-focus="setLongFocus"on-blur="setLongUnFocus"type="[[question.subType]]"title$="[[question.text]]"no-label-float=""half-width-desktop$="[[question.halfWidthDesktop]]"on-value-changed="_debounceChangeEvent"required$="[[question.required]]"maxlength="[[question.maxLength]]"></paper-input></template></template><template is="dom-if"if="[[_isTextarea(question)]]"><paper-textarea-aria id="structuredQuestion_[[index]]"data-type="text"value="{{question.value}}"minlength="2"always-float-label="[[_floatIfValueOrIE(question.value)]]"label="[[_getTextWithIndex(question)]]"char-counter=""use-small-font$="[[useSmallFont]]"on-value-changed="_debounceChangeEvent"rows="3"max-rows="5"maxrows="5"required$="[[question.required]]"maxlength="[[question.maxLength]]"></paper-textarea-aria></template><template is="dom-if"if="[[_isTextareaLong(question)]]"><div class="question general longQuestion"has-focus$="[[longFocus]]"has-content$="[[question.value]]"is-from-new-post$="[[isFromNewPost]]"use-small-font$="[[useSmallFont]]"id="structuredQuestionIntro_[[index]]"inner-h-t-m-l="[[_getTextWithIndex(question)]]"></div><template is="dom-if"if="[[question.richTextAllowed]]"><yp-simple-html-editor id="structuredQuestion_[[index]]"question="[[question]]"on-focus="setLongFocus"on-blur="setLongUnFocus"></yp-simple-html-editor></template><template is="dom-if"if="[[!question.richTextAllowed]]"><paper-textarea-aria id="structuredQuestion_[[index]]"data-type="text"value="{{question.value}}"minlength="2"char-counter=""on-focus="setLongFocus"on-blur="setLongUnFocus"no-label-float=""use-small-font$="[[useSmallFont]]"on-value-changed="_debounceChangeEvent"rows="3"max-rows="5"maxrows="5"required$="[[question.required]]"maxlength="[[question.maxLength]]"></paper-textarea-aria></template></template><template is="dom-if"if="[[_isTextHeader(question)]]"><div class="header"is-not-first$="[[index]]"is-first$="[[!index]]">[[question.text]]</div></template><template is="dom-if"if="[[_isTextDescription(question)]]"><div class="question general"id="structuredQuestionQuestion_[[index]]"use-small-font$="[[useSmallFont]]"is-from-new-post$="[[isFromNewPost]]"inner-h-t-m-l="[[_textWithLinks(question)]]"extra-top-margin$="[[question.extraTopMargin]]"less-bottom-margin$="[[question.lessBottomMargin]]"></div></template><template is="dom-if"if="[[_isSeparator(question)]]"><hr></template><template is="dom-if"if="[[_isRadios(question)]]"><div class="question general radiosLabel"use-small-font$="[[useSmallFont]]"is-first-rating$="[[isFirstRating]]"id="structuredQuestionIntro_[[index]]"is-from-new-post$="[[isFromNewPost]]"inner-h-t-m-l="[[_getTextWithIndex(question)]]"></div><paper-radio-group required$="[[question.required]]"data-type="radios"on-selected-changed="_radioChanged"id="structuredQuestion_[[index]]"name="structuredQuestionRatioGroup_[[index]]"class$="[[_getRadioClass(question)]]"><template is="dom-repeat"items="[[question.radioButtons]]"as="radioButton"index-as="buttonIndex"><template is="dom-if"if="[[!radioButton.isSpecify]]"><paper-radio-button use-small-font$="[[useSmallFont]]"on-keypress="setRadioEventType"id="structuredQuestionRatioGroup_[[index]]_[[buttonIndex]]"name="[[radioButton.text]]">[[radioButton.text]]</paper-radio-button></template><template is="dom-if"if="[[radioButton.isSpecify]]"class="layout horizontal"><paper-radio-button use-small-font$="[[useSmallFont]]"on-keypress="setRadioEventType"id="structuredQuestionRatioGroup_[[index]]_[[buttonIndex]]"name="[[radioButton.text]]">[[radioButton.text]]</paper-radio-button><template is="dom-if"if="[[_isNumberSubType(radioButton)]]"><paper-input class="specifyInput"hidden=""no-label-float=""on-value-changed="_debounceChangeEvent"maxlength="[[question.maxLength]]"allowed-pattern="[0-9]"type="text"id="structuredQuestion_[[index]]_[[buttonIndex]]__radioOther"></paper-input></template><template is="dom-if"if="[[!_isNumberSubType(radioButton)]]"><paper-input class="specifyInput"hidden=""no-label-float=""on-value-changed="_debounceChangeEvent"maxlength="[[question.maxLength]]"type="[[radioButton.subType]]"id="structuredQuestion_[[index]]_[[buttonIndex]]__radioOther"></paper-input></template></template></template></paper-radio-group></template><template is="dom-if"if="[[_isCheckboxes(question)]]"><div id="structuredQuestionIntro_[[index]]"class="question general checkBoxesLabel"use-small-font$="[[useSmallFont]]"is-from-new-post$="[[isFromNewPost]]"inner-h-t-m-l="[[_getTextWithIndex(question)]]"></div><div id="structuredQuestion_[[index]]"data-type="checkboxes"class="layout vertical"><template is="dom-repeat"items="[[question.checkboxes]]"as="checkbox"index-as="buttonIndex"><template is="dom-if"if="[[!checkbox.isSpecify]]"><paper-checkbox id="structuredQuestionCheckbox_[[index]]_[[buttonIndex]]"on-change="_checkboxChanged">[[checkbox.text]]</paper-checkbox></template><template is="dom-if"if="[[checkbox.isSpecify]]"><paper-checkbox id="structuredQuestionCheckbox_[[index]]_[[buttonIndex]]"on-change="_checkboxChanged">[[checkbox.text]]</paper-checkbox><paper-input class="specifyInput specifyCheckBox"hidden=""no-label-float=""on-value-changed="_debounceChangeEvent"type="[[checkbox.subType]]"id="structuredQuestion_[[index]]_[[buttonIndex]]_checkboxOther"></paper-input></template></template></div></template><template is="dom-if"if="[[_isDropDown(question)]]"><paper-dropdown-menu id="structuredQuestion_[[index]]"data-type="dropdown"label="[[_getTextWithIndex(question)]]"required$="[[question.required]]"><paper-listbox id="structuredQuestion_[[index]]_listbox"slot="dropdown-content"attr-for-selected="name"><template is="dom-repeat"items="[[question.dropdownOptions]]"as="dropDownOptions"><paper-item name="[[dropDownOptions.text]]">[[dropDownOptions.text]]</paper-item></template></paper-listbox></paper-dropdown-menu></template></template><script>var YpStructuredQuestionEdit=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"setLongUnFocus",value:function(){this.set("longFocus",!1)}},{key:"setLongFocus",value:function(){this.set("longFocus",!0)}},{key:"_isNumberSubType",value:function(e){return e&&"number"===e.subType}},{key:"_keyPressed",value:function(e){13!=e.which&&13!=e.keyCode||this.fire("yp-goto-next-index",{currentIndex:this.index})}},{key:"setRadioEventType",value:function(){this.radioKeypress=!0}},{key:"_sendDebouncedChange",value:function(e){this.debunceChangeEventTimer||(this.debunceChangeEventTimer=this.async(function(){this.fire("yp-answer-content-changed",e),this.debunceChangeEventTimer=null,this._resizeScrollerIfNeeded()},2e3))}},{key:"_debounceChangeEvent",value:function(e,t){e.stopPropagation(),this._sendDebouncedChange(t)}},{key:"_getTextWithIndex",value:function(e){return e.text}},{key:"_getRadioClass",value:function(e){return e.subType&&"rating"===e.subType&&!this.isLastRating?"layout horizontal wrap lessBottomMargin":e.subType&&"rating"===e.subType?"layout horizontal wrap":"layout vertical"}},{key:"_textWithLinks",value:function(e){var t=linkifyHtml(e.text);return t=t.replace(/\n/g,"<br>")}},{key:"_resizeScrollerIfNeeded",value:function(){this.fire("resize-scroller")}},{key:"_floatIfValueOrIE",value:function(e){return/Trident.*rv[ :]*11\./.test(navigator.userAgent)||e}},{key:"validate",value:function(){var e=this.$$("#structuredQuestion_"+this.index);return!e||(e&&this.question.type&&"radios"===this.question.type.toLowerCase()&&this.question.required?null==e.selectedItem?(e.setAttribute("invalid",!0),!1):(e.removeAttribute("invalid"),!0):!e||"function"!=typeof e.validate||e.validate())}},{key:"focus",value:function(){if("textfield"===this.question.type.toLowerCase()||"textfieldlong"===this.question.type.toLowerCase()||"textarea"===this.question.type.toLowerCase()||"textarealong"===this.question.type.toLowerCase()||"numberfield"===this.question.type.toLowerCase()){var e=this.$$("#structuredQuestion_"+this.index);e&&this.async(function(){e.focus()},250)}}},{key:"cleanValue",value:function(e){return e?e.replace(/,/g,";").replace(/:/g,";"):(console.warn("No value for cleanValue"),"")}},{key:"getAnswer",value:function(){var n=this.$$("#structuredQuestion_"+this.index);if(n){var s=null;if("textfield"===this.question.type.toLowerCase()||"textfieldlong"===this.question.type.toLowerCase()||"textarea"===this.question.type.toLowerCase()||"textarealong"===this.question.type.toLowerCase()||"numberfield"===this.question.type.toLowerCase())s=n.value;else if("dropdown"===this.question.type.toLowerCase()){var e=this.$$("#structuredQuestion_"+this.index+"_listbox");s=e.selected}else if("radios"===this.question.type.toLowerCase()){if(n.selected){var o=null;this.question.radioButtons.forEach(function(e,t){if(e.text===n.selected)if((o=e).isSpecify){var i=this.$$("#structuredQuestion_"+this.index+"_"+t+"__radioOther");s=i?o.text+":"+this.cleanValue(i.value):o.text}else s=o.text}.bind(this))}}else if("checkboxes"===this.question.type.toLowerCase()){for(var t="",i=0;i<n.children.length;i++)if(n.children[i].checked){var r=n.children[i].id.split("_")[2],u=this.question.checkboxes[r];if(u.isSpecify){var a=this.$$("#structuredQuestion_"+this.index+"_"+r+"_checkboxOther");a&&""!==a.value?t+=u.text+":"+this.cleanValue(a.value)+",":t+=u.text+","}else t+=u.text+","}""!==t&&(s=t.substring(0,t.length-1))}return{uniqueId:this.question.uniqueId,value:s}}console.error("Can't find question item for "+this.question.text)}},{key:"setAnswer",value:function(n){if(n){var s=this.$$("#structuredQuestion_"+this.index);if(s){if("textfield"===this.question.type.toLowerCase()||"textfieldlong"===this.question.type.toLowerCase()||"textarea"===this.question.type.toLowerCase()||"textarealong"===this.question.type.toLowerCase()||"numberfield"===this.question.type.toLowerCase())1==this.question.richTextAllowed?s.setRichValue(n):s.value=n;else if("dropdown"===this.question.type.toLowerCase()){this.$$("#structuredQuestion_"+this.index+"_listbox").selected=n}else if("radios"===this.question.type.toLowerCase()){var o=null;if(-1<n.indexOf(":"))n=(u=n.split(":"))[0],o=u[1];this.question.radioButtons.forEach(function(e,t){if(e.text===n&&(s.select(n),o)){var i=this.$$("#structuredQuestion_"+this.index+"_"+t+"__radioOther");i?(i.hidden=!1,i.value=o):console.error("Can't find checkbox specify value")}}.bind(this))}else if("checkboxes"===this.question.type.toLowerCase()){for(var e=n.split(","),t={},i=!1,r=0;r<e.length;r++)if(-1<e[r].indexOf(":")){var u=e[r].split(":");e[r]=u[0],t[u[0]]=u[1],i=!0}for(r=0;r<s.children.length;r++)if(s.children[r]){var a=s.children[r].id.split("_")[2],l=this.question.checkboxes[a];if(l){if(-1<e.indexOf(l.text)&&(s.children[r].checked=!0,i)){var d=this.$$("#structuredQuestion_"+this.index+"_"+a+"_checkboxOther");d&&t[l.text]?(d.hidden=!1,d.value=t[l.text]):console.error("Can't find checkbox specify value")}}else console.debug("No selectedCheckbox")}}}else console.error("cant find answer for item index "+this.index)}}},{key:"hide",value:function(){var e=this.$$("#structuredQuestion_"+this.index);if(e){e.hidden=!0;var t=this.$$("#structuredQuestionIntro_"+this.index);t&&(t.hidden=!0)}else console.error("Can't find question index: "+this.index)}},{key:"show",value:function(){var e=this.$$("#structuredQuestion_"+this.index);if(e){e.hidden=!1;var t=this.$$("#structuredQuestionIntro_"+this.index);t&&(t.hidden=!1)}else console.error("Can't find question index: "+this.index)}},{key:"_openSubQuestion",value:function(){this.dispatchEvent(new CustomEvent("yp-open-sub-question",{bubbles:!0,composed:!0,detail:this.question.id}))}},{key:"_closeSubQuestion",value:function(){this.dispatchEvent(new CustomEvent("yp-close-sub-question",{bubbles:!0,composed:!0,detail:this.question.id}))}},{key:"_checkboxChanged",value:function(e){if(e.target.checked){var t=e.target.id.split("_")[2];if(this.question.checkboxes[t].isSpecify){var i=this.$$("#structuredQuestion_"+this.index+"_"+t+"_checkboxOther");i?(i.hidden=!1,i.value||(i.value=""),i.focus()):console.error("Can't find checkbox input")}}if(this.question.maxLength){for(var n=0,s=this.$$("#structuredQuestion_"+this.index),o=0;o<s.children.length;o++)"paper-checkbox"===s.children[o].tagName.toLowerCase()&&s.children[o].checked&&(n+=1);if(n>=parseInt(this.question.maxLength))for(var r=0;r<s.children.length;r++)"paper-checkbox"!==s.children[r].tagName.toLowerCase()||s.children[r].checked||(s.children[r].disabled=!0);else for(var u=0;u<s.children.length;u++)"paper-checkbox"===s.children[u].tagName.toLowerCase()&&s.children[u].disabled&&(s.children[u].disabled=!1)}e.stopPropagation(),this._sendDebouncedChange({value:1})}},{key:"_radioChanged",value:function(e,s){e.stopPropagation(),this._sendDebouncedChange({value:1});var o=null;this.question.radioButtons.forEach(function(e,t){if(e.text===s.value)if((o=e).skipTo)this.fire("yp-skip-to-unique-id",{fromId:this.question.uniqueId,toId:o.skipTo});else if(o.isSpecify){var i=this.$$("#structuredQuestion_"+this.index+"_"+t+"__radioOther");i?(i.hidden=!1,i.focus()):console.error("Can't find radio specify value")}else{var n;this.async(function(){this.radioKeypress||this.fire("yp-goto-next-index",{currentIndex:this.index})}),this.question.radioButtons.forEach(function(e){e.skipTo&&(n=e.skipTo)}.bind(this)),n&&this.fire("yp-open-to-unique-id",{fromId:this.question.uniqueId,toId:n})}}.bind(this))}},{key:"_isTextarea",value:function(e){return e.type&&"textarea"===e.type.toLowerCase()||void 0===e.type&&1<e.maxLength}},{key:"_isTextareaLong",value:function(e){return e.type&&"textarealong"===e.type.toLowerCase()}},{key:"_isTextField",value:function(e){return e.type&&"textfield"===e.type.toLowerCase()}},{key:"_isTextFieldLong",value:function(e){return e.type&&"textfieldlong"===e.type.toLowerCase()}},{key:"_isNumberField",value:function(e){return e.type&&"numberfield"===e.type.toLowerCase()}},{key:"_isTextHeader",value:function(e){return e.type&&"textheader"===e.type.toLowerCase()}},{key:"_isTextDescription",value:function(e){return e.type&&"textdescription"===e.type.toLowerCase()}},{key:"_isCheckboxes",value:function(e){return e.type&&"checkboxes"===e.type.toLowerCase()}},{key:"_isSeparator",value:function(e){return e.type&&"separator"===e.type.toLowerCase()}},{key:"_isRadios",value:function(e){return e.type&&"radios"===e.type.toLowerCase()}},{key:"_isDropDown",value:function(e){return e.type&&"dropdown"===e.type.toLowerCase()}},{key:"_structuredAnsweredChanged",value:function(e){if(e&&this.question.uniqueId){var t={};try{e.forEach(function(e){if(this.question.uniqueId===e.uniqueId)throw this.async(function(){this.setAnswer(e.value)},100),t}.bind(this))}catch(e){if(e!==t)throw e}}}},{key:"ready",value:function(){window.i18nTranslation&&this.set("language",window.locale),this.question&&"numberField"===this.question.type&&(this.question.type="textField",this.question.subType="number"),this.async(function(){1!==this.question.questionIndex||this.dontFocusFirstQuestion||this.focus()},500),babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"ready",this).call(this)}}],[{key:"is",get:function(){return"yp-structured-question-edit"}},{key:"properties",get:function(){return{question:{type:Object},index:{type:Number},isFromNewPost:{type:Boolean,value:!1},language:{type:String},hideQuestionIndex:{type:Boolean,value:!0},dontFocusFirstQuestion:{type:Boolean,value:!1},useSmallFont:{type:Boolean,value:!1},structuredAnswers:{type:Array,observer:"_structuredAnsweredChanged"},longFocus:{type:Boolean,value:!1},isLastRating:{type:Boolean,value:!1},isFirstRating:{type:Boolean,value:!1}}}}]),t}(Polymer.mixinBehaviors([Polymer.IronFormElementBehavior,Polymer.IronValidatableBehavior],Polymer.Element));customElements.define(YpStructuredQuestionEdit.is,YpStructuredQuestionEdit)</script></dom-module><dom-module id="yp-post-edit"assetpath="../yp-post/"><template><style include="iron-flex iron-flex-alignment">.access{@apply --layout-horizontal;@apply --layout-center-justified;}paper-button{background-color:var(--accent-color);color:#FFF;}yp-file-upload{margin-top:16px;}.accessHeader{color:var(--primary-color,#777);font-weight:normal;margin-bottom:0;}paper-radio-button{display:block;}.container{width:100%;width:100%;}yp-post-location{min-height:320px;}@media (max-width: 600px){.container{padding-right:16px;}.subContainer{}paper-tab{font-size:12px;}}yp-post-location{}section{margin-top:32px;}.imageSizeInfo{font-size:12px;padding-bottom:16px;color:#444;}paper-dropdown-menu{max-width:250px;}.optional{font-size:12px;}.icon{padding-right:8px;}[hidden]{display:none !important;}paper-checkbox{margin-left:8px;margin-top:4px;}section{width:100%;}.contactInfo{margin-top:16px;}#description{--paper-input-container-input:{max-height:125px;};}.postEmoji{margin-left:16px;direction:ltr !important;}.pointEmoji{direction:ltr !important;}.uploadSection{max-width:220px;vertical-align:top;margin-left:8px;margin-right:8px;}@media (max-width: 600px){.uploadSection{max-width:100%;}.videoCam{--iron-icon-height:15px;--iron-icon-width:15px;--iron-icon-fill-color:#555;}yp-structured-question-edit{max-width:calc(100vw - 64px);}}.postCoverVideoInfo{margin-top:8px;}.videoUploadDisclamer{margin-top:6px;font-size:12px;padding:0;max-width:200px;}.categoryDropDown{margin-bottom:8px;}.topNewPostContainer[no-title]{margin-top:-42px;}paper-tabs[title-disabled]{margin-bottom:24px;}.videoCamIcon{margin-left:6px;margin-bottom:2px;}.mediaTab{vertical-align:center;}.attachmentInfo{margin-top:-8px;margin-left:8px;}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-yp-auto-translate="_autoTranslateEvent"></lite-signal><yp-edit-dialog name="postEdit"double-width=""id="editDialog"icon="lightbulb-outline"action="[[action]]"use-next-tab-action="[[newPost]]"on-next-tab-action="_nextTab"method="[[method]]"title="[[editHeaderText]]"save-text="[[saveText]]"class="container"custom-submit=""next-action-text="[[t('next')]]"toast-text="[[toastText]]"params="[[params]]"><paper-tabs title-disabled$="[[group.configuration.hideNameInputAndReplaceWith]]"selected="{{selected}}"id="paperTabs"focused=""hidden$="[[hasOnlyOneTab]]"><paper-tab><span>[[t('post.yourPost')]]</span></paper-tab><template is="dom-if"restamp=""if="[[newPointShown]]"><paper-tab><div class="layout vertical center-center"><div>[[t('post.yourPoint')]]</div><div class="optional"hidden$="[[!group.configuration.newPointOptional]]">[[t('optional')]]</div></div></paper-tab></template><template is="dom-if"if="[[!locationHidden]]"restamp=""><paper-tab>[[t('post.location')]]</paper-tab></template><template is="dom-if"if="[[!mediaHidden]]"restamp=""><paper-tab><div>[[t('media')]]</div><div class="videoCamIcon"><iron-icon class="videoCam"icon="videocam"style="color: #555"></iron-icon></div></paper-tab></template></paper-tabs><div class="layout vertical wrap topNewPostContainer"no-title$="[[group.configuration.hideNameInputAndReplaceWith]]"><iron-pages id="pages"class="layout horizontal"selected="[[selected]]"><section><div class="layout vertical flex"><template is="dom-if"if="[[group.configuration.hideNameInputAndReplaceWith]]"><input type="hidden"name="name"value="[[replacedName]]"></template><template is="dom-if"if="[[!group.configuration.hideNameInputAndReplaceWith]]"><paper-input id="name"required=""minlength="3"name="name"type="text"label="[[titleQuestionText]]"value="{{post.name}}"maxlength="60"char-counter=""></paper-input></template><template is="dom-if"if="[[_showCategories(group)]]"restamp=""><paper-dropdown-menu class="categoryDropDown"label="[[t('category.select')]]"required$="[[group.configuration.makeCategoryRequiredOnNewPost]]"><paper-listbox slot="dropdown-content"selected="{{selectedCategoryArrayId}}"><template is="dom-repeat"items="[[group.Categories]]"as="category"><paper-item data-category-id$="[[category.id]]">[[category.name]]</paper-item></template></paper-listbox></paper-dropdown-menu><input type="hidden"name="categoryId"value="[[selectedCategoryId]]"></template><template is="dom-if"if="[[group.configuration.usePostTags]]"><paper-input id="tags"name="tags"type="text"label="[[t('commaSeperatedTags')]]"value="{{post.public_data.tags}}"></paper-input></template><template is="dom-if"if="[[postDescriptionLimit]]"><paper-textarea-aria id="description"hidden$="[[hasStructuredQuestions]]"required$="[[!hasStructuredQuestions]]"minlength="3"name="description"value="{{post.description}}"always-float-label="[[_floatIfValueOrIE(post.description)]]"label="[[t('post.description')]]"aria-label$="[[t('post.description')]]"on-value-changed="_resizeScrollerIfNeeded"char-counter=""rows="2"max-rows="5"maxrows="5"maxlength="[[postDescriptionLimit]]"></paper-textarea-aria><div class="horizontal end-justified layout postEmoji"hidden$="[[group.configuration.hideEmoji]]"><emoji-selector id="emojiSelectorDescription"hidden$="[[hasStructuredQuestions]]"></emoji-selector></div></template><template is="dom-if"if="[[hasStructuredQuestions]]"><div id="surveyContainer"><template is="dom-repeat"items="[[structuredQuestions]]"as="question"><yp-structured-question-edit index="[[index]]"use-small-font=""is-from-new-post=""id="structuredQuestionContainer_[[index]]"dont-focus-first-question="[[!group.configuration.hideNameInputAndReplaceWith]]"on-resize-scroller="_resizeScrollerIfNeeded"structured-answers="[[initialStructuredAnswersJson]]"is-last-rating="[[_isLastRating(index)]]"is-first-rating="[[_isFirstRating(index)]]"hide-question-index="[[group.configuration.hideQuestionIndexOnNewPost]]"question="[[question]]"></yp-structured-question-edit></template></div></template><template is="dom-if"if="[[group.configuration.attachmentsEnabled]]"><yp-file-upload id="attachmentFileUpload"raised="true"multi="false"accept="application/msword,application/vnd.ms-excel,application/vnd.ms-powerpoint,text/plain,application/pdf,image/*"target="/api/groups/[[group.id]]/upload_document"method="POST"group="[[group]]"attachment-upload=""on-success="_documentUploaded"><iron-icon class="icon"icon="attach-file"></iron-icon><span>[[t('uploadAttachment')]]</span></yp-file-upload><small class="attachmentInfo">[[t('documentOnlyVisibleToAdmins')]]</small><template is="dom-if"if="[[post.data.attachment.url]]"><paper-checkbox name="deleteAttachment">[[t('deleteAttachment')]]: [[post.data.attachment.filename]]</paper-checkbox></template></template><template is="dom-if"if="[[group.configuration.moreContactInformation]]"><h2 class="contactInfo">[[t('contactInformation')]]</h2><paper-input id="contactName"name="contactName"type="text"label="[[t('user.name')]]"value="{{post.data.contact.name}}"char-counter=""></paper-input><paper-input id="contactEmail"name="contactEmail"type="text"label="[[t('user.email')]]"value="{{post.data.contact.email}}"char-counter=""></paper-input><paper-input id="contactTelephone"name="contacTelephone"type="text"label="[[t('contactTelephone')]]"value="{{post.data.contact.telephone}}"maxlength="20"char-counter=""></paper-input><paper-input id="contactAddress"name="contactAddress"type="text"hidden$="[[!group.configuration.moreContactInformationAddress]]"label="[[t('contactAddress')]]"value="{{post.data.contact.address}}"maxlength="300"char-counter=""></paper-input></template></div></section><template is="dom-if"restamp=""if="[[newPointShown]]"><section class="subContainer"><paper-textarea-aria id="pointFor"required$="[[!group.configuration.newPointOptional]]"minlength="3"name="pointFor"value="{{post.pointFor}}"always-float-label="[[_floatIfValueOrIE(post.pointFor)]]"label="[[t('point.for')]]"aria-label$="[[t('point.for')]]"char-counter=""rows="2"max-rows="5"maxlength="[[_pointMaxLength(group)]]"></paper-textarea-aria><div class="horizontal end-justified layout pointEmoji"hidden$="[[group.configuration.hideEmoji]]"><emoji-selector id="emojiSelectorPointFor"></emoji-selector></div></section></template><template is="dom-if"if="[[!locationHidden]]"restamp=""><section><template is="dom-if"if="[[mapActive]]"restamp=""><yp-post-location encoded-location="{{encodedLocation}}"location="{{location}}"group="[[group]]"post="[[post]]"></yp-post-location></template></section></template><section><div class="layout vertical center-center"><div class="layout horizontal center-center wrap"><div class="layout vertical center-center self-start uploadSection"hidden$="[[group.configuration.hidePostImageUploads]]"><yp-file-upload id="imageFileUpload"raised="true"multi="false"target="/api/images?itemType=post-header"method="POST"on-success="_imageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('image.upload')]]</span></yp-file-upload><div class="imageSizeInfo layout horizontal"><div>864 x 486 (16/9 widescreen)</div></div><div>[[t('post.cover.imageInfo')]]</div></div><template is="dom-if"if="[[group.configuration.allowPostVideoUploads]]"><div class="layout vertical center-center self-start uploadSection"><yp-file-upload id="videoFileUpload"container-type="posts"group="[[group]]"raised="true"upload-limit-seconds="[[group.configuration.videoPostUploadLimitSec]]"multi="false"video-upload=""method="POST"on-success="_videoUploaded"><iron-icon class="icon"icon="videocam"></iron-icon><span>[[t('uploadVideo')]]</span></yp-file-upload><div hidden$="[[!group.configuration.showVideoUploadDisclaimer]]"><div class="videoUploadDisclamer"hidden$="[[!uploadedVideoId]]">[[t('videoUploadDisclaimer')]]</div></div></div></template><template is="dom-if"if="[[group.configuration.allowPostAudioUploads]]"><div class="layout vertical center-center self-start uploadSection"><yp-file-upload id="audioFileUpload"container-type="posts"group="[[group]]"raised="true"upload-limit-seconds="[[group.configuration.audioPostUploadLimitSec]]"multi="false"audio-upload=""method="POST"on-success="_audioUploaded"><iron-icon class="icon"icon="keyboard-voice"></iron-icon><span>[[t('uploadAudio')]]</span></yp-file-upload></div></template></div><br><h3 class="accessHeader">[[t('post.cover.media')]]</h3><paper-radio-group id="coverMediaType"name="coverMediaType"class="coverMediaType layout horizontal wrap"selected="{{selectedCoverMediaType}}"><paper-radio-button name="none">[[t('post.cover.none')]]</paper-radio-button><paper-radio-button name="image"hidden$="[[!uploadedHeaderImageId]]">[[t('post.cover.image')]]</paper-radio-button><paper-radio-button name="video"hidden$="[[!showVideoCover]]">[[t('postCoverVideo')]]</paper-radio-button><paper-radio-button name="audio"hidden$="[[!showAudioCover]]">[[t('postCoverAudio')]]</paper-radio-button><template is="dom-if"if="[[location]]"><paper-radio-button name="map">[[t('post.cover.map')]]</paper-radio-button><paper-radio-button name="streetView">[[t('post.cover.streetview')]]</paper-radio-button></template></paper-radio-group></div></section></iron-pages><input type="hidden"name="location"value="[[encodedLocation]]"> <input type="hidden"name="coverMediaType"value="[[selectedCoverMediaType]]"> <input type="hidden"name="uploadedHeaderImageId"value="[[uploadedHeaderImageId]]"> <input type="hidden"name="uploadedDocumentUrl"value="[[uploadedDocumentUrl]]"> <input type="hidden"name="uploadedDocumentFilename"value="[[uploadedDocumentFilename]]"> <input type="hidden"name="structuredAnswers"value="[[structuredAnswers]]"> <input type="hidden"name="structuredAnswersJson"value="[[structuredAnswersJson]]"></div></yp-edit-dialog><template is="dom-if"if="[[group.configuration.alternativeTextForNewIdeaButtonHeader]]"><yp-magic-text id="alternativeTextForNewIdeaButtonHeaderId"hidden=""content-id="[[group.id]]"text-only=""content="[[group.configuration.alternativeTextForNewIdeaButtonHeader]]"content-language="[[group.language]]"on-new-translation="_alternativeTextForNewIdeaButtonHeaderTranslation"text-type="alternativeTextForNewIdeaButtonHeader"></yp-magic-text></template><template is="dom-if"if="[[group.configuration.customThankYouTextNewPosts]]"><yp-magic-text id="customThankYouTextNewPostsId"hidden=""content-id="[[group.id]]"text-only=""content="[[group.configuration.customThankYouTextNewPosts]]"content-language="[[group.language]]"text-type="customThankYouTextNewPosts"></yp-magic-text></template><template is="dom-if"if="[[group.configuration.customTitleQuestionText]]"><yp-magic-text id="customTitleQuestionTextId"hidden=""content-id="[[group.id]]"text-only=""content="[[group.configuration.customTitleQuestionText]]"content-language="[[group.language]]"on-new-translation="_updatePostTitle"role="heading"aria-level="2"text-type="customTitleQuestionText"></yp-magic-text></template><yp-ajax hidden=""id="translatedQuestionsAjax"on-response="_translatedQuestionsResponse"></yp-ajax></template></dom-module><script>Polymer({is:"yp-post-edit",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypEditDialogBehavior,Polymer.ypGotoBehavior],properties:{action:{type:String,value:"/api/posts"},newPost:{type:Boolean,value:!1},initialStructuredAnswersJson:{type:Array,value:null},post:{type:Object,observer:"_postChanged"},titleQuestionText:{type:String,computed:"_titleQuestionText(post, customTitleQuestionText, group)"},customTitleQuestionText:{type:String,value:null},group:{type:Object,observer:"_groupChanged"},locationHidden:{type:Boolean,value:!1,observer:"_locationHiddenChanged"},location:{type:Object,observer:"_locationChanged"},encodedLocation:{type:String,observer:"_encodedLocationChanged"},selectedCategoryArrayId:{type:Number,observer:"_selectedCategoryChanged"},selectedCategoryId:{type:Number},emailValidationPattern:{type:String,value:"^[_A-Za-z0-9-\\+]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})$"},selectedCoverMediaType:{type:String,value:"none",observer:"_coverMediaTypeValueChanged"},uploadedHeaderImageId:{type:String,observer:"_uploadedHeaderImageIdChanged"},uploadedVideoId:{type:String,value:null},uploadedAudioId:{type:String,value:null},currentVideoId:{type:String,value:null},currentAudioId:{type:String,value:null},showVideoCover:{type:Boolean,computed:"_showVideoCover(uploadedVideoId, currentVideoId)"},showAudioCover:{type:Boolean,computed:"_showAudioCover(uploadedAudioId, currentAudioId)"},newPointShown:{type:Boolean,computed:"_newPointShown(newPost, group)"},mediaHidden:{type:Boolean,computed:"_mediaHidden(newPost, group)"},selected:{type:Number,value:0,observer:"_selectedChanged"},mapActive:{type:Boolean,value:!1},postDescriptionLimit:{type:Number,value:null},structuredQuestions:{type:Array,computed:"_structuredQuestions(post, group, translatedQuestions)"},hasStructuredQuestions:{type:Boolean,computed:"_hasStructuredQuestions(structuredQuestions)"},replacedName:{type:String,computed:"_replacedName(post, group, newPost)"},sructuredAnswers:{type:String,value:null},sructuredAnswersJson:{type:Object,value:null},uploadedDocumentUrl:String,uploadedDocumentFilename:String,pointMaxLength:{type:Number,computed:"_pointMaxLength(group)"},hasOnlyOneTab:{type:Boolean,value:!1},translatedQuestions:{type:Array,value:null},autoTranslate:{type:Boolean,value:!1}},_autoTranslateEvent:function(t,e){this.set("autoTranslate",e),this._getSurveyTranslationsIfNeeded()},_getQuestionLengthWithSubOptions:function(t){for(var e=0,i=0;i<t.length;i++){e+=1;var o=t[i];"radios"===o.type&&o.radioButtons&&0<o.radioButtons.length?e+=o.radioButtons.length:"checkboxes"===o.type&&o.checkboxes&&0<o.checkboxes.length?e+=o.checkboxes.length:"dropdown"===o.type&&o.dropdownOptions&&0<o.dropdownOptions.length&&(e+=o.dropdownOptions.length)}return e},_getSurveyTranslationsIfNeeded:function(){this.set("translatedQuestions",null),this.autoTranslate&&this.language!==this.group.language&&(this.$.translatedQuestionsAjax.url="/api/groups/".concat(this.group.id,"/translatedSurveyQuestions?targetLanguage=").concat(this.language),this.$.translatedQuestionsAjax.generateRequest())},_translatedQuestionsResponse:function(t,e){if(this.autoTranslate&&this.language!==this.group.language){var i=e.response,o=JSON.parse(JSON.stringify(this.group.configuration.structuredQuestionsJson));if(i.length===this._getQuestionLengthWithSubOptions(o)){for(var n,s=0,r=0;r<o.length;r++)if((n=o[r]).originalText=n.text,n.text=i[s++],"radios"===n.type&&n.radioButtons&&0<n.radioButtons.length)for(var u=0;u<n.radioButtons.length;u++)n.radioButtons[u].originalText=n.radioButtons[u].text,n.radioButtons[u].text=i[s++];else if("checkboxes"===n.type&&n.checkboxes&&0<n.checkboxes.length)for(u=0;u<n.checkboxes.length;u++)n.checkboxes[u].originalText=n.checkboxes[u].text,n.checkboxes[u].text=i[s++];else if("dropdown"===n.type&&n.dropdownOptions&&0<n.dropdownOptions.length)for(u=0;u<n.dropdownOptions.length;u++)n.dropdownOptions[u].originalText=n.dropdownOptions[u].text,n.dropdownOptions[u].text=i[s++];this.set("translatedQuestions",o)}else console.error("Questions and Translated texts length does not match")}else this.set("translatedQuestions",null)},_groupChanged:function(t){t&&t.configuration&&t.configuration.structuredQuestionsJson&&0<t.configuration.structuredQuestionsJson.length&&(window.autoTranslate&&this.set("autoTranslate",window.autoTranslate),this._getSurveyTranslationsIfNeeded())},listeners:{"iron-form-invalid":"_formInvalid","yp-custom-form-submit":"_customSubmit","yp-skip-to-unique-id":"_skipToId","yp-open-to-unique-id":"_openToId","yp-goto-next-index":"_goToNextIndex"},_titleQuestionText:function(t,e,i){return t&&i&&e?e:t&&i&&i.configuration&&i.configuration.customTitleQuestionText?i.configuration.customTitleQuestionText:this.t("title")},_isLastRating:function(t){return"rating"===this.structuredQuestions[t].subType&&t+2<this.structuredQuestions.length&&"rating"!==this.structuredQuestions[t+1].subType},_isFirstRating:function(t){return"rating"===this.structuredQuestions[t].subType&&this.structuredQuestions[t-1]&&"rating"!==this.structuredQuestions[t-1].subType},_openToId:function(t,e){this._skipToId(t,e,!0)},_goToNextIndex:function(t,e){var i=this.liveQuestionIds.indexOf(e.currentIndex);if(i<this.liveQuestionIds.length-1){var o=this.$$("#structuredQuestionContainer_"+this.liveQuestionIds[i+1]);o.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}),o.focus()}},_hasStructuredQuestions:function(t){return null!=t},_skipToId:function(t,e,i){var o=!1;if(this.$$("#surveyContainer"))for(var n=this.$$("#surveyContainer").children,s=0;s<n.length;s++){var r=e.toId.replace(/]/g,""),u=e.fromId.replace(/]/g,"");if(n[s+1]&&n[s+1].question&&n[s+1].question.uniqueId&&"a"===n[s+1].question.uniqueId.substring(n[s+1].question.uniqueId.length-1)&&(n[s].question.uniqueId=n[s+1].question.uniqueId.substring(0,n[s+1].question.uniqueId.length-1)),n[s].question&&e.fromId&&n[s].question.uniqueId===u)o=!0;else{if(n[s].question&&e.toId&&(n[s].question.uniqueId===r||n[s].question.uniqueId===r+"a"))break;o&&(n[s].hidden=!i)}}else console.error("No survey container found")},observers:["_setupTranslation(language,t)"],_updatePostTitle:function(){this.async(function(){var t=this.$$("#customTitleQuestionTextId");t&&t.finalContent&&this.set("customTitleQuestionText",t.finalContent)})},_replacedName:function(t,e){if(t&&e&&e.configuration.hideNameInputAndReplaceWith){var i=e.configuration.hideNameInputAndReplaceWith;return i=(i=(i=i.replace("<DATESECONDS>",moment(new Date).format("DD/MM/YYYY hh:mm:ss"))).replace("<DATEMINUTES>",moment(new Date).format("DD/MM/YYYY hh:mm"))).replace("<DATE>",moment(new Date).format("DD/MM/YYYY"))}return null},_pointMaxLength:function(t){return t&&t.configuration&&t.configuration.pointCharLimit?t.configuration.pointCharLimit:500},_floatIfValueOrIE:function(t){return/Trident.*rv[ :]*11\./.test(navigator.userAgent)||t},_mediaHidden:function(t,e){return!(!e||!e.configuration||!0!==e.configuration.hideMediaInput)},_newPointShown:function(t,e){var i=!1;return e&&e.configuration&&!0===e.configuration.hideNewPointOnNewIdea&&(i=!0),t&&!i},_customSubmit:function(){if(this.group.configuration&&this.group.configuration.structuredQuestionsJson){var o=[];this.liveQuestionIds.forEach(function(t){var e=this.$$("#structuredQuestionContainer_"+t);e&&o.push(e.getAnswer())}.bind(this)),this.set("structuredAnswersJson",JSON.stringify(o)),this.$.editDialog._reallySubmit()}else if(this.structuredQuestions&&0<this.structuredQuestions.length){var t="";o="";for(i=0;i<this.structuredQuestions.length;i+=1)t+=this.structuredQuestions[i].question,this.structuredQuestions[i].question&&"?"!==this.structuredQuestions[i].question[this.structuredQuestions[i].question.length-1]&&(t+=":"),t+="\n",t+=this.structuredQuestions[i].value,o+=this.structuredQuestions[i].value,i!==this.structuredQuestions.length-1&&(o+="%!#x",t+="\n\n");this.set("post.description",t),this.set("structuredAnswers",o),this.$.editDialog._reallySubmit()}else this.$.editDialog._reallySubmit()},_resizeScrollerIfNeeded:function(){this.$.editDialog.scrollResize()},_structuredQuestions:function(t,e,i){if(t&&e&&e.configuration.structuredQuestionsJson)return i||e.configuration.structuredQuestionsJson;if(t&&e&&e.configuration.structuredQuestions&&""!==e.configuration.structuredQuestions){for(var o=[],n=e.configuration.structuredQuestions.split(","),s=0;s<n.length;s+=2){var r=n[s],u=n[s+1];o.push({text:r,question:r,maxLength:u,value:""})}if(!this.newPost&&t.public_data.structuredAnswers&&""!==t.public_data.structuredAnswers){var a=t.public_data.structuredAnswers.split("%!#x");for(s=0;s<a.length;s+=1)o[s]&&(o[s].value=a[s])}return o}return null},_showVideoCover:function(t,e){return t||e},_showAudioCover:function(t,e){return t||e},_videoUploaded:function(t,e){this.set("uploadedVideoId",e.videoId),this.set("selectedCoverMediaType","video"),this.async(function(){this.fire("iron-resize")},50)},_audioUploaded:function(t,e){this.set("uploadedAudioId",e.audioId),this.set("selectedCoverMediaType","audio"),this.async(function(){this.fire("iron-resize")})},_documentUploaded:function(t,e){var i=e.attachmentURL.split("?")[0];this.set("uploadedDocumentUrl",i),this.set("uploadedDocumentFilename",e.filename)},customFormResponse:function(){document.dispatchEvent(new CustomEvent("lite-signal",{bubbles:!0,compose:!0,detail:{name:"yp-refresh-group-posts",data:{id:4}}}))},_updateEmojiBindings:function(){this.async(function(){var t=this.$$("#description"),e=this.$$("#emojiSelectorDescription");t&&e?e.inputTarget=t:console.warn("Post edit: Can't bind emojis :(");var i=this.$$("#emojiSelectorPointFor"),o=this.$$("#pointFor");i&&o&&(i.inputTarget=o)}.bind(this),500)},_locationHiddenChanged:function(){this.async(function(){var t=this.$$("#pages");t&&t.forceSynchronousItemUpdate();var e=this.$$("#paperTabs");e&&e.forceSynchronousItemUpdate(),console.log("Location hidden changed")},10)},_formInvalid:function(){this.newPointShown&&!this.$$("#pointFor").validate()?this.set("selected",1):this.set("selected",0),this.$$("#name")&&(this.$$("#name").autoValidate=!0),this.$$("#description")&&(this.$$("#description").autoValidate=!0),this.newPointShown&&(this.$$("#pointFor").autoValidate=!0)},_encodedLocationChanged:function(){},_locationChanged:function(t){!t||this.selectedCoverMediaType&&""!=this.selectedCoverMediaType&&"none"!=this.selectedCoverMediaType||this.set("selectedCoverMediaType","map")},_uploadedHeaderImageIdChanged:function(t){t&&this.set("selectedCoverMediaType","image")},_nextOnEnter:function(t){13===t.keyCode&&this._searchMap()},_getTabLength:function(){var t=4;return this.newPointShown||(t-=1),this.locationHidden&&(t-=1),this.mediaHidden&&(t-=1),t},_nextTab:function(){var t=this._getTabLength();this.selected<t&&this.set("selected",this.selected+1)},_selectedChanged:function(o){this.async(function(){this.locationHidden||o!=(this.newPointShown?2:1)?this.set("mapActive",!1):this.set("mapActive",!0);var t=this._getTabLength()-1;if(0==t&&this.set("hasOnlyOneTab",!0),this.$$("#editDialog").useNextTabAction=o!=t,0==o){var e=this.$$("#name");e&&e.focus()}if(1==o&&this.newPointShown){var i=this.$$("#pointFor");i&&i.focus()}this.async(function(){this._resizeScrollerIfNeeded()},50)})},_selectedCategoryChanged:function(t){null!=t&&null!=t&&(this.selectedCategoryId=this.group.Categories[t].id)},_showCategories:function(t){return!(!t||!t.Categories)&&0<t.Categories.length},getPositionInArrayFromId:function(t,e){for(var i=0;i<t.length;i++)if(t[i].id==e)return i;return null},_postChanged:function(t){t&&(t.location&&(this.set("location",t.location),this.set("encodedLocation",JSON.stringify(this.location))),t.cover_media_type&&(this.selectedCoverMediaType=t.cover_media_type)),this._updateEmojiBindings()},_updateInitialCategory:function(t){t&&this.post&&this.post.category_id&&(this.selectedCategoryId=this.post.category_id,this.selectedCategoryArrayId=this.getPositionInArrayFromId(t.Categories,this.post.category_id))},_imageUploaded:function(t,e){var i=JSON.parse(e.xhr.response);this.set("uploadedHeaderImageId",i.id)},_coverMediaTypeValueChanged:function(){},_coverMediaTypeChanged:function(){},_customRedirect:function(e){var t;e?(e.newEndorsement&&window.appUser&&window.appUser.endorsementPostsIndex&&(window.appUser.endorsementPostsIndex[e.id]=e.newEndorsement),this.uploadedVideoId?(this.post=e,(t=document.createElement("iron-ajax")).handleAs="json",t.contentType="application/json",t.url="/api/videos/"+this.post.id+"/completeAndAddToPost",t.method="PUT",t.body={videoId:this.uploadedVideoId,appLanguage:this.language},t.addEventListener("response",function(t){this._finishRedirect(e),this.async(function(){window.appGlobals.showSpeechToTextInfoIfNeeded()},20)}.bind(this)),t.generateRequest()):this.uploadedAudioId&&this.newPost?(this.post=e,(t=document.createElement("iron-ajax")).handleAs="json",t.contentType="application/json",t.url="/api/audios/"+this.post.id+"/completeAndAddToPost",t.method="PUT",t.body={audioId:this.uploadedAudioId,appLanguage:this.language},t.addEventListener("response",function(t){this._finishRedirect(e)}.bind(this)),this.async(function(){window.appGlobals.showSpeechToTextInfoIfNeeded()},20),t.generateRequest()):this._finishRedirect(e)):console.warn("No post found on custom redirect")},_finishRedirect:function(t){this.fire("yp-reset-keep-open-for-page"),window.appGlobals.activity("completed","newPost");var e=this.t("thankYouForYourSubmission");this.group&&this.group.configuration&&this.group.configuration.customThankYouTextNewPosts&&this.$$("#customThankYouTextNewPostsId")&&this.$$("#customThankYouTextNewPostsId").content&&(e=this.$$("#customThankYouTextNewPostsId").finalContent?this.$$("#customThankYouTextNewPostsId").finalContent:this.$$("#customThankYouTextNewPostsId").content),Polymer.dom(document).querySelector("yp-app").getDialogAsync("masterToast",function(t){t.text=e,t.duration=5e3,t.show()}.bind(this)),this.group&&this.group.configuration&&this.group.configuration.allPostsBlockedByDefault||this.redirectTo("/post/"+(t?t.id:this.post.id))},_clear:function(){this.newPost&&(this.set("post",{name:"",description:"",pointFor:"",categoryId:null}),this.set("location",null),this.set("selectedCategoryArrayId",null),this.set("selectedCategoryId",null),this.set("selected",0),this.set("uploadedHeaderImageId",null),this.set("uploadedVideoId",null),this.set("uploadedAudioId",null),this.set("currentVideoId",null),this.set("currentAudioId",null),this.set("selectedCoverMediaType","none"),this.async(function(){this.fire("iron-resize")}),this.$$("#imageFileUpload")&&this.$$("#imageFileUpload").clear())},setup:function(t,e,i,o){this._setupGroup(o),t?(this.set("post",t),t.PostVideos&&0<t.PostVideos.length&&this.set("currentVideoId",t.PostVideos[0].id),t.PostAudios&&0<t.PostAudios.length&&this.set("currentAudioId",t.PostAudios[0].id)):this.set("post",null),this._updateInitialCategory(o),this.set("newPost",e),this.set("refreshFunction",i),this._setupTranslation(),this._clear()},_setupGroup:function(t){t&&(this.set("group",t),t.configuration?(t.configuration.locationHidden&&1==t.configuration.locationHidden?this.set("locationHidden",!0):this.set("locationHidden",!1),t.configuration.postDescriptionLimit?this.set("postDescriptionLimit",t.configuration.postDescriptionLimit):this.set("postDescriptionLimit",500),t.configuration.structuredQuestionsJson&&this.async(function(){this.liveQuestionIds=[],this.uniqueIdsToElementIndexes={},this.liveUniqueIds=[],t.configuration.structuredQuestionsJson.forEach(function(t,e){"textfield"!==t.type.toLowerCase()&&"textfieldlong"!==t.type.toLowerCase()&&"textarea"!==t.type.toLowerCase()&&"textarealong"!==t.type.toLowerCase()&&"numberfield"!==t.type.toLowerCase()&&"checkboxes"!==t.type.toLowerCase()&&"radios"!==t.type.toLowerCase()&&"dropdown"!==t.type.toLowerCase()||(this.liveQuestionIds.push(e),this.uniqueIdsToElementIndexes[t.uniqueId]=e,this.liveUniqueIds.push(t.uniqueId))}.bind(this))})):this.set("postDescriptionLimit",500),this.async(function(){this.structuredQuestions&&this.set("postDescriptionLimit",9999)},50))},setupAfterOpen:function(t){this._setupGroup(t.group),this.async(function(){var t=this.$$("#name");t&&t.focus()}.bind(this),250),!this.newPost&&this.post.public_data&&this.post.public_data.structuredAnswersJson&&this.set("initialStructuredAnswersJson",this.post.public_data.structuredAnswersJson)},_alternativeTextForNewIdeaButtonHeaderTranslation:function(){this.async(function(){var t=this.$$("#alternativeTextForNewIdeaButtonHeaderId");t&&t.finalContent&&this.set("editHeaderText",t.finalContent)})},_setupTranslation:function(){this.async(function(){if(this.t)if(this.newPost){if(this.group&&this.group.configuration&&this.group.configuration.alternativeTextForNewIdeaButtonHeader){var t=this.$$("#alternativeTextForNewIdeaButtonHeaderId");this.editHeaderText=t&&t.finalContent?t.finalContent:this.group.configuration.alternativeTextForNewIdeaButtonHeader}else this.editHeaderText=this.t("post.new");this.toastText=this.t("postCreated"),this.set("saveText",this.t("create"))}else this.set("saveText",this.t("save")),this.editHeaderText=this.t("post.edit"),this.toastText=this.t("postUpdated")}.bind(this),20)}})</script><script>Polymer.ypCollectionStatusOptions={properties:{collectionStatusOptions:{type:Object,computed:"_collectionStatusOptions(language)"}},_collectionStatusOptions:function(t){return t?[{name:"active",translatedName:this.t("status.active")},{name:"featured",translatedName:this.t("status.featured")},{name:"archived",translatedName:this.t("status.archived")},{name:"hidden",translatedName:this.t("status.hidden")}]:[]}}</script><dom-module id="yp-community-edit"assetpath="../yp-community/"><template><style include="iron-flex iron-flex-alignment">.access{@apply --layout-horizontal;@apply --layout-center-justified;}.accessHeader{color:var(--primary-color,#777);font-weight:normal;margin-bottom:0px;}paper-radio-button{display:block;}.additionalSettings{padding-top:16px;}.half{width:50%;}.hostnameInfo{color:#888;}.config{margin-top:16px;}paper-checkbox{margin-bottom:4px;}.uploadSection{max-width:300px;margin:8px;}.useVideoCover{margin-left:4px;margin-top:4px;}[hidden]{display:none !important;}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><yp-edit-dialog name="communityEdit"id="editDialog"title="[[editHeaderText]]"icon="group-work"action="[[action]]"method="[[method]]"params="[[params]]"save-text="[[saveText]]"toast-text="[[toastText]]"><div class="layout vertical"><paper-input id="name"name="name"type="text"label="[[t('name')]]"value="{{community.name}}"maxlength="60"minlength="1"required=""char-counter=""class="mainInput"></paper-input><paper-input id="hostname"name="hostname"type="text"allowed-pattern="[a-z0-9-]"label="[[t('community.hostname')]]"value="{{community.hostname}}"maxlength="80"minlength="1"required="[[!community.is_community_folder]]"char-counter=""class="mainInput"></paper-input><div class="hostnameInfo">https://[[hostnameExample]]</div><paper-textarea id="description"name="description"value="{{community.description}}"always-float-label="[[community.description]]"label="[[t('description')]]"char-counter=""rows="2"max-rows="5"minlength="1"on-value-changed="_descriptionChanged"required=""maxlength="[[descriptionMaxLength]]"class="mainInput"></paper-textarea><div class="horizontal end-justified layout"><emoji-selector id="emojiSelectorDescription"></emoji-selector></div></div><div class="layout horizontal wrap"><div class="layout vertical additionalSettings uploadSection"><yp-file-upload id="logoImageUpload"raised="true"multi="false"target="/api/images?itemType=community-logo"method="POST"on-success="_logoImageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('image.logo.upload')]]</span></yp-file-upload></div><div class="layout vertical additionalSettings uploadSection"><yp-file-upload id="headerImageUpload"raised="true"multi="false"target="/api/images?itemType=community-header"method="POST"on-success="_headerImageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('image.header.upload')]]</span></yp-file-upload></div><template is="dom-if"if="[[hasVideoUpload]]"><div class="layout vertical uploadSection"><yp-file-upload id="videoFileUpload"raised="true"multi="false"video-upload=""method="POST"on-success="_videoUploaded"><iron-icon class="icon"icon="videocam"></iron-icon><span>[[t('uploadVideo')]]</span></yp-file-upload><paper-checkbox class="useVideoCover"name="useVideoCover"disabled$="[[!uploadedVideoId]]"checked$="{{community.configuration.useVideoCover}}">[[t('useVideoCover')]]</paper-checkbox></div></template></div><yp-theme-selector object="[[community]]"selected-theme="{{themeId}}"></yp-theme-selector><div class="layout vertical config"hidden$="[[community.is_community_folder]]"><paper-checkbox name="onlyAdminsCanCreateGroups"checked$="{{community.only_admins_can_create_groups}}">[[t('community.onlyAdminsCanCreateGroups')]]</paper-checkbox><paper-checkbox hidden$="[[!community.configuration.alternativeHeader]]"name="alternativeHeader"checked$="{{community.configuration.alternativeHeader}}">[[t('community.alternativeHeader')]]</paper-checkbox><paper-checkbox name="disableDomainUpLink"checked$="{{community.configuration.disableDomainUpLink}}">[[t('disableCommunityDomainUpLink')]]</paper-checkbox><paper-checkbox name="disableNameAutoTranslation"checked$="{{community.configuration.disableNameAutoTranslation}}">[[t('disableNameAutoTranslation')]]</paper-checkbox><paper-checkbox name="hideAllTabs"checked$="{{community.configuration.hideAllTabs}}">[[t('hideAllTabs')]]</paper-checkbox></div><input type="hidden"name="themeId"value="[[themeId]]"><paper-input id="themeOverrideColorPrimary"name="themeOverrideColorPrimary"allowed-pattern="[#-#0-9A-Fa-f]"maxlength="7"char-counter=""label="[[t('themeOverrideColorPrimary')]]"value="{{community.configuration.themeOverrideColorPrimary}}"><div prefix="">#</div></paper-input><paper-input id="themeOverrideColorAccent"name="themeOverrideColorAccent"allowed-pattern="[#-#0-9A-Fa-f]"maxlength="7"char-counter=""label="[[t('themeOverrideColorAccent')]]"value="{{community.configuration.themeOverrideColorAccent}}"></paper-input><paper-input id="themeOverrideBackgroundColor"name="themeOverrideBackgroundColor"allowed-pattern="[#-#0-9A-Fa-f]"maxlength="7"char-counter=""label="[[t('themeOverrideBackgroundColor')]]"value="{{community.configuration.themeOverrideBackgroundColor}}"></paper-input><div class="themeOverrideInfo"><b><em>[[t('themeOverrideColorInfo')]]</em></b></div><input type="hidden"name="uploadedLogoImageId"value="[[uploadedLogoImageId]]"> <input type="hidden"name="uploadedHeaderImageId"value="[[uploadedHeaderImageId]]"> <input type="hidden"name="appHomeScreenIconImageId"value="[[appHomeScreenIconImageId]]"> <input type="hidden"name="ssnLoginListDataId"value="[[ssnLoginListDataId]]"> <input type="hidden"name="is_community_folder"value="[[community.is_community_folder]]"><div class="layout horizontal config"><paper-dropdown-menu label="[[t('status.select')]]"><paper-listbox slot="dropdown-content"attr-for-selected="name"selected="{{status}}"><template is="dom-repeat"items="[[collectionStatusOptions]]"as="statusOption"><paper-item name="[[statusOption.name]]">[[statusOption.translatedName]]</paper-item></template></paper-listbox></paper-dropdown-menu><input type="hidden"name="status"value="[[status]]"></div><div class="layout horizontal config"hidden$="[[!availableCommunityFolders]]"><paper-dropdown-menu label="[[t('inCommunityFolder')]]"><paper-listbox slot="dropdown-content"attr-for-selected="folderid"selected="{{inCommunityFolderId}}"><template is="dom-repeat"items="[[availableCommunityFolders]]"as="communityFolder"><paper-item folderid="[[communityFolder.id]]">[[communityFolder.name]]</paper-item></template></paper-listbox></paper-dropdown-menu><input type="hidden"name="in_community_folder_id"value="[[inCommunityFolderId]]"></div><yp-language-selector name="defaultLocale"no-user-events=""selected-locale="{{community.default_locale}}"></yp-language-selector><div class="layout horizontal config"hidden$="[[!pages]]"><paper-dropdown-menu label="[[t('signupTermsSelectPage')]]"><paper-listbox slot="dropdown-content"attr-for-selected="name"selected="{{community.configuration.signupTermsPageId}}"><template is="dom-repeat"items="[[translatedPages]]"as="page"><paper-item name="[[page.id]]"data-args$="[[index]]">[[_getLocalizePageTitle(page)]]</paper-item></template></paper-listbox></paper-dropdown-menu><input type="hidden"name="signupTermsPageId"value="[[community.configuration.signupTermsPageId]]"></div><div class="layout horizontal config"hidden$="[[!pages]]"><paper-dropdown-menu label="[[t('welcomeSelectPage')]]"><paper-listbox slot="dropdown-content"attr-for-selected="name"selected="{{community.configuration.welcomePageId}}"><template is="dom-repeat"items="[[translatedPages]]"as="page"><paper-item name="[[page.id]]"data-args$="[[index]]">[[_getLocalizePageTitle(page)]]</paper-item></template></paper-listbox></paper-dropdown-menu><input type="hidden"name="welcomePageId"value="[[community.configuration.welcomePageId]]"></div><paper-input id="google_analytics_code"name="google_analytics_code"type="text"label="[[t('analyticsTrackerCode')]]"value="{{community.google_analytics_code}}"maxlength="40"style="width: 200px;"></paper-input><paper-input id="facebookPixelId"name="facebookPixelId"type="text"label="[[t('facebookPixelId')]]"value="{{community.configuration.facebookPixelId}}"maxlength="40"style="width: 200px;"></paper-input><paper-input id="defaultLocationLongLat"name="defaultLocationLongLat"type="text"label="[[t('defaultLocationLongLat')]]"value="{{community.defaultLocationLongLat}}"maxlength="100"style="width: 300px;"></paper-input><h3 class="accessHeader">[[t('access')]]</h3><paper-radio-group id="access"name="access"class="access"selected="{{communityAccess}}"><paper-radio-button name="public">[[t('public')]]</paper-radio-button><paper-radio-button name="closed">[[t('closed')]]</paper-radio-button><paper-radio-button name="secret">[[t('secret')]]</paper-radio-button></paper-radio-group><paper-textarea id="welcomeHTML"name="welcomeHTML"value="{{community.configuration.welcomeHTML}}"always-float-label="[[community.configuration.welcomeHTML]]"label="[[t('welcomeHTML')]]"rows="2"max-rows="5"minlength="1"class="mainInput"></paper-textarea><paper-input id="customBackURL"name="customBackURL"type="text"maxlength="256"label="[[t('customBackURL')]]"value="{{community.configuration.customBackURL}}"></paper-input><paper-input id="customBackName"name="customBackName"type="text"maxlength="20"label="[[t('customBackName')]]"value="{{community.configuration.customBackName}}"></paper-input><paper-input id="highlightedLanguages"name="highlightedLanguages"type="text"maxlength="200"label="[[t('highlightedLanguages')]]"value="{{community.configuration.highlightedLanguages}}"></paper-input><paper-input id="redirectToGroupId"name="redirectToGroupId"type="text"label="[[t('redirectToGroupId')]]"value="{{community.configuration.redirectToGroupId}}"maxlength="11"></paper-input><paper-input id="appHomeScreenShortName"name="appHomeScreenShortName"type="text"label="[[t('appHomeScreenShortName')]]"value="{{community.configuration.appHomeScreenShortName}}"maxlength="12"style="width: 200px;"></paper-input><div class="layout vertical additionalSettings half"><yp-file-upload id="appHomeScreenIconImageUpload"raised="true"multi="false"target="/api/images?itemType=app-home-screen-icon"method="POST"on-success="_appHomeScreenIconImageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('appHomeScreenIconImageUpload')]] (512x512)</span></yp-file-upload></div><paper-checkbox name="sortBySortOrder"checked$="{{community.configuration.sortBySortOrder}}">[[t('sortGroupsBySortOrder')]]</paper-checkbox><paper-checkbox name="hideRecommendationOnNewsFeed"checked$="{{community.configuration.hideRecommendationOnNewsFeed}}">[[t('hideRecommendationOnNewsFeed')]]</paper-checkbox><paper-checkbox name="forceSecureSamlLogin"disabled$="[[!hasSamlLoginProvider]]"checked$="{{community.configuration.forceSecureSamlLogin}}">[[t('forceSecureSamlLogin')]]</paper-checkbox><paper-textarea id="customSamlLoginMessage"name="customSamlLoginMessage"value="{{community.configuration.customSamlLoginMessage}}"always-float-label="[[community.configuration.customSamlLoginMessage]]"label="[[t('customSamlLoginMessage')]]"char-counter=""rows="2"max-rows="5"minlength="1"maxlength="175"class="mainInput"></paper-textarea><paper-textarea id="customSamlDeniedMessage"name="customSamlDeniedMessage"value="{{community.configuration.customSamlDeniedMessage}}"always-float-label="[[community.configuration.customSamlDeniedMessage]]"label="[[t('customSamlDeniedMessage')]]"char-counter=""rows="2"max-rows="5"minlength="1"maxlength="150"class="mainInput"></paper-textarea><paper-input id="externalId"name="externalId"type="text"label="[[t('externalId')]]"value="{{community.configuration.externalId}}"></paper-input><div class="layout horizontal additionalSettings half"hidden$="[[!ssnLoginListDataId]]"><div><b>[[t('ssnLoginListCount')]]: [[ssnLoginListDataCount]]</b></div><div><paper-button style="padding: 8px;"raised=""on-tap="_deleteSsnLoginList">[[t('deleteSsnLoginList')]]</paper-button></div></div><div class="layout vertical additionalSettings half"hidden$="[[ssnLoginListDataId]]"><yp-file-upload id="ssnLoginListDataUpload"raised="true"disabled$="[[!hasSamlLoginProvider]]"hidden$="[[!community.id]]"accept=".txt,.csv"multi="false"target="/api/communities/[[community.id]]/upload_ssn_login_list"method="POST"on-success="_ssnLoginListDataUploaded"><iron-icon class="icon"icon="link"></iron-icon><span>[[t('ssnLoginListDataUpload')]]</span></yp-file-upload></div><yp-ajax id="pagesAjax"on-response="_pagesResponse"></yp-ajax><yp-ajax id="communityFoldersAjax"on-response="_communityFoldersResponse"></yp-ajax><yp-ajax id="ssnLoginListCount"on-response="_ssnLoginListCount"></yp-ajax><yp-ajax id="ssnLoginListDelete"method="DELETE"></yp-ajax></yp-edit-dialog></template></dom-module><script>Polymer({is:"yp-community-edit",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypEditDialogBehavior,Polymer.ypCollectionStatusOptions,Polymer.ypGotoBehavior,Polymer.ypTranslatedPagesBehavior],properties:{action:{type:String,value:"/api/communities"},community:{type:Object,observer:"_communityChanged"},hostnameExample:{type:String,computed:"_getExampleHostname(community.hostname)"},communityAccess:{type:String,value:"public"},inCommunityFolderId:{type:String,value:null},availableCommunityFolders:{type:Array,value:null},params:{type:String},method:{type:String},uploadedLogoImageId:{type:String},uploadedHeaderImageId:{type:String},uploadedAppIconImageId:{type:String},status:String,themeId:{type:String,value:null},appHomeScreenIconImageId:String,ssnLoginListDataId:{type:String,value:null},ssnLoginListDataCount:String,hasVideoUpload:{type:Boolean,value:!1},uploadedVideoId:{type:Number,value:null},hasSamlLoginProvider:{type:Boolean,value:!1},descriptionMaxLength:{type:Number,value:300}},observers:["_setupTranslation(language,t)"],_descriptionChanged:function(t){var i=t.target.value,e=new RegExp(/(?:https?|http?):\/\/[\n\S]+/g),s=i.match(e);if(s&&0<s.length){for(var n=0,o=0;o<Math.min(s.length,10);o++)n+=s[o].length;var a=300;a+=n,a-=Math.min(n,30*s.length),this.set("descriptionMaxLength",a)}},_videoUploaded:function(t,i){this.set("uploadedVideoId",i.videoId),this.set("community.configuration.useVideoCover",!0)},_pagesResponse:function(t,i){var e=i.response;e.unshift({id:-1,title:{en:this.t("none")}}),this._setPages(t,e)},_communityFoldersResponse:function(t,i){var e,s=i.response;this.community.id&&(s.forEach(function(t,i){t.id==this.community.id&&(e=i)}.bind(this)),e&&s.splice(e,1));s&&0<s.length?(s.unshift({id:-1,name:this.t("none")}),this.set("availableCommunityFolders",s)):this.set("availableCommunityFolders",null)},_appHomeScreenIconImageUploaded:function(t,i){var e=JSON.parse(i.xhr.response);this.set("appHomeScreenIconImageId",e.id)},_deleteSsnLoginList:function(){this.$.ssnLoginListDelete.url="/api/communities/"+this.community.id+"/"+this.ssnLoginListDataId+"/delete_ssn_login_list",this.$.ssnLoginListDelete.body={},this.$.ssnLoginListDelete.generateRequest(),this.set("ssnLoginListDataId",null),this.set("ssnLoginListDataCount",null)},_ssnLoginListDataUploaded:function(t,i){this.set("ssnLoginListDataId",JSON.parse(i.xhr.response).ssnLoginListDataId),this._getSsnListCount()},_getSsnListCount:function(){this.$.ssnLoginListCount.url="/api/communities/"+this.community.id+"/"+this.ssnLoginListDataId+"/ssn_login_list_count",this.$.ssnLoginListCount.generateRequest()},_ssnLoginListCount:function(t,i){this.set("ssnLoginListDataCount",i.response.count)},_updateEmojiBindings:function(){this.async(function(){var t=this.$$("#description"),i=this.$$("#emojiSelectorDescription");t&&i?i.inputTarget=t:console.warn("Community edit: Can't bind emojis :(")}.bind(this),500)},_getExampleHostname:function(t){return t?t+"."+window.appGlobals.domain.domain_name:"your-hostname."+window.appGlobals.domain.domain_name},_customRedirect:function(i){if(i&&i.hostnameTaken)Polymer.dom(document).querySelector("yp-app").getDialogAsync("errorDialog",function(t){t.showErrorDialog(this.t("hostnameTaken"))}.bind(this));else if(i)if(window.appUser.recheckAdminRights(),this.uploadedVideoId){var t=document.createElement("iron-ajax");t.handleAs="json",t.contentType="application/json",t.url="/api/videos/"+i.id+"/completeAndAddToCommunity",t.method="PUT",t.body={videoId:this.uploadedVideoId},t.addEventListener("response",function(t){this._finishRedirect(i)}.bind(this)),t.generateRequest()}else this._finishRedirect(i);else console.warn("No community found on custom redirect")},_finishRedirect:function(t){t.is_community_folder?this.redirectTo("/community_folder/"+t.id):this.redirectTo("/community/"+t.id),window.appGlobals.activity("completed","editCommunity")},_communityChanged:function(t){t&&(0===this.community.access?this.communityAccess="public":1===this.community.access?this.communityAccess="closed":2===this.community.access&&(this.communityAccess="secret"),this.community.status&&this.set("status",this.community.status),this.community.in_community_folder_id&&this.set("inCommunityFolderId",this.community.in_community_folder_id)),this._updateEmojiBindings(),window.appGlobals.hasVideoUpload?this.set("hasVideoUpload",!0):this.set("hasVideoUpload",!1),window.appGlobals.domain&&window.appGlobals.domain.samlLoginProvided?this.set("hasSamlLoginProvider",!0):this.set("hasSamlLoginProvider",!1),this.community&&this.community.configuration&&this.community.configuration.ssnLoginListDataId&&(this.set("ssnLoginListDataId",this.community.configuration.ssnLoginListDataId),this._getSsnListCount())},_clear:function(){this.set("community",null),this.set("uploadedLogoImageId",null),this.set("uploadedHeaderImageId",null),this.set("appHomeScreenIconImageId",null),this.set("ssnLoginListDataId",null),this.set("ssnLoginListDataCount",null),this.set("communityFolderId",null),this.set("availableCommunityFolders",null),this.$.headerImageUpload.clear(),this.$.logoImageUpload.clear(),this.$.appHomeScreenIconImageUpload.clear(),this.$$("#videoFileUpload")&&this.$$("#videoFileUpload").clear()},_checkCommunityFolders:function(t){var i;i=t.Domain?t.Domain:window.appGlobals.domain,this.$.communityFoldersAjax.url="/api/domains/"+i.id+"/availableCommunityFolders",this.$.communityFoldersAjax.generateRequest()},setup:function(t,i,e,s,n){t?(this.set("community",t),t.CommunityLogoVideos&&0<t.CommunityLogoVideos.length&&this.set("uploadedVideoId",t.CommunityLogoVideos[0].id),this.$.pagesAjax.url="/api/communities/"+t.id+"/pages",this.$.pagesAjax.generateRequest()):this.set("community",{name:"",description:"",access:0,status:"active",community_folder_id:n||null,is_community_folder:s||null}),this._checkCommunityFolders(this.community),this.set("new",i),this.set("refreshFunction",e),this._setupTranslation()},_setupTranslation:function(){this.t&&(this.new?(this.community&&this.community.is_community_folder?this.set("editHeaderText",this.t("newCommunityFolder")):this.set("editHeaderText",this.t("community.new")),this.set("saveText",this.t("create")),this.set("toastText",this.t("communityToastCreated"))):(this.community&&this.community.is_community_folder?this.set("editHeaderText",this.t("updateCommunityFolder")):this.set("editHeaderText",this.t("Update community info")),this.set("saveText",this.t("save")),this.set("toastText",this.t("communityToastUpdated"))))}})</script><dom-module id="yp-group-edit"assetpath="../yp-group/"><template><style include="iron-flex iron-flex-alignment">.access{@apply --layout-horizontal;@apply --layout-center-justified;}.subHeaders{color:#333;font-weight:normal;margin-bottom:8px;margin-top:30px;font-size:22px;width:100%;padding-bottom:8px;border-bottom:2px solid #888;text-align:center;}paper-radio-button{display:block;}.additionalSettings{padding-top:8px;}yp-file-upload{}.half{width:50%;}.config{padding:8px;vertical-align:top;}paper-checkbox{padding-top:8px;}.icon{padding-right:8px;}paper-dropdown-menu{max-width:250px;width:250px;}.categoryName{padding-left:8px;}[hidden]{display:none !important;}.uploadSection{max-width:300px;margin:8px;margin-bottom:0;}.useVideoCover{margin-left:16px;margin-top:4px;}.themeOverrideInfo, .structuredQuestionsInfo{color:#555;font-style:italic;font-size:14px;}.exteraTopMargin{margin-top:8px;}.defaultPostImage{margin-top:16px;}#structuredQuestionsJsonErrorInfo, #registrationQuestionsJsonErrorInfo, #dataForVisualizationJsonError{margin-top:0px;margin-bottom:8px;color:#F00;font-weight:bold;}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><yp-edit-dialog name="groupEdit"id="editDialog"title="[[editHeaderText]]"icon="people"action="[[action]]"method="[[method]]"params="[[params]]"save-text="[[saveText]]"toast-text="[[toastText]]"><paper-input id="name"name="name"type="text"label="[[t('name')]]"value="{{group.name}}"maxlength="50"char-counter=""></paper-input><paper-textarea id="objectives"name="objectives"value="{{group.objectives}}"always-float-label="[[group.objectives]]"label="[[t('group.objectives')]]"char-counter=""rows="2"on-value-changed="_objectivesChanged"max-rows="5"maxlength="[[maxObjectivesLength]]"></paper-textarea><div class="horizontal end-justified layout"><emoji-selector id="emojiSelectorDescription"></emoji-selector></div><div class="layout vertical"><div class="subHeaders">[[t('headerMedia')]]</div><div class="layout horizontal wrap"><div class="layout vertical additionalSettings uploadSection"><yp-file-upload id="logoImageUpload"raised="true"multi="false"target="/api/images?itemType=group-logo"method="POST"on-success="_logoImageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('image.logo.upload')]]</span></yp-file-upload></div><div class="layout vertical additionalSettings uploadSection"><yp-file-upload id="headerImageUpload"raised="true"multi="false"target="/api/images?itemType=group-header"method="POST"on-success="_headerImageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('image.header.upload')]]</span></yp-file-upload></div><template is="dom-if"if="[[hasVideoUpload]]"><div class="layout horizontal uploadSection"><yp-file-upload id="videoFileUpload"raised="true"multi="false"video-upload=""method="POST"on-success="_videoUploaded"><iron-icon class="icon"icon="videocam"></iron-icon><span>[[t('uploadVideo')]]</span></yp-file-upload><paper-checkbox class="useVideoCover"name="useVideoCover"disabled$="[[!uploadedVideoId]]"checked$="{{group.configuration.useVideoCover}}">[[t('useVideoCover')]]</paper-checkbox></div></template><input type="hidden"name="uploadedLogoImageId"value="[[uploadedLogoImageId]]"> <input type="hidden"name="uploadedHeaderImageId"value="[[uploadedHeaderImageId]]"></div><div class="subHeaders exteraTopMargin">[[t('access')]]</div><paper-radio-group id="access"name="access"class="access"selected="{{groupAccess}}"><paper-radio-button name="open_to_community">[[t('group.openToCommunity')]]</paper-radio-button><paper-radio-button name="public">[[t('group.public')]]</paper-radio-button><paper-radio-button name="closed">[[t('group.closed')]]</paper-radio-button><paper-radio-button name="secret">[[t('group.secret')]]</paper-radio-button></paper-radio-group><paper-dropdown-menu label="[[t('status.select')]]"><paper-listbox slot="dropdown-content"attr-for-selected="name"selected="{{status}}"><template is="dom-repeat"items="[[collectionStatusOptions]]"as="statusOption"><paper-item name="[[statusOption.name]]">[[statusOption.translatedName]]</paper-item></template></paper-listbox></paper-dropdown-menu><paper-checkbox name="allowAnonymousUsers"checked$="{{group.configuration.allowAnonymousUsers}}">[[t('allowAnonymousUsers')]]</paper-checkbox><paper-checkbox name="allowAnonymousAutoLogin"disabled$="[[!group.configuration.allowAnonymousUsers]]"checked$="{{group.configuration.allowAnonymousAutoLogin}}">[[t('allowAnonymousAutoLogin')]]</paper-checkbox><paper-checkbox name="allowOneTimeLoginWithName"checked$="{{group.configuration.allowOneTimeLoginWithName}}">[[t('allowOneTimeLoginWithName')]]</paper-checkbox><paper-checkbox name="disableFacebookLoginForGroup"checked$="{{group.configuration.disableFacebookLoginForGroup}}">[[t('disableFacebookLoginForGroup')]]</paper-checkbox><paper-checkbox name="forceSecureSamlLogin"disabled$="[[!hasSamlLoginProvider]]"checked$="{{group.configuration.forceSecureSamlLogin}}">[[t('forceSecureSamlLogin')]]</paper-checkbox><paper-checkbox name="forceSecureSamlEmployeeLogin"disabled$="[[!hasSamlLoginProvider]]"checked$="{{group.configuration.forceSecureSamlEmployeeLogin}}">[[t('forceSecureSamlEmployeeLogin')]]</paper-checkbox><input type="hidden"name="status"value="[[status]]"><div class="subHeaders">[[t('languageSettings')]]</div><yp-language-selector name="defaultLocale"no-user-events=""selected-locale="{{group.configuration.defaultLocale}}"></yp-language-selector><paper-checkbox name="disableNameAutoTranslation"checked$="{{group.configuration.disableNameAutoTranslation}}">[[t('disableNameAutoTranslation')]]</paper-checkbox><div class="subHeaders">[[t('themeSettings')]]</div><yp-theme-selector object="[[group]]"selected-theme="{{themeId}}"></yp-theme-selector><paper-input id="themeOverrideColorPrimary"name="themeOverrideColorPrimary"allowed-pattern="[#-#0-9A-Fa-f]"maxlength="7"char-counter=""label="[[t('themeOverrideColorPrimary')]]"value="{{group.configuration.themeOverrideColorPrimary}}"><div prefix="">#</div></paper-input><paper-input id="themeOverrideColorAccent"name="themeOverrideColorAccent"allowed-pattern="[#-#0-9A-Fa-f]"maxlength="7"char-counter=""label="[[t('themeOverrideColorAccent')]]"value="{{group.configuration.themeOverrideColorAccent}}"></paper-input><paper-input id="themeOverrideBackgroundColor"name="themeOverrideBackgroundColor"allowed-pattern="[#-#0-9A-Fa-f]"maxlength="7"char-counter=""label="[[t('themeOverrideBackgroundColor')]]"value="{{group.configuration.themeOverrideBackgroundColor}}"></paper-input><div class="themeOverrideInfo"><em>[[t('themeOverrideColorInfo')]]</em></div><div class="subHeaders">[[t('postSettings')]]</div><paper-checkbox name="canAddNewPosts"checked$="{{canAddNewPosts}}">[[t('group.canAddNewPosts')]]</paper-checkbox><paper-checkbox name="locationHidden"checked$="{{locationHidden}}">[[t('group.locationHidden')]]</paper-checkbox><paper-checkbox name="showWhoPostedPosts"checked$="{{showWhoPostedPosts}}">[[t('group.showWhoPostedPosts')]]</paper-checkbox><paper-checkbox name="disableDebate"checked$="{{group.configuration.disableDebate}}">[[t('disableDebate')]]</paper-checkbox><paper-checkbox name="allowAdminsToDebate"checked$="{{group.configuration.allowAdminsToDebate}}">[[t('allowAdminsToDebate')]]</paper-checkbox><paper-input id="postDescriptionLimit"name="postDescriptionLimit"type="text"allowed-pattern="[0-9]"label="[[t('postDescriptionLimit')]]"value="{{group.configuration.postDescriptionLimit}}"maxlength="4"char-counter=""></paper-input><paper-checkbox name="allowPostVideoUploads"disabled$="[[!hasVideoUpload]]"checked$="{{allowPostVideoUploads}}">[[t('allowPostVideoUploads')]]</paper-checkbox><paper-input id="videoPostUploadLimitSec"name="videoPostUploadLimitSec"allowed-pattern="[0-9]"maxlength="3"type="number"disabled$="[[!hasVideoUpload]]"label="[[t('videoPostUploadLimitSec')]]"value="{{group.configuration.videoPostUploadLimitSec}}"></paper-input><paper-checkbox name="allowPostAudioUploads"disabled$="[[!hasAudioUpload]]"checked$="{{allowPostAudioUploads}}">[[t('allowPostAudioUploads')]]</paper-checkbox><paper-input id="audioPostUploadLimitSec"name="audioPostUploadLimitSec"allowed-pattern="[0-9]"maxlength="3"type="number"disabled$="[[!hasaudioUpload]]"label="[[t('audioPostUploadLimitSec')]]"value="{{group.configuration.audioPostUploadLimitSec}}"></paper-input><paper-input id="customTitleQuestionText"name="customTitleQuestionText"maxlength="60"label="[[t('customTitleQuestionText')]]"value="{{group.configuration.customTitleQuestionText}}"></paper-input><paper-input id="hideNameInputAndReplaceWith"name="hideNameInputAndReplaceWith"maxlength="60"label="[[t('hideNameInputAndReplaceWith')]]"value="{{group.configuration.hideNameInputAndReplaceWith}}"></paper-input><paper-checkbox name="makeCategoryRequiredOnNewPost"checked$="{{group.configuration.makeCategoryRequiredOnNewPost}}">[[t('makeCategoryRequiredOnNewPost')]]</paper-checkbox><paper-checkbox name="showVideoUploadDisclaimer"checked$="{{group.configuration.showVideoUploadDisclaimer}}">[[t('showVideoUploadDisclaimer')]]</paper-checkbox><paper-checkbox name="moreContactInformation"checked$="{{group.configuration.moreContactInformation}}">[[t('moreContactInformation')]]</paper-checkbox><paper-checkbox name="moreContactInformationAddress"checked$="{{group.configuration.moreContactInformationAddress}}">[[t('moreContactInformationAddress')]]</paper-checkbox><paper-checkbox name="attachmentsEnabled"checked$="{{group.configuration.attachmentsEnabled}}">[[t('attachmentsEnabled')]]</paper-checkbox><paper-checkbox name="useContainImageMode"checked$="{{group.configuration.useContainImageMode}}">[[t('useContainImageMode')]]</paper-checkbox><paper-checkbox name="hideNewPost"checked$="{{group.configuration.hideNewPost}}">[[t('hideNewPost')]]</paper-checkbox><paper-checkbox name="hideRecommendationOnNewsFeed"checked$="{{group.configuration.hideRecommendationOnNewsFeed}}">[[t('hideRecommendationOnNewsFeed')]]</paper-checkbox><paper-checkbox name="hideNewPostOnPostPage"checked$="{{hideNewPostOnPostPage}}">[[t('hideNewPostOnPostPage')]]</paper-checkbox><paper-checkbox name="hidePostCover"checked$="{{group.configuration.hidePostCover}}">[[t('hidePostCover')]]</paper-checkbox><paper-checkbox name="hidePostDescription"checked$="{{group.configuration.hidePostDescription}}">[[t('hidePostDescription')]]</paper-checkbox><paper-checkbox name="hidePostActionsInGrid"checked$="{{group.configuration.hidePostActionsInGrid}}">[[t('hidePostActionsInGrid')]]</paper-checkbox><paper-checkbox name="hideDebateIcon"checked$="{{group.configuration.hideDebateIcon}}">[[t('hideDebateIcon')]]</paper-checkbox><paper-checkbox name="hideSharing"checked$="{{group.configuration.hideSharing}}">[[t('hideSharing')]]</paper-checkbox><paper-checkbox name="hideEmoji"checked$="{{hideEmoji}}">[[t('hideEmoji')]]</paper-checkbox><paper-checkbox name="hidePostFilterAndSearch"checked$="{{group.configuration.hidePostFilterAndSearch}}">[[t('hidePostFilterAndSearch')]]</paper-checkbox><paper-checkbox name="hideMediaInput"checked$="{{group.configuration.hideMediaInput}}">[[t('hideMediaInput')]]</paper-checkbox><paper-checkbox name="hidePostImageUploads"disabled$="[[!hasVideoUpload]]"checked$="{{group.configuration.hidePostImageUploads}}">[[t('hidePostImageUploads')]]</paper-checkbox><paper-checkbox name="disablePostPageLink"checked$="{{group.configuration.disablePostPageLink}}">[[t('disablePostPageLink')]]</paper-checkbox><paper-input id="defaultLocationLongLat"name="defaultLocationLongLat"type="text"label="[[t('defaultLocationLongLat')]]"value="{{group.configuration.defaultLocationLongLat}}"maxlength="100"style="width: 300px;"></paper-input><paper-input id="forcePostSortMethodAs"name="forcePostSortMethodAs"type="text"label="[[t('forcePostSortMethodAs')]]"value="{{group.configuration.forcePostSortMethodAs}}"maxlength="12"></paper-input><paper-input id="customThankYouTextNewPosts"name="customThankYouTextNewPosts"type="text"char-counter=""label="[[t('customThankYouTextNewPosts')]]"value="{{group.configuration.customThankYouTextNewPosts}}"maxlength="120"></paper-input><paper-input id="descriptionTruncateAmount"name="descriptionTruncateAmount"type="text"allowed-pattern="[0-9]"label="[[t('descriptionTruncateAmount')]]"value="{{group.configuration.descriptionTruncateAmount}}"maxlength="4"></paper-input><paper-checkbox name="descriptionSimpleFormat"checked$="{{group.configuration.descriptionSimpleFormat}}">[[t('descriptionSimpleFormat')]]</paper-checkbox><paper-checkbox name="transcriptSimpleFormat"checked$="{{group.configuration.transcriptSimpleFormat}}">[[t('transcriptSimpleFormat')]]</paper-checkbox><paper-checkbox name="allPostsBlockedByDefault"checked$="{{group.configuration.allPostsBlockedByDefault}}">[[t('allPostsBlockedByDefault')]]</paper-checkbox><paper-checkbox name="exportSubCodesForRadiosAndCheckboxes"checked$="{{group.configuration.exportSubCodesForRadiosAndCheckboxes}}">[[t('exportSubCodesForRadiosAndCheckboxes')]]</paper-checkbox><paper-textarea id="structuredQuestions"name="structuredQuestions"type="text"rows="4"always-float-label="[[group.configuration.structuredQuestions]]"maxrows="8"on-value-changed="_structuredQuestionsChanged"max-rows="8"label="[[t('structuredQuestions')]]"value="{{group.configuration.structuredQuestions}}"></paper-textarea><div id="structuredQuestionsJsonErrorInfo"hidden$="[[!structuredQuestionsJsonError]]">[[t('structuredQuestionsJsonFormatNotValid')]]</div><div class="structuredQuestionsInfo">[[t('structuredQuestionsInfo')]]</div><div class="layout vertical additionalSettings uploadSection"><yp-file-upload id="docxSurveyUpload"raised="true"multi="false"target="/api/groups/-1/convert_docx_survey_to_json"accept="application/vnd.openxmlformats-officedocument.wordprocessingml.document"method="PUT"on-success="_haveUploadedDocxSurvey"><iron-icon class="icon"icon="sort"></iron-icon><span>[[t('uploadDocxSurveyFormat')]]</span></yp-file-upload></div><paper-input id="alternativeTextForNewIdeaButton"name="alternativeTextForNewIdeaButton"type="text"label="[[t('alternativeTextForNewIdeaButton')]]"value="{{group.configuration.alternativeTextForNewIdeaButton}}"maxlength="30"char-counter=""></paper-input><paper-input id="alternativeTextForNewIdeaButtonClosed"name="alternativeTextForNewIdeaButtonClosed"type="text"label="[[t('alternativeTextForNewIdeaButtonClosed')]]"value="{{group.configuration.alternativeTextForNewIdeaButtonClosed}}"maxlength="30"char-counter=""></paper-input><paper-input id="alternativeTextForNewIdeaButtonHeader"name="alternativeTextForNewIdeaButtonHeader"type="text"label="[[t('alternativeTextForNewIdeaButtonHeader')]]"value="{{group.configuration.alternativeTextForNewIdeaButtonHeader}}"maxlength="30"char-counter=""></paper-input><div class="layout vertical additionalSettings defaultPostImage"><yp-file-upload id="defaultPostImageUpload"raised="true"multi="false"target="/api/images?itemType=group-logo"method="POST"on-success="_defaultPostImageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('defaultPostImage')]]</span></yp-file-upload></div><div class="layout horizontal"><div class="layout vertical additionalSettings"><yp-file-upload id="defaultDataImageUpload"raised="true"multi="false"target="/api/images?itemType=group-logo"method="POST"on-success="_defaultDataImageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('defaultDataImage')]]</span></yp-file-upload></div><input type="hidden"name="uploadedDefaultDataImageId"value="[[uploadedDefaultDataImageId]]"></div><input type="hidden"name="canVote"value$="[[canVote]]"> <input type="hidden"name="canAddNewPosts"value$="[[canAddNewPosts]]"> <input type="hidden"name="locationHidden"value$="[[locationHidden]]"> <input type="hidden"name="showWhoPostedPosts"value$="[[showWhoPostedPosts]]"> <input type="hidden"name="themeId"value="[[themeId]]"> <input type="hidden"name="uploadedDefaultPostImageId"value="[[uploadedDefaultPostImageId]]"><div class="subHeaders exteraTopMargin">[[t('voteSettings')]]</div><div class="layout horizontal"><paper-dropdown-menu label="[[t('endorsementButtons')]]"disabled$="[[endorsementButtonsDisabled]]"><paper-listbox slot="dropdown-content"attr-for-selected="name"selected="{{endorsementButtons}}"><template is="dom-repeat"items="[[endorsementButtonsOptions]]"as="buttonsSelection"><paper-item name="[[buttonsSelection.name]]">[[buttonsSelection.translatedName]]</paper-item></template></paper-listbox></paper-dropdown-menu><input type="hidden"name="endorsementButtons"value="[[endorsementButtons]]"></div><paper-checkbox name="canVote"checked$="{{canVote}}">[[t('group.canVote')]]</paper-checkbox><paper-checkbox name="hideVoteCount"checked$="{{group.configuration.hideVoteCount}}">[[t('hideVoteCount')]]</paper-checkbox><paper-checkbox name="hideVoteCountUntilVoteCompleted"checked$="{{group.configuration.hideVoteCountUntilVoteCompleted}}">[[t('hideVoteCountUntilVoteCompleted')]]</paper-checkbox><paper-checkbox name="hideDownVoteForPost"checked$="{{group.configuration.hideDownVoteForPost}}">[[t('hideDownVoteForPost')]]</paper-checkbox><paper-input id="maxNumberOfGroupVotes"name="maxNumberOfGroupVotes"type="text"allowed-pattern="[0-9]"label="[[t('maxNumberOfGroupVotes')]]"value="{{group.configuration.maxNumberOfGroupVotes}}"maxlength="4"></paper-input><paper-input id="customVoteUpHoverText"name="customVoteUpHoverText"type="text"label="[[t('customVoteUpHoverText')]]"value="{{group.configuration.customVoteUpHoverText}}"maxlength="100"char-counter=""></paper-input><paper-input id="customVoteDownHoverText"name="customVoteDownHoverText"type="text"label="[[t('customVoteDownHoverText')]]"value="{{group.configuration.customVoteDownHoverText}}"maxlength="100"char-counter=""></paper-input><paper-textarea id="customRatingsText"name="customRatingsText"type="text"rows="2"on-value-changed="_customRatingsTextChanged"always-float-label="[[group.configuration.customRatingsText]]"maxrows="2"label="[[t('customRatings')]]"value="{{group.configuration.customRatingsText}}"></paper-textarea><div class="structuredQuestionsInfo">[[t('customRatingsInfo')]]</div><div class="subHeaders">[[t('pointSettings')]]</div><paper-checkbox name="newPointOptional"checked$="{{newPointOptional}}">[[t('newPointOptional')]]</paper-checkbox><paper-checkbox name="hideNewPointOnNewIdea"checked$="{{group.configuration.hideNewPointOnNewIdea}}">[[t('hideNewPointOnNewIdea')]]</paper-checkbox><paper-checkbox name="hidePointAuthor"checked$="{{group.configuration.hidePointAuthor}}">[[t('hidePointAuthor')]]</paper-checkbox><paper-checkbox name="hidePointAgainst"checked$="{{group.configuration.hidePointAgainst}}">[[t('hidePointAgainst')]]</paper-checkbox><paper-input id="pointCharLimit"name="pointCharLimit"type="text"allowed-pattern="[0-9]"label="[[t('pointCharLimit')]]"value="{{group.configuration.pointCharLimit}}"maxlength="4"></paper-input><paper-input id="alternativePointForHeader"name="alternativePointForHeader"type="text"label="[[t('alternativePointForHeader')]]"value="{{group.configuration.alternativePointForHeader}}"maxlength="100"char-counter=""></paper-input><paper-input id="alternativePointAgainstHeader"name="alternativePointAgainstHeader"type="text"label="[[t('alternativePointAgainstHeader')]]"value="{{group.configuration.alternativePointAgainstHeader}}"maxlength="100"char-counter=""></paper-input><paper-input id="alternativePointForLabel"name="alternativePointForLabel"type="text"label="[[t('alternativePointForLabel')]]"value="{{group.configuration.alternativePointForLabel}}"maxlength="100"char-counter=""></paper-input><paper-input id="alternativePointAgainstLabel"name="alternativePointAgainstLabel"type="text"label="[[t('alternativePointAgainstLabel')]]"value="{{group.configuration.alternativePointAgainstLabel}}"maxlength="100"char-counter=""></paper-input><paper-checkbox name="allowPointVideoUploads"disabled$="[[!hasVideoUpload]]"checked$="{{allowPointVideoUploads}}">[[t('allowPointVideoUploads')]]</paper-checkbox><paper-input id="videoPointUploadLimitSec"name="videoPointUploadLimitSec"type="text"maxlength="3"allowed-pattern="[0-9]"disabled$="[[!hasVideoUpload]]"label="[[t('videoPointUploadLimitSec')]]"value="{{group.configuration.videoPointUploadLimitSec}}"></paper-input><paper-checkbox name="allowPointAudioUploads"disabled$="[[!hasAudioUpload]]"checked$="{{allowPointAudioUploads}}">[[t('allowPointAudioUploads')]]</paper-checkbox><paper-input id="audioPointUploadLimitSec"name="audioPointUploadLimitSec"type="text"maxlength="3"allowed-pattern="[0-9]"disabled$="[[!hasaudioUpload]]"label="[[t('audioPointUploadLimitSec')]]"value="{{group.configuration.audioPointUploadLimitSec}}"></paper-input><paper-checkbox name="disableMachineTranscripts"checked$="{{group.configuration.disableMachineTranscripts}}">[[t('disableMachineTranscripts')]]</paper-checkbox><paper-checkbox name="allowAdminAnswersToPoints"checked$="{{group.configuration.allowAdminAnswersToPoints}}">[[t('allowAdminAnswersToPoints')]]</paper-checkbox><paper-input id="customAdminCommentsTitle"name="customAdminCommentsTitle"type="text"label="[[t('customAdminCommentsTitle')]]"value="{{group.configuration.customAdminCommentsTitle}}"maxlength="50"char-counter=""></paper-input><div class="subHeaders">[[t('additionalGroupConfig')]]</div><paper-checkbox name="hideAllTabs"checked$="{{hideAllTabs}}">[[t('hideAllTabs')]]</paper-checkbox><paper-checkbox name="hideGroupLevelTabs"checked$="{{group.configuration.hideGroupLevelTabs}}">[[t('hideGroupLevelTabs')]]</paper-checkbox><paper-checkbox name="hideHelpIcon"checked$="{{hideHelpIcon}}">[[t('hideHelpIcon')]]</paper-checkbox><paper-checkbox name="useCommunityTopBanner"checked$="{{group.configuration.useCommunityTopBanner}}">[[t('useCommunityTopBanner')]]</paper-checkbox><paper-checkbox name="makeMapViewDefault"checked$="{{group.configuration.makeMapViewDefault}}">[[t('makeMapViewDefault')]]</paper-checkbox><paper-checkbox name="simpleFormatDescription"checked$="{{group.configuration.simpleFormatDescription}}">[[t('simpleFormatDescription')]]</paper-checkbox><paper-checkbox name="resourceLibraryLinkMode"checked$="{{group.configuration.resourceLibraryLinkMode}}">[[t('resourceLibraryLinkMode')]]</paper-checkbox><paper-checkbox name="collapsableTranscripts"checked$="{{group.configuration.collapsableTranscripts}}">[[t('collapsableTranscripts')]]</paper-checkbox><paper-checkbox name="allowWhatsAppSharing"checked$="{{group.configuration.allowWhatsAppSharing}}">[[t('allowWhatsAppSharing')]]</paper-checkbox><paper-input id="actAsLinkToCommunityId"name="actAsLinkToCommunityId"type="number"allowed-pattern="[0-9]"label="[[t('actAsLinkToCommunityId')]]"value="{{group.configuration.actAsLinkToCommunityId}}"maxlength="8"></paper-input><paper-input id="maxDaysBackForRecommendations"name="maxDaysBackForRecommendations"type="text"maxlength="5"allowed-pattern="[0-9]"label="[[t('maxDaysBackForRecommendations')]]"value="{{group.configuration.maxDaysBackForRecommendations}}"></paper-input><paper-input id="customUserNamePrompt"name="customUserNamePrompt"type="text"label="[[t('customUserNamePrompt')]]"value="{{group.configuration.customUserNamePrompt}}"maxlength="45"char-counter=""></paper-input><paper-input id="customTermsIntroText"name="customTermsIntroText"type="text"label="[[t('customTermsIntroText')]]"value="{{group.configuration.customTermsIntroText}}"maxlength="100"char-counter=""></paper-input><paper-input id="externalGoalTriggerUrl"name="externalGoalTriggerUrl"type="text"label="[[t('externalGoalTriggerUrl')]]"value="{{group.configuration.externalGoalTriggerUrl}}"></paper-input><paper-input id="externalId"name="externalId"type="text"label="[[t('externalId')]]"value="{{group.configuration.externalId}}"></paper-input><paper-input id="customBackURL"name="customBackURL"type="text"maxlength="256"label="[[t('customBackURL')]]"value="{{group.configuration.customBackURL}}"></paper-input><paper-input id="customBackName"name="customBackName"type="text"maxlength="20"label="[[t('customBackName')]]"value="{{group.configuration.customBackName}}"></paper-input><paper-input id="optionalSortOrder"name="optionalSortOrder"type="number"allowed-pattern="[0-9]"label="[[t('optionalSortOrder')]]"value="{{group.configuration.optionalSortOrder}}"maxlength="4"></paper-input><paper-checkbox name="usePostListFormatOnDesktop"checked$="{{group.configuration.usePostListFormatOnDesktop}}">[[t('usePostListFormatOnDesktop')]]</paper-checkbox><paper-checkbox name="usePostTags"checked$="{{group.configuration.usePostTags}}">[[t('usePostTags')]]</paper-checkbox><paper-checkbox name="usePostTagsForPostListItems"checked$="{{group.configuration.usePostTagsForPostListItems}}">[[t('usePostTagsForPostListItems')]]</paper-checkbox><paper-checkbox name="usePostTagsForPostCards"checked$="{{group.configuration.usePostTagsForPostCards}}">[[t('usePostTagsForPostCards')]]</paper-checkbox><paper-checkbox name="forceShowDebateCountOnPost"checked$="{{group.configuration.forceShowDebateCountOnPost}}">[[t('forceShowDebateCountOnPost')]]</paper-checkbox><div class="layout horizontal config"hidden$="[[!pages]]"><paper-dropdown-menu label="[[t('welcomeSelectPage')]]"><paper-listbox slot="dropdown-content"attr-for-selected="name"selected="{{group.configuration.welcomePageId}}"><template is="dom-repeat"items="[[translatedPages]]"as="page"><paper-item name="[[page.id]]"data-args$="[[index]]">[[_getLocalizePageTitle(page)]]</paper-item></template></paper-listbox></paper-dropdown-menu><input type="hidden"name="welcomePageId"value="[[group.configuration.welcomePageId]]"></div><paper-textarea id="registrationQuestions"name="registrationQuestions"type="text"rows="4"always-float-label="[[group.configuration.registrationQuestions]]"maxrows="8"on-value-changed="_registrationQuestionsChanged"max-rows="8"label="[[t('registrationQuestions')]]"value="{{group.configuration.registrationQuestions}}"></paper-textarea><div id="registrationQuestionsJsonErrorInfo"hidden$="[[!registrationQuestionsJsonError]]">[[t('structuredQuestionsJsonFormatNotValid')]]</div><paper-checkbox id="isDataVisualizationGroup"name="isDataVisualizationGroup"on-tap="_isDataVisualizationGroupClick"checked$="{{group.configuration.isDataVisualizationGroup}}">[[t('isDataVisualizationGroup')]]</paper-checkbox><paper-textarea id="dataForVisualization"name="dataForVisualization"type="text"hidden$="[[!isDataVisualizationGroup]]"rows="4"always-float-label="[[group.configuration.dataForVisualization]]"maxrows="8"on-value-changed="_dataForVisualizationChanged"max-rows="8"label="[[t('dataForVisualization')]]"value="{{group.configuration.dataForVisualization}}"></paper-textarea><div id="dataForVisualizationJsonError"hidden$="[[!dataForVisualizationJsonError]]">[[t('structuredQuestionsJsonFormatNotValid')]]</div><input type="hidden"name="hideAllTabs"value$="[[hideAllTabs]]"> <input type="hidden"name="hideNewPostOnPostPage"value$="[[hideNewPostOnPostPage]]"> <input type="hidden"name="newPointOptional"value$="[[newPointOptional]]"> <input type="hidden"name="hideHelpIcon"value$="[[hideHelpIcon]]"> <input type="hidden"name="hideEmoji"value$="[[hideEmoji]]"> <input type="hidden"name="hideGroupHeader"value$="[[hideGroupHeader]]"> <input type="hidden"name="allowPostVideoUploads"value$="[[allowPostVideoUploads]]"> <input type="hidden"name="allowPointVideoUploads"value$="[[allowPointVideoUploads]]"> <input type="hidden"name="allowPostAudioUploads"value$="[[allowPostAudioUploads]]"> <input type="hidden"name="allowPointAudioUploads"value$="[[allowPointAudioUploads]]"><div class="layout vertical config"hidden$="[[!group.Categories]]"><div class="subHeaders">[[t('categories.the_all')]]</div><template is="dom-repeat"items="[[group.Categories]]"as="category"><paper-item data-category$="[[category]]"data-category-name$="[[category.name]]"on-tap="_openCategoryEdit"><img sizing="cover"height="24"width="24"class="filterIcon"src="[[_categoryImageSrc(category)]]"> <span class="categoryName">[[category.name]] - [[category.id]]</span></paper-item></template></div></div><yp-ajax id="pagesAjax"on-response="_pagesResponse"></yp-ajax></yp-edit-dialog></template></dom-module><script>Polymer({is:"yp-group-edit",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypEditDialogBehavior,Polymer.ypCollectionStatusOptions,Polymer.ypGotoBehavior,Polymer.ypMediaFormatsBehavior,Polymer.ypTranslatedPagesBehavior],properties:{canVote:{type:Boolean,value:!0},canAddNewPosts:{type:Boolean,value:!0},showWhoPostedPosts:{type:Boolean,value:!1},hideAllTabs:Boolean,hideNewPostOnPostPage:Boolean,newPointOptional:Boolean,hideHelpIcon:Boolean,hideEmoji:Boolean,hideGroupHeader:Boolean,action:{type:String,value:"/api/groups"},group:{type:Object,observer:"_groupChanged"},community:{type:Object},groupAccess:{type:String,value:"public"},uploadedLogoImageId:{type:String},uploadedHeaderImageId:{type:String},uploadedDefaultDataImageId:{type:String},uploadedDefaultPostImageId:{type:String},allowPostVideoUploads:{type:Boolean,value:null},allowPointVideoUploads:{type:Boolean,value:null},allowPostAudioUploads:{type:Boolean,value:null},allowPointAudioUploads:{type:Boolean,value:null},endorsementButtonsDisabled:{type:Boolean,value:!1},status:String,publicCommunity:{type:Boolean,value:!1},themeId:{type:String,value:null},locationHidden:Boolean,endorsementButtonsOptions:{type:Object,computed:"_endorsementButtonsOptions(language)"},endorsementButtons:String,hasSamlLoginProvider:{type:Boolean,value:!1},hasVideoUpload:{type:Boolean,value:!1},hasAudioUpload:{type:Boolean,value:!1},uploadedVideoId:{type:Number,value:null},structuredQuestionsJsonError:{type:Boolean,value:!1},registrationQuestionsJsonError:{type:Boolean,value:!1},dataForVisualizationJsonError:{type:Boolean,value:!1},maxObjectivesLength:{type:Number,value:300},isDataVisualizationGroup:{type:Boolean,value:!1}},_isDataVisualizationGroupClick:function(){this.set("isDataVisualizationGroup",this.$$("#isDataVisualizationGroup").checked)},_objectivesChanged:function(t){var o=t.target.value,e=new RegExp(/(?:https?|http?):\/\/[\n\S]+/g),s=o.match(e);if(s&&0<s.length){for(var i=0,a=0;a<Math.min(s.length,10);a++)i+=s[a].length;var n=300;n+=i,n-=Math.min(i,30*s.length),this.set("maxObjectivesLength",n)}},_structuredQuestionsChanged:function(t,o){if(o&&o.value){var e=o.value.trim();if(e.startsWith("[")||e.startsWith("{")){var s=!1;try{JSON.parse(e)}catch(t){s=!0}this.set("structuredQuestionsJsonError",s)}else this.set("structuredQuestionsJsonError",!1)}else this.set("structuredQuestionsJsonError",!1)},_registrationQuestionsChanged:function(t,o){if(o&&o.value){var e=o.value.trim(),s=!1;try{JSON.parse(e)}catch(t){s=!0}this.set("registrationQuestionsJsonError",s)}else this.set("registrationQuestionsJsonError",!1)},_dataForVisualizationChanged:function(t,o){if(o&&o.value){var e=o.value.trim();try{JSON.parse(e)}catch(t){!0}}else this.set("dataForVisualizationJsonError",!1)},_customRatingsTextChanged:function(t,o){o.value&&""!==o.value?this.set("endorsementButtonsDisabled",!0):this.set("endorsementButtonsDisabled",!1)},_videoUploaded:function(t,o){this.set("uploadedVideoId",o.videoId),this.set("group.configuration.useVideoCover",!0)},observers:["_setupTranslation(language,t)"],_openCategoryEdit:function(o){window.appGlobals.activity("open","category.new"),Polymer.dom(document).querySelector("yp-app").getDialogAsync("categoryEdit",function(t){t.setup(this.group,!1,this._refreshCategories.bind(this),o.model.category),t.open("edit",{categoryId:o.model.category.id})}.bind(this))},_refreshCategories:function(o){var e=[];__.each(this.group.Categories,function(t){t.id===o.id?e.push(o):e.push(t)}),this.set("group.Categories",e)},_categoryImageSrc:function(t){return this.getImageFormatUrl(t.CategoryIconImages,0)},_endorsementButtonsOptions:function(){return this.t?[{name:"hearts",translatedName:this.t("endorsementButtonsHeart")},{name:"arrows",translatedName:this.t("endorsementArrows")},{name:"thumbs",translatedName:this.t("endorsementThumbs")},{name:"hats",translatedName:this.t("endorsementHats")}]:[]},_updateEmojiBindings:function(){this.async(function(){var t=this.$$("#objectives"),o=this.$$("#emojiSelectorDescription");t&&o?o.inputTarget=t:console.warn("Group edit: Can't bind emojis :(")}.bind(this),500)},_publicCommunity:function(t){return!!t&&0===t.Community.access},_customRedirect:function(o){if(o)if(window.appUser.recheckAdminRights(),this.uploadedVideoId){var t=document.createElement("iron-ajax");t.handleAs="json",t.contentType="application/json",t.url="/api/videos/"+o.id+"/completeAndAddToGroup",t.method="PUT",t.body={videoId:this.uploadedVideoId},t.addEventListener("response",function(t){this._finishRedirect(o)}.bind(this)),t.generateRequest()}else this._finishRedirect(o);else console.warn("No group found on custom redirect")},_finishRedirect:function(t){t&&t.configuration.isDataVisualizationGroup?this.redirectTo("/group_data_viz/"+t.id):this.redirectTo("/group/"+t.id),window.appGlobals.activity("completed","editGroup")},_groupChanged:function(t){t&&(0==t.access?this.groupAccess="public":1==t.access?this.groupAccess="closed":2==t.access?this.groupAccess="secret":3==t.access&&(this.groupAccess="open_to_community"),t&&t.status&&this.set("status",t.status),t.configuration&&null!=t.configuration.canVote?(this.set("canVote",t.configuration.canVote),this.set("canAddNewPosts",t.configuration.canAddNewPosts)):(this.set("canVote",!0),this.set("canAddNewPosts",!0)),t.configuration&&null!=t.configuration.endorsementButtons?this.set("endorsementButtons",t.configuration.endorsementButtons):this.set("endorsementButtons","hearts"),this._setFromConfiguration("locationHidden"),this._setFromConfiguration("hideAllTabs"),this._setFromConfiguration("hideNewPostOnPostPage"),this._setFromConfiguration("newPointOptional"),this._setFromConfiguration("hideHelpIcon"),this._setFromConfiguration("hideEmoji"),this._setFromConfiguration("hideGroupHeader"),this._setFromConfiguration("showWhoPostedPosts"),this._setFromConfiguration("allowPostVideoUploads",!0),this._setFromConfiguration("allowPointVideoUploads",!0),this._setFromConfiguration("allowPostAudioUploads",!0),this._setFromConfiguration("allowPointAudioUploads",!0),t.configuration&&t.configuration.isDataVisualizationGroup&&this.set("isDataVisualizationGroup",!0),this.async(function(){this.community?0==this.community.access?this.set("publicCommunity",!0):this.set("publicCommunity",!1):t&&t.Community&&(0==t.Community.access?this.set("publicCommunity",!0):this.set("publicCommunity",!1))}),t&&t.id||!window.appGlobals.hasVideoUpload||(null===this.allowPostVideoUploads&&this.set("allowPostVideoUploads",!0),null===this.allowPointVideoUploads&&this.set("allowPointVideoUploads",!0)),window.appGlobals.hasVideoUpload?this.set("hasVideoUpload",!0):this.set("hasVideoUpload",!1),t&&t.id||!window.appGlobals.hasAudioUpload||(null===this.allowPostAudioUploads&&this.set("allowPostAudioUploads",!0),null===this.allowPointAudioUploads&&this.set("allowPointAudioUploads",!0)),window.appGlobals.hasAudioUpload?this.set("hasAudioUpload",!0):this.set("hasAudioUpload",!1),t.configuration&&t.configuration.structuredQuestions&&this._structuredQuestionsChanged(null,{value:t.configuration.structuredQuestions})),this._updateEmojiBindings(),window.appGlobals.domain&&window.appGlobals.domain.samlLoginProvided?this.set("hasSamlLoginProvider",!0):this.set("hasSamlLoginProvider",!1)},_setFromConfiguration:function(t,o){this.group.configuration&&null!=this.group.configuration[t]&&""!==this.group.configuration[t]?this.set(t,this.group.configuration[t]):this.set(t,!!o&&null)},_clear:function(){this.set("group",null),this.set("uploadedLogoImageId",null),this.set("uploadedHeaderImageId",null),this.set("uploadedDefaultDataImageId",null),this.set("uploadedVideoId",null),this.$$("#videoFileUpload")&&this.$$("#videoFileUpload").clear(),this.$$("#headerImageUpload")&&this.$$("#headerImageUpload").clear(),this.$$("#logoImageUpload")&&this.$$("#logoImageUpload").clear(),this.$$("#defaultDataImageUpload")&&this.$$("#defaultDataImageUpload").clear()},setup:function(t,o,e){if(t){if(t.configuration&&t.configuration.customRatings&&!t.configuration.customRatingsText){var s="";t.configuration.customRatings.forEach(function(t){s+=t.name+","+t.numberOf+","+t.emoji+","}),s=s.substring(0,s.length-1),t.configuration.customRatingsText=s}this.set("group",t),t.GroupLogoVideos&&0<t.GroupLogoVideos.length&&this.set("uploadedVideoId",t.GroupLogoVideos[0].id),this.$.pagesAjax.url="/api/groups/"+t.id+"/pages",this.$.pagesAjax.generateRequest()}else this.set("group",{name:"",objectives:"",access:0,status:"active"});this.set("new",o),this.set("refreshFunction",e),this.group.configuration&&this.group.configuration.customRatingsText&&""!==this.group.configuration.customRatingsText?this.set("endorsementButtonsDisabled",!0):this.set("endorsementButtonsDisabled",!1),this._setupTranslation()},setupAfterOpen:function(t){t.community&&(this.community=t.community);var o=0;this.community?0!=this.community.access&&(this.set("groupAccess","open_to_community"),this.set("group.access",3),o=3):this.group.Community&&0!=this.group.Community.access&&(this.set("groupAccess","open_to_community"),o=3),this.set("group.access",o)},_pagesResponse:function(t,o){var e=o.response;e.unshift({id:-1,title:{en:this.t("none")}}),this._setPages(t,e)},_setupTranslation:function(){this.language&&this.t&&(this.new?(this.editHeaderText=this.t("group.new"),this.toastText=this.t("groupToastCreated"),this.set("saveText",this.t("create"))):(this.set("saveText",this.t("save")),this.editHeaderText=this.t("group.update"),this.toastText=this.t("groupToastUpdated")))},_haveUploadedDocxSurvey:function(t,o){o.xhr.response&&((o=JSON.parse(o.xhr.response)).jsonContent=JSON.stringify(JSON.parse(o.jsonContent)),this.$$("#structuredQuestions").value=o.jsonContent,this.$$("#structuredQuestions").alwaysFloatLabel=!0,this.group&&this.group.configuration&&(this.group.configuration.structuredQuestions=o.jsonContent),this.$.editDialog.scrollResize(),this.fire("iron-resize"))}})</script><dom-module id="yp-magic-text-dialog"assetpath="../yp-magic-text/"><template><style>:host{display:block;}#dialog[rtl]{direction:rtl;}#dialog{background-color:#FFF;max-width:50%;}@media (max-width: 1100px){#dialog{max-width:80%;}}@media (max-width: 600px){#dialog{max-width:100%;}paper-dialog{padding:0;margin:0;}}.buttons{color:var(--accent-color);}</style><paper-dialog id="dialog"rtl$="[[rtl]]"><h2>[[pageTitle]]</h2><paper-dialog-scrollable><div hidden$="[[!finalContent]]"inner-h-t-m-l="[[finalContent]]"></div><div hidden$="[[finalContent]]">[[content]]</div></paper-dialog-scrollable><div class="buttons"><paper-button raised=""dialog-dismiss="">[[closeDialogText]]</paper-button></div></paper-dialog><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><lite-signal on-lite-signal-yp-auto-translate="_autoTranslateEvent"></lite-signal><iron-ajax id="getTranslationAjax"on-response="_getTranslationResponse"></iron-ajax></template><script>var YpMagicTextBoxDialog=function(e){function t(){return babelHelpers.classCallCheck(this,t),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(t).apply(this,arguments))}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"subClassProcessing",value:function(){this.processedContent=this.processedContent.replace(/\n/g,"<br />")}},{key:"open",value:function(e,t,i,s,n,o,a,l,r){l&&(this.skipSanitize=!0),this.contentId=t,this.extraId=i,this.textType=s,this.contentLanguage=n,this.disableTranslation=r,this.structuredQuestionsConfig=a,this.set("isDialog",!0),this.set("content",e),this.set("closeDialogText",o),this.$.dialog.open(),setTimeout(function(){this.$.dialog.fire("iron-resize")}.bind(this),50)}}],[{key:"is",get:function(){return"yp-magic-text-dialog"}}]),t}(YpMagicTextBox);customElements.define(YpMagicTextBoxDialog.is,YpMagicTextBoxDialog)</script></dom-module><dom-module id="yp-post-user-image-edit"assetpath="../yp-post/"><template><style include="iron-flex iron-flex-alignment"></style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><yp-edit-dialog double-width=""id="editDialog"icon="photo-camera"action="[[action]]"title="[[editHeaderText]]"method="[[method]]"save-text="[[saveText]]"next-action-text="[[t('next')]]"toast-text="[[toastText]]"params="[[params]]"><div class="layout vertical center-center"><yp-file-upload id="imageFileUpload"raised="true"multi="false"method="POST"on-success="_imageUploaded"><iron-icon class="icon"icon="photo-camera"></iron-icon><span>[[t('image.upload')]]</span></yp-file-upload></div><paper-input id="photographerName"name="photographerName"type="text"label="[[t('post.photographerName')]]"value="{{image.photographer_name}}"maxlength="60"char-counter=""></paper-input><paper-textarea id="description"required=""minlength="1"name="description"value="{{image.description}}"always-float-label="[[image.description]]"label="[[t('post.description')]]"char-counter=""rows="2"max-rows="5"maxlength="200"></paper-textarea><input type="hidden"name="uploadedPostUserImageId"value="[[uploadedPostUserImageId]]"> <input type="hidden"name="oldUploadedPostUserImageId"value="[[oldUploadedPostUserImageId]]"></yp-edit-dialog></template><script>Polymer({is:"yp-post-user-image-edit",behaviors:[Polymer.ypLanguageBehavior,Polymer.ypEditDialogBehavior],properties:{new:{type:Boolean,value:!1},image:{type:Object,observer:"_imageChanged"},post:{type:Object,observer:"_postChange"},action:{type:String,value:"/api/images"},imageUploadTarget:{type:String,notify:!0},uploadedPostUserImageId:{type:String},oldUploadedPostUserImageId:{type:String},editHeaderText:{type:String},saveText:{type:String},method:{type:String}},_postChange:function(t){t&&(this.$.imageFileUpload.target="/api/images?itemType=post-user-image&postId="+t.id)},listeners:{"iron-form-invalid":"_formInvalid"},_imageChanged:function(t){t&&this.set("oldUploadedPostUserImageId",t.id)},_formInvalid:function(){this.set("selected",0),this.$$("#photographerName").autoValidate=!0,this.$$("#description").autoValidate=!0},_imageUploaded:function(t,e){var i=JSON.parse(e.xhr.response);this.set("uploadedPostUserImageId",i.id)},_clear:function(){this.set("uploadedPostUserImageId",null),this.$$("#imageFileUpload").clear()},setup:function(t,e,i,s){e?this.set("image",e):this.set("image",{description:"",photographerName:""}),t?this.set("post",t):this.set("post",null),this.set("new",i),this.set("refreshFunction",s),this._setupTranslation()},_setupTranslation:function(){this.new?(this.editHeaderText=this.t("post.newPhoto"),this.toastText=this.t("post.photo.toast.added")):(this.editHeaderText=this.t("post.photoUpdate"),this.toastText=this.t("post.photo.toast.updated"))}})</script></dom-module><dom-module id="yp-api-action-dialog"assetpath="../yp-api-action-dialog/"><template><style include="iron-flex iron-flex-alignment">:host{display:block;height:0;}paper-dialog{background-color:#FFF;}</style><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><yp-ajax method$="[[method]]"id="apiAjax"on-response="_response"></yp-ajax><paper-dialog id="confirmationDialog"on-close="_onClose"><div>[[confirmationText]]</div><div class="buttons"><paper-button dialog-dismiss="">[[t('cancel')]]</paper-button><paper-button dialog-confirm=""on-tap="_delete">[[confirmButtonText]]</paper-button></div></paper-dialog></template><script>Polymer({is:"yp-api-action-dialog",behaviors:[Polymer.ypLanguageBehavior],properties:{confirmationText:{type:String},action:{type:String},onFinishedFunction:{type:Function,value:null},confirmButtonText:{type:String},finalDeleteWarning:{type:Boolean,value:!1}},_onClose:function(){this.fire("close")},setup:function(i,t,n,e,o){this.set("action",i),this.set("confirmationText",t),this.set("onFinishedFunction",n),e?this.set("confirmButtonText",e):this.set("confirmButtonText",this.t("delete")),o?this.set("method",o):this.set("method","DELETE")},open:function(i){i&&i.finalDeleteWarning&&this.set("finalDeleteWarning",!0),this.$$("#confirmationDialog").open()},_delete:function(){var i=this;this.finalDeleteWarning?(this.set("finalDeleteWarning",!1),this.set("confirmationText",this.t("finalDeleteWarning")),this.$$("#confirmationDialog").close(),this.async(function(){i.$$("#confirmationDialog").open()},10)):(this.$$("#apiAjax").url=this.action,this.$$("#apiAjax").setBody({deleteConfirmed:!0}),this.$$("#apiAjax").generateRequest())},_response:function(i){this.fire("api-action-finished"),this.onFinishedFunction&&this.onFinishedFunction(i)}})</script></dom-module></div>