<div hidden=""by-polymer-bundler=""><script>!function(e){if("object"===("undefined"==typeof exports?"undefined":babelHelpers.typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}}(function(){return function o(a,s,c){function p(t,e){if(!s[t]){if(!a[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(d)return d(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var i=s[t]={exports:{}};a[t][0].call(i.exports,function(e){return p(a[t][1][e]||e)},i,i.exports,o,a,s,c)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<c.length;e++)p(c[e]);return p}({1:[function(e,t,r){"use strict";var n=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});t.exports=n},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=o.log,n=o.detectBrowser(e),i={browserDetails:n,commonShim:p,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings,sdp:d};switch(n.browser){case"chrome":if(!a||!a.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(null===n.version)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=a,p.shimAddIceCandidateNullOrEmpty(e,n),p.shimParameterlessSetLocalDescription(e,n),a.shimGetUserMedia(e,n),a.shimMediaStream(e,n),a.shimPeerConnection(e,n),a.shimOnTrack(e,n),a.shimAddTrackRemoveTrack(e,n),a.shimGetSendersWithDtmf(e,n),a.shimGetStats(e,n),a.shimSenderReceiverGetStats(e,n),a.fixNegotiationNeeded(e,n),p.shimRTCIceCandidate(e,n),p.shimConnectionState(e,n),p.shimMaxMessageSize(e,n),p.shimSendThrowTypeError(e,n),p.removeExtmapAllowMixed(e,n);break;case"firefox":if(!s||!s.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=s,p.shimAddIceCandidateNullOrEmpty(e,n),p.shimParameterlessSetLocalDescription(e,n),s.shimGetUserMedia(e,n),s.shimPeerConnection(e,n),s.shimOnTrack(e,n),s.shimRemoveStream(e,n),s.shimSenderGetStats(e,n),s.shimReceiverGetStats(e,n),s.shimRTCDataChannel(e,n),s.shimAddTransceiver(e,n),s.shimGetParameters(e,n),s.shimCreateOffer(e,n),s.shimCreateAnswer(e,n),p.shimRTCIceCandidate(e,n),p.shimConnectionState(e,n),p.shimMaxMessageSize(e,n),p.shimSendThrowTypeError(e,n);break;case"safari":if(!c||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=c,p.shimAddIceCandidateNullOrEmpty(e,n),p.shimParameterlessSetLocalDescription(e,n),c.shimRTCIceServerUrls(e,n),c.shimCreateOfferLegacy(e,n),c.shimCallbacksAPI(e,n),c.shimLocalStreamsAPI(e,n),c.shimRemoteStreamsAPI(e,n),c.shimTrackEventTransceiver(e,n),c.shimGetUserMedia(e,n),c.shimAudioContext(e,n),p.shimRTCIceCandidate(e,n),p.shimMaxMessageSize(e,n),p.shimSendThrowTypeError(e,n),p.removeExtmapAllowMixed(e,n);break;default:r("Unsupported browser!")}return i};var o=n(e("./utils")),a=n(e("./chrome/chrome_shim")),s=n(e("./firefox/firefox_shim")),c=n(e("./safari/safari_shim")),p=n(e("./common_shim")),d=n(e("sdp"));function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11,sdp:12}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var s="function"==typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)},n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(o){if("object"!==(void 0===o?"undefined":s(o))||!o.RTCPeerConnection||"ontrack"in o.RTCPeerConnection.prototype)c.wrapPeerConnectionEvent(o,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var e=o.RTCPeerConnection.prototype.setRemoteDescription;o.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._ontrackpoly||(this._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(t){var e=void 0;e=o.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track};var r=new Event("track");r.track=t.track,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],i.dispatchEvent(r)}),n.stream.getTracks().forEach(function(t){var e=void 0;e=o.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t};var r=new Event("track");r.track=t,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],i.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}},r.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var n=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){var r=i.apply(this,arguments);return r||(r=n(this,e),this._senders.push(r)),r};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(e){t._senders.push(n(t,e))})};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var r=this;this._senders=this._senders||[],t.apply(this,[e]),e.getTracks().forEach(function(t){var e=r._senders.find(function(e){return e.track===t});e&&r._senders.splice(r._senders.indexOf(e),1)})}}else if("object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=a.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function(e){if(!e.RTCPeerConnection)return;var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var r=this,e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],i=e[2];if(0<arguments.length&&"function"==typeof t)return s.apply(this,arguments);if(0===s.length&&(0===arguments.length||"function"!=typeof t))return s.apply(this,[]);function o(e){var n={};return e.result().forEach(function(t){var r={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){r[e]=t.stat(e)}),n[r.id]=r}),n}function a(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))}if(2<=arguments.length){return s.apply(this,[function(e){n(a(o(e)))},t])}return new Promise(function(t,e){s.apply(r,[function(e){t(a(o(e)))},e])}).then(n,i)}},r.shimSenderReceiverGetStats=function(o){if(!("object"===(void 0===o?"undefined":s(o))&&o.RTCPeerConnection&&o.RTCRtpSender&&o.RTCRtpReceiver))return;if(!("getStats"in o.RTCRtpSender.prototype)){var r=o.RTCPeerConnection.prototype.getSenders;r&&(o.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e});var t=o.RTCPeerConnection.prototype.addTrack;t&&(o.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),o.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return c.filterStats(e,t.track,!0)})}}if(!("getStats"in o.RTCRtpReceiver.prototype)){var n=o.RTCPeerConnection.prototype.getReceivers;n&&(o.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),c.wrapPeerConnectionEvent(o,"track",function(e){return e.receiver._pc=e.srcElement,e}),o.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return c.filterStats(e,t.track,!1)})}}if(!("getStats"in o.RTCRtpSender.prototype&&"getStats"in o.RTCRtpReceiver.prototype))return;var a=o.RTCPeerConnection.prototype.getStats;o.RTCPeerConnection.prototype.getStats=function(e){if(0<arguments.length&&babelHelpers.instanceof(e,o.MediaStreamTrack)){var t=e,r=void 0,n=void 0,i=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?i=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?i=!0:n=e),e.track===t}),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}},r.shimAddTrackRemoveTrackWithNative=d,r.shimAddTrackRemoveTrack=function(a,e){if(!a.RTCPeerConnection)return;if(a.RTCPeerConnection.prototype.addTrack&&65<=e.version)return d(a);var r=a.RTCPeerConnection.prototype.getLocalStreams;a.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})};var n=a.RTCPeerConnection.prototype.addStream;a.RTCPeerConnection.prototype.addStream=function(e){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[e.id]){var t=new a.MediaStream(e.getTracks());this._streams[e.id]=t,this._reverseStreams[t.id]=e,e=t}n.apply(this,[e])};var t=a.RTCPeerConnection.prototype.removeStream;function i(n,e){var i=e.sdp;return Object.keys(n._reverseStreams||[]).forEach(function(e){var t=n._reverseStreams[e],r=n._streams[t.id];i=i.replace(new RegExp(r.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:i})}a.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},a.RTCPeerConnection.prototype.addTrack=function(t,e){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var i=this._streams[e.id];if(i)i.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var o=new a.MediaStream([t]);this._streams[e.id]=o,this._reverseStreams[o.id]=e,this.addStream(o)}return this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var t=a.RTCPeerConnection.prototype[e],r=p({},e,function(){var r=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?t.apply(this,[function(e){var t=i(r,e);n[0].apply(null,[t])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):t.apply(this,arguments).then(function(e){return i(r,e)})});a.RTCPeerConnection.prototype[e]=r[e]});var o=a.RTCPeerConnection.prototype.setLocalDescription;a.RTCPeerConnection.prototype.setLocalDescription=function(e){return arguments.length&&e.type&&(n=this,i=(t=e).sdp,Object.keys(n._reverseStreams||[]).forEach(function(e){var t=n._reverseStreams[e],r=n._streams[t.id];i=i.replace(new RegExp(t.id,"g"),r.id)}),e=new RTCSessionDescription({type:t.type,sdp:i})),o.apply(this,arguments);var n,t,i};var s=Object.getOwnPropertyDescriptor(a.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(a.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=s.get.apply(this);return""===e.type?e:i(this,e)}}),a.RTCPeerConnection.prototype.removeTrack=function(t){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(e){r._streams[e].getTracks().find(function(e){return t.track===e})&&(n=r._streams[e])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}},r.shimPeerConnection=function(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection);if(!n.RTCPeerConnection)return;e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=n.RTCPeerConnection.prototype[e],r=p({},e,function(){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});n.RTCPeerConnection.prototype[e]=r[e]})},r.fixNegotiationNeeded=function(e,r){c.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if(!(r.version<72||t.getConfiguration&&"plan-b"===t.getConfiguration().sdpSemantics)||"stable"===t.signalingState)return e})};var c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils.js"));function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function d(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=n.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(r)&&this._shimmedLocalStreams[t.id].push(r):this._shimmedLocalStreams[t.id]=[t,r],r};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var t=this.getSenders();i.apply(this,arguments);var n=this.getSenders().filter(function(e){return-1===t.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(n)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(r){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=n._shimmedLocalStreams[e].indexOf(r);-1!==t&&n._shimmedLocalStreams[e].splice(t,1),1===n._shimmedLocalStreams[e].length&&delete n._shimmedLocalStreams[e]}),o.apply(this,arguments)}}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(o,e){if(o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices)return;if(!o.navigator.mediaDevices)return;if("function"!=typeof e)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");o.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(function(e){var t=i.video&&i.video.width,r=i.video&&i.video.height,n=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:n||3}},t&&(i.video.mandatory.maxWidth=t),r&&(i.video.mandatory.maxHeight=r),o.navigator.mediaDevices.getUserMedia(i)})}}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var p="function"==typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)};r.shimGetUserMedia=function(e,a){var s=e&&e.navigator;if(!s.mediaDevices)return;function c(i){if("object"!==(void 0===i?"undefined":p(i))||i.mandatory||i.optional)return i;var o={};return Object.keys(i).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var r="object"===p(i[t])?i[t]:{ideal:i[t]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);var n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){o.optional=o.optional||[];var e={};"number"==typeof r.ideal?(e[n("min",t)]=r.ideal,o.optional.push(e),(e={})[n("max",t)]=r.ideal):e[n("",t)]=r.ideal,o.optional.push(e)}void 0!==r.exact&&"number"!=typeof r.exact?(o.mandatory=o.mandatory||{},o.mandatory[n("",t)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(o.mandatory=o.mandatory||{},o.mandatory[n(e,t)]=r[e])})}}),i.advanced&&(o.optional=(o.optional||[]).concat(i.advanced)),o}function n(r,n){if(61<=a.version)return n(r);if((r=JSON.parse(JSON.stringify(r)))&&"object"===p(r.audio)){var e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","googAutoGainControl"),e(r.audio,"noiseSuppression","googNoiseSuppression"),r.audio=c(r.audio)}if(r&&"object"===p(r.video)){var i=r.video.facingMode;i=i&&("object"===(void 0===i?"undefined":p(i))?i:{ideal:i});var t=a.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||t)){delete r.video.facingMode;var o=void 0;if("environment"===i.exact||"environment"===i.ideal?o=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(o=["front"]),o)return s.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return o.some(function(e){return t.label.toLowerCase().includes(e)})});return!t&&e.length&&o.includes("back")&&(t=e[e.length-1]),t&&(r.video.deviceId=i.exact?{exact:t.deviceId}:{ideal:t.deviceId}),r.video=c(r.video),d("chrome: "+JSON.stringify(r)),n(r)})}r.video=c(r.video)}return d("chrome: "+JSON.stringify(r)),n(r)}function i(e){return 64<=a.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}}if(s.getUserMedia=function(e,t,r){n(e,function(e){s.webkitGetUserMedia(e,t,function(e){r&&r(i(e))})})}.bind(s),s.mediaDevices.getUserMedia){var r=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(e){return n(e,function(t){return r(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(i(e))})})}}};var d=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils.js")).log},{"../utils.js":11}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)};r.shimRTCIceCandidate=function(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;var i=t.RTCIceCandidate;t.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new i(e),r=d.default.parseCandidate(e.candidate),n=Object.assign(t,r);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new i(e)},t.RTCIceCandidate.prototype=i.prototype,a.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e})},r.shimMaxMessageSize=function(e,c){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var p=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t,r;this._sctp=null,"chrome"===c.browser&&76<=c.version&&("plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}));if(function(e){if(!e||!e.sdp)return!1;var t=d.default.splitSections(e.sdp);return t.shift(),t.some(function(e){var t=d.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})}(e)){var n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(e),i=(t=n,r=65536,"firefox"===c.browser&&(r=c.version<57?-1===t?16384:2147483637:c.version<60?57===c.version?65535:65536:2147483637),r),o=function(e,t){var r=65536;"firefox"===c.browser&&57===c.version&&(r=65535);var n=d.default.matchPrefix(e.sdp,"a=max-message-size:");return 0<n.length?r=parseInt(n[0].substr(19),10):"firefox"===c.browser&&-1!==t&&(r=2147483637),r}(e,n),a=void 0;a=0===i&&0===o?Number.POSITIVE_INFINITY:0===i||0===o?Math.max(i,o):Math.min(i,o);var s={};Object.defineProperty(s,"maxMessageSize",{get:function(){return a}}),this._sctp=s}return p.apply(this,arguments)}},r.shimSendThrowTypeError=function(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,i){var o=n.send;n.send=function(e){var t=e,r=t.length||t.size||t.byteLength;if("open"===n.readyState&&i.sctp&&r>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(n,arguments)}}var r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=r.apply(this,arguments);return t(e,this),e},a.wrapPeerConnectionEvent(e,"datachannel",function(e){return t(e.channel,e.target),e})},r.shimConnectionState=function(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;var r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var t=r[e];r[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}})},r.removeExtmapAllowMixed=function(r,e){if(!r.RTCPeerConnection)return;if("chrome"===e.browser&&71<=e.version)return;if("safari"===e.browser&&605<=e.version)return;var n=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(e){if(e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")){var t=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n");r.RTCSessionDescription&&babelHelpers.instanceof(e,r.RTCSessionDescription)?arguments[0]=new r.RTCSessionDescription({type:e.type,sdp:t}):e.sdp=t}return n.apply(this,arguments)}},r.shimAddIceCandidateNullOrEmpty=function(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;var n=e.RTCPeerConnection.prototype.addIceCandidate;if(!n||0===n.length)return;e.RTCPeerConnection.prototype.addIceCandidate=function(e,t){return e?("chrome"===r.browser&&r.version<78||"firefox"===r.browser&&r.version<68||"safari"===r.browser)&&e&&""===e.candidate?Promise.resolve():n.apply(this,arguments):(t&&t.apply(null),Promise.resolve())}},r.shimParameterlessSetLocalDescription=function(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;var n=e.RTCPeerConnection.prototype.setLocalDescription;if(!n||0===n.length)return;e.RTCPeerConnection.prototype.setLocalDescription=function(e){var t=this,r=e||{};if("object"!==(void 0===r?"undefined":o(r))||r.type&&r.sdp)return n.apply(this,arguments);if(!(r={type:r.type,sdp:r.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||"offer"!==r.type&&"answer"!==r.type?n.apply(this,[r]):("offer"===r.type?this.createOffer:this.createAnswer).apply(this).then(function(e){return n.apply(t,[e])})}};var n,i=e("sdp"),d=(n=i)&&n.__esModule?n:{default:n},a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./utils"))},{"./utils":11,sdp:12}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var c="function"==typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)},n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":c(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(n,i){if("object"!==(void 0===n?"undefined":c(n))||!n.RTCPeerConnection&&!n.mozRTCPeerConnection)return;!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection);i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=n.RTCPeerConnection.prototype[e],r=function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}({},e,function(){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});n.RTCPeerConnection.prototype[e]=r[e]});var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=n.RTCPeerConnection.prototype.getStats;n.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],r=e[2];return a.apply(this,[t||null]).then(function(r){if(i.version<53&&!n)try{r.forEach(function(e){e.type=o[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;r.forEach(function(e,t){r.set(t,Object.assign({},e,{type:o[e.type]||e.type}))})}return r}).then(n,r)}},r.shimSenderGetStats=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;var r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e});var t=e.RTCPeerConnection.prototype.addTrack;t&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e});e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},r.shimReceiverGetStats=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;var r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e});o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}},r.shimRemoveStream=function(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype)return;e.RTCPeerConnection.prototype.removeStream=function(t){var r=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&t.getTracks().includes(e.track)&&r.removeTrack(e)})}},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},r.shimAddTransceiver=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection)return;var s=e.RTCPeerConnection.prototype.addTransceiver;s&&(e.RTCPeerConnection.prototype.addTransceiver=function(e,t){this.setParametersPromises=[];var r=t,n=r&&"sendEncodings"in r;n&&r.sendEncodings.forEach(function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(1<=parseFloat(e.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(0<=parseFloat(e.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")});var i=s.apply(this,arguments);if(n){var o=i.sender,a=o.getParameters();"encodings"in a&&(1!==a.encodings.length||0!==Object.keys(a.encodings[0]).length)||(a.encodings=r.sendEncodings,o.sendEncodings=r.sendEncodings,this.setParametersPromises.push(o.setParameters(a).then(function(){delete o.sendEncodings}).catch(function(){delete o.sendEncodings})))}return i})},r.shimGetParameters=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCRtpSender)return;var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})},r.shimCreateOffer=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection)return;var r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):r.apply(this,arguments)}},r.shimCreateAnswer=function(e){if("object"!==(void 0===e?"undefined":c(e))||!e.RTCPeerConnection)return;var r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):r.apply(this,arguments)}};var o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils"))},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(r,n){if(r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices)return;if(!r.navigator.mediaDevices)return;r.navigator.mediaDevices.getDisplayMedia=function(e){if(e&&e.video)return!0===e.video?e.video={mediaSource:n}:e.video.mediaSource=n,r.navigator.mediaDevices.getUserMedia(e);var t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)}}},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)};r.shimGetUserMedia=function(e,t){var n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){p.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(55<t.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},o=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":c(e))&&"object"===c(e.audio)&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},r&&r.prototype.getSettings){var a=r.prototype.getSettings;r.prototype.getSettings=function(){var e=a.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(r&&r.prototype.applyConstraints){var s=r.prototype.applyConstraints;r.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":c(e))&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),s.apply(this,[e])}}}};var p=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils"))},{"../utils":11}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)};r.shimLocalStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;"getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in e.RTCPeerConnection.prototype)){var o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(e){return o.call(r,e,t)}),t.getVideoTracks().forEach(function(e){return o.call(r,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var t=this,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n&&n.forEach(function(e){t._localStreams?t._localStreams.includes(e)||t._localStreams.push(e):t._localStreams=[e]}),o.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach(function(e){n.includes(e.track)&&t.removeTrack(e)})}})},r.shimRemoteStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;"getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var r=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(r._remoteStreams||(r._remoteStreams=[]),!r._remoteStreams.includes(e)){r._remoteStreams.push(e);var t=new Event("addstream");t.stream=e,r.dispatchEvent(t)}})})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(r._remoteStreams||(r._remoteStreams=[]),!(0<=r._remoteStreams.indexOf(e))){r._remoteStreams.push(e);var t=new Event("addstream");t.stream=e,r.dispatchEvent(t)}})}),t.apply(r,arguments)}}},r.shimCallbacksAPI=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,o=t.createOffer,a=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,c=t.addIceCandidate;t.createOffer=function(e,t,r){var n=2<=arguments.length?r:e,i=o.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t,r){var n=2<=arguments.length?r:e,i=a.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var r=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=r,r=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=r,r=function(e,t,r){var n=c.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=r},r.shimGetUserMedia=function(e){var n=e&&e.navigator;if(n.mediaDevices&&n.mediaDevices.getUserMedia){var t=n.mediaDevices,r=t.getUserMedia.bind(t);n.mediaDevices.getUserMedia=function(e){return r(i(e))}}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(e,t,r){n.mediaDevices.getUserMedia(e).then(t,r)}.bind(n))},r.shimConstraints=i,r.shimRTCIceServerUrls=function(e){if(!e.RTCPeerConnection)return;var o=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r,n=[],i=0;i<e.iceServers.length;i++)!(r=e.iceServers[i]).hasOwnProperty("urls")&&r.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,n.push(r)):n.push(e.iceServers[i]);e.iceServers=n}return new o(e,t)},e.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in o&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var n=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var t=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind});!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind});!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return n.apply(this,arguments)}},r.shimAudioContext=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.AudioContext)return;e.AudioContext=e.webkitAudioContext};var a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils"));function i(e){return e&&void 0!==e.video?Object.assign({},e,{video:a.compactObject(e.video)}):e}},{"../utils":11}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)};function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.extractVersion=a,r.wrapPeerConnectionEvent=function(e,n,i){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,o=t.addEventListener;t.addEventListener=function(e,r){if(e!==n)return o.apply(this,arguments);function t(e){var t=i(e);t&&(r.handleEvent?r.handleEvent(t):r(t))}return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(r,t),o.apply(this,[e,t])};var a=t.removeEventListener;t.removeEventListener=function(e,t){if(e!==n||!this._eventMap||!this._eventMap[n])return a.apply(this,arguments);if(!this._eventMap[n].has(t))return a.apply(this,arguments);var r=this._eventMap[n].get(t);return this._eventMap[n].delete(t),0===this._eventMap[n].size&&delete this._eventMap[n],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(t,"on"+n,{get:function(){return this["_on"+n]},set:function(e){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),e&&this.addEventListener(n,this["_on"+n]=e)},enumerable:!0,configurable:!0})},r.disableLog=function(e){return"boolean"==typeof e?(i=e)?"adapter.js logging disabled":"adapter.js logging enabled":new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.")},r.disableWarnings=function(e){return"boolean"==typeof e?(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")):new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.")},r.log=function(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function(e,t){if(!o)return;console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=a(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=a(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=a(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},r.compactObject=function o(a){if(!c(a))return a;return Object.keys(a).reduce(function(e,t){var r=c(a[t]),n=r?o(a[t]):a[t],i=r&&!Object.keys(n).length;return void 0===n||i?e:Object.assign(e,s({},t,n))},{})},r.walkStats=p,r.filterStats=function(r,t,e){var n=e?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return r.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){r.forEach(function(e){e.type===n&&e.trackId===t.id&&p(r,e,i)})}),i};var i=!0,o=!0;function a(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function c(e){return"[object Object]"===Object.prototype.toString.call(e)}function p(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(e){e.endsWith("Id")?p(t,t.get(r[e]),n):e.endsWith("Ids")&&r[e].forEach(function(e){p(t,t.get(e),n)})}))}},{}],12:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)},d={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};d.localCName=d.generateIdentifier(),d.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},d.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},d.getDescription=function(e){var t=d.splitSections(e);return t&&t[0]},d.getMediaSections=function(e){var t=d.splitSections(e);return t.shift(),t},d.matchPrefix=function(e,t){return d.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},d.parseCandidate=function(e){for(var t=void 0,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},d.writeCandidate=function(e){var t=[e.foundation],r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},d.parseIceOptions=function(e){return e.substr(14).split(" ")},d.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},d.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},d.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},d.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},d.parseFmtp=function(e){for(var t={},r=void 0,n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)t[(r=n[i].trim().split("="))[0].trim()]=r[1];return t},d.writeFmtp=function(t){var e="",r=t.payloadType;if(void 0!==t.preferredPayloadType&&(r=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var n=[];Object.keys(t.parameters).forEach(function(e){void 0!==t.parameters[e]?n.push(e+"="+t.parameters[e]):n.push(e)}),e+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return e},d.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},d.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},d.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return-1<n?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},d.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},d.getMid=function(e){var t=d.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},d.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},d.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:d.matchPrefix(e+t,"a=fingerprint:").map(d.parseFingerprint)}},d.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},d.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},d.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===n(e.keyParams)?d.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},d.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},d.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},d.getCryptoParameters=function(e,t){return d.matchPrefix(e+t,"a=crypto:").map(d.parseCryptoLine)},d.getIceParameters=function(e,t){var r=d.matchPrefix(e+t,"a=ice-ufrag:")[0],n=d.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null},d.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},d.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=d.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],o=d.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var a=d.parseRtpMap(o),s=d.matchPrefix(e,"a=fmtp:"+i+" ");switch(a.parameters=s.length?d.parseFmtp(s[0]):{},a.rtcpFeedback=d.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(d.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return d.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(d.parseExtmap(e))}),t},d.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=0<t.codecs.length?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=d.writeRtpMap(e),r+=d.writeFmtp(e),r+=d.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),0<n&&(r+="a=maxptime:"+n+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=d.writeExtmap(e)}),r},d.parseRtpEncodingParameters=function(e){var r=[],t=d.parseRtpParameters(e),n=-1!==t.fecMechanisms.indexOf("RED"),i=-1!==t.fecMechanisms.indexOf("ULPFEC"),o=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),a=0<o.length&&o[0].ssrc,s=void 0,c=d.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});0<c.length&&1<c[0].length&&c[0][0]===a&&(s=c[0][1]),t.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&s&&(t.rtx={ssrc:s}),r.push(t),n&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:a,mechanism:i?"red+ulpfec":"red"},r.push(t))}}),0===r.length&&a&&r.push({ssrc:a});var p=d.matchPrefix(e,"b=");return p.length&&(p=0===p[0].indexOf("b=TIAS:")?parseInt(p[0].substr(7),10):0===p[0].indexOf("b=AS:")?1e3*parseInt(p[0].substr(5),10)*.95-16e3:void 0,r.forEach(function(e){e.maxBitrate=p})),r},d.parseRtcpParameters=function(e){var t={},r=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var n=d.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<n.length,t.compound=0===n.length;var i=d.matchPrefix(e,"a=rtcp-mux");return t.mux=0<i.length,t},d.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},d.parseMsid=function(e){var t=void 0,r=d.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var n=d.matchPrefix(e,"a=ssrc:").map(function(e){return d.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<n.length?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},d.parseSctpDescription=function(e){var t=d.parseMLine(e),r=d.matchPrefix(e,"a=max-message-size:"),n=void 0;0<r.length&&(n=parseInt(r[0].substr(19),10)),isNaN(n)&&(n=65536);var i=d.matchPrefix(e,"a=sctp-port:");if(0<i.length)return{port:parseInt(i[0].substr(12),10),protocol:t.fmt,maxMessageSize:n};var o=d.matchPrefix(e,"a=sctpmap:");if(0<o.length){var a=o[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:n}}},d.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},d.generateSessionId=function(){return Math.random().toString().substr(2,21)},d.writeSessionBoilerplate=function(e,t,r){var n=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||d.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},d.getDirection=function(e,t){for(var r=d.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?d.getDirection(t):"sendrecv"},d.getKind=function(e){return d.splitLines(e)[0].split(" ")[0].substr(2)},d.isRejected=function(e){return"0"===e.split(" ",2)[1]},d.parseMLine=function(e){var t=d.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},d.parseOLine=function(e){var t=d.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},d.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=d.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"===(void 0===t?"undefined":n(t))&&(t.exports=d)},{}]},{},[1])(1)})</script><script>!function(e,t){"object"===("undefined"==typeof exports?"undefined":babelHelpers.typeof(exports))&&"object"===("undefined"==typeof module?"undefined":babelHelpers.typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define("RecordRTC",[],t):"object"===("undefined"==typeof exports?"undefined":babelHelpers.typeof(exports))?exports.RecordRTC=t():e.RecordRTC=t()}(window,function(){return o={},n.m=i=[function(P,z,e){"use strict";(function(e,t){var i;function T(i,r){if(!i)throw"First parameter is required.";r=new m(i,r=r||{type:"video"});var n=this;function t(e){e&&(r.initCallback=function(){e(),e=r.initCallback=null});var t=new g(i,r);(l=new t(i,r)).record(),c("recording"),r.disableLogs||console.log("Initialized recorderType:",l.constructor.name,"for output-type:",r.type)}function a(o){if(o=o||function(){},l){if("paused"===n.state)return n.resumeRecording(),void setTimeout(function(){a(o)},1);"recording"===n.state||r.disableLogs||console.warn('Recording state should be: "recording", however current state is: ',n.state),r.disableLogs||console.log("Stopped recording "+r.type+" stream."),"gif"!==r.type?l.stop(e):(l.stop(),e()),c("stopped")}else u();function e(e){if(l){Object.keys(l).forEach(function(e){"function"!=typeof l[e]&&(n[e]=l[e])});var t=l.blob;if(!t){if(!e)throw"Recording failed.";l.blob=t=e}if(t&&!r.disableLogs&&console.log(t.type,"->",b(t.size)),o){var i;try{i=k.createObjectURL(t)}catch(e){}"function"==typeof o.call?o.call(n,i):o(i)}r.autoWriteToDisk&&s(function(e){var t={};t[r.type+"Blob"]=e,O.Store(t)})}else"function"==typeof o.call?o.call(n,""):o("")}}function d(e){postMessage((new FileReaderSync).readAsDataURL(e))}function s(t,e){if(!t)throw"Pass a callback function over getDataURL.";var i=e?e.blob:(l||{}).blob;if(!i)return r.disableLogs||console.warn("Blob encoder did not finish its job yet."),void setTimeout(function(){s(t,e)},1e3);if("undefined"==typeof Worker||navigator.mozGetUserMedia){var o=new FileReader;o.readAsDataURL(i),o.onload=function(e){t(e.target.result)}}else{var n=function(e){try{var t=k.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),i=new Worker(t);return k.revokeObjectURL(t),i}catch(e){}}(d);n.onmessage=function(e){t(e.data)},n.postMessage(i)}}function o(e){e=e||0,"paused"!==n.state?"stopped"!==n.state&&(e>=n.recordingDuration?a(n.onRecordingStopped):(e+=1e3,setTimeout(function(){o(e)},1e3))):setTimeout(function(){o(e)},1e3)}function c(e){n&&(n.state=e,"function"==typeof n.onStateChanged.call?n.onStateChanged.call(n,e):n.onStateChanged(e))}var e='It seems that recorder is destroyed or "startRecording" is not invoked for '+r.type+" recorder.";function u(){!0!==r.disableLogs&&console.warn(e)}var l,f={startRecording:function(e){return r.disableLogs||console.log("RecordRTC version: ",n.version),e&&(r=new m(i,e)),r.disableLogs||console.log("started recording "+r.type+" stream."),l?(l.clearRecordedData(),l.record(),c("recording"),n.recordingDuration&&o()):t(function(){n.recordingDuration&&o()}),n},stopRecording:a,pauseRecording:function(){l?"recording"===n.state?(c("paused"),l.pause(),r.disableLogs||console.log("Paused recording.")):r.disableLogs||console.warn("Unable to pause the recording. Recording state: ",n.state):u()},resumeRecording:function(){l?"paused"===n.state?(c("recording"),l.resume(),r.disableLogs||console.log("Resumed recording.")):r.disableLogs||console.warn("Unable to resume the recording. Recording state: ",n.state):u()},initRecorder:t,setRecordingDuration:function(e,t){if(void 0===e)throw"recordingDuration is required.";if("number"!=typeof e)throw"recordingDuration must be a number.";return n.recordingDuration=e,n.onRecordingStopped=t||function(){},{onRecordingStopped:function(e){n.onRecordingStopped=e}}},clearRecordedData:function(){l?(l.clearRecordedData(),r.disableLogs||console.log("Cleared old recorded data.")):u()},getBlob:function(){if(l)return l.blob;u()},getDataURL:s,toURL:function(){if(l)return k.createObjectURL(l.blob);u()},getInternalRecorder:function(){return l},save:function(e){l?w(l.blob,e):u()},getFromDisk:function(e){l?T.getFromDisk(r.type,e):u()},setAdvertisementArray:function(e){r.advertisement=[];for(var t=e.length,i=0;i<t;i++)r.advertisement.push({duration:i,image:e[i]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,reset:function(){"recording"!==n.state||r.disableLogs||console.warn("Stop an active recorder."),l&&"function"==typeof l.clearRecordedData&&l.clearRecordedData(),l=null,c("inactive"),n.blob=null},onStateChanged:function(e){r.disableLogs||console.log("Recorder state changed:",e)},state:"inactive",getState:function(){return n.state},destroy:function(){var e=r.disableLogs;r={disableLogs:!0},n.reset(),c("destroyed"),f=n=null,y.AudioContextConstructor&&(y.AudioContextConstructor.close(),y.AudioContextConstructor=null),r.disableLogs=e,r.disableLogs||console.log("RecordRTC is destroyed.")},version:"5.6.1"};if(!this)return n=f;for(var h in f)this[h]=f[h];return n=this,f}function m(e,t){return t.recorderType||t.type||(t.audio&&t.video?t.type="video":t.audio&&!t.video&&(t.type="audio")),t.recorderType&&!t.type&&(t.recorderType===D||t.recorderType===A||void 0!==F&&t.recorderType===F?t.type="video":t.recorderType===E?t.type="gif":t.recorderType===M?t.type="audio":t.recorderType===L&&(C(e,"audio").length&&C(e,"video").length?t.type="video":!C(e,"audio").length&&C(e,"video").length?t.type="video":C(e,"audio").length&&!C(e,"video").length&&(t.type="audio"))),void 0!==L&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(t.mimeType||(t.mimeType="video/webm"),t.type||(t.type=t.mimeType.split("/")[0]),t.bitsPerSecond),t.type||(t.mimeType&&(t.type=t.mimeType.split("/")[0]),t.type||(t.type="audio")),t}function g(e,t){var i;return(u||d||s)&&(i=M),"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&!u&&(i=L),"video"===t.type&&(u||s)&&(i=D,void 0!==F&&"undefined"!=typeof ReadableStream&&(i=F)),"gif"===t.type&&(i=E),"canvas"===t.type&&(i=A),S()&&i!==A&&i!==E&&"undefined"!=typeof MediaRecorder&&"requestData"in MediaRecorder.prototype&&(C(e,"video").length||C(e,"audio").length)&&("audio"===t.type?"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("audio/webm")&&(i=L):"function"==typeof MediaRecorder.isTypeSupported&&MediaRecorder.isTypeSupported("video/webm")&&(i=L)),babelHelpers.instanceof(e,Array)&&e.length&&(i=j),t.recorderType&&(i=t.recorderType),!t.disableLogs&&i&&i.name&&console.log("Using recorderType:",i.name||i.constructor.name),!i&&l&&(i=L),i}function o(d){this.addStream=function(e){e&&(d=e)},this.mediaType={audio:!0,video:!0},this.startRecording=function(){var e,t=this.mediaType,i=this.mimeType||{audio:null,video:null,gif:null};if("function"!=typeof t.audio&&S()&&!C(d,"audio").length&&(t.audio=!1),"function"!=typeof t.video&&S()&&!C(d,"video").length&&(t.video=!1),"function"!=typeof t.gif&&S()&&!C(d,"video").length&&(t.gif=!1),!t.audio&&!t.video&&!t.gif)throw"MediaStream must have either audio or video tracks.";if(t.audio&&(e=null,"function"==typeof t.audio&&(e=t.audio),this.audioRecorder=new T(d,{type:"audio",bufferSize:this.bufferSize,sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:e,mimeType:i.audio,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp}),t.video||this.audioRecorder.startRecording()),t.video){e=null,"function"==typeof t.video&&(e=t.video);var o=d;if(S()&&t.audio&&"function"==typeof t.audio){var n=C(d,"video")[0];c?((o=new v).addTrack(n),e&&e===D&&(e=L)):(o=new v).addTrack(n)}this.videoRecorder=new T(o,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:e,mimeType:i.video,timeSlice:this.timeSlice,onTimeStamp:this.onTimeStamp,workerPath:this.workerPath,webAssemblyPath:this.webAssemblyPath,frameRate:this.frameRate,bitrate:this.bitrate}),t.audio||this.videoRecorder.startRecording()}if(t.audio&&t.video){var r=this,a=!0===S();babelHelpers.instanceof(t.audio,M)&&t.video?a=!1:!0!==t.audio&&!0!==t.video&&t.audio!==t.video&&(a=!1),!0===a?(r.audioRecorder=null,r.videoRecorder.startRecording()):r.videoRecorder.initRecorder(function(){r.audioRecorder.initRecorder(function(){r.videoRecorder.startRecording(),r.audioRecorder.startRecording()})})}t.gif&&(e=null,"function"==typeof t.gif&&(e=t.gif),this.gifRecorder=new T(d,{type:"gif",frameRate:this.frameRate||200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:e,mimeType:i.gif}),this.gifRecorder.startRecording())},this.stopRecording=function(t){t=t||function(){},this.audioRecorder&&this.audioRecorder.stopRecording(function(e){t(e,"audio")}),this.videoRecorder&&this.videoRecorder.stopRecording(function(e){t(e,"video")}),this.gifRecorder&&this.gifRecorder.stopRecording(function(e){t(e,"gif")})},this.pauseRecording=function(){this.audioRecorder&&this.audioRecorder.pauseRecording(),this.videoRecorder&&this.videoRecorder.pauseRecording(),this.gifRecorder&&this.gifRecorder.pauseRecording()},this.resumeRecording=function(){this.audioRecorder&&this.audioRecorder.resumeRecording(),this.videoRecorder&&this.videoRecorder.resumeRecording(),this.gifRecorder&&this.gifRecorder.resumeRecording()},this.getBlob=function(e){var t={};return this.audioRecorder&&(t.audio=this.audioRecorder.getBlob()),this.videoRecorder&&(t.video=this.videoRecorder.getBlob()),this.gifRecorder&&(t.gif=this.gifRecorder.getBlob()),e&&e(t),t},this.destroy=function(){this.audioRecorder&&(this.audioRecorder.destroy(),this.audioRecorder=null),this.videoRecorder&&(this.videoRecorder.destroy(),this.videoRecorder=null),this.gifRecorder&&(this.gifRecorder.destroy(),this.gifRecorder=null)},this.getDataURL=function(i){function o(e,t){if("undefined"!=typeof Worker){var i=function(e){var t,i=k.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),o=new Worker(i);if(void 0!==k)t=k;else{if("undefined"==typeof webkitURL)throw"Neither URL nor webkitURL detected.";t=webkitURL}return t.revokeObjectURL(i),o}(function(e){postMessage((new FileReaderSync).readAsDataURL(e))});i.onmessage=function(e){t(e.data)},i.postMessage(e)}else{var o=new FileReader;o.readAsDataURL(e),o.onload=function(e){t(e.target.result)}}}this.getBlob(function(e){e.audio&&e.video?o(e.audio,function(t){o(e.video,function(e){i({audio:t,video:e})})}):e.audio?o(e.audio,function(e){i({audio:e})}):e.video&&o(e.video,function(e){i({video:e})})})},this.writeToDisk=function(){T.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})},this.save=function(e){(e=e||{audio:!0,video:!0,gif:!0}).audio&&this.audioRecorder&&this.audioRecorder.save("string"==typeof e.audio?e.audio:""),e.video&&this.videoRecorder&&this.videoRecorder.save("string"==typeof e.video?e.video:""),e.gif&&this.gifRecorder&&this.gifRecorder.save("string"==typeof e.gif?e.gif:"")}}T.version="5.6.1",P.exports=T,void 0===(i=function(){return T}.apply(z,[]))||(P.exports=i),T.getFromDisk=function(i,o){if(!o)throw"callback is mandatory.";console.log("Getting recorded "+("all"===i?"blobs":i+" blob ")+" from disk!"),O.Fetch(function(e,t){"all"!==i&&t===i+"Blob"&&o&&o(e),"all"===i&&o&&o(e,t.replace("Blob",""))})},T.writeToDisk=function(e){console.log("Writing recorded blob(s) to disk!"),(e=e||{}).audio&&e.video&&e.gif?e.audio.getDataURL(function(i){e.video.getDataURL(function(t){e.gif.getDataURL(function(e){O.Store({audioBlob:i,videoBlob:t,gifBlob:e})})})}):e.audio&&e.video?e.audio.getDataURL(function(t){e.video.getDataURL(function(e){O.Store({audioBlob:t,videoBlob:e})})}):e.audio&&e.gif?e.audio.getDataURL(function(t){e.gif.getDataURL(function(e){O.Store({audioBlob:t,gifBlob:e})})}):e.video&&e.gif?e.video.getDataURL(function(t){e.gif.getDataURL(function(e){O.Store({videoBlob:t,gifBlob:e})})}):e.audio?e.audio.getDataURL(function(e){O.Store({audioBlob:e})}):e.video?e.video.getDataURL(function(e){O.Store({videoBlob:e})}):e.gif&&e.gif.getDataURL(function(e){O.Store({gifBlob:e})})},o.getFromDisk=T.getFromDisk,o.writeToDisk=T.writeToDisk,void 0!==T&&(T.MRecordRTC=o);var n;(n=void 0!==e?e:null)&&"undefined"==typeof window&&void 0!==e&&(e.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},e.console||(e.console={}),void 0!==e.console.log&&void 0!==e.console.error||(e.console.error=e.console.log=e.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(n.document={documentElement:{appendChild:function(){return""}}},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""},style:{}};return e},n.HTMLVideoElement=function(){}),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(n.screen={width:0,height:0}),void 0===k&&(n.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),n.window=e);var h=window.requestAnimationFrame;if(void 0===h)if("undefined"!=typeof webkitRequestAnimationFrame)h=webkitRequestAnimationFrame;else if("undefined"!=typeof mozRequestAnimationFrame)h=mozRequestAnimationFrame;else if("undefined"!=typeof msRequestAnimationFrame)h=msRequestAnimationFrame;else if(void 0===h){var r=0;h=function(e){var t=(new Date).getTime(),i=Math.max(0,16-(t-r)),o=setTimeout(function(){e(t+i)},i);return r=t+i,o}}var p=window.cancelAnimationFrame;void 0===p&&("undefined"!=typeof webkitCancelAnimationFrame?p=webkitCancelAnimationFrame:"undefined"!=typeof mozCancelAnimationFrame?p=mozCancelAnimationFrame:"undefined"!=typeof msCancelAnimationFrame?p=msCancelAnimationFrame:void 0===p&&(p=function(e){clearTimeout(e)}));var a=window.AudioContext;void 0===a&&("undefined"!=typeof webkitAudioContext&&(a=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(a=mozAudioContext));var k=window.URL;void 0===k&&"undefined"!=typeof webkitURL&&(k=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var d=!(-1===navigator.userAgent.indexOf("Edge")||!navigator.msSaveBlob&&!navigator.msSaveOrOpenBlob),s=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),c=-1<navigator.userAgent.toLowerCase().indexOf("firefox")&&"netscape"in window&&/ rv:/.test(navigator.userAgent),u=!s&&!d&&!!navigator.webkitGetUserMedia||f()||-1!==navigator.userAgent.toLowerCase().indexOf("chrome/"),l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);l&&!u&&-1!==navigator.userAgent.indexOf("CriOS")&&(u=!(l=!1));var v=window.MediaStream;function b(e){if(0===e)return"0 Bytes";var t=parseInt(Math.floor(Math.log(e)/Math.log(1e3)),10);return(e/Math.pow(1e3,t)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][t]}function w(e,t){if(!e)throw"Blob object is required.";if(!e.type)try{e.type="video/webm"}catch(e){}var i=(e.type||"video/webm").split("/")[1];if(t&&-1!==t.indexOf(".")){var o=t.split(".");t=o[0],i=o[1]}var n=(t||Math.round(9999999999*Math.random())+888888888)+"."+i;if(void 0!==navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(e,n);if(void 0!==navigator.msSaveBlob)return navigator.msSaveBlob(e,n);var r=document.createElement("a");r.href=k.createObjectURL(e),r.download=n,r.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(r),"function"==typeof r.click?r.click():(r.target="_blank",r.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}))),k.revokeObjectURL(r.href)}function f(){return"undefined"!=typeof window&&"object"===babelHelpers.typeof(window.process)&&"renderer"===window.process.type||(!(void 0===t||"object"!==babelHelpers.typeof(t.versions)||!t.versions.electron)||"object"===("undefined"==typeof navigator?"undefined":babelHelpers.typeof(navigator))&&"string"==typeof navigator.userAgent&&0<=navigator.userAgent.indexOf("Electron"))}function C(e,t){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(t||"audio")}):[]}function R(e,t){"srcObject"in t?t.srcObject=e:"mozSrcObject"in t?t.mozSrcObject=e:t.srcObject=e}void 0===v&&"undefined"!=typeof webkitMediaStream&&(v=webkitMediaStream),void 0!==v&&void 0===v.prototype.stop&&(v.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}),void 0!==T&&(T.invokeSaveAsDialog=w,T.getTracks=C,T.getSeekableBlob=function(e,n){if("undefined"==typeof EBML)throw new Error("Please link: https://www.webrtc-experiment.com/EBML.js");var r=new EBML.Reader,a=new EBML.Decoder,d=EBML.tools,t=new FileReader;t.onload=function(e){a.decode(this.result).forEach(function(e){r.read(e)}),r.stop();var t=d.makeMetadataSeekable(r.metadatas,r.duration,r.cues),i=this.result.slice(r.metadataSize),o=new Blob([t,i],{type:"video/webm"});n(o)},t.readAsArrayBuffer(e)},T.bytesToSize=b,T.isElectron=f);var y={};function S(){if(c||l||d)return!0;navigator.appVersion;var e,t,i=navigator.userAgent,o=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10);return(u||s)&&(e=i.indexOf("Chrome"),o=i.substring(e+7)),-1!==(t=o.indexOf(";"))&&(o=o.substring(0,t)),-1!==(t=o.indexOf(" "))&&(o=o.substring(0,t)),n=parseInt(""+o,10),isNaN(n)&&(o=""+parseFloat(navigator.appVersion),n=parseInt(navigator.appVersion,10)),49<=n}function L(t,o){var n=this;if(void 0===t)throw'First argument "MediaStream" is required.';if("undefined"==typeof MediaRecorder)throw"Your browser does not support the Media Recorder API. Please try other modules e.g. WhammyRecorder or StereoAudioRecorder.";if("audio"===(o=o||{mimeType:"video/webm"}).type){var e;if(C(t,"video").length&&C(t,"audio").length)navigator.mozGetUserMedia?(e=new v).addTrack(C(t,"audio")[0]):e=new v(C(t,"audio")),t=e;o.mimeType&&-1!==o.mimeType.toString().toLowerCase().indexOf("audio")||(o.mimeType=u?"audio/webm":"audio/ogg"),o.mimeType&&"audio/ogg"!==o.mimeType.toString().toLowerCase()&&navigator.mozGetUserMedia&&(o.mimeType="audio/ogg")}var r,a=[];function d(){n.timestamps.push((new Date).getTime()),"function"==typeof o.onTimeStamp&&o.onTimeStamp(n.timestamps[n.timestamps.length-1],n.timestamps)}function s(e){return r&&r.mimeType?r.mimeType:e.mimeType||"video/webm"}function i(){a=[],r=null,n.timestamps=[]}this.getArrayOfBlobs=function(){return a},this.record=function(){n.blob=null,n.clearRecordedData(),n.timestamps=[],c=[],a=[];var i=o;o.disableLogs||console.log("Passing following config over MediaRecorder API.",i),r=r&&null,u&&!S()&&(i="video/vp8"),"function"==typeof MediaRecorder.isTypeSupported&&i.mimeType&&(MediaRecorder.isTypeSupported(i.mimeType)||(o.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",i.mimeType),i.mimeType="audio"===o.type?"audio/webm":"video/webm"));try{r=new MediaRecorder(t,i),o.mimeType=i.mimeType}catch(e){r=new MediaRecorder(t)}i.mimeType&&!MediaRecorder.isTypeSupported&&"canRecordMimeType"in r&&!1===r.canRecordMimeType(i.mimeType)&&(o.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",i.mimeType)),r.ondataavailable=function(e){if(e.data&&c.push("ondataavailable: "+b(e.data.size)),"number"!=typeof o.timeSlice)!e.data||!e.data.size||e.data.size<100||n.blob?n.recordingCallback&&(n.recordingCallback(new Blob([],{type:s(i)})),n.recordingCallback=null):(n.blob=o.getNativeBlob?e.data:new Blob([e.data],{type:s(i)}),n.recordingCallback&&(n.recordingCallback(n.blob),n.recordingCallback=null));else if(e.data&&e.data.size&&(a.push(e.data),d(),"function"==typeof o.ondataavailable)){var t=o.getNativeBlob?e.data:new Blob([e.data],{type:s(i)});o.ondataavailable(t)}},r.onstart=function(){c.push("started")},r.onpause=function(){c.push("paused")},r.onresume=function(){c.push("resumed")},r.onstop=function(){c.push("stopped")},r.onerror=function(e){e&&(e.name||(e.name="UnknownError"),c.push("error: "+e),o.disableLogs||(-1!==e.name.toString().toLowerCase().indexOf("invalidstate")?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed.",e):-1!==e.name.toString().toLowerCase().indexOf("notsupported")?console.error("MIME type (",i.mimeType,") is not supported.",e):-1!==e.name.toString().toLowerCase().indexOf("security")?console.error("MediaRecorder security error",e):"OutOfMemory"===e.name?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"IllegalStreamModification"===e.name?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"OtherRecordingError"===e.name?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute.",e):"GenericError"===e.name?console.error("The UA cannot provide the codec or recording option that has been requested.",e):console.error("MediaRecorder Error",e)),function(){if(!n.manuallyStopped&&r&&"inactive"===r.state)return delete o.timeslice,r.start(6e5);setTimeout(void 0,1e3)}(),"inactive"!==r.state&&"stopped"!==r.state&&r.stop())},"number"==typeof o.timeSlice?(d(),r.start(o.timeSlice)):r.start(36e5),o.initCallback&&o.initCallback()},this.timestamps=[],this.stop=function(e){e=e||function(){},n.manuallyStopped=!0,r&&(this.recordingCallback=e,"recording"===r.state&&r.stop(),"number"==typeof o.timeSlice&&setTimeout(function(){n.blob=new Blob(a,{type:s(o)}),n.recordingCallback(n.blob)},100))},this.pause=function(){r&&"recording"===r.state&&r.pause()},this.resume=function(){r&&"paused"===r.state&&r.resume()},this.clearRecordedData=function(){r&&"recording"===r.state&&n.stop(i),i()},this.getInternalRecorder=function(){return r},this.blob=null,this.getState=function(){return r&&r.state||"inactive"};var c=[];this.getAllStates=function(){return c},void 0===o.checkForInactiveTracks&&(o.checkForInactiveTracks=!1);n=this;!function e(){if(r&&!1!==o.checkForInactiveTracks)return!1===function(){if("active"in t){if(!t.active)return!1}else if("ended"in t&&t.ended)return!1;return!0}()?(o.disableLogs||console.log("MediaStream seems stopped."),void n.stop()):void setTimeout(e,1e3)}(),this.name="MediaStreamRecorder",this.toString=function(){return this.name}}function M(e,r){if(!C(e,"audio").length)throw"Your stream has no audio tracks.";var a,d=this,s=[],c=[],u=!1,l=0,f=2,o=(r=r||{}).desiredSampRate;function h(){if(!1===r.checkForInactiveTracks)return!0;if("active"in e){if(!e.active)return!1}else if("ended"in e&&e.ended)return!1;return!0}function t(e,t){function i(e,t){var i,o=e.numberOfAudioChannels,n=e.leftBuffers.slice(0),r=e.rightBuffers.slice(0),a=e.sampleRate,d=e.internalInterleavedLength,s=e.desiredSampRate;function c(e,t,i){var o,n,r=Math.round(e.length*(t/i)),a=[],d=+(e.length-1)/(r-1);a[0]=e[0];for(var s=1;s<r-1;s++){var c=s*d,u=(+Math.floor(c)).toFixed(),l=(+Math.ceil(c)).toFixed(),f=c-u;a[s]=(o=e[u],n=e[l],o+(n-o)*f)}return a[r-1]=e[e.length-1],a}function u(e,t){for(var i,o=new Float64Array(t),n=0,r=e.length,a=0;a<r;a++)i=e[a],o.set(i,n),n+=i.length;return o}function l(e,t,i){for(var o=i.length,n=0;n<o;n++)e.setUint8(t+n,i.charCodeAt(n))}2===o&&(n=u(n,d),r=u(r,d),s&&(n=c(n,s,a),r=c(r,s,a))),1===o&&(n=u(n,d),s&&(n=c(n,s,a))),s&&(a=s),2===o&&(i=function(e,t){for(var i=e.length+t.length,o=new Float64Array(i),n=0,r=0;r<i;)o[r++]=e[n],o[r++]=t[n],n++;return o}(n,r)),1===o&&(i=n);var f=i.length,h=new ArrayBuffer(44+2*f),m=new DataView(h);l(m,0,"RIFF"),m.setUint32(4,36+2*f,!0),l(m,8,"WAVE"),l(m,12,"fmt "),m.setUint32(16,16,!0),m.setUint16(20,1,!0),m.setUint16(22,o,!0),m.setUint32(24,a,!0),m.setUint32(28,2*a,!0),m.setUint16(32,2*o,!0),m.setUint16(34,16,!0),l(m,36,"data"),m.setUint32(40,2*f,!0);for(var g=f,p=44,v=0;v<g;v++)m.setInt16(p,32767*i[v],!0),p+=2;if(t)return t({buffer:h,view:m});postMessage({buffer:h,view:m})}if(e.noWorker)i(e,function(e){t(e.buffer,e.view)});else{var o,n,r,a=(o=i,n=k.createObjectURL(new Blob([o.toString(),";this.onmessage =  function (eee) {"+o.name+"(eee.data);}"],{type:"application/javascript"})),(r=new Worker(n)).workerURL=n,r);a.onmessage=function(e){t(e.data.buffer,e.data.view),k.revokeObjectURL(a.workerURL),a.terminate()},a.postMessage(e)}}!0===r.leftChannel&&(f=1),1===r.numberOfAudioChannels&&(f=1),(!f||f<1)&&(f=2),r.disableLogs||console.log("StereoAudioRecorder is set to record number of channels: "+f),void 0===r.checkForInactiveTracks&&(r.checkForInactiveTracks=!0),this.record=function(){if(!1===h())throw"Please make sure MediaStream is active.";b(),y=v=!1,u=!0,void 0!==r.timeSlice&&S()},this.stop=function(i){i=i||function(){},u=!1,t({desiredSampRate:o,sampleRate:p,numberOfAudioChannels:f,internalInterleavedLength:l,leftBuffers:s,rightBuffers:1===f?[]:c,noWorker:r.noWorker},function(e,t){d.blob=new Blob([t],{type:"audio/wav"}),d.buffer=new ArrayBuffer(t.buffer.byteLength),d.view=t,d.sampleRate=o||p,d.bufferSize=g,d.length=l,y=!1,i&&i(d.blob)})},void 0===T.Storage&&(T.Storage={AudioContextConstructor:null,AudioContext:window.AudioContext||window.webkitAudioContext}),T.Storage.AudioContextConstructor&&"closed"!==T.Storage.AudioContextConstructor.state||(T.Storage.AudioContextConstructor=new T.Storage.AudioContext);var i=T.Storage.AudioContextConstructor,m=i.createMediaStreamSource(e),n=[0,256,512,1024,2048,4096,8192,16384],g=void 0===r.bufferSize?4096:r.bufferSize;if(-1===n.indexOf(g)&&(r.disableLogs||console.log("Legal values for buffer-size are "+JSON.stringify(n,null,"\t"))),i.createJavaScriptNode)a=i.createJavaScriptNode(g,f,f);else{if(!i.createScriptProcessor)throw"WebAudio API has no support on this browser.";a=i.createScriptProcessor(g,f,f)}m.connect(a),r.bufferSize||(g=a.bufferSize);var p=void 0!==r.sampleRate?r.sampleRate:i.sampleRate||44100;(p<22050||96e3<p)&&(r.disableLogs||console.log("sample-rate must be under range 22050 and 96000.")),r.disableLogs||r.desiredSampRate&&console.log("Desired sample-rate: "+r.desiredSampRate);var v=!1;function b(){s=[],l=0,v=u=y=!(c=[]),i=null,d.leftchannel=s,d.rightchannel=c,d.numberOfAudioChannels=f,d.desiredSampRate=o,d.sampleRate=p,d.recordingLength=l,R={left:[],right:[],recordingLength:0}}function w(){a&&(a.onaudioprocess=null,a.disconnect(),a=null),m&&(m.disconnect(),m=null),b()}this.pause=function(){v=!0},this.resume=function(){if(!1===h())throw"Please make sure MediaStream is active.";if(!u)return r.disableLogs||console.log("Seems recording has been restarted."),void this.record();v=!1},this.clearRecordedData=function(){r.checkForInactiveTracks=!1,u&&this.stop(w),w()},this.name="StereoAudioRecorder";var y=!(this.toString=function(){return this.name});a.onaudioprocess=function(e){if(!v)if(!1===h()&&(r.disableLogs||console.log("MediaStream seems stopped."),a.disconnect(),u=!1),u){y||(y=!0,r.onAudioProcessStarted&&r.onAudioProcessStarted(),r.initCallback&&r.initCallback());var t=e.inputBuffer.getChannelData(0),i=new Float32Array(t);if(s.push(i),2===f){var o=e.inputBuffer.getChannelData(1),n=new Float32Array(o);c.push(n)}l+=g,d.recordingLength=l,void 0!==r.timeSlice&&(R.recordingLength+=g,R.left.push(i),2===f&&R.right.push(n))}else m&&(m.disconnect(),m=null)},i.createMediaStreamDestination?a.connect(i.createMediaStreamDestination()):a.connect(i.destination),this.leftchannel=s,this.rightchannel=c,this.numberOfAudioChannels=f,this.desiredSampRate=o,this.sampleRate=p,d.recordingLength=l;var R={left:[],right:[],recordingLength:0};function S(){u&&"function"==typeof r.ondataavailable&&void 0!==r.timeSlice&&(R.left.length?(t({desiredSampRate:o,sampleRate:p,numberOfAudioChannels:f,internalInterleavedLength:R.recordingLength,leftBuffers:R.left,rightBuffers:1===f?[]:R.right},function(e,t){var i=new Blob([t],{type:"audio/wav"});r.ondataavailable(i),setTimeout(S,r.timeSlice)}),R={left:[],right:[],recordingLength:0}):setTimeout(S,r.timeSlice))}}function A(o,r){if("undefined"==typeof html2canvas)throw"Please link: https://www.webrtc-experiment.com/screenshot.js";(r=r||{}).frameInterval||(r.frameInterval=10);var n=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){e in document.createElement("canvas")&&(n=!0)});var i,a,d,e=!(!window.webkitRTCPeerConnection&&!window.webkitGetUserMedia||!window.chrome),t=50,s=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(e&&s&&s[2]&&(t=parseInt(s[2],10)),e&&t<52&&(n=!1),r.useWhammyRecorder&&(n=!1),n)if(r.disableLogs||console.log("Your browser supports both MediRecorder API and canvas.captureStream!"),babelHelpers.instanceof(o,HTMLCanvasElement))i=o;else{if(!babelHelpers.instanceof(o,CanvasRenderingContext2D))throw"Please pass either HTMLCanvasElement or CanvasRenderingContext2D.";i=o.canvas}else navigator.mozGetUserMedia&&(r.disableLogs||console.error("Canvas recording is NOT supported in Firefox."));this.record=function(){if(d=!0,n&&!r.useWhammyRecorder){var e;"captureStream"in i?e=i.captureStream(25):"mozCaptureStream"in i?e=i.mozCaptureStream(25):"webkitCaptureStream"in i&&(e=i.webkitCaptureStream(25));try{var t=new v;t.addTrack(C(e,"video")[0]),e=t}catch(e){}if(!e)throw"captureStream API are NOT available.";(a=new L(e,{mimeType:r.mimeType||"video/webm"})).record()}else h.frames=[],f=(new Date).getTime(),l();r.initCallback&&r.initCallback()},this.getWebPImages=function(e){if("canvas"===o.nodeName.toLowerCase()){var n=h.frames.length;h.frames.forEach(function(e,t){var i=n-t;r.disableLogs||console.log(i+"/"+n+" frames remaining"),r.onEncodingCallback&&r.onEncodingCallback(i,n);var o=e.image.toDataURL("image/webp",1);h.frames[t].image=o}),r.disableLogs||console.log("Generating WebM"),e()}else e()};var c=!(this.stop=function(t){d=!1;var i=this;n&&a?a.stop(t):this.getWebPImages(function(){h.compile(function(e){r.disableLogs||console.log("Recording finished!"),i.blob=e,i.blob.forEach&&(i.blob=new Blob([],{type:"video/webm"})),t&&t(i.blob),h.frames=[]})})});function u(){h.frames=[],c=d=!1}function l(){if(c)return f=(new Date).getTime(),setTimeout(l,500);if("canvas"===o.nodeName.toLowerCase()){var e=(new Date).getTime()-f;return f=(new Date).getTime(),h.frames.push({image:(t=document.createElement("canvas"),i=t.getContext("2d"),t.width=o.width,t.height=o.height,i.drawImage(o,0,0),t),duration:e}),void(d&&setTimeout(l,r.frameInterval))}var t,i;html2canvas(o,{grabMouse:void 0===r.showMousePointer||r.showMousePointer,onrendered:function(e){var t=(new Date).getTime()-f;if(!t)return setTimeout(l,r.frameInterval);f=(new Date).getTime(),h.frames.push({image:e.toDataURL("image/webp",1),duration:t}),d&&setTimeout(l,r.frameInterval)}})}this.pause=function(){c=!0,babelHelpers.instanceof(a,L)&&a.pause()},this.resume=function(){c=!1,babelHelpers.instanceof(a,L)?a.resume():d||this.record()},this.clearRecordedData=function(){d&&this.stop(u),u()},this.name="CanvasRecorder",this.toString=function(){return this.name};var f=(new Date).getTime(),h=new x.Video(100)}function D(e,o){function i(e){e=void 0!==e?e:10;var t=(new Date).getTime()-s;return t?a?(s=(new Date).getTime(),setTimeout(i,100)):(s=(new Date).getTime(),d.paused&&d.play(),u.drawImage(d,0,0,y.width,y.height),c.frames.push({duration:t,image:y.toDataURL("image/webp")}),void(r||setTimeout(i,e,e))):setTimeout(i,e,e)}function n(i,e,t,o,n){var r=document.createElement("canvas");r.width=y.width,r.height=y.height;var a,d,s,u=r.getContext("2d"),l=[],f=-1===e,c=e&&0<e&&e<=i.length?e:i.length,h=0,m=0,g=0,p=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),v=t&&0<=t&&t<=1?t:0,b=o&&0<=o&&o<=1?o:0,w=!1;d=-1,s=(a={length:c,functionToLoop:function(e,t){function r(){!w&&s-a<=s*b||(f&&(w=!0),l.push(i[t])),e()}var a,d,s;if(w)r();else{var c=new Image;c.onload=function(){u.drawImage(c,0,0,y.width,y.height);var e=u.getImageData(0,0,y.width,y.height);a=0,d=e.data.length,s=e.data.length/4;for(var t=0;t<d;t+=4){var i=e.data[t],o=e.data[t+1],n=e.data[t+2];Math.sqrt(Math.pow(i-h,2)+Math.pow(o-m,2)+Math.pow(n-g,2))<=p*v&&a++}r()},c.src=i[t].image}},callback:function(){(l=l.concat(i.slice(c))).length<=0&&l.push(i[i.length-1]),n(l)}}).length,function e(){++d!==s?setTimeout(function(){a.functionToLoop(e,d)},1):a.callback()}()}(o=o||{}).frameInterval||(o.frameInterval=10),o.disableLogs||console.log("Using frames-interval:",o.frameInterval);var r=!(this.record=function(){o.width||(o.width=320),o.height||(o.height=240),o.video||(o.video={width:o.width,height:o.height}),o.canvas||(o.canvas={width:o.width,height:o.height}),y.width=o.canvas.width||320,y.height=o.canvas.height||240,u=y.getContext("2d"),o.video&&babelHelpers.instanceof(o.video,HTMLVideoElement)?(d=o.video.cloneNode(),o.initCallback&&o.initCallback()):(d=document.createElement("video"),R(e,d),d.onloadedmetadata=function(){o.initCallback&&o.initCallback()},d.width=o.video.width,d.height=o.video.height),d.muted=!0,d.play(),s=(new Date).getTime(),c=new x.Video,o.disableLogs||(console.log("canvas resolutions",y.width,"*",y.height),console.log("video width/height",d.width||y.width,"*",d.height||y.height)),i(o.frameInterval)}),a=!(this.stop=function(t){t=t||function(){},r=!0;var i=this;setTimeout(function(){n(c.frames,-1,null,null,function(e){c.frames=e,o.advertisement&&o.advertisement.length&&(c.frames=o.advertisement.concat(c.frames)),c.compile(function(e){i.blob=e,i.blob.forEach&&(i.blob=new Blob([],{type:"video/webm"})),t&&t(i.blob)})})},10)});function t(){c.frames=[],a=!(r=!0)}this.pause=function(){a=!0},this.resume=function(){a=!1,r&&this.record()},this.clearRecordedData=function(){r||this.stop(t),t()},this.name="WhammyRecorder",this.toString=function(){return this.name};var d,s,c,y=document.createElement("canvas"),u=y.getContext("2d")}void 0!==a?y.AudioContext=a:"undefined"!=typeof webkitAudioContext&&(y.AudioContext=webkitAudioContext),void 0!==T&&(T.Storage=y),void 0!==T&&(T.MediaStreamRecorder=L),void 0!==T&&(T.StereoAudioRecorder=M),void 0!==T&&(T.CanvasRecorder=A),void 0!==T&&(T.WhammyRecorder=D);var x=(U.prototype.add=function(e,t){if("canvas"in e&&(e=e.canvas),"toDataURL"in e&&(e=e.toDataURL("image/webp",this.quality)),!/^data:image\/webp;base64,/gi.test(e))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:e,duration:t||this.duration})},U.prototype.compile=function(t){var e,i,o,n=(e=B,i=k.createObjectURL(new Blob([e.toString(),"this.onmessage =  function (eee) {"+e.name+"(eee.data);}"],{type:"application/javascript"})),o=new Worker(i),k.revokeObjectURL(i),o);n.onmessage=function(e){e.data.error?console.error(e.data.error):t(e.data)},n.postMessage(this.frames)},{Video:U});function U(e){this.frames=[],this.duration=e||1,this.quality=.8}function B(e){function c(e,i,t){return[{data:e,id:231}].concat(t.map(function(e){var t=function(e){var t=0;e.keyframe&&(t|=128);e.invisible&&(t|=8);e.lacing&&(t|=e.lacing<<1);e.discardable&&(t|=1);if(127<e.trackNum)throw"TrackNumber > 127 not supported";return[128|e.trackNum,e.timecode>>8,255&e.timecode,t].map(function(e){return String.fromCharCode(e)}).join("")+e.frame}({discardable:0,frame:e.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(i)});return i+=e.duration,{data:t,id:163}}))}function u(e){for(var t=[];0<e;)t.push(255&e),e>>=8;return new Uint8Array(t.reverse())}function l(e){var t=[];e=(e.length%8?Array(9-e.length%8).join("0"):"")+e;for(var i=0;i<e.length;i+=8)t.push(parseInt(e.substr(i,8),2));return new Uint8Array(t)}function d(e){for(var t,i=0,o={};i<e.length;){var n=e.substr(i,4),r=(t=i,parseInt(e.substr(t+4,4).split("").map(function(e){var t=e.charCodeAt(0).toString(2);return Array(8-t.length+1).join("0")+t}).join(""),2)),a=e.substr(i+4+4,r);i+=8+r,o[n]=o[n]||[],"RIFF"===n||"LIST"===n?o[n].push(d(a)):o[n].push(a)}return o}var t=new function(e){var t=function(e){if(!e[0])return void postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});for(var t=e[0].width,i=e[0].height,o=e[0].duration,n=1;n<e.length;n++)o+=e[n].duration;return{duration:o,width:t,height:i}}(e);if(!t)return[];for(var i,o=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:(i=t.duration,[].slice.call(new Uint8Array(new Float64Array([i]).buffer),0).map(function(e){return String.fromCharCode(e)}).reverse().join("")),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:t.width,id:176},{data:t.height,id:186}]}]}]}]}],n=0,r=0;n<e.length;){for(var a=[],d=0;a.push(e[n]),d+=e[n].duration,++n<e.length&&d<3e4;);var s={id:524531317,data:c(r,0,a)};o[1].data.push(s),r+=d}return function e(t){for(var i,o=[],n=0;n<t.length;n++){i=t[n].data,"object"===babelHelpers.typeof(i)&&(i=e(i)),"number"==typeof i&&(i=l(i.toString(2))),"string"==typeof i&&(i=new Uint8Array(i.split("").map(function(e){return e.charCodeAt(0)})));var r=i.size||i.byteLength||i.length,a=Math.ceil(Math.ceil(Math.log(r)/Math.log(2))/8),d=r.toString(2),s=Array(7*a+7+1-d.length).join("0")+d,c=Array(a).join("0")+"1"+s;o.push(u(t[n].id)),o.push(l(c)),o.push(i)}return new Blob(o,{type:"video/webm"})}(o)}(e.map(function(e){var t=function(e){for(var t=e.RIFF[0].WEBP[0],i=t.indexOf("*"),o=0,n=[];o<4;o++)n[o]=t.charCodeAt(i+3+o);return{width:16383&(n[1]<<8|n[0]),height:16383&(n[3]<<8|n[2]),data:t,riff:e}}(d(atob(e.image.slice(23))));return t.duration=e.duration,t}));postMessage(t)}void 0!==T&&(T.Whammy=x);var O={init:function(){var i=this;if("undefined"!=typeof indexedDB&&void 0!==indexedDB.open){var o,e=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),t=indexedDB.open(e,1);t.onerror=i.onError,t.onsuccess=function(){((o=t.result).onerror=i.onError,o.setVersion)?1!==o.version?o.setVersion(1).onsuccess=function(){n(o),r()}:r():r()},t.onupgradeneeded=function(e){n(e.target.result)}}else console.error("IndexedDB API are not available in this browser.");function n(e){e.createObjectStore(i.dataStoreName)}function r(){var e=o.transaction([i.dataStoreName],"readwrite");function t(t){e.objectStore(i.dataStoreName).get(t).onsuccess=function(e){i.callback&&i.callback(e.target.result,t)}}i.videoBlob&&e.objectStore(i.dataStoreName).put(i.videoBlob,"videoBlob"),i.gifBlob&&e.objectStore(i.dataStoreName).put(i.gifBlob,"gifBlob"),i.audioBlob&&e.objectStore(i.dataStoreName).put(i.audioBlob,"audioBlob"),t("audioBlob"),t("videoBlob"),t("gifBlob")}},Fetch:function(e){return this.callback=e,this.init(),this},Store:function(e){return this.audioBlob=e.audioBlob,this.videoBlob=e.videoBlob,this.gifBlob=e.gifBlob,this.init(),this},onError:function(e){console.error(JSON.stringify(e,null,"\t"))},dataStoreName:"recordRTC",dbName:null};function E(e,i){if("undefined"==typeof GIFEncoder){var t=document.createElement("script");t.src="https://www.webrtc-experiment.com/gif-recorder.js",(document.body||document.documentElement).appendChild(t)}i=i||{};var o=babelHelpers.instanceof(e,CanvasRenderingContext2D)||babelHelpers.instanceof(e,HTMLCanvasElement);this.record=function(){"undefined"!=typeof GIFEncoder&&d?(o||(i.width||(i.width=s.offsetWidth||320),i.height||(i.height=s.offsetHeight||240),i.video||(i.video={width:i.width,height:i.height}),i.canvas||(i.canvas={width:i.width,height:i.height}),r.width=i.canvas.width||320,r.height=i.canvas.height||240,s.width=i.video.width||320,s.height=i.video.height||240),(u=new GIFEncoder).setRepeat(0),u.setDelay(i.frameRate||200),u.setQuality(i.quality||10),u.start(),"function"==typeof i.onGifRecordingStarted&&i.onGifRecordingStarted(),Date.now(),l=h(function e(t){if(!0!==f.clearedRecordedData){if(n)return setTimeout(function(){e(t)},100);l=h(e),void 0===babelHelpers.typeof(c)&&(c=t),t-c<90||(!o&&s.paused&&s.play(),o||a.drawImage(s,0,0,r.width,r.height),i.onGifPreview&&i.onGifPreview(r.toDataURL("image/png")),u.addFrame(a),c=t)}}),i.initCallback&&i.initCallback()):setTimeout(f.record,1e3)};var n=!(this.stop=function(e){e=e||function(){},l&&p(l),Date.now(),this.blob=new Blob([new Uint8Array(u.stream().bin)],{type:"image/gif"}),e(this.blob),u.stream().bin=[]});this.pause=function(){n=!0},this.resume=function(){n=!1},this.clearRecordedData=function(){f.clearedRecordedData=!0,u&&(u.stream().bin=[])},this.name="GifRecorder",this.toString=function(){return this.name};var r=document.createElement("canvas"),a=r.getContext("2d");o&&(babelHelpers.instanceof(e,CanvasRenderingContext2D)?r=(a=e).canvas:babelHelpers.instanceof(e,HTMLCanvasElement)&&(a=e.getContext("2d"),r=e));var d=!0;if(!o){var s=document.createElement("video");s.muted=!0,s.autoplay=!0,s.playsInline=!0,d=!1,s.onloadedmetadata=function(){d=!0},R(e,s),s.play()}var c,u,l=null,f=this}function I(n,r){r=r||"multi-streams-mixer";var a=[],d=!1,s=document.createElement("canvas"),c=s.getContext("2d");s.style.opacity=0,s.style.position="absolute",s.style.zIndex=-1,s.style.top="-1000em",s.style.left="-1000em",s.className=r,(document.body||document.documentElement).appendChild(s),this.disableLogs=!1,this.frameInterval=10,this.width=360,this.height=240,this.useGainNode=!0;var u=this,e=window.AudioContext;void 0===e&&("undefined"!=typeof webkitAudioContext&&(e=webkitAudioContext),"undefined"!=typeof mozAudioContext&&(e=mozAudioContext));var t=window.URL;void 0===t&&"undefined"!=typeof webkitURL&&(t=webkitURL),"undefined"!=typeof navigator&&void 0===navigator.getUserMedia&&(void 0!==navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),void 0!==navigator.mozGetUserMedia&&(navigator.getUserMedia=navigator.mozGetUserMedia));var l=window.MediaStream;void 0===l&&"undefined"!=typeof webkitMediaStream&&(l=webkitMediaStream),void 0!==l&&void 0===l.prototype.stop&&(l.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})});var o={};function f(){if(!d){var e=a.length,t=!1,i=[];if(a.forEach(function(e){e.stream||(e.stream={}),e.stream.fullcanvas?t=e:i.push(e)}),t)s.width=t.stream.width,s.height=t.stream.height;else if(i.length){s.width=1<e?2*i[0].width:i[0].width;var o=1;3!==e&&4!==e||(o=2),5!==e&&6!==e||(o=3),7!==e&&8!==e||(o=4),9!==e&&10!==e||(o=5),s.height=i[0].height*o}else s.width=u.width||360,s.height=u.height||240;t&&babelHelpers.instanceof(t,HTMLVideoElement)&&h(t),i.forEach(function(e,t){h(e,t)}),setTimeout(f,u.frameInterval)}}function h(e,t){if(!d){var i=0,o=0,n=e.width,r=e.height;1===t&&(i=e.width),2===t&&(o=e.height),3===t&&(i=e.width,o=e.height),4===t&&(o=2*e.height),5===t&&(i=e.width,o=2*e.height),6===t&&(o=3*e.height),7===t&&(i=e.width,o=3*e.height),void 0!==e.stream.left&&(i=e.stream.left),void 0!==e.stream.top&&(o=e.stream.top),void 0!==e.stream.width&&(n=e.stream.width),void 0!==e.stream.height&&(r=e.stream.height),c.drawImage(e,i,o,n,r),"function"==typeof e.stream.onRender&&e.stream.onRender(c,i,o,n,r,t)}}function m(e){var t,i,o=document.createElement("video");return t=e,"srcObject"in(i=o)?i.srcObject=t:"mozSrcObject"in i?i.mozSrcObject=t:i.srcObject=t,o.className=r,o.muted=!0,o.volume=0,o.width=e.width||u.width||360,o.height=e.height||u.height||240,o.play(),o}function i(e){a=[],(e=e||n).forEach(function(e){if(e.getTracks().filter(function(e){return"video"===e.kind}).length){var t=m(e);t.stream=e,a.push(t)}})}void 0!==e?o.AudioContext=e:"undefined"!=typeof webkitAudioContext&&(o.AudioContext=webkitAudioContext),this.startDrawingFrames=function(){f()},this.appendStreams=function(e){if(!e)throw"First parameter is required.";babelHelpers.instanceof(e,Array)||(e=[e]),e.forEach(function(e){var t=new l;if(e.getTracks().filter(function(e){return"video"===e.kind}).length){var i=m(e);i.stream=e,a.push(i),t.addTrack(e.getTracks().filter(function(e){return"video"===e.kind})[0])}if(e.getTracks().filter(function(e){return"audio"===e.kind}).length){var o=u.audioContext.createMediaStreamSource(e);u.audioDestination=u.audioContext.createMediaStreamDestination(),o.connect(u.audioDestination),t.addTrack(u.audioDestination.stream.getTracks().filter(function(e){return"audio"===e.kind})[0])}n.push(t)})},this.releaseStreams=function(){a=[],d=!0,u.gainNode&&(u.gainNode.disconnect(),u.gainNode=null),u.audioSources.length&&(u.audioSources.forEach(function(e){e.disconnect()}),u.audioSources=[]),u.audioDestination&&(u.audioDestination.disconnect(),u.audioDestination=null),u.audioContext&&u.audioContext.close(),u.audioContext=null,c.clearRect(0,0,s.width,s.height),s.stream&&(s.stream.stop(),s.stream=null)},this.resetVideoStreams=function(e){e&&!babelHelpers.instanceof(e,Array)&&(e=[e]),i(e)},this.name="MultiStreamsMixer",this.toString=function(){return this.name},this.getMixedStream=function(){d=!1;var t=function(){var e;i(),"captureStream"in s?e=s.captureStream():"mozCaptureStream"in s?e=s.mozCaptureStream():u.disableLogs||console.error("Upgrade to latest Chrome or otherwise enable this flag: chrome://flags/#enable-experimental-web-platform-features");var t=new l;return e.getTracks().filter(function(e){return"video"===e.kind}).forEach(function(e){t.addTrack(e)}),s.stream=t}(),e=function(){o.AudioContextConstructor||(o.AudioContextConstructor=new o.AudioContext);u.audioContext=o.AudioContextConstructor,u.audioSources=[],!0===u.useGainNode&&(u.gainNode=u.audioContext.createGain(),u.gainNode.connect(u.audioContext.destination),u.gainNode.gain.value=0);var i=0;return n.forEach(function(e){if(e.getTracks().filter(function(e){return"audio"===e.kind}).length){i++;var t=u.audioContext.createMediaStreamSource(e);!0===u.useGainNode&&t.connect(u.gainNode),u.audioSources.push(t)}}),i?(u.audioDestination=u.audioContext.createMediaStreamDestination(),u.audioSources.forEach(function(e){e.connect(u.audioDestination)}),u.audioDestination.stream):void 0}();return e&&e.getTracks().filter(function(e){return"audio"===e.kind}).forEach(function(e){t.addTrack(e)}),n.forEach(function(e){e.fullcanvas&&!0}),t}}function j(i,o){i=i||[];var n,r,a=this;(o=o||{elementClass:"multi-streams-mixer",mimeType:"video/webm",video:{width:360,height:240}}).frameInterval||(o.frameInterval=10),o.video||(o.video={}),o.video.width||(o.video.width=360),o.video.height||(o.video.height=240),this.record=function(){var t;n=new I(i,o.elementClass||"multi-streams-mixer"),(t=[],i.forEach(function(e){C(e,"video").forEach(function(e){t.push(e)})}),t).length&&(n.frameInterval=o.frameInterval||10,n.width=o.video.width||360,n.height=o.video.height||240,n.startDrawingFrames()),o.previewStream&&"function"==typeof o.previewStream&&o.previewStream(n.getMixedStream()),(r=new L(n.getMixedStream(),o)).record()},this.stop=function(t){r&&r.stop(function(e){a.blob=e,t(e),a.clearRecordedData()})},this.pause=function(){r&&r.pause()},this.resume=function(){r&&r.resume()},this.clearRecordedData=function(){r&&(r.clearRecordedData(),r=null),n&&(n.releaseStreams(),n=null)},this.addStreams=function(e){if(!e)throw"First parameter is required.";babelHelpers.instanceof(e,Array)||(e=[e]),i.concat(e),r&&n&&(n.appendStreams(e),o.previewStream&&"function"==typeof o.previewStream&&o.previewStream(n.getMixedStream()))},this.resetVideoStreams=function(e){n&&(e&&!babelHelpers.instanceof(e,Array)&&(e=[e]),n.resetVideoStreams(e))},this.getMixer=function(){return n},this.name="MultiStreamRecorder",this.toString=function(){return this.name}}function F(d,s){var c,o,n;function r(t,e){if(!s.workerPath&&!e)return c=!1,void fetch("https://unpkg.com/webm-wasm@latest/dist/webm-worker.js").then(function(e){e.arrayBuffer().then(function(e){r(t,e)})});if(!s.workerPath&&babelHelpers.instanceof(e,ArrayBuffer)){var i=new Blob([e],{type:"text/javascript"});s.workerPath=k.createObjectURL(i)}s.workerPath||console.error("workerPath parameter is missing."),(o=new Worker(s.workerPath)).postMessage(s.webAssemblyPath||"https://unpkg.com/webm-wasm@latest/dist/webm-wasm.wasm"),o.addEventListener("message",function(e){"READY"===e.data?(o.postMessage({width:s.width,height:s.height,bitrate:s.bitrate||1200,timebaseDen:s.frameRate||30,realtime:s.realtime}),new ReadableStream({start:function(o){var n=document.createElement("canvas"),r=document.createElement("video"),a=!0;r.srcObject=d,r.muted=!0,r.height=s.height,r.width=s.width,r.volume=0,r.onplaying=function(){n.width=s.width,n.height=s.height;var e=n.getContext("2d"),t=1e3/s.frameRate,i=setInterval(function(){if(c&&(clearInterval(i),o.close()),a&&(a=!1,s.onVideoProcessStarted&&s.onVideoProcessStarted()),e.drawImage(r,0,0),"closed"!==o._controlledReadableStream.state)try{o.enqueue(e.getImageData(0,0,s.width,s.height))}catch(e){}},t)},r.play()}}).pipeTo(new WritableStream({write:function(e){c?console.error("Got image, but recorder is finished!"):o.postMessage(e.data.buffer,[e.data.buffer])}}))):e.data&&(n||a.push(e.data))})}"undefined"!=typeof ReadableStream&&"undefined"!=typeof WritableStream||console.error("Following polyfill is strongly recommended: https://unpkg.com/@mattiasbuelens/web-streams-polyfill/dist/polyfill.min.js"),(s=s||{}).width=s.width||640,s.height=s.height||480,s.frameRate=s.frameRate||30,s.bitrate=s.bitrate||1200,s.realtime=s.realtime||!0,this.record=function(){n=!(a=[]),this.blob=null,r(d),"function"==typeof s.initCallback&&s.initCallback()},this.pause=function(){n=!0},this.resume=function(){n=!1};var a=[];this.stop=function(e){c=!0;var t,i=this;t=function(){i.blob=new Blob(a,{type:"video/webm"}),e(i.blob)},o?(o.addEventListener("message",function(e){null===e.data&&(o.terminate(),o=null,t&&t())}),o.postMessage(null)):t&&t()},this.name="WebAssemblyRecorder",this.toString=function(){return this.name},this.clearRecordedData=function(){n=!(a=[]),this.blob=null},this.blob=null}void 0!==T&&(T.DiskStorage=O),void 0!==T&&(T.GifRecorder=E),void 0===T&&(P.exports=I,void 0===(i=function(){return I}.apply(z,[]))||(P.exports=i)),void 0!==T&&(T.MultiStreamRecorder=j),void 0!==T&&(T.RecordRTCPromisesHandler=function(e,t){if(!this)throw'Use "new RecordRTCPromisesHandler()"';if(void 0===e)throw'First argument "MediaStream" is required.';var o=this;o.recordRTC=new T(e,t),this.startRecording=function(){return new Promise(function(e,t){try{o.recordRTC.startRecording(),e()}catch(e){t(e)}})},this.stopRecording=function(){return new Promise(function(t,i){try{o.recordRTC.stopRecording(function(e){o.blob=o.recordRTC.getBlob(),o.blob&&o.blob.size?t(e):i("Empty blob.",o.blob)})}catch(e){i(e)}})},this.pauseRecording=function(){return new Promise(function(e,t){try{o.recordRTC.pauseRecording(),e()}catch(e){t(e)}})},this.resumeRecording=function(){return new Promise(function(e,t){try{o.recordRTC.resumeRecording(),e()}catch(e){t(e)}})},this.getDataURL=function(e){return new Promise(function(t,i){try{o.recordRTC.getDataURL(function(e){t(e)})}catch(e){i(e)}})},this.getBlob=function(){return new Promise(function(e,t){try{e(o.recordRTC.getBlob())}catch(e){t(e)}})},this.getInternalRecorder=function(){return new Promise(function(e,t){try{e(o.recordRTC.getInternalRecorder())}catch(e){t(e)}})},this.reset=function(){return new Promise(function(e,t){try{e(o.recordRTC.reset())}catch(e){t(e)}})},this.destroy=function(){return new Promise(function(e,t){try{e(o.recordRTC.destroy())}catch(e){t(e)}})},this.getState=function(){return new Promise(function(e,t){try{e(o.recordRTC.getState())}catch(e){t(e)}})},this.blob=null,this.version="5.6.1"}),void 0!==T&&(T.WebAssemblyRecorder=F)}).call(this,e(1),e(2))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"===("undefined"==typeof window?"undefined":babelHelpers.typeof(window))&&(i=window)}e.exports=i},function(e,t){var i,o,n=e.exports={};function r(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function d(t){if(i===setTimeout)return setTimeout(t,0);if((i===r||!i)&&setTimeout)return i=setTimeout,setTimeout(t,0);try{return i(t,0)}catch(e){try{return i.call(null,t,0)}catch(e){return i.call(this,t,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:r}catch(e){i=r}try{o="function"==typeof clearTimeout?clearTimeout:a}catch(e){o=a}}();var s,c=[],u=!1,l=-1;function f(){u&&s&&(u=!1,s.length?c=s.concat(c):l=-1,c.length&&h())}function h(){if(!u){var e=d(f);u=!0;for(var t=c.length;t;){for(s=c,c=[];++l<t;)s&&s[l].run();l=-1,t=c.length}s=null,u=!1,function(t){if(o===clearTimeout)return clearTimeout(t);if((o===a||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{o(t)}catch(e){try{return o.call(null,t)}catch(e){return o.call(this,t)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function g(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];c.push(new m(e,t)),1!==c.length||u||d(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}}],n.c=o,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===babelHelpers.typeof(t)&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0);function n(e){if(o[e])return o[e].exports;var t=o[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,o})</script><script>!function(e,t){"object"==("undefined"==typeof exports?"undefined":babelHelpers.typeof(exports))&&"object"==("undefined"==typeof module?"undefined":babelHelpers.typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define("WaveSurfer",[],t):"object"==("undefined"==typeof exports?"undefined":babelHelpers.typeof(exports))?exports.WaveSurfer=t():e.WaveSurfer=t()}(window,function(){return n={},i.m=r=[function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ajax",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"getId",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"max",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"min",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(t,"Observer",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"extend",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(t,"style",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(t,"requestAnimationFrame",{enumerable:!0,get:function(){return c.default}}),Object.defineProperty(t,"frame",{enumerable:!0,get:function(){return h.default}}),Object.defineProperty(t,"debounce",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(t,"preventClick",{enumerable:!0,get:function(){return d.default}});var n=p(r(5)),i=p(r(6)),a=p(r(7)),s=p(r(8)),o=p(r(1)),u=p(r(9)),l=p(r(10)),c=p(r(2)),h=p(r(11)),f=p(r(12)),d=p(r(13));function p(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";function n(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=(n(a.prototype,[{key:"on",value:function(e,t){var r=this;this.handlers||(this.handlers={});var n=this.handlers[e];return(n=n||(this.handlers[e]=[])).push(t),{name:e,callback:t,un:function(e,t){return r.un(e,t)}}}},{key:"un",value:function(e,t){if(this.handlers){var r,n=this.handlers[e];if(n)if(t)for(r=n.length-1;0<=r;r--)n[r]==t&&n.splice(r,1);else n.length=0}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(i,a){var s=this;return this.on(i,function e(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];a.apply(s,r),setTimeout(function(){s.un(i,e)},0)})}},{key:"fireEvent",value:function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(this.handlers){var i=this.handlers[e];i&&i.forEach(function(e){e.apply(void 0,r)})}}}]),a);function a(){!function(e,t){if(!babelHelpers.instanceof(e,t))throw new TypeError("Cannot call a class as a function")}(this,a),this.handlers=null}t.default=i,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){return setTimeout(e,1e3/60)}).bind(window);t.default=n,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(0));function s(e){return(s="function"==typeof Symbol&&"symbol"==babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)})(e)}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c="playing",h="paused",f="finished",d=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(p,n.Observer),a(p,[{key:"supportsWebAudio",value:function(){return!(!window.AudioContext&&!window.webkitAudioContext)}},{key:"getAudioContext",value:function(){return window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(e){return window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,e)),window.WaveSurferOfflineAudioContext}}]),a(p,[{key:"init",value:function(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(h),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach(function(e){e&&e.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))}},{key:"setState",value:function(e){this.state!==this.states[e]&&(this.state=this.states[e],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.setFilters(t)}},{key:"setFilters",value:function(e){this.disconnectFilters(),e&&e.length&&(this.filters=e,this.analyser.disconnect(),e.reduce(function(e,t){return e.connect(t),t},this.analyser).connect(this.gainNode))}},{key:"createScriptNode",value:function(){this.params.audioScriptProcessor?this.scriptNode=this.params.audioScriptProcessor:this.ac.createScriptProcessor?this.scriptNode=this.ac.createScriptProcessor(p.scriptBufferSize):this.scriptNode=this.ac.createJavaScriptNode(p.scriptBufferSize),this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function(){var t=this;this.scriptNode.onaudioprocess=function(){var e=t.getCurrentTime();e>=t.getDuration()?(t.setState(f),t.fireEvent("pause")):e>=t.scheduledPause?t.pause():t.state===t.states[c]&&t.fireEvent("audioprocess",e)}}},{key:"removeOnAudioProcess",value:function(){this.scriptNode.onaudioprocess=null}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){this.ac.createGain?this.gainNode=this.ac.createGain():this.gainNode=this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(e){if(e){var t=new window.Audio;if(!t.setSinkId)return Promise.reject(new Error("setSinkId is not supported in your browser"));t.autoplay=!0;var r=this.ac.createMediaStreamDestination();return this.gainNode.disconnect(),this.gainNode.connect(r),t.srcObject=r.stream,t.setSinkId(e)}return Promise.reject(new Error("Invalid deviceId: "+e))}},{key:"setVolume",value:function(e){this.gainNode.gain.setValueAtTime(e,this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(e,t,r){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(e,function(e){return t(e)},r)}},{key:"setPeaks",value:function(e,t){this.explicitDuration=t,this.peaks=e}},{key:"setLength",value:function(e){if(!this.mergedPeaks||e!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[],this.mergedPeaks=[];var t,r=this.buffer?this.buffer.numberOfChannels:1;for(t=0;t<r;t++)this.splitPeaks[t]=[],this.splitPeaks[t][2*(e-1)]=0,this.splitPeaks[t][2*(e-1)+1]=0;this.mergedPeaks[2*(e-1)]=0,this.mergedPeaks[2*(e-1)+1]=0}}},{key:"getPeaks",value:function(e,t,r){if(this.peaks)return this.peaks;if(t=t||0,r=r||e-1,this.setLength(e),!this.buffer.length){var n=this.createBuffer(1,4096,this.sampleRate);this.buffer=n.buffer}var i,a=this.buffer.length/e,s=~~(a/10)||1,o=this.buffer.numberOfChannels;for(i=0;i<o;i++){var u=this.splitPeaks[i],l=this.buffer.getChannelData(i),c=void 0;for(c=t;c<=r;c++){var h=~~(c*a),f=~~(h+a),d=0,p=0,v=void 0;for(v=h;v<f;v+=s){var y=l[v];p<y&&(p=y),y<d&&(d=y)}u[2*c]=p,u[2*c+1]=d,(0==i||p>this.mergedPeaks[2*c])&&(this.mergedPeaks[2*c]=p),(0==i||d<this.mergedPeaks[2*c+1])&&(this.mergedPeaks[2*c+1]=d)}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroy",value:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"==typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null)}},{key:"load",value:function(e){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=e,this.createSource()}},{key:"createSource",value:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime),this.source.buffer=this.buffer,this.source.connect(this.analyser)}},{key:"isPaused",value:function(){return this.state!==this.states[c]}},{key:"getDuration",value:function(){return this.buffer?this.buffer.duration:this.explicitDuration?this.explicitDuration:0}},{key:"seekTo",value:function(e,t){if(this.buffer)return(this.scheduledPause=null)==e&&(e=this.getCurrentTime())>=this.getDuration()&&(e=0),null==t&&(t=this.getDuration()),this.startPosition=e,this.lastPlay=this.ac.currentTime,this.state===this.states[f]&&this.setState(h),{start:e,end:t}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(e,t){if(this.buffer){this.createSource();var r=this.seekTo(e,t);e=r.start,t=r.end,this.scheduledPause=t,this.source.start(0,e,t-e),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(c),this.fireEvent("play")}}},{key:"pause",value:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(h),this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(e){e=e||1,this.isPaused()?this.playbackRate=e:(this.pause(),this.playbackRate=e,this.play())}}]),p);function p(e){var t,r,n,i,a;return function(e,t){if(!babelHelpers.instanceof(e,t))throw new TypeError("Cannot call a class as a function")}(this,p),(i=this,n=!(a=u(p).call(this))||"object"!==s(a)&&"function"!=typeof a?function(){if(void 0!==i)return i;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():a).audioContext=null,n.offlineAudioContext=null,n.stateBehaviors=(o(t={},c,{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),o(t,h,{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var e=this.getDuration();return this.getCurrentTime()/e||0},getCurrentTime:function(){return this.startPosition}}),o(t,f,{init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),t),n.params=e,n.ac=e.audioContext||n.getAudioContext(),n.lastPlay=n.ac.currentTime,n.startPosition=0,n.scheduledPause=null,n.states=(o(r={},c,Object.create(n.stateBehaviors[c])),o(r,h,Object.create(n.stateBehaviors[h])),o(r,f,Object.create(n.stateBehaviors[f])),r),n.analyser=null,n.buffer=null,n.filters=[],n.gainNode=null,n.mergedPeaks=null,n.offlineAc=null,n.peaks=null,n.playbackRate=1,n.analyser=null,n.scriptNode=null,n.source=null,n.splitPeaks=[],n.state=null,n.explicitDuration=null,n}(t.default=d).scriptBufferSize=256,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(0)),n=u(r(14)),a=u(r(3)),s=u(r(16)),o=u(r(17));function u(e){return e&&e.__esModule?e:{default:e}}function l(e){return(l="function"==typeof Symbol&&"symbol"==babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)})(e)}function c(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?d(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function v(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),e}var y=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(m,i.Observer),v(m,null,[{key:"create",value:function(e){return new m(e).init()}}]),v(m,[{key:"init",value:function(){return this.registerPlugins(this.params.plugins),this.createDrawer(),this.createBackend(),this.createPeakCache(),this}},{key:"registerPlugins",value:function(e){var t=this;return e.forEach(function(e){return t.addPlugin(e)}),e.forEach(function(e){e.deferInit||t.initPlugin(e.name)}),this.fireEvent("plugins-registered",e),this}},{key:"addPlugin",value:function(t){var r=this;if(!t.name)throw new Error("Plugin does not have a name!");if(!t.instance)throw new Error("Plugin ".concat(t.name," does not have an instance property!"));t.staticProps&&Object.keys(t.staticProps).forEach(function(e){r[e]=t.staticProps[e]});var n=t.instance;return Object.getOwnPropertyNames(i.Observer.prototype).forEach(function(e){n.prototype[e]=i.Observer.prototype[e]}),this[t.name]=new n(t.params||{},this),this.fireEvent("plugin-added",t.name),this}},{key:"initPlugin",value:function(e){if(!this[e])throw new Error("Plugin ".concat(e," has not been added yet!"));return this.initialisedPluginList[e]&&this.destroyPlugin(e),this[e].init(),this.initialisedPluginList[e]=!0,this.fireEvent("plugin-initialised",e),this}},{key:"destroyPlugin",value:function(e){if(!this[e])throw new Error("Plugin ".concat(e," has not been added yet and cannot be destroyed!"));if(!this.initialisedPluginList[e])throw new Error("Plugin ".concat(e," is not active and cannot be destroyed!"));if("function"!=typeof this[e].destroy)throw new Error("Plugin ".concat(e," does not have a destroy function!"));return this[e].destroy(),delete this.initialisedPluginList[e],this.fireEvent("plugin-destroyed",e),this}},{key:"destroyAllPlugins",value:function(){var t=this;Object.keys(this.initialisedPluginList).forEach(function(e){return t.destroyPlugin(e)})}},{key:"createDrawer",value:function(){var r=this;this.drawer=new this.Drawer(this.container,this.params),this.drawer.init(),this.fireEvent("drawer-created",this.drawer),!1!==this.params.responsive&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0)),this.drawer.on("redraw",function(){r.drawBuffer(),r.drawer.progress(r.backend.getPlayedPercents())}),this.drawer.on("click",function(e,t){setTimeout(function(){return r.seekTo(t)},0)}),this.drawer.on("scroll",function(e){r.params.partialRender&&r.drawBuffer(),r.fireEvent("scroll",e)})}},{key:"createBackend",value:function(){var t=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||this.Backend.prototype.supportsWebAudio.call(null)||(this.params.backend="MediaElement"),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",function(){t.drawer.progress(t.backend.getPlayedPercents()),t.fireEvent("finish")}),this.backend.on("play",function(){return t.fireEvent("play")}),this.backend.on("pause",function(){return t.fireEvent("pause")}),this.backend.on("audioprocess",function(e){t.drawer.progress(t.backend.getPlayedPercents()),t.fireEvent("audioprocess",e)})}},{key:"createPeakCache",value:function(){this.params.partialRender&&(this.peakCache=new o.default)}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(e){e>=this.getDuration()?this.seekTo(1):this.seekTo(e/this.getDuration())}},{key:"play",value:function(e,t){var r=this;return this.fireEvent("interaction",function(){return r.play(e,t)}),this.backend.play(e,t)}},{key:"pause",value:function(){if(!this.backend.isPaused())return this.backend.pause()}},{key:"playPause",value:function(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(e){this.skip(-e||-this.params.skipLength)}},{key:"skipForward",value:function(e){this.skip(e||this.params.skipLength)}},{key:"skip",value:function(e){var t=this.getDuration()||1,r=this.getCurrentTime()||0;r=Math.max(0,Math.min(t,r+(e||0))),this.seekAndCenter(r/t)}},{key:"seekAndCenter",value:function(e){this.seekTo(e),this.drawer.recenter(e)}},{key:"seekTo",value:function(e){var t=this;if("number"!=typeof e||!isFinite(e)||e<0||1<e)return console.error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.fireEvent("interaction",function(){return t.seekTo(e)});var r=this.backend.isPaused();r||this.backend.pause();var n=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(e*this.getDuration()),this.drawer.progress(e),r||this.backend.play(),this.params.scrollParent=n,this.fireEvent("seek",e)}},{key:"stop",value:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)}},{key:"setSinkId",value:function(e){return this.backend.setSinkId(e)}},{key:"setVolume",value:function(e){this.backend.setVolume(e),this.fireEvent("volume",e)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(e){this.backend.setPlaybackRate(e)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(e){e!==this.isMuted&&(e?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume))),this.fireEvent("mute",this.isMuted)}},{key:"getMute",value:function(){return this.isMuted}},{key:"isReady",value:function(){return this.isReady}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){return this.params.waveColor}},{key:"setWaveColor",value:function(e){this.params.waveColor=e,this.drawBuffer()}},{key:"getProgressColor",value:function(){return this.params.progressColor}},{key:"setProgressColor",value:function(e){this.params.progressColor=e,this.drawBuffer()}},{key:"getCursorColor",value:function(){return this.params.cursorColor}},{key:"setCursorColor",value:function(e){this.params.cursorColor=e,this.drawer.updateCursor()}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(e){this.params.height=e,this.drawer.setHeight(e*this.params.pixelRatio),this.drawBuffer()}},{key:"drawBuffer",value:function(){var e,t=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),r=this.drawer.getWidth(),n=t,i=this.drawer.getScrollX(),a=Math.max(i+r,n);if(this.params.fillParent&&(!this.params.scrollParent||t<r)&&(i=0,a=n=r),this.params.partialRender){var s,o=this.peakCache.addRangeToPeakCache(n,i,a);for(s=0;s<o.length;s++)e=this.backend.getPeaks(n,o[s][0],o[s][1]),this.drawer.drawPeaks(e,n,o[s][0],o[s][1])}else e=this.backend.getPeaks(n,i,a),this.drawer.drawPeaks(e,n,i,a);this.fireEvent("redraw",e,n)}},{key:"zoom",value:function(e){this.params.scrollParent=e?(this.params.minPxPerSec=e,!0):(this.params.minPxPerSec=this.defaultParams.minPxPerSec,!1),this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",e)}},{key:"loadArrayBuffer",value:function(e){var t=this;this.decodeArrayBuffer(e,function(e){t.isDestroyed||t.loadDecodedBuffer(e)})}},{key:"loadDecodedBuffer",value:function(e){this.backend.load(e),this.drawBuffer(),this.fireEvent("ready"),this.isReady=!0}},{key:"loadBlob",value:function(e){var t=this,r=new FileReader;r.addEventListener("progress",function(e){return t.onProgress(e)}),r.addEventListener("load",function(e){return t.loadArrayBuffer(e.target.result)}),r.addEventListener("error",function(){return t.fireEvent("error","Error reading file")}),r.readAsArrayBuffer(e),this.empty()}},{key:"load",value:function(e,t,r,n){if(this.empty(),r){var i={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(r),"Peaks are not provided":!t,"Backend is not of type MediaElement":"MediaElement"!==this.params.backend,"Url is not of type string":"string"!=typeof e},a=Object.keys(i).filter(function(e){return i[e]});a.length&&(console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+a.join("\n\t- ")),r=null)}switch(this.params.backend){case"WebAudio":return this.loadBuffer(e,t,n);case"MediaElement":return this.loadMediaElement(e,t,r,n)}}},{key:"loadBuffer",value:function(t,e,r){function n(e){return e&&i.tmpEvents.push(i.once("ready",e)),i.getArrayBuffer(t,function(e){return i.loadArrayBuffer(e)})}var i=this;if(!e)return n();this.backend.setPeaks(e,r),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",n))}},{key:"loadMediaElement",value:function(e,t,r,n){var i=this,a=e;if("string"==typeof e)this.backend.load(a,this.mediaContainer,t,r);else{var s=e;this.backend.loadElt(s,t),a=s.src}this.tmpEvents.push(this.backend.once("canplay",function(){i.drawBuffer(),i.fireEvent("ready"),i.isReady=!0}),this.backend.once("error",function(e){return i.fireEvent("error",e)})),t&&this.backend.setPeaks(t,n),t&&!this.params.forceDecode||!this.backend.supportsWebAudio()||this.getArrayBuffer(a,function(e){i.decodeArrayBuffer(e,function(e){i.backend.buffer=e,i.backend.setPeaks(null),i.drawBuffer(),i.fireEvent("waveform-ready")})})}},{key:"decodeArrayBuffer",value:function(t,r){var n=this;this.arraybuffer=t,this.backend.decodeArrayBuffer(t,function(e){n.isDestroyed||n.arraybuffer!=t||(r(e),n.arraybuffer=null)},function(){return n.fireEvent("error","Error decoding audiobuffer")})}},{key:"getArrayBuffer",value:function(e,r){var n=this,t=i.ajax({url:e,responseType:"arraybuffer",xhr:this.params.xhr});return this.currentAjax=t,this.tmpEvents.push(t.on("progress",function(e){n.onProgress(e)}),t.on("success",function(e,t){r(e),n.currentAjax=null}),t.on("error",function(e){n.fireEvent("error","XHR error: "+e.target.statusText),n.currentAjax=null})),t}},{key:"onProgress",value:function(e){var t;t=e.lengthComputable?e.loaded/e.total:e.loaded/(e.loaded+1e6),this.fireEvent("loading",Math.round(100*t),e.target)}},{key:"exportPCM",value:function(e,t,r,n){e=e||1024,n=n||0,t=t||1e4,r=r||!1;var i=this.backend.getPeaks(e,n),a=[].map.call(i,function(e){return Math.round(e*t)/t}),s=JSON.stringify(a);return r||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(s)),s}},{key:"exportImage",value:function(e,t){return e=e||"image/png",t=t||1,this.drawer.getImage(e,t)}},{key:"cancelAjax",value:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach(function(e){return e.un()})}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.isReady=!1,this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function(){this.destroyAllPlugins(),this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),!1!==this.params.responsive&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0)),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0,this.isReady=!1,this.arraybuffer=null}}]),m);function m(e){var t;if(function(e,t){if(!babelHelpers.instanceof(e,t))throw new TypeError("Cannot call a class as a function")}(this,m),(t=c(this,h(m).call(this))).defaultParams={audioContext:null,audioScriptProcessor:null,audioRate:1,autoCenter:!0,backend:"WebAudio",barHeight:1,barGap:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:n.default,responsive:!1,scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999",xhr:{}},t.backends={MediaElement:s.default,WebAudio:a.default},t.util=i,t.params=i.extend({},t.defaultParams,e),t.container="string"==typeof e.container?document.querySelector(t.params.container):t.params.container,!t.container)throw new Error("Container element not found");if(null==t.params.mediaContainer?t.mediaContainer=t.container:"string"==typeof t.params.mediaContainer?t.mediaContainer=document.querySelector(t.params.mediaContainer):t.mediaContainer=t.params.mediaContainer,!t.mediaContainer)throw new Error("Media Container element not found");if(t.params.maxCanvasWidth<=1)throw new Error("maxCanvasWidth must be greater than 1");if(1==t.params.maxCanvasWidth%2)throw new Error("maxCanvasWidth must be an even number");if(t.savedVolume=0,t.isMuted=!1,t.tmpEvents=[],t.currentAjax=null,t.arraybuffer=null,t.drawer=null,t.backend=null,t.peakCache=null,"function"!=typeof t.params.renderer)throw new Error("Renderer parameter is invalid");t.Drawer=t.params.renderer,t.Backend=t.backends[t.params.backend],t.initialisedPluginList={},t.isDestroyed=!1,t.isReady=!1;var r=0;return t._onResize=i.debounce(function(){r==t.drawer.wrapper.clientWidth||t.params.scrollParent||(r=t.drawer.wrapper.clientWidth,t.drawer.fireEvent("redraw"))},"number"==typeof t.params.responsive?t.params.responsive:100),c(t,d(d(t)))}(t.default=y).VERSION="2.1.1",y.util=i,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=new i.default,r=new XMLHttpRequest,n=!1;return r.open(e.method||"GET",e.url,!0),r.responseType=e.responseType||"json",e.xhr&&(e.xhr.requestHeaders&&e.xhr.requestHeaders.forEach(function(e){r.setRequestHeader(e.key,e.value)}),e.xhr.withCredentials&&(r.withCredentials=!0)),r.addEventListener("progress",function(e){t.fireEvent("progress",e),e.lengthComputable&&e.loaded==e.total&&(n=!0)}),r.addEventListener("load",function(e){n||t.fireEvent("progress",e),t.fireEvent("load",e),200==r.status||206==r.status?t.fireEvent("success",r.response,e):t.fireEvent("error",e)}),r.addEventListener("error",function(e){return t.fireEvent("error",e)}),r.send(),t.xhr=r,t};var n,i=(n=r(1))&&n.__esModule?n:{default:n};e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var r=-1/0;return Object.keys(t).forEach(function(e){t[e]>r&&(r=t[e])}),r},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t){var r=1/0;return Object.keys(t).forEach(function(e){t[e]<r&&(r=t[e])}),r},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){for(var e=arguments.length,t=Array(1<e?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return t.forEach(function(t){Object.keys(t).forEach(function(e){r[e]=t[e]})}),r},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(t,r){return Object.keys(r).forEach(function(e){t.style[e]!==r[e]&&(t.style[e]=r[e])}),t},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(n){return function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,i.default)(function(){return n.apply(void 0,t)})}};var n,i=(n=r(2))&&n.__esModule?n:{default:n};e.exports=t.default},function(e,t){function r(t,r,n){var i,a,s,o,u;function l(){var e=Date.now()-o;e<r&&0<=e?i=setTimeout(l,r-e):(i=null,n||(u=t.apply(s,a),s=a=null))}null==r&&(r=100);function e(){s=this,a=arguments,o=Date.now();var e=n&&!i;return i=i||setTimeout(l,r),e&&(u=t.apply(s,a),s=a=null),u}return e.clear=function(){i&&(clearTimeout(i),i=null)},e.flush=function(){i&&(u=t.apply(s,a),s=a=null,clearTimeout(i),i=null)},e}r.debounce=r,e.exports=r},function(e,t,r){"use strict";function n(e){e.stopPropagation(),document.body.removeEventListener("click",n,!0)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){document.body.addEventListener("click",n,!0)},e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=r(15))&&n.__esModule?n:{default:n},f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(0));function a(e){return(a="function"==typeof Symbol&&"symbol"==babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)})(e)}function s(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var l=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(c,i.default),s(c.prototype,[{key:"init",value:function(){this.createWrapper(),this.createElements()}},{key:"createElements",value:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"})),this.addCanvas(),this.updateCursor()}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function(){for(var n=this,e=Math.round(this.width/this.params.pixelRatio),t=Math.ceil(e/this.maxCanvasElementWidth);this.canvases.length<t;)this.addCanvas();for(;this.canvases.length>t;)this.removeCanvas();this.canvases.forEach(function(e,t){var r=n.maxCanvasWidth+2*Math.ceil(n.params.pixelRatio/2);t==n.canvases.length-1&&(r=n.width-n.maxCanvasWidth*(n.canvases.length-1)),n.updateDimensions(e,r,n.height),n.clearWaveForEntry(e)})}},{key:"addCanvas",value:function(){var e={},t=this.maxCanvasElementWidth*this.canvases.length;e.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:2,left:t+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"})),e.waveCtx=e.wave.getContext("2d"),this.hasProgressCanvas&&(e.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:t+"px",top:0,bottom:0,height:"100%"})),e.progressCtx=e.progress.getContext("2d")),this.canvases.push(e)}},{key:"removeCanvas",value:function(){var e=this.canvases.pop();e.wave.parentElement.removeChild(e.wave),this.hasProgressCanvas&&e.progress.parentElement.removeChild(e.progress)}},{key:"updateDimensions",value:function(e,t,r){var n=Math.round(t/this.params.pixelRatio),i=Math.round(this.width/this.params.pixelRatio);e.start=e.waveCtx.canvas.offsetLeft/i||0,e.end=e.start+n/i,e.waveCtx.canvas.width=t,e.waveCtx.canvas.height=r,this.style(e.waveCtx.canvas,{width:n+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(e.progressCtx.canvas.width=t,e.progressCtx.canvas.height=r,this.style(e.progressCtx.canvas,{width:n+"px"}))}},{key:"clearWave",value:function(){var t=this;this.canvases.forEach(function(e){return t.clearWaveForEntry(e)})}},{key:"clearWaveForEntry",value:function(e){e.waveCtx.clearRect(0,0,e.waveCtx.canvas.width,e.waveCtx.canvas.height),this.hasProgressCanvas&&e.progressCtx.clearRect(0,0,e.progressCtx.canvas.width,e.progressCtx.canvas.height)}},{key:"drawBars",value:function(e,t,v,y){var m=this;return this.prepareDraw(e,t,v,y,function(e){var t=e.absmax,r=e.hasMinVals,n=(e.height,e.offsetY),i=e.halfH,a=e.peaks;if(void 0!==v){var s,o=r?2:1,u=a.length/o,l=m.params.barWidth*m.params.pixelRatio,c=l+(null===m.params.barGap?Math.max(m.params.pixelRatio,~~(l/2)):Math.max(m.params.pixelRatio,m.params.barGap*m.params.pixelRatio)),h=u/m.width,f=y;for(s=v;s<f;s+=c){var d=a[Math.floor(s*h*o)]||0,p=Math.round(d/t*i);m.fillRect(s+m.halfPixel,i-p+n,l+m.halfPixel,2*p)}}})}},{key:"drawWave",value:function(e,t,l,c){var h=this;return this.prepareDraw(e,t,l,c,function(e){var t=e.absmax,r=e.hasMinVals,n=(e.height,e.offsetY),i=e.halfH,a=e.peaks;if(!r){var s,o=[],u=a.length;for(s=0;s<u;s++)o[2*s]=a[s],o[2*s+1]=-a[s];a=o}void 0!==l&&h.drawLine(a,t,i,n,l,c),h.fillRect(0,i+n-h.halfPixel,h.width,h.halfPixel)})}},{key:"drawLine",value:function(t,r,n,i,a,s){var o=this;this.canvases.forEach(function(e){o.setFillStyles(e),o.drawLineToContext(e,e.waveCtx,t,r,n,i,a,s),o.drawLineToContext(e,e.progressCtx,t,r,n,i,a,s)})}},{key:"drawLineToContext",value:function(e,t,r,n,i,a,s,o){if(t){var u=r.length/2,l=this.params.fillParent&&this.width!=u?this.width/u:1,c=Math.round(u*e.start),h=Math.round(u*e.end)+1;if(!(o<c||h<s)){var f,d,p=Math.min(c,s),v=Math.max(h,o);for(t.beginPath(),t.moveTo((p-c)*l+this.halfPixel,i+a),f=p;f<v;f++){var y=r[2*f]||0,m=Math.round(y/n*i);t.lineTo((f-c)*l+this.halfPixel,i-m+a)}for(d=v-1;p<=d;d--){var b=r[2*d+1]||0,g=Math.round(b/n*i);t.lineTo((d-c)*l+this.halfPixel,i-g+a)}t.closePath(),t.fill()}}}},{key:"fillRect",value:function(e,t,r,n){var i,a=Math.floor(e/this.maxCanvasWidth),s=Math.min(Math.ceil((e+r)/this.maxCanvasWidth)+1,this.canvases.length);for(i=a;i<s;i++){var o=this.canvases[i],u=i*this.maxCanvasWidth,l={x1:Math.max(e,i*this.maxCanvasWidth),y1:t,x2:Math.min(e+r,i*this.maxCanvasWidth+o.waveCtx.canvas.width),y2:t+n};l.x1<l.x2&&(this.setFillStyles(o),this.fillRectToContext(o.waveCtx,l.x1-u,l.y1,l.x2-l.x1,l.y2-l.y1),this.fillRectToContext(o.progressCtx,l.x1-u,l.y1,l.x2-l.x1,l.y2-l.y1))}}},{key:"prepareDraw",value:function(s,o,u,l,c){var h=this;return f.frame(function(){if(babelHelpers.instanceof(s[0],Array)){var e=s;if(h.params.splitChannels)return h.setHeight(e.length*h.params.height*h.params.pixelRatio),e.forEach(function(e,t){return h.prepareDraw(e,t,u,l,c)});s=e[0]}var t=1/h.params.barHeight;if(h.params.normalize){var r=f.max(s),n=f.min(s);t=r<-n?-n:r}var i=[].some.call(s,function(e){return e<0}),a=h.params.height*h.params.pixelRatio;return c({absmax:t,hasMinVals:i,height:a,offsetY:a*o||0,halfH:a/2,peaks:s})})()}},{key:"fillRectToContext",value:function(e,t,r,n,i){e&&e.fillRect(t,r,n,i)}},{key:"setFillStyles",value:function(e){e.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(e.progressCtx.fillStyle=this.params.progressColor)}},{key:"getImage",value:function(t,r){var e=this.canvases.map(function(e){return e.wave.toDataURL(t,r)});return 1<e.length?e:e[0]}},{key:"updateProgress",value:function(e){this.style(this.progressWave,{width:e+"px"})}}]),c);function c(e,t){var r,n,i;return function(e,t){if(!babelHelpers.instanceof(e,t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=this,r=!(i=o(c).call(this,e,t))||"object"!==a(i)&&"function"!=typeof i?function(){if(void 0!==n)return n;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():i).maxCanvasWidth=t.maxCanvasWidth,r.maxCanvasElementWidth=Math.round(t.maxCanvasWidth/t.pixelRatio),r.hasProgressCanvas=t.waveColor!=t.progressColor,r.halfPixel=.5/t.pixelRatio,r.canvases=[],r.progressWave=null,r}t.default=l,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}return t.default=e,t}(r(0));function a(e){return(a="function"==typeof Symbol&&"symbol"==babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)})(e)}function i(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(l,n.Observer),i(l.prototype,[{key:"style",value:function(e,t){return n.style(e,t)}},{key:"createWrapper",value:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()}},{key:"handleEvent",value:function(e,t){t||e.preventDefault();var r,n=e.targetTouches?e.targetTouches[0].clientX:e.clientX,i=this.wrapper.getBoundingClientRect(),a=this.width,s=this.getWidth();return!this.params.fillParent&&a<s?1<(r=(n-i.left)*(this.params.pixelRatio/a)||0)&&(r=1):r=(n-i.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,r}},{key:"setupWrapperEvents",value:function(){var n=this;this.wrapper.addEventListener("click",function(e){var t=n.wrapper.offsetHeight-n.wrapper.clientHeight;if(0!=t){var r=n.wrapper.getBoundingClientRect();if(e.clientY>=r.bottom-t)return}n.params.interact&&n.fireEvent("click",e,n.handleEvent(e))}),this.wrapper.addEventListener("scroll",function(e){return n.fireEvent("scroll",e)})}},{key:"drawPeaks",value:function(e,t,r,n){this.setWidth(t)||this.clearWave(),this.params.barWidth?this.drawBars(e,0,r,n):this.drawWave(e,0,r,n)}},{key:"resetScroll",value:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)}},{key:"recenter",value:function(e){var t=this.wrapper.scrollWidth*e;this.recenterOnPosition(t,!0)}},{key:"recenterOnPosition",value:function(e,t){var r=this.wrapper.scrollLeft,n=~~(this.wrapper.clientWidth/2),i=this.wrapper.scrollWidth-this.wrapper.clientWidth,a=e-n,s=a-r;0!=i&&(!t&&-n<=s&&s<n&&(a=r+(s=Math.max(-5,Math.min(5,s)))),(a=Math.max(0,Math.min(i,a)))!=r&&(this.wrapper.scrollLeft=a))}},{key:"getScrollX",value:function(){var e=this.params.pixelRatio,t=Math.round(this.wrapper.scrollLeft*e);if(this.params.scrollParent){var r=~~(this.wrapper.scrollWidth*e-this.getWidth());t=Math.min(r,Math.max(0,t))}return t}},{key:"getWidth",value:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function(e){return this.width!=e&&(this.width=e,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"setHeight",value:function(e){return e!=this.height&&(this.height=e,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"progress",value:function(e){var t=1/this.params.pixelRatio,r=Math.round(e*this.width)*t;if(r<this.lastPos||r-this.lastPos>=t){if(this.lastPos=r,this.params.scrollParent&&this.params.autoCenter){var n=~~(this.wrapper.scrollWidth*e);this.recenterOnPosition(n)}this.updateProgress(r)}}},{key:"destroy",value:function(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container&&this.container.removeChild(this.wrapper),this.wrapper=null)}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(){}},{key:"drawWave",value:function(){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(){}}]),l);function l(e,t){var r,n,i;return function(e,t){if(!babelHelpers.instanceof(e,t))throw new TypeError("Cannot call a class as a function")}(this,l),(n=this,r=!(i=s(l).call(this))||"object"!==a(i)&&"function"!=typeof i?function(){if(void 0!==n)return n;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():i).container=e,r.params=t,r.width=0,r.height=t.height*r.params.pixelRatio,r.lastPos=0,r.wrapper=null,r}t.default=u,e.exports=t.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n,i=(n=r(3))&&n.__esModule?n:{default:n};function a(e){return(a="function"==typeof Symbol&&"symbol"==babelHelpers.typeof(Symbol.iterator)?function(e){return babelHelpers.typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":babelHelpers.typeof(e)})(e)}function s(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function o(e,t,r){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(r):i.value}})(e,t,r||e)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(e){if(!e||!e.__esModule){var t={};if(null!=e)for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(e,r):{};n.get||n.set?Object.defineProperty(t,r,n):t[r]=e[r]}t.default=e}}(r(0));var c=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(h,i.default),s(h.prototype,[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer()}},{key:"createTimer",value:function(){var t=this;this.on("play",function e(){t.isPaused()||(t.fireEvent("audioprocess",t.getCurrentTime()),(window.requestAnimationFrame||window.webkitRequestAnimationFrame)(e))}),this.on("pause",function(){t.fireEvent("audioprocess",t.getCurrentTime())})}},{key:"load",value:function(e,t,r,n){var i=document.createElement(this.mediaType);i.controls=this.params.mediaControls,i.autoplay=this.params.autoplay||!1,i.preload=null==n?"auto":n,i.src=e,i.style.width="100%";var a=t.querySelector(this.mediaType);a&&t.removeChild(a),t.appendChild(i),this._load(i,r)}},{key:"loadElt",value:function(e,t){e.controls=this.params.mediaControls,e.autoplay=this.params.autoplay||!1,this._load(e,t)}},{key:"_load",value:function(e,t){var r=this;"function"==typeof e.load&&e.load(),e.addEventListener("error",function(){r.fireEvent("error","Error loading media element")}),e.addEventListener("canplay",function(){r.fireEvent("canplay")}),e.addEventListener("ended",function(){r.fireEvent("finish")}),e.addEventListener("play",function(){r.fireEvent("play")}),e.addEventListener("pause",function(){r.fireEvent("pause")}),this.media=e,this.peaks=t,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate),this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration)return this.explicitDuration;var e=(this.buffer||this.media).duration;return 1/0<=e&&(e=this.media.seekable.end(0)),e}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(e){this.playbackRate=e||1,this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(e){null!=e&&(this.media.currentTime=e),this.clearPlayEnd()}},{key:"play",value:function(e,t){this.seekTo(e);var r=this.media.play();return t&&this.setPlayEnd(t),r}},{key:"pause",value:function(){var e;return this.media&&(e=this.media.pause()),this.clearPlayEnd(),e}},{key:"setPlayEnd",value:function(t){var r=this;this._onPlayEnd=function(e){t<=e&&(r.pause(),r.seekTo(t))},this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}},{key:"getPeaks",value:function(e,t,r){return this.buffer?o(u(h.prototype),"getPeaks",this).call(this,e,t,r):this.peaks||[]}},{key:"setSinkId",value:function(e){return e?this.media.setSinkId?this.media.setSinkId(e):Promise.reject(new Error("setSinkId is not supported in your browser")):Promise.reject(new Error("Invalid deviceId: "+e))}},{key:"getVolume",value:function(){return this.volume||this.media.volume}},{key:"setVolume",value:function(e){this.volume=e,this.media.volume=this.volume}},{key:"destroy",value:function(){this.pause(),this.unAll(),this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}]),h);function h(e){var t,r,n;return function(e,t){if(!babelHelpers.instanceof(e,t))throw new TypeError("Cannot call a class as a function")}(this,h),(r=this,t=!(n=u(h).call(this,e))||"object"!==a(n)&&"function"!=typeof n?function(){if(void 0!==r)return r;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}():n).params=e,t.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0},t.mediaType=e.mediaType.toLowerCase(),t.elementPosition=e.elementPosition,t.peaks=null,t.playbackRate=1,t.volume=1,t.buffer=null,t.onPlayEnd=null,t}t.default=c,e.exports=t.default},function(e,t,r){"use strict";function n(e,t){for(var r,n=0;n<t.length;n++)(r=t[n]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=(n(a.prototype,[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[],this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(e,t,r){e!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=e);for(var n=[],i=0;i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<t;)i++;for(0==i%2&&n.push(t);i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<=r;)n.push(this.peakCacheRanges[i]),i++;0==i%2&&n.push(r),n=n.filter(function(e,t,r){return 0==t?e!=r[t+1]:t==r.length-1?e!=r[t-1]:e!=r[t-1]&&e!=r[t+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(n),this.peakCacheRanges=this.peakCacheRanges.sort(function(e,t){return e-t}).filter(function(e,t,r){return 0==t?e!=r[t+1]:t==r.length-1?e!=r[t-1]:e!=r[t-1]&&e!=r[t+1]});var a=[];for(i=0;i<n.length;i+=2)a.push([n[i],n[i+1]]);return a}},{key:"getCacheRanges",value:function(){var e,t=[];for(e=0;e<this.peakCacheRanges.length;e+=2)t.push([this.peakCacheRanges[e],this.peakCacheRanges[e+1]]);return t}}]),a);function a(){!function(e,t){if(!babelHelpers.instanceof(e,t))throw new TypeError("Cannot call a class as a function")}(this,a),this.clearPeakCache()}t.default=i,e.exports=t.default}],i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==babelHelpers.typeof(t)&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=4);function i(e){if(n[e])return n[e].exports;var t=n[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var r,n})</script><script>!function(e,t){"object"===("undefined"==typeof exports?"undefined":babelHelpers.typeof(exports))&&"object"===("undefined"==typeof module?"undefined":babelHelpers.typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define("microphone",[],t):"object"===("undefined"==typeof exports?"undefined":babelHelpers.typeof(exports))?exports.microphone=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.microphone=t())}(window,function(){return i={},n.m=r={"./src/plugin/microphone.js":function(e,t){"use strict";function i(e,t){for(var r,i=0;i<t.length;i++)(r=t[i]).enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}function r(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function i(e,t){var r=this;!function(e,t){if(!babelHelpers.instanceof(e,t))throw new TypeError("Cannot call a class as a function")}(this,i),this.params=e,this.stream=e.stream,this.wavesurfer=t,this.active=!1,this.paused=!1,this.browser=this.detectBrowser(),this.reloadBufferFunction=function(e){return r.reloadBuffer(e)},this.constraints=this.params.constraints||{video:!1,audio:!0},this.bufferSize=this.params.bufferSize||4096,this.numberOfInputChannels=this.params.numberOfInputChannels||1,this.numberOfOutputChannels=this.params.numberOfOutputChannels||1,this._onBackendCreated=function(){r.micContext=r.wavesurfer.backend.getAudioContext()}}return r(i,null,[{key:"create",value:function(e){return{name:"microphone",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,instance:i}}}]),r(i,[{key:"init",value:function(){this.wavesurfer.on("backend-created",this._onBackendCreated),this.wavesurfer.backend&&this._onBackendCreated()}},{key:"destroy",value:function(){this.paused=!0,this.wavesurfer.un("backend-created",this._onBackendCreated),this.stop()}},{key:"start",value:function(){var t=this;navigator.mediaDevices.getUserMedia(this.constraints).then(function(e){return t.gotStream(e)}).catch(function(e){return t.deviceError(e)})}},{key:"togglePlay",value:function(){this.active?(this.paused=!this.paused,this.paused?this.pause():this.play()):this.start()}},{key:"play",value:function(){this.paused=!1,this.connect()}},{key:"pause",value:function(){this.paused=!0,this.disconnect()}},{key:"stop",value:function(){this.active&&(this.stopDevice(),this.wavesurfer.empty())}},{key:"stopDevice",value:function(){if(this.active=!1,this.disconnect(),this.stream){if(("chrome"===this.browser.browser&&45<=this.browser.version||"firefox"===this.browser.browser&&44<=this.browser.version||"edge"===this.browser.browser||"safari"===this.browser.browser)&&this.stream.getTracks)return void this.stream.getTracks().forEach(function(e){return e.stop()});this.stream.stop()}}},{key:"connect",value:function(){void 0!==this.stream&&("edge"===this.browser.browser&&(this.localAudioBuffer=this.micContext.createBuffer(this.numberOfInputChannels,this.bufferSize,this.micContext.sampleRate)),this.mediaStreamSource=this.micContext.createMediaStreamSource(this.stream),this.levelChecker=this.micContext.createScriptProcessor(this.bufferSize,this.numberOfInputChannels,this.numberOfOutputChannels),this.mediaStreamSource.connect(this.levelChecker),this.levelChecker.connect(this.micContext.destination),this.levelChecker.onaudioprocess=this.reloadBufferFunction)}},{key:"disconnect",value:function(){void 0!==this.mediaStreamSource&&this.mediaStreamSource.disconnect(),void 0!==this.levelChecker&&(this.levelChecker.disconnect(),this.levelChecker.onaudioprocess=void 0),void 0!==this.localAudioBuffer&&(this.localAudioBuffer=void 0)}},{key:"reloadBuffer",value:function(e){if(!this.paused)if(this.wavesurfer.empty(),"edge"===this.browser.browser){var t,r;for(t=0,r=Math.min(this.localAudioBuffer.numberOfChannels,e.inputBuffer.numberOfChannels);t<r;t++)this.localAudioBuffer.getChannelData(t).set(e.inputBuffer.getChannelData(t));this.wavesurfer.loadDecodedBuffer(this.localAudioBuffer)}else this.wavesurfer.loadDecodedBuffer(e.inputBuffer)}},{key:"gotStream",value:function(e){this.stream=e,this.active=!0,this.play(),this.fireEvent("deviceReady",e)}},{key:"deviceError",value:function(e){this.fireEvent("deviceError",e)}},{key:"extractVersion",value:function(e,t,r){var i=e.match(t);return i&&i.length>=r&&parseInt(i[r],10)}},{key:"detectBrowser",value:function(){var e={browser:null,version:null,minVersion:null};return"undefined"!=typeof window&&window.navigator?navigator.mozGetUserMedia?(e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1),e.minVersion=31):navigator.webkitGetUserMedia?(e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2),e.minVersion=38):navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),e.minVersion=10547):window.RTCPeerConnection&&navigator.userAgent.match(/AppleWebKit\/(\d+)\./)?(e.browser="safari",e.minVersion=11,e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)):e.browser="Not a supported browser.":e.browser="Not a supported browser.",e}}]),i}();t.default=n,e.exports=t.default}},n.c=i,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"===babelHelpers.typeof(t)&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="localhost:8080/dist/plugin/",n(n.s="./src/plugin/microphone.js");function n(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return r[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var r,i})</script><dom-module id="yp-media-recorder"assetpath="../yp-media-recorder/"><template><style>video{}paper-dialog{background-color:#fff;}#dialog[audio-recording]{width:430px;}.mainbuttons{width:100%;margin-top:8px;margin-bottom:8px;}.horizontal{@apply --layout-horizontal;}.center-center{@apply --layout-center-center;}.flex{@apply --layout-flex;}.optionsButtons{margin-top:24px;}.uploadFileButton{width:180px;margin-bottom:20px;}.recording{color:#f00;animation-name:pulse;animation-duration:1.3s;animation-iteration-count:infinite;animation-timing-function:linear;}.recordingTime{color:#f00;animation-name:pulse;animation-duration:1s;animation-iteration-count:infinite;animation-timing-function:linear;}@keyframes pulse{from{opacity:1;}to{opacity:0.5;}}.buttonText{margin-left:6px;}.actionButton{color:var(--accent-color);}.iconButtons{margin-top:2px;}#secondsLeft{margin-top:12px;margin-left:4px;margin-right:4px;}.mainContainer{padding:0 24px;}@media (max-width: 640px){#dialog{padding:0;margin:0;@apply --layout-self-start;}.mainContainer{padding:0 0;}.mainbuttons{position:absolute;bottom:0;left:0;width:100%;background-color:rgba(240, 240, 240, 0.5);}#dialog{min-height:242px;min-width:320px;width:100%;}}@media (max-width: 360px){.uploadFileText{display:none;}}.rememberBox{margin-top:8px;}#checkBox{margin-left:6px;}.header{font-weight:bold;font-size:18px;margin-bottom:10px;}#waveform{height:128px;}[hidden]{display:none !important;}</style><paper-dialog id="selectDevices"modal=""><h2>[[selectDeviceTitle]]</h2><paper-dialog-scrollable><paper-listbox id="deviceListBox"><template is="dom-repeat"items="[[allDevices]]"><paper-item on-tap="selectDeviceFunction"id="[[item.deviceId]]">[[item.label]]</paper-item></template></paper-listbox><div class="layout horizontal rememberBox"><div>[[t('rememberDevice')]]</div><input id="checkBox"type="checkbox"></div></paper-dialog-scrollable></paper-dialog><paper-dialog id="noDevices"><h2>[[t('noDevicesFound')]]</h2><div class="button layout horizontal center-center"><paper-button dialog-dismiss=""raised="">[[t('ok')]]</paper-button></div></paper-dialog><paper-dialog id="optionsDialog"modal=""><div class="layout vertical center-center"><div class="layout vertical center-center optionsButtons"><div class="layout horizontal center-center"><paper-button raised=""dialog-confirm=""class="uploadFileButton"on-tap="_openRecorderDialog"><iron-icon icon="fiber-manual-record"></iron-icon><div class="buttonText">[[t('record')]]</div></paper-button></div><div class="layout horizontal center-center"><paper-button raised=""dialog-confirm=""class="uploadFileButton"on-tap="_uploadFile"><iron-icon icon="file-upload"></iron-icon><div class="buttonText">[[t('upload')]]</div></paper-button></div></div><div class="videoAspectDescription">[[t('videoFormat')]]</div><div><paper-radio-group name="aspect"hidden$="[[audioRecording]]"class="aspect layout horizontal wrap"selected="{{videoAspect}}"><paper-radio-button name="landscape">landscape</paper-radio-button><paper-radio-button name="portrait">portrait</paper-radio-button></paper-radio-group></div><div class="layout horizontal center-center"><paper-button dialog-dismiss="">[[t('cancel')]]</paper-button></div></div></paper-dialog><paper-dialog id="dialog"modal=""audio-recording$="[[audioRecording]]"><div class="layout vertical no-padding mainContainer"><template is="dom-if"if="[[videoRecording]]"><video id="videoRecorder"class="videoRecorder"hidden$="[[previewActive]]"></video><video id="videoPreviewer"preload="auto"class="videoRecorder"hidden$="[[!previewActive]]"></video></template><template is="dom-if"if="[[audioRecording]]"><div class="layout vertical center-center"><div class="layout horizontal center-center header">[[t('voiceRecorder')]]</div><div id="waveform"hidden$="[[recordedData]]"></div><audio id="audioRecorder"class="audioRecorder"hidden=""></audio><audio id="audioPreviewer"controls=""preload="auto"class="audioRecorder"hidden$="[[!previewActive]]"></audio></div></template><div class="layout horizontal mainbuttons"><paper-icon-button aria-label$="[[t('closeRecordingWindow')]]"icon="clear"class="iconButtons"on-tap="_close"></paper-icon-button><paper-icon-button aria-label$="[[t('deleteRecordedMedia')]]"icon="delete"class="iconButtons"on-tap="_deleteRecording"hidden$="[[!recordedData]]"></paper-icon-button><div class="layout horizontal"hidden$="[[!recorder]]"><paper-button on-tap="_startRecording"hidden$="[[recordedData]]"><iron-icon id="recordingIcon"icon="fiber-manual-record"></iron-icon><div class="buttonText">[[t('record')]]</div></paper-button><div id="secondsLeft"hidden$="[[recordedData]]">[[recordSecondsLeft]] [[t('seconds')]]</div><paper-button on-tap="_stopRecording"hidden$="[[!isRecording]]"><iron-icon icon="stop"></iron-icon><div class="buttonText">[[t('stop')]]</div></paper-button></div><paper-button on-tap="_sendBack"class="actionButton"hidden$="[[!recordedData]]"><iron-icon icon="send"></iron-icon><div class="buttonText">[[t('send')]]</div></paper-button></div></div><div hidden$="[[!error]]">[[error]]</div></paper-dialog><lite-signal on-lite-signal-yp-language="_languageEvent"></lite-signal><iron-ajax id="getTranslationAjax"on-response="_getTranslationResponse"></iron-ajax></template><script>var YpMediaRecorder=function(e){function i(){return babelHelpers.classCallCheck(this,i),babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(i).apply(this,arguments))}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"_selectAudioDevice",value:function(e){e.target.id&&this.set("selectedAudioDeviceId",e.target.id),this.$$("#checkBox").checked&&localStorage.setItem("selectedAudioDeviceId",this.selectedAudioDeviceId),this.$.selectDevices.close(),this._openMediaSession(this.captureCallback)}},{key:"_selectVideoDevice",value:function(e){e.target.id&&this.set("selectedVideoDeviceId",e.target.id),this.$$("#checkBox").checked&&localStorage.setItem("selectedVideoDeviceId",this.selectedVideoDeviceId),this.$.selectDevices.close(),this._checkAudioDevices()}},{key:"_checkAudioDevices",value:function(){this.audioDevices&&1<this.audioDevices.length?localStorage.getItem("selectedAudioDeviceId")?(this.set("selectedAudioDeviceId",localStorage.getItem("selectedAudioDeviceId")),this._openMediaSession(this.captureCallback)):(this.set("selectDeviceTitle",this.t("selectAudioDevice")),this.$$("#checkBox").checked=!1,this.selectDeviceFunction=this._selectAudioDevice.bind(this),this.set("allDevices",this.audioDevices),this.$$("#deviceListBox").selected=null,this.$.selectDevices.open()):this._openMediaSession(this.captureCallback)}},{key:"_checkVideoDevices",value:function(){this.videoRecording&&this.videoDevices&&1<this.videoDevices.length?localStorage.getItem("selectedVideoDeviceId")?(this.set("selectedVideoDeviceId",localStorage.getItem("selectedVideoDeviceId")),this._checkAudioDevices()):(this.set("selectDeviceTitle",this.t("selectVideoDevice")),this.$$("#checkBox").checked=!1,this.set("rememberDevice",!1),this.selectDeviceFunction=this._selectVideoDevice.bind(this),this.set("allDevices",this.videoDevices),this.$$("#deviceListBox").selected=null,this.$.selectDevices.open()):this._checkAudioDevices()}},{key:"_closeMediaStream",value:function(){this.mediaStream&&this.mediaStream.getTracks().forEach(function(e){e.stop()}),this.surfer&&(this.surfer.microphone.stop(),this.surfer.destroy()),this.set("previewActive",!1)}},{key:"_close",value:function(){this._closeMediaStream(),this.$.dialog.close()}},{key:"_uploadFile",value:function(){this._close(),this.uploadFileFunction(this.videoAspect)}},{key:"_uploadFileThroughPhoneCamera",value:function(){this._close(),this.uploadFileFunction(this.videoAspect,!0)}},{key:"_sendBack",value:function(){this.callbackFunction&&this.recorder?(this.callbackFunction(this.recordedData),this.recordedData=null,this.recorder.clearRecordedData(),this.recorder.reset(),this.recorder=null,this._close()):console.error("No callback function for media player")}},{key:"checkDevices",value:function(){navigator.mediaDevices.enumerateDevices().then(function(e){this.audioDevices=e.filter(function(e){return"audioinput"===e.kind}),this.videoDevices=e.filter(function(e){return"videoinput"===e.kind});var i=!1;this.videoDevices.forEach(function(e){e.label&&""!=e.label&&(i=!0)}),i||(this.videoDevices=null,this.audioDevices=null),this._checkVideoDevices()}.bind(this))}},{key:"captureUserMedia",value:function(e){this.captureCallback=e,this.checkDevices()}},{key:"_openMediaSession",value:function(i){this.selectedVideoDeviceId&&(this.videoSettings.deviceId=this.selectedVideoDeviceId);var e={audio:!this.selectedAudioDeviceId||{deviceId:this.selectedAudioDeviceId},video:this.videoRecording?this.videoSettings:null};/firefox/.test(navigator.userAgent.toLowerCase())&&!window.MSStream?navigator.getUserMedia(e,function(e){i(e)},function(e){console.error(e),i(null)}):navigator.mediaDevices.getUserMedia(e).then(function(e){e.getTracks().forEach(function(e){console.info(e.getCapabilities())}),i(e)}).catch(function(e){console.error(e),i(null)})}},{key:"$$",value:function(e){return this.shadowRoot.querySelector(e)}},{key:"open",value:function(e){this.callbackFunction=e.callbackFunction,this.set("recordingFinished",!1),this.set("error",null),this.set("audioRecording",!1),this.set("videoRecording",!1),e.videoRecording?this.set("videoRecording",!0):e.audioRecording&&this.set("audioRecording",!0),this.set("maxLength",e.maxLength),this.set("uploadFileFunction",e.uploadFileFunction),this.$$("#secondsLeft").className="",this.videoRecording?this.$.optionsDialog.open():this.audioRecording&&setTimeout(function(){this._openRecorderDialog()}.bind(this))}},{key:"_openRecorderDialog",value:function(){if(this.videoRecording&&this.isMobile)this._uploadFileThroughPhoneCamera();else if(this.videoRecording){var e,i,t=this.shadowRoot.querySelector("#videoRecorder"),o=this.shadowRoot.querySelector("#videoPreviewer");if(window.innerHeight>window.innerWidth)this.set("videoSettings",{width:720,height:1280}),i=Math.min(1280,Math.abs(window.innerHeight)).toFixed(),e=Math.min(720,Math.abs(.5625*i)).toFixed(),console.info("Portrait - width: "+e+" height: "+i+" video width: 720 height: 1280");else{this.set("videoSettings",{width:1280,height:720});var s=.8;window.innerHeight<700&&(s=.7),window.innerHeight<500&&(s=.6),i=Math.min(720,Math.abs(window.innerHeight*s)).toFixed(),e=Math.min(1280,Math.abs(1.77777777778*i)).toFixed(),console.info("Landscape - width: "+e+" height: "+i)}t.style.height=i+"px",t.style.width=e+"px",o.style.height=(.8*i).toFixed()+"px",o.style.width=(.8*e).toFixed()+"px"}!this.audioRecording&&this.isMobile||(setTimeout(function(){this.$.dialog.open()}.bind(this)),setTimeout(function(){this.setupRecorders()}.bind(this),20))}},{key:"_generateRandomString",value:function(){if(window.crypto){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),i="",t=0,o=e.length;t<o;t++)i+=e[t].toString(36);return i}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}},{key:"_startRecording",value:function(){this.isRecording?this._stopRecording():(this.recorder.startRecording(),this.recordSecondsLeft=this.maxLength,this.set("isRecording",!0),this.$$("#recordingIcon").className="recording",this._recordingTimer())}},{key:"_stopRecording",value:function(){this.$$("#recordingIcon").className="",this.set("isRecording",!1),this.recorder.stopRecording(this._storeRecordedData.bind(this)),this.$$("#secondsLeft").className=""}},{key:"_deleteRecording",value:function(){this.recorder.reset(),this.set("previewActive",!1),this.set("recordedData",null),this.recordSecondsLeft=this.maxLength,this.$$("#secondsLeft").className="",this.$$("#recordingIcon").className=""}},{key:"_storeRecordedData",value:function(){var e,i=this.recorder.getBlob();if(this.videoRecording){var t=this.shadowRoot.querySelector("#videoRecorder"),o=this.shadowRoot.querySelector("#videoPreviewer");e=this._generateRandomString()+".webm",this.recordedData=new File([i],e,{type:"video/webm"}),t.controls=!0,this.recorder.reset(),o.src=window.URL.createObjectURL(this.recordedData),o.controls=!0,this.set("previewActive",!0)}else if(this.audioRecording){var s=this.shadowRoot.querySelector("#audioRecorder"),c=this.shadowRoot.querySelector("#audioPreviewer");e=this._generateRandomString()+".mp3",this.recordedData=new File([i],e,{type:"audio/mp3"}),s.controls=!0,s.pause(),c.src=window.URL.createObjectURL(this.recordedData),c.controls=!0,this.set("previewActive",!0)}}},{key:"_recordingTimer",value:function(){this.isRecording?setTimeout(function(){this.isRecording&&(0<this.recordSecondsLeft?this._recordingTimer():this._stopRecording(),0<this.recordSecondsLeft&&(this.recordSecondsLeft-=1),this.recordSecondsLeft<=5&&(this.$$("#secondsLeft").className="recordingTime"))}.bind(this),1e3):console.error("_recordingTimer called without in recording mode")}},{key:"setupRecorders",value:function(){if(this.recordSecondsLeft=this.maxLength,this.videoRecording){var t=this.shadowRoot.querySelector("#videoRecorder");this.captureUserMedia(function(i){if(i){this.mediaStream=i;try{t.srcObject=i}catch(e){console.error(e),t.src=window.URL.createObjectURL(i)}t.play(),t.muted=!0,t.controls=!1,this.recorder=RecordRTC(i,{type:"video"})}else console.error("Can't find stream"),this.$.noDevices.open()}.bind(this))}else if(this.audioRecording){var o=this.shadowRoot.querySelector("#audioRecorder");this.captureUserMedia(function(i){if(i){this.mediaStream=i;try{o.srcObject=i}catch(e){console.error(e),o.src=window.URL.createObjectURL(i)}o.play(),o.muted=!0,o.controls=!1,this.surfer=WaveSurfer.create({container:this.$$("#waveform"),waveColor:"#ff3d00",progressColor:"#ff3d00",cursorWidth:0,plugins:[WaveSurfer.microphone.create({stream:this.mediaStream})]}),this.surfer.microphone.play(),this.recorder=RecordRTC(i,{type:"audio"})}else console.error("Can't find stream"),this.$.noDevices.open()}.bind(this))}setTimeout(function(){this.$.dialog.center()}.bind(this))}},{key:"ready",value:function(){window.i18nTranslation&&this.set("language",window.locale),babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"ready",this).call(this),window.innerHeight>window.innerWidth?this.videoAspect="portrait":this.videoAspect="landscape",(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||window.matchMedia("only screen and (max-width: 480px)").matches)&&this.set("isMobile",!0)}},{key:"_languageEvent",value:function(e,i){"language-loaded"===i.type&&this.set("language",i.language)}}],[{key:"is",get:function(){return"yp-media-recorder"}},{key:"properties",get:function(){return{recorder:{type:Object,value:null},mediaStream:Object,audioRecording:{type:Boolean,value:!1},videoRecording:{type:Boolean,value:!1},maxLength:{type:Number,value:5},recordedData:{type:Object,value:null},recordingFinished:{type:Boolean,value:!1},callbackFunction:{type:Function,value:null},error:{type:String,value:null},recordSecondsLeft:Number,isRecording:{type:Boolean,value:!1},rememberDevice:{type:Boolean,value:!1},audioDevices:Array,videoDevices:Array,allDevices:Array,captureCallback:Function,uploadFileFunction:Function,captureStream:Object,previewActive:{type:Boolean,value:!1},videoOptions:Object,selectDeviceTitle:String,selectDeviceFunction:{type:Function,value:null},surfer:{type:Object,value:null},aspect:{type:String,value:"portrait"},selectedCamera:{type:String,value:"user"},hasFacingMode:{type:Boolean,value:!1},isMobile:{type:Boolean,value:!1}}}}]),i}(Polymer.mixinBehaviors([Polymer.ypLanguageBehavior],Polymer.Element));customElements.define(YpMediaRecorder.is,YpMediaRecorder)</script></dom-module></div>